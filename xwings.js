var phase=0;var round=1;var skillturn=0;var waitingforaction=false;var tabskill;var SETUP_PHASE=0,PLANNING_PHASE=1,ACTIVATION_PHASE=2,COMBAT_PHASE=3;var DICES=["focusred","hitred","criticalred","blankred","focusgreen","evadegreen","blankgreen"];var ROCKS=[];var PATTERN;function loadrock(){PATTERN=s.image("img/asteroid.jpg",0,0,200,200).pattern(0,0,200,200);var a;for(a=1;a<=6;a++){Snap.load("data/rock"+a+".svg",function(b){ROCKS.push(new Rock(a,b))})}}function Rock(c,b){var a;this.g=b.select("path");this.g.attr({fill:PATTERN,strokeWidth:0,stroke:"#F00",});this.name="Asteroid #"+c;this.arraypts=[];for(a=0;a<this.g.getTotalLength();a+=5){this.arraypts.push(this.g.getPointAtLength(a))}this.dragged=false;this.m=(new Snap.Matrix()).add(MT(300+Math.random()*300,100+600*Math.random())).add(MS(0.5,0.5));this.g.drag(this.dragmove.bind(this),this.dragstart.bind(this),this.dragstop.bind(this));this.path="";this.g.hover(function(){this.g.attr({strokeWidth:4})}.bind(this),function(){this.g.attr({strokeWidth:0})}.bind(this));this.show()}Rock.prototype={getrangeallunits:function(){return Unit.prototype.getrangeallunits.call(this)},getrange:function(a){return Unit.prototype.getrange.call(this,a)},gethitrangeallunits:function(){return[[],[],[],[]]},togglehitsector:function(){},togglerange:function(){},getOutlinePoints:function(){var a;var b=[];for(a=0;a<this.arraypts.length;a++){b.push(transformPoint(this.m,this.arraypts[a]))}return b},getOutline:function(){var a;this.path="M ";for(a=0;a<this.arraypts.length;a++){var c=transformPoint(this.m,this.arraypts[a]);this.path+=c.x+" "+c.y+" ";if(a==0){this.path+=" L "}}this.path+="Z";var b=s.path(this.path).attr({display:"none"});b.appendTo(s);return b},turn:function(a){this.m.add(MR(a,0,0));this.show()},unselect:function(){},select:function(){},dragmove:function(c,b,a,d){this.dragMatrix=MT(c,b).add(this.m);this.dragged=true;this.g.transform(this.dragMatrix)},dragstart:function(b,d,c){this.dragged=false;var c=activeunit;activeunit=this;this.select();c.unselect()},dragstop:function(b){var c;if(this.dragged){this.m=this.dragMatrix}this.dragged=false},show:function(){this.g.transform(this.m);this.g.appendTo(s)}};function center(){var a=activeunit.g.getBBox();$("#playmat").scrollLeft(a.x-window.innerWidth/2+a.width/2);$("#playmat").scrollTop(a.y-window.innerHeight/2+a.height/2)}function prevselect(){if(waitingforaction){return}var a=activeunit;if(phase==ACTIVATION_PHASE||phase==COMBAT_PHASE){if(skillturn==-1){return}active=(active==0)?tabskill[skillturn].length-1:active-1;tabskill[skillturn][active].select()}else{active=(active==0)?squadron.length-1:active-1;squadron[active].select()}a.unselect()}function nextselect(){if(waitingforaction){return}var a=activeunit;if(phase==ACTIVATION_PHASE||phase==COMBAT_PHASE){if(skillturn==-1){return}active=(active==tabskill[skillturn].length-1)?0:active+1;tabskill[skillturn][active].select()}else{active=(active==squadron.length-1)?0:active+1;squadron[active].select()}a.unselect()}function hitrangetostr(b,a){var n="";var g,f,e,l;for(l=0;l<squadron.length;l++){if(squadron[l]==activeunit){break}}for(g=1;g<=3;g++){if(b[g].length>0){for(f=0;f<b[g].length;f++){var e=b[g][f].unit;n+="<div><div>"+g+"</div>";n+=squadron[e];if(a){n+="<div></div><div></div><div></div></div>";for(w=0;w<b[g][f].wp.length;w++){var q=activeunit.weapons[w];n+="<div><div></div><div>Weapon</div>";var d=activeunit.evaluatetohit(w,squadron[e]);if(d==undefined){break}var c;if(q.isprimary){if(q.type=="Turret"){c="<p class='Turretlaser'></p>"}else{c="<p class='Laser'></p>"}}else{c="<p class='"+q.type+"'></p>"}var m=d.tokill[b[g][f].hull+b[g][f].shield];if(typeof m=="undefined"){m=0}else{m=Math.round(m*10000)/100}n+="<div>"+c+q.name+"</div>";n+="<div>"+d.tohit+"% to hit</div><div>"+d.meanhit+"<p class='hit'></p></div><div>"+d.meancritical+"<p class='critical'></p></div><div>"+m+"% to kill</div>";if(phase==COMBAT_PHASE&&skillturn==activeunit.skill&&activeunit.canfire()){n+="<div><a href='#combatmodal' onclick=\"resolvecombat("+e+","+w+")\" class='bigbutton'>Fire!</a></div>"}else{n+="<div></div>"}n+="</div>"}}else{n+="</div>"}}}}if(n==""){n="No unit in range of "+activeunit.name;activeunit.istargeting=false}else{var o="<div><div>Range</div><div>Name</div><div>Stats</div><div>Points</div><div>Tokens</div>";if(a){o+="<div></div><div></div>"}n=o+"<div></div></div>"+n}return n}function resolvecombat(b,a){targetunit=squadron[b];activeunit.weapons[a].fire(targetunit);$("#attacker").html(""+activeunit);$("#defender").html(""+targetunit);activeunit.resolvefire(a)}function inrange(){$("#listtitle").html("Units in range of "+activeunit.name);$("#listunits").html(hitrangetostr(activeunit.getrangeallunits(),false));window.location="#modal"}function inhitrange(){$("#listtitle").html("Units in weapon range of "+activeunit.name);$("#listunits").html(hitrangetostr(activeunit.gethitrangeallunits(),true));window.location="#modal"}function help(){$("#listtitle").html("This is the help page");$("#listunits").html("")}function unitstostr(){var e;var d,a;var c={REBEL:"",EMPIRE:"",SCUM:""};for(d=0;d<squadron.length;d++){var b=squadron[d];c[b.faction]+="<div><div><p class='"+b.faction+"'></p></div>"+b+"</div>"}e="<div><div></div><div>Names</div><div>Stats</div><div>Points</div><div>Tokens</div></div>"+c.REBEL+c.EMPIRE+c.SCUM;return e}function allunitlist(){$("#listtitle").html("List of units");$("#listunits").html(unitstostr());window.location="#modal"}function usecloak(){if((phase==ACTIVATION_PHASE)&&(activeunit.stress==0)&&!activeunit.hasmoved){activeunit.resolveuncloak();activeunit.show()}}function usefocus(b){if(phase==COMBAT_PHASE&&activeunit.hasfired){if(activeunit==squadron[b]){activeunit.resolvefocus();activeunit.show();var a=$(".focusreddice").length;$(".focusreddice").remove();for(b=0;b<a;b++){$("#attack").append("<b class='hitreddice'></b>")}}else{targetunit.resolvefocus();targetunit.show();var a=$(".focusgreendice").length;$(".focusgreendice").remove();for(b=0;b<a;b++){$("#defense").append("<b class='evadegreendice'></b>")}}}}function usetarget(b){if(phase==COMBAT_PHASE&&activeunit.hasfired&&squadron[b]==activeunit){if(targetunit==activeunit.targeting){var a=$(".blankreddice").length;$(".blankreddice").remove();activeunit.target--;activeunit.show();targetunit.istargeted--;targetunit.show();if(activeunit.focus==0){a+=$(".focusreddice").length;$(".focusreddice").remove()}reroll(a,true)}}}function useevade(a){if(phase==COMBAT_PHASE&&activeunit.hasfired&&squadron[a]==targetunit){targetunit.evade--;targetunit.show();$("#defense").append("<b class='evadegreendice'></b>")}}function nextcombat(){var c,b=0,d=0;var a=activeunit;while(b==0&&skillturn>=0){for(c=0;c<tabskill[skillturn].length;c++){if(tabskill[skillturn][c].canfire()){b++;d=c;break}}if(b==0){skillturn--;while(skillturn>=0&&tabskill[skillturn].length==0){skillturn--}}}if(skillturn==-1){log("No more firing units, ready to end phase.");return}b=tabskill[skillturn].length;active=d;tabskill[skillturn][d].select();activeunit.show();a.unselect()}function nextactivation(){var b=0,d=0,c;if(skillturn>12){return}for(c=0;c<tabskill[skillturn].length;c++){if(tabskill[skillturn][c].maneuver!=-1){b++;d=c}}if(b==0){skillturn++;while(skillturn<13&&tabskill[skillturn].length==0){skillturn++}if(skillturn==13){waitingforaction=true;return}b=tabskill[skillturn].length;d=0}var a=activeunit;active=d;tabskill[skillturn][d].select();a.unselect();activeunit.show()}function resolveaction(){if(activeunit.resolveaction()){unbind("action")}}function nextaction(){activeunit.updateactionlist();activeunit.maneuver=-1;if(activeunit.actionList.length==1){activeunit.action=0;resolveaction()}else{waitingforaction=true;bindall("action")}}function showfire(a,c){var b;for(b=0;b<DICES.length;b++){$("."+DICES[b]+"dice").remove()}for(b=0;b<a.length;b++){$("#attack").append("<b class='"+a[b]+"reddice'></b>")}for(b=0;b<c.length;b++){$("#defense").append("<b class='"+c[b]+"greendice'></b>")}}function reroll(d,c){var a;for(a=0;a<d;a++){var b=Math.floor(Math.random()*7);if(c){$("#attack").append("<b class='"+FACE[ATTACKDICE[b]]+"reddice'></b>")}else{$("#defense").append("<b class='"+FACE[ATTACKDICE[b]]+"reddice'></b>")}}}function enablenextphase(){var a;var b=true;switch(phase){case PLANNING_PHASE:for(a=0;a<squadron.length;a++){if(squadron[a].maneuver<0){b=false;break}}if(b&&$(".nextphase").prop("disabled")){log("All units have planned a maneuver, ready to end phase")}break;case ACTIVATION_PHASE:for(a=0;a<squadron.length;a++){if(squadron[a].maneuver>=0){b=false;break}}if(b&&$(".nextphase").prop("disabled")){log("All units have been activated, ready to end phase")}break}if(b){$(".nextphase").prop("disabled",false)}return b}function resolvedamage(){window.location="#";$("#listunits").html("");if(activeunit.hasfired&&!activeunit.hasdamaged){activeunit.resolvedamage();nextcombat()}else{}}function applymaneuver(){if(activeunit.maneuver>-1&&activeunit.skill==skillturn){waitingforaction=true;unbind("phase2");activeunit.resolvemaneuver()}}var keybindings={phase0:[{k:"t",f:function(){activeunit.turn(45)}},{k:"shift+t",f:function(){activeunit.turn(-45)}},{k:"b",f:function(){activeunit.turn(5)}},{k:"shift+b",f:function(){activeunit.turn(-5,0,0)}}],phase1:[{k:"m",f:function(){activeunit.nextmaneuver()}},{k:"shift+m",f:function(){activeunit.prevmaneuver()}}],phase2:[{k:"enter",f:applymaneuver}],phase3:[{k:"enter",f:resolvedamage}],action:[{k:"a",f:function(){if(!activeunit.actiondone&&activeunit.hasmoved&&activeunit.skill==skillturn){activeunit.nextaction();activeunit.showaction()}}},{k:"shift+a",f:function(){if(!activeunit.actiondone&&activeunit.hasmoved&&activeunit.skill==skillturn){activeunit.prevaction();activeunit.showaction()}}},{k:"enter",f:function(){if(phase==ACTIVATION_PHASE&&!activeunit.actiondone&&activeunit.hasmoved&&activeunit.skill==skillturn){resolveaction()}}}],select:[{k:"tab",f:nextselect},{k:"shift+tab",f:prevselect}]};function actioncomplete(){bindall("phase2");$("#actionbutton").prop("disabled",true);enablenextphase();waitingforaction=false;activeunit.actiondone=true;nextactivation()}function maneuvercomplete(){activeunit.hasmoved=true;$("#manbutton").prop("disabled",true);nextaction();activeunit.showaction()}function firecomplete(a){$("#primary").prop("disabled",true);showfire(a.detail.ar,a.detail.dr)}document.addEventListener("actioncomplete",actioncomplete,false);document.addEventListener("maneuvercomplete",maneuvercomplete,false);document.addEventListener("firecomplete",firecomplete,false);function bind(a,d,b){$(document.body).bind("keydown."+a,jwerty.event(d,b))}function unbind(a){$(document.body).unbind("keydown."+a)}function bindall(b){var c=keybindings[b];var a;for(a=0;a<c.length;a++){bind(b,c[a].k,c[a].f)}}var phasetext=["End setup","End planning","End activation","End combat","Next round"];SOUNDS=["xwing_fire","xwing_fly","ywing_fly","tie_fire","tie_fly","isd_fly","slave_fire","slave_fly","falcon_fire","falcon_fly","yt2400_fly"];function nextphase(){var b;if(!enablenextphase()){return}window.location="#";switch(phase){case SETUP_PHASE:activeunit.g.undrag();for(b=0;b<SOUNDS.length;b++){$("#"+SOUNDS[b]).trigger("load")}$(".nextphase").prop("disabled",true);$(".xwingship").css("cursor","pointer");$("#panel_SETUP").hide();for(b=0;b<ROCKS.length;b++){ROCKS[b].g.undrag()}break;case PLANNING_PHASE:$(".nextphase").prop("disabled",true);$("#panel_PLANNING").hide();break;case ACTIVATION_PHASE:$("#panel_ACTIVATION").hide();for(b=0;b<squadron.length;b++){squadron[b].hasmoved=false;squadron[b].actiondone=false}break;case COMBAT_PHASE:$("#panel_COMBAT").hide();$("#listunits").html("");for(b=0;b<squadron.length;b++){squadron[b].focus=squadron[b].evade=0;squadron[b].hasfired=false;squadron[b].showinfo()}round++;break}waitingforaction=false;phase=(phase==COMBAT_PHASE)?PLANNING_PHASE:phase+1;for(b=0;b<squadron.length;b++){squadron[b].unselect()}for(b=SETUP_PHASE;b<=COMBAT_PHASE;b++){if(b!=phase){unbind("phase"+b)}else{bindall("phase"+b)}}switch(phase){case SETUP_PHASE:log("<div>[turn "+round+"] Setup phase</div>");$(".xwingship").css("cursor","move");$("#panel_SETUP").show();bindall("select");var a=activeunit;squadron[0].select();a.unselect();break;case PLANNING_PHASE:log("<div>[turn "+round+"] Planning phase</div>");$("#manbutton").attr({onclick:"activeunit.nextmaneuver();"});$("#msg").html("Set maneuver for each unit.");$("#panel_PLANNING").show();$("#actionbutton").prop("disabled",true);var a=activeunit;squadron[0].select();a.unselect();break;case ACTIVATION_PHASE:log("<div>[turn "+round+"] Activation phase</div>");$("#manbutton").attr({onclick:"applymaneuver();"});$("#msg").html("Launch maneuver, select action and resolve it.");$("#panel_ACTIVATION").show();tabskill=[];for(b=0;b<=12;b++){tabskill[b]=[]}for(b=0;b<squadron.length;b++){tabskill[squadron[b].skill].push(squadron[b])}skillturn=0;nextactivation();break;case COMBAT_PHASE:log("<div>[turn "+round+"] Combat phase</div>");$("#panel_COMBAT").show();skillturn=12;nextcombat();break}activeunit.show()}function log(a){$("footer").append("<div>"+a+"<div>").scrollTop(10000)}function importonesquadron(m,c){var h=["turret","torpedo","mod","title","elite","astromech","missile","crew","cannon","bomb","system","illicit","salvaged"];var f,e,d;var a=0;for(f=0;f<m.pilots.length;f++){var g=m.pilots[f];var b;b=Pilot(PILOT_dict[g.name]);b.team=1;squadron.push(b);if(typeof g.upgrades!="undefined"){for(e=0;e<h.length;e++){var l=g.upgrades[h[e]];if(typeof l!="undefined"){for(d=0;d<l.length;d++){Upgrade(b,UPGRADE_dict[l[d]])}}}}if(c==1){b.m.add(MT(80,70+82*a)).add(MR(90,0,0))}else{b.m.add(MT(800,70+82*a)).add(MR(-90,0,0))}a++;b.show()}}function importsquadron(h,g){var e,c;try{e=$.parseJSON(h)}catch(f){alert("JSON error for 1st squad:"+f.message);return}try{c=$.parseJSON(g)}catch(f){alert("JSON error for 2nd squad:"+f.message);return}var d,b,a;if(squadron.length>0){for(d=0;d<squadron.length;d++){squadron[d].g.remove()}}squadron=[];importonesquadron(e,1);importonesquadron(c,2);squadron.sort(function(j,i){return j.skill-i.skill});squadron[0].select()}jwerty.key("l",allunitlist);jwerty.key("r",inrange);jwerty.key("w",inhitrange);jwerty.key("s",function(){activeunit.togglehitsector()});jwerty.key("shift+s",function(){activeunit.togglerange()});jwerty.key("x",function(){window.location="#"});jwerty.key("escape",nextphase);jwerty.key("c",center);jwerty.key("1",function(){activeunit.focus++;activeunit.show()});jwerty.key("2",function(){activeunit.evade++;activeunit.show()});jwerty.key("3",function(){if(!activeunit.iscloaked){activeunit.iscloaked=true;activeunit.ship.evade+=2;activeunit.show()}});jwerty.key("4",function(){activeunit.stress++;activeunit.show()});var a1=[];a1[0]=2/8;a1[1]=3/8;a1[10]=1/8;a1[100]=2/8;var d1=[];d1[0]=3/8;d1[1]=3/8;d1[10]=2/8;function addattackdice(l,d){var e,j,b,a;var g=[];for(e=0;e<l;e++){for(b=0;b<l-e;b++){for(j=0;j<l-b-e;j++){a=100*e+b+10*j;g[a]=0;g[a+1]=0;g[a+10]=0;g[a+100]=0}}}for(e=0;e<l;e++){for(b=0;b<l-e;b++){for(j=0;j<l-b-e;j++){a=100*e+b+10*j;g[a]+=d[a]*a1[0];g[a+1]+=d[a]*a1[1];g[a+10]+=d[a]*a1[10];g[a+100]+=d[a]*a1[100]}}}return g}function adddefensedice(h,b){var c,g,a;var d=[];for(c=0;c<h;c++){for(g=0;g<h-c;g++){a=10*c+g;d[a]=0;d[a+1]=0;d[a+10]=0}}for(c=0;c<h;c++){for(g=0;g<h-c;g++){a=10*c+g;d[a]+=b[a]*d1[0];d[a+1]+=b[a]*d1[1];d[a+10]+=b[a]*d1[10]}}return d}function attackproba(c){var a;var b=[];b[0]=a1[0];b[1]=a1[1];b[10]=a1[10];b[100]=a1[100];for(a=2;a<=c;a++){b=addattackdice(a,b)}return b}function defenseproba(c){var a;var b=[];b[0]=d1[0];b[1]=d1[1];b[10]=d1[10];for(a=2;a<=c;a++){b=adddefensedice(a,b)}return b}function attackwithreroll(t,e,q){var x,u,z,g,y,m,o,l,A;var d=[];if(t.istargeting){this.reroll=this.weapon[0].attack}if(t.reroll==0){return e}if(typeof t.reroll=="undefined"){return e}for(x=0;x<=q;x++){for(u=0;u<=q-x;u++){for(z=0;z<=q-u-x;z++){o=100*x+u+10*z;d[o]=0}}}var n=0,a;for(x=0;x<=q;x++){for(u=0;u<=q-x;u++){for(z=0;z<=q-u-x;z++){o=100*x+u+10*z;A=q-u-z-x;a=t.reroll;n=x;if(t.reroll>A){if(t.focus==0){if(t.reroll>x+A){a=x+A;n=0}else{n=x-(a-A)}}else{a=A}}if(a==0){d[o]+=e[o]}else{var v=0;for(g=0;g<=a;g++){for(y=0;y<=a-g;y++){for(m=0;m<=a-g-y;m++){l=100*g+y+10*m;k=100*(n+g)+u+y+10*(z+m);d[k]+=e[o]*ATTACK[a][l]}}}}}}}return d}function tohitproba(D,y,q,r,z,b){var u=[];var v=[];var F,C,I,H,t,G,A,x,E,n;var o=0,B=0,g=0;var m=q;var l=D.reroll;var r=(b==0)?[]:r;for(C=0;C<=z;C++){for(I=0;I<=z-C;I++){A=C+10*I;u[A]=0}}if(typeof m=="undefined"){return{proba:[],tohit:0,meanhit:0,meancritical:0,tokill:0}}m=attackwithreroll(D,q,z);for(x=0;x<10;x++){v[x]=0}for(F=0;F<=z;F++){for(C=0;C<=z-F;C++){for(I=0;I<=z-C-F;I++){var J=m[100*F+C+10*I];for(t=0;t<=b;t++){for(G=0;G<=b-t;G++){if(b==0){H=1}else{H=r[10*t+G]}n=G;E=C;A=0;if(y.evade>0){n+=1}if(y.focus>0){n+=t}if(D.focus>0){E+=F}if(E>n){A=E-n;n=0}else{n=n-E}if(I>n){A+=10*(I-n)}u[A]+=J*H}}}}}for(C=0;C<=z;C++){for(I=0;I<=z-C;I++){A=C+10*I;if(I+C>0){o+=u[A]}B+=C*u[A];g+=I*u[A];for(x=1;x<=I+C;x++){v[x]+=u[A]}}}return{proba:u,tohit:Math.round(o*10000)/100,meanhit:o==0?0:Math.round(B*100/o)/100,meancritical:o==0?0:Math.round(g/o*100)/100,tokill:v}}function probatable(b,a){var e,d;var g="";for(e=1;e<=5;e++){g+="<tr><td>"+e+"</td>";for(d=0;d<=5;d++){var c=d;if(a.adddice>0){c+=a.adddice}var f=tohitproba(b,a,ATTACK[e],DEFENSE[c],e,c);g+="<td class='probacell' style='background:hsl("+(1.2*(100-f.tohit))+",100%,80%)'>";g+="<div>"+f.tohit+"%</div><div><b class='symbols'>d</b>"+f.meanhit+"</div><div><b class='symbols'>c</b>"+f.meancritical+"</div></td>"}g+="</tr>"}return g}function fillprobatable(){var b={focus:$("#focusA").prop("checked")?1:0,reroll:$("#targetA").prop("checked")?5:0};var a={focus:$("#focusD").prop("checked")?1:0,evade:$("#evadeD").prop("checked")?1:0,adddice:$("#cloakD").prop("checked")?2:0,reroll:0};var e;e=parseInt("0"+$("#rerollA",10).val());var c=parseInt($("0#rerollD",10).val());if(b.reroll==0||(e>0&&e<b.reroll)){b.reroll=e}if(a.reroll==0||(c>0&&c<a.reroll)){a.reroll=c}var d="<tr><th>Rolls</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>"+probatable(b,a);$("#probatable").html(d)}var dice=1;var ATTACK=[];var DEFENSE=[];var SQUAD=['{"description":"xwings/awings","faction":"rebels","name":"Unnamed Squadron","pilots":[{"name":"tychocelchu","points":24,"ship":"awing","upgrades":{"missile":["chardaanrefit"]}},{"name":"lukeskywalker","points":32,"ship":"xwing","upgrades":{"torpedo":["protontorpedoes"]}},{"name":"wedgeantilles","points":29,"ship":"xwing"},{"name":"prototypepilot","points":15,"ship":"awing","upgrades":{"missile":["chardaanrefit"]}}],"points":100,"vendor":{"yasb":{"builder":"(Yet Another) X-Wing Miniatures Squad Builder","builder_url":"http://geordanr.github.io/xwing/","link":"http://geordanr.github.io/xwing/?f=Rebel%20Alliance&d=v3!s!29:-1,72:-1:-1:;5:-1,1,-1:-1:-1:;0:-1,-1,-1:-1:-1:;32:72:-1:-1:"}},"version":"0.2.0"}','{"description":"","faction":"empire","name":"Unnamed Squadron","pilots":[{"name":"maulermithel","points":17,"ship":"tiefighter"},{"name":"backstabber","points":16,"ship":"tiefighter"},{"name":"howlrunner","points":18,"ship":"tiefighter"},{"name":"academypilot","points":12,"ship":"tiefighter"},{"name":"bountyhunter","points":37,"ship":"firespray31","upgrades":{"cannon":["manglercannon"]}}],"points":100,"vendor":{"yasb":{"builder":"(Yet Another) X-Wing Miniatures Squad Builder","builder_url":"http://geordanr.github.io/xwing/","link":"http://geordanr.github.io/xwing/?f=Galactic%20Empire&d=v3!s!17:-1:-1:-1:;15::-1:-1:;18:-1:-1:-1:;10::-1:-1:;40:110,-1,-1,-1:-1:-1:"}},"version":"0.2.0"}'];$(document).ready(function(){s=Snap("#svgout");P={F0:{path:s.path("M 0 0 L 0 0"),speed:0,key:"5"},F1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"8"},F2:{path:s.path("M 0 0 L 0 -120"),speed:2,key:"8"},F3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"8"},F4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"8"},F5:{path:s.path("M 0 0 L 0 -240"),speed:5,key:"8"},TR1:{path:s.path("M0 0 C 0 -40 15 -55 55 -55"),speed:1,key:"6"},TR2:{path:s.path("M0 0 C 0 -50 33 -83 83 -83"),speed:2,key:"6"},TR3:{path:s.path("M0 0 C 0 -60 45 -105 105 -105"),speed:3,key:"6"},TL1:{path:s.path("M0 0 C 0 -40 -15 -55 -55 -55"),speed:1,key:"4"},TL2:{path:s.path("M0 0 C 0 -50 -33 -83 -83 -83"),speed:2,key:"4"},TL3:{path:s.path("M0 0 C 0 -60 -45 -105 -105 -105"),speed:3,key:"4"},BR1:{path:s.path("M0 0 C 0 -20 18 -72 38 -92"),speed:1,key:"9"},BR2:{path:s.path("M0 0 C 0 -30 24 -96 54 -126"),speed:2,key:"9"},BR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),speed:3,key:"9"},SR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),speed:3,key:"3"},BL1:{path:s.path("M0 0 C 0 -20 -18 -72 -38 -92"),speed:1,key:"7"},BL2:{path:s.path("M0 0 C 0 -30 -24 -96 -54 -126"),speed:2,key:"7"},BL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"7"},SL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"1"},K1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"2"},K2:{path:s.path("M 0 0 L 0 -120"),speed:2,key:"2"},K3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"2"},K4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"2"},K5:{path:s.path("M 0 0 L 0 -240"),speed:5,key:"2"}};loadrock();$.ajax({dataType:"json",url:"data/ships.json",mimeType:"application/json",success:function(b){var f=setInterval(function(){ATTACK[dice]=attackproba(dice);DEFENSE[dice]=defenseproba(dice);dice++;if(dice==8){fillprobatable();$("#showproba").prop("disabled",false);clearInterval(f)}},500);unitlist=b;var c=0,d=0,a;squadron=[];importsquadron(SQUAD[0],SQUAD[1]);phase=-1;$("#panel_ACTIVATION").hide();$("#panel_COMBAT").hide();$("#showproba").prop("disabled",true);nextphase()},fail:function(){}})});
