var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,f){if(f.get||f.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[e]=f.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var e=0;return $jscomp.iteratorPrototype(function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var f=0,l={next:function(){if(f<b.length){var m=f++;return{value:e(m,b[m]),done:!1}}l.next=function(){return{done:!0,value:void 0}};return l.next()}};l[Symbol.iterator]=function(){return l};return l};
$jscomp.polyfill=function(b,e,f,l){if(e){f=$jscomp.global;b=b.split(".");for(l=0;l<b.length-1;l++){var m=b[l];m in f||(f[m]={});f=f[m]}b=b[b.length-1];l=f[b];e=e(l);e!=l&&null!=e&&$jscomp.defineProperty(f,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6-impl","es3");
$jscomp.findInternal=function(b,e,f){b instanceof String&&(b=String(b));for(var l=b.length,m=0;m<l;m++){var h=b[m];if(e.call(f,h,m,b))return{i:m,v:h}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6-impl","es3");$jscomp.owns=function(b,e){return Object.prototype.hasOwnProperty.call(b,e)};
$jscomp.polyfill("Object.assign",function(b){return b?b:function(b,f){for(var e=1;e<arguments.length;e++){var m=arguments[e];if(m)for(var h in m)$jscomp.owns(m,h)&&(b[h]=m[h])}return b}},"es6-impl","es3");$jscomp.checkStringArgs=function(b,e,f){if(null==b)throw new TypeError("The 'this' value for String.prototype."+f+" must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype."+f+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.repeat",function(b){return b?b:function(b){var e=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var l="";b;)if(b&1&&(l+=e),b>>>=1)e+=e;return l}},"es6-impl","es3");var gapi=window.gapi=window.gapi||{};gapi._bs=(new Date).getTime();
(function(){var b=window,e=document,f=b.location,l=function(){},m=/\[native code\]/,h=function(b,e,f){return b[e]=b[e]||f},q=function(b){for(var e=0;e<this.length;e++)if(this[e]===b)return e;return-1},t=function(b){b=b.sort();for(var e=[],f=void 0,h=0;h<b.length;h++){var l=b[h];l!=f&&e.push(l);f=l}return e},w=function(){var b;if((b=Object.create)&&m.test(b))b=b(null);else{b={};for(var e in b)b[e]=void 0}return b},y=h(b,"gapi",{}),v;v=h(b,"___jsl",w());h(v,"I",0);h(v,"hel",10);var z=function(){var b=
f.href,e;if(v.dpo)e=v.h;else{e=v.h;var h=RegExp("([#].*&|[#])jsh=([^&#]*)","g"),l=RegExp("([?#].*&|[?#])jsh=([^&#]*)","g");if(b=b&&(h.exec(b)||l.exec(b)))try{e=decodeURIComponent(b[2])}catch(Y){}}return e},B=function(b){var e=h(v,"PQ",[]);v.PQ=[];var f=e.length;if(0===f)b();else for(var l=0,m=function(){++l===f&&b()},q=0;q<f;q++)e[q](m)},E=function(b){return h(h(v,"H",w()),b,w())},D=h(v,"perf",w()),K=h(D,"g",w()),J=h(D,"i",w());h(D,"r",[]);w();w();var L=function(b,e,f){var h=D.r;"function"===typeof h?
h(b,e,f):h.push([b,e,f])},H=function(b,e,f){e&&0<e.length&&(e=F(e),f&&0<f.length&&(e+="___"+F(f)),28<e.length&&(e=e.substr(0,28)+(e.length-28)),f=e,e=h(J,"_p",w()),h(e,f,w())[b]=(new Date).getTime(),L(b,"_p",f))},F=function(b){return b.join("__").replace(/\./g,"_").replace(/\-/g,"_").replace(/\,/g,"_")},G=w(),I=[],Q=function(b){throw Error("Bad hint"+(b?": "+b:""));};I.push(["jsl",function(b){for(var e in b)if(Object.prototype.hasOwnProperty.call(b,e)){var f=b[e];"object"==typeof f?v[e]=h(v,e,[]).concat(f):
h(v,e,f)}if(e=b.u)b=h(v,"us",[]),b.push(e),(e=/^https:(.*)$/.exec(e))&&b.push("http:"+e[1])}]);var O=/^(\/[a-zA-Z0-9_\-]+)+$/,S=/^[a-zA-Z0-9\-_\.,!]+$/,V=/^gapi\.loaded_[0-9]+$/,la=/^[a-zA-Z0-9,._-]+$/,ta=function(b,e,f,h){var l=b.split(";"),m=l.shift(),q=G[m],v=null;q?v=q(l,e,f,h):Q("no hint processor for: "+m);v||Q("failed to generate load url");e=v;f=e.match(N);(h=e.match(fa))&&1===h.length&&da.test(e)&&f&&1===f.length||Q("failed sanity: "+b);return v},Z=function(b,e,f,h){b=na(b);V.test(f)||Q("invalid_callback");
e=qa(e);h=h&&h.length?qa(h):null;var l=function(b){return encodeURIComponent(b).replace(/%2C/g,",")};return[encodeURIComponent(b.g).replace(/%2C/g,",").replace(/%2F/g,"/"),"/k=",l(b.version),"/m=",l(e),h?"/exm="+l(h):"","/rt=j/sv=1/d=1/ed=1",b.a?"/am="+l(b.a):"",b.c?"/rs="+l(b.c):"",b.f?"/t="+l(b.f):"","/cb=",l(f)].join("")},na=function(b){"/"!==b.charAt(0)&&Q("relative path");for(var e=b.substring(1).split("/"),f=[];e.length;){b=e.shift();if(!b.length||0==b.indexOf("."))Q("empty/relative directory");
else if(0<b.indexOf("=")){e.unshift(b);break}f.push(b)}b={};for(var h=0,l=e.length;h<l;++h){var m=e[h].split("="),q=decodeURIComponent(m[0]),v=decodeURIComponent(m[1]);2==m.length&&q&&v&&(b[q]=b[q]||v)}e="/"+f.join("/");O.test(e)||Q("invalid_prefix");f=ha(b,"k",!0);h=ha(b,"am");l=ha(b,"rs");b=ha(b,"t");return{g:e,version:f,a:h,c:l,f:b}},qa=function(b){for(var e=[],f=0,h=b.length;f<h;++f){var l=b[f].replace(/\./g,"_").replace(/-/g,"_");la.test(l)&&e.push(l)}return e.join(",")},ha=function(b,e,f){b=
b[e];!b&&f&&Q("missing: "+e);if(b){if(S.test(b))return b;Q("invalid: "+e)}return null},da=/^https?:\/\/[a-z0-9_.-]+\.google\.com(:\d+)?\/[a-zA-Z0-9_.,!=\-\/]+$/,fa=/\/cb=/g,N=/\/\//g,aa=function(){var b=z();if(!b)throw Error("Bad hint");return b};G.m=function(b,e,f,h){(b=b[0])||Q("missing_hint");return"https://apis.google.com"+Z(b,e,f,h)};var ca=decodeURI("%73cript"),T=function(b,e){for(var f=[],h=0;h<b.length;++h){var l=b[h];l&&0>q.call(e,l)&&f.push(l)}return f},ua=function(b){"loading"!=e.readyState?
Da(b):e.write("<"+ca+' src="'+encodeURI(b)+'"></'+ca+">")},Da=function(b){var f=e.createElement(ca);f.setAttribute("src",b);f.async="true";(b=e.getElementsByTagName(ca)[0])?b.parentNode.insertBefore(f,b):(e.head||e.body||e.documentElement).appendChild(f)},ia=function(b,e){var f=e&&e._c;if(f)for(var h=0;h<I.length;h++){var l=I[h][0],m=I[h][1];m&&Object.prototype.hasOwnProperty.call(f,l)&&m(f[l],b,e)}},ea=function(b,e,f){W(function(){var f;f=e===z()?h(y,"_",w()):w();f=h(E(e),"_",f);b(f)},f)},ka=function(b,
e){var f=e||{};"function"==typeof e&&(f={},f.callback=e);ia(b,f);var l=b?b.split(":"):[],m=f.h||aa(),q=h(v,"ah",w());if(q["::"]&&l.length){for(var t=[],z=null;z=l.shift();){var y=z.split("."),y=q[z]||q[y[1]&&"ns:"+y[0]||""]||m,B=t.length&&t[t.length-1]||null,E=B;B&&B.hint==y||(E={hint:y,b:[]},t.push(E));E.b.push(z)}var D=t.length;if(1<D){var F=f.callback;F&&(f.callback=function(){0==--D&&F()})}for(;l=t.shift();)ja(l.b,f,l.hint)}else ja(l||[],f,m)},ja=function(e,f,m){e=t(e)||[];var q=f.callback,z=
f.config,w=f.timeout,D=f.ontimeout,pa=f.onerror,F=void 0;"function"==typeof pa&&(F=pa);var O=null,S=!1;if(w&&!D||!w&&D)throw"Timeout requires both the timeout parameter and ontimeout parameter to be set";var pa=h(E(m),"r",[]).sort(),K=h(E(m),"L",[]).sort(),G=[].concat(pa),W=function(e,f){if(S)return 0;b.clearTimeout(O);K.push.apply(K,J);var l=((y||{}).config||{}).update;l?l(z):z&&h(v,"cu",[]).push(z);if(f){H("me0",e,G);try{ea(f,m,F)}finally{H("me1",e,G)}}return 1};0<w&&(O=b.setTimeout(function(){S=
!0;D()},w));var J=T(e,K);if(J.length){var J=T(e,pa),I=h(v,"CP",[]),x=I.length;I[x]=function(b){if(!b)return 0;H("ml1",J,G);var e=function(e){I[x]=null;W(J,b)&&B(function(){q&&q();e()})},f=function(){var b=I[x+1];b&&b()};0<x&&I[x-1]?I[x]=function(){e(f)}:e(f)};if(J.length){var V="loaded_"+v.I++;y[V]=function(b){I[x](b);y[V]=null};e=ta(m,J,"gapi."+V,pa);pa.push.apply(pa,J);H("ml0",J,G);f.sync||b.___gapisync?ua(e):Da(e)}else I[x](l)}else W(J)&&q&&q()},W=function(b,e){if(v.hee&&0<v.hel)try{return b()}catch(Aa){e&&
e(Aa),v.hel--,ka("debug_error",function(){try{window.___jsl.hefn(Aa)}catch(Ba){throw Aa;}})}else try{return b()}catch(Aa){throw e&&e(Aa),Aa;}};y.load=function(b,e){return W(function(){return ka(b,e)})};K.bs0=window.gapi._bs||(new Date).getTime();L("bs0");K.bs1=(new Date).getTime();L("bs1");delete window.gapi._bs})();
gapi.load("",{callback:window.gapi_onload,_c:{jsl:{ci:{deviceType:"desktop","oauth-flow":{authUrl:"https://accounts.google.com/o/oauth2/auth",proxyUrl:"https://accounts.google.com/o/oauth2/postmessageRelay",disableOpt:!0,idpIframeUrl:"https://accounts.google.com/o/oauth2/iframe",usegapi:!1},debug:{reportExceptionRate:.05,forceIm:!1,rethrowException:!1,host:"https://apis.google.com"},lexps:[81,97,100,122,124,30,79,127],enableMultilogin:!0,"googleapis.config":{auth:{useFirstPartyAuthV2:!1}},isPlusUser:!1,
inline:{css:1},disableRealtimeCallback:!1,drive_share:{skipInitCommand:!0},csi:{rate:.01},report:{apiRate:{"gapi\\.signin\\..*":.05,"gapi\\.signin2\\..*":.05},apis:["iframes\\..*","gadgets\\..*","gapi\\.appcirclepicker\\..*","gapi\\.auth\\..*","gapi\\.client\\..*"],rate:.001,host:"https://apis.google.com"},client:{headers:{request:"Accept Accept-Language Authorization Cache-Control Content-Disposition Content-Encoding Content-Language Content-Length Content-MD5 Content-Range Content-Type Date GData-Version Host If-Match If-Modified-Since If-None-Match If-Unmodified-Since Origin OriginToken Pragma Range Slug Transfer-Encoding Want-Digest X-ClientDetails X-GData-Client X-GData-Key X-Goog-AuthUser X-Goog-PageId X-Goog-Encode-Response-If-Executable X-Goog-Correlation-Id X-Goog-Request-Info X-Goog-Experiments x-goog-iam-authority-selector x-goog-iam-authorization-token X-Goog-Spatula X-Goog-Upload-Command X-Goog-Upload-Content-Disposition X-Goog-Upload-Content-Length X-Goog-Upload-Content-Type X-Goog-Upload-File-Name X-Goog-Upload-Offset X-Goog-Upload-Protocol X-Goog-Visitor-Id X-HTTP-Method-Override X-JavaScript-User-Agent X-Pan-Versionid X-Origin X-Referer X-Upload-Content-Length X-Upload-Content-Type X-Use-HTTP-Status-Code-Override X-Ios-Bundle-Identifier X-Android-Package X-YouTube-VVT X-YouTube-Page-CL X-YouTube-Page-Timestamp".split(" "),
response:"Digest Cache-Control Content-Disposition Content-Encoding Content-Language Content-Length Content-MD5 Content-Range Content-Type Date ETag Expires Last-Modified Location Pragma Range Server Transfer-Encoding WWW-Authenticate Vary Unzipped-Content-MD5 X-Goog-Generation X-Goog-Metageneration X-Goog-Safety-Content-Type X-Goog-Safety-Encoding X-Google-Trace X-Goog-Upload-Chunk-Granularity X-Goog-Upload-Control-URL X-Goog-Upload-Size-Received X-Goog-Upload-Status X-Goog-Upload-URL X-Goog-Diff-Download-Range X-Goog-Hash X-Goog-Updated-Authorization X-Server-Object-Version X-Guploader-Customer X-Guploader-Upload-Result X-Guploader-Uploadid X-Google-Gfe-Backend-Request-Cost".split(" ")},
rms:"migrated",cors:!1},isLoggedIn:!1,signInDeprecation:{rate:0},include_granted_scopes:!0,llang:"fr",iframes:{youtube:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/youtube?usegapi=1",methods:["scroll","openwindow"]},ytsubscribe:{url:"https://www.youtube.com/subscribe_embed?usegapi=1"},plus_circle:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/plus/circle?usegapi=1"},plus_share:{params:{url:""},url:":socialhost:/:session_prefix::se:_/+1/sharebutton?plusShare=true&usegapi=1"},
rbr_s:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarsimplescroller"},udc_webconsentflow:{params:{url:""},url:"https://www.google.com/settings/webconsent?usegapi=1"},":source:":"3p",playemm:{url:"https://play.google.com/work?usegapi=1&usegapi=1"},blogger:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/blogger?usegapi=1",methods:["scroll","openwindow"]},evwidget:{params:{url:""},url:":socialhost:/:session_prefix:_/events/widget?usegapi=1"},
partnersbadge:{url:"https://www.gstatic.com/partners/badge/templates/badge.html?usegapi=1"},":socialhost:":"https://apis.google.com",shortlists:{url:""},hangout:{url:"https://talkgadget.google.com/:session_prefix:talkgadget/_/widget"},plus_followers:{params:{url:""},url:":socialhost:/_/im/_/widget/render/plus/followers?usegapi=1"},post:{params:{url:""},url:":socialhost:/:session_prefix::im_prefix:_/widget/render/post?usegapi=1"},":gplus_url:":"https://plus.google.com",signin:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/signin?usegapi=1",
methods:["onauth"]},rbr_i:{params:{url:""},url:":socialhost:/:session_prefix::se:_/widget/render/recobarinvitation"},donation:{url:"https://onetoday.google.com/home/donationWidget?usegapi=1"},share:{url:":socialhost:/:session_prefix::im_prefix:_/widget/render/share?usegapi=1"},plusone:{params:{count:"",size:"",url:""},url:":socialhost:/:session_prefix::se:_/+1/fastbutton?usegapi=1"},comments:{params:{location:["search","hash"]},url:":socialhost:/:session_prefix:_/widget/render/comments?usegapi=1",
methods:["scroll","openwindow"]},":im_socialhost:":"https://plus.googleapis.com",backdrop:{url:"https://clients3.google.com/cast/chromecast/home/widget/backdrop?usegapi=1"},visibility:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/visibility?usegapi=1"},autocomplete:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/autocomplete"},additnow:{url:"https://apis.google.com/additnow/additnow.html?usegapi=1",methods:["launchurl"]},":signuphost:":"https://plus.google.com",
appcirclepicker:{url:":socialhost:/:session_prefix:_/widget/render/appcirclepicker"},follow:{url:":socialhost:/:session_prefix:_/widget/render/follow?usegapi=1"},community:{url:":ctx_socialhost:/:session_prefix::im_prefix:_/widget/render/community?usegapi=1"},sharetoclassroom:{url:"https://www.gstatic.com/classroom/sharewidget/widget_stable.html?usegapi=1"},ytshare:{params:{url:""},url:":socialhost:/:session_prefix:_/widget/render/ytshare?usegapi=1"},plus:{url:":socialhost:/:session_prefix:_/widget/render/badge?usegapi=1"},
family_creation:{params:{url:""},url:"https://families.google.com/webcreation?usegapi=1&usegapi=1"},commentcount:{url:":socialhost:/:session_prefix:_/widget/render/commentcount?usegapi=1"},configurator:{url:":socialhost:/:session_prefix:_/plusbuttonconfigurator?usegapi=1"},zoomableimage:{url:"https://ssl.gstatic.com/microscope/embed/"},savetowallet:{url:"https://clients5.google.com/s2w/o/savetowallet"},person:{url:":socialhost:/:session_prefix:_/widget/render/person?usegapi=1"},savetodrive:{url:"https://drive.google.com/savetodrivebutton?usegapi=1",
methods:["save"]},page:{url:":socialhost:/:session_prefix:_/widget/render/page?usegapi=1"},card:{url:":socialhost:/:session_prefix:_/hovercard/card"}}},h:"m;/_/scs/apps-static/_/js/k=oz.gapi.fr.RtN3VtG2yac.O/m=__features__/am=EQ/rt=j/d=1/rs=AGLTcCNh3CUzUyRhab3nnFmD-mmgi7MvpA",u:"https://apis.google.com/js/api.js",hee:!0,fp:"8e93d657eacdccd49a48df518caca05fc0f47051",dpo:!1},fp:"8e93d657eacdccd49a48df518caca05fc0f47051",annotation:["interactivepost","recobar","signin2","autocomplete","profile"],bimodal:["signin",
"share"]}});!function(b){var e,f,l=/[\.\/]/,m=/\s*,\s*/,h=function(b,e){return b-e},q={n:{}},t=function(){for(var b=0,e=this.length;e>b;b++)if("undefined"!=typeof this[b])return this[b]},w=function(){for(var b=this.length;--b;)if("undefined"!=typeof this[b])return this[b]},y=function(b,l){b=String(b);var m,q=f,v=Array.prototype.slice.call(arguments,2),z=y.listeners(b),J=0,L=[],H={},F=[],G=e;F.firstDefined=t;F.lastDefined=w;e=b;for(var I=f=0,Q=z.length;Q>I;I++)"zIndex"in z[I]&&(L.push(z[I].zIndex),0>z[I].zIndex&&
(H[z[I].zIndex]=z[I]));for(L.sort(h);0>L[J];)if(m=H[L[J++]],F.push(m.apply(l,v)),f)return f=q,F;for(I=0;Q>I;I++)if(m=z[I],"zIndex"in m)if(m.zIndex==L[J]){if(F.push(m.apply(l,v)),f)break;do if(J++,m=H[L[J]],m&&F.push(m.apply(l,v)),f)break;while(m)}else H[m.zIndex]=m;else if(F.push(m.apply(l,v)),f)break;return f=q,e=G,F};y._events=q;y.listeners=function(b){var e,f,h,m,v,t,w,y=b.split(l);e=q;var F=[e],G=[];b=0;for(m=y.length;m>b;b++){w=[];v=0;for(t=F.length;t>v;v++)for(e=F[v].n,f=[e[y[b]],e["*"]],h=
2;h--;)(e=f[h])&&(w.push(e),G=G.concat(e.f||[]));F=w}return G};y.on=function(b,e){if(b=String(b),"function"!=typeof e)return function(){};for(var f=b.split(m),h=0,v=f.length;v>h;h++)!function(b){var f;b=b.split(l);for(var h=q,m=0,v=b.length;v>m;m++)h=h.n,h=h.hasOwnProperty(b[m])&&h[b[m]]||(h[b[m]]={n:{}});h.f=h.f||[];m=0;for(v=h.f.length;v>m;m++)if(h.f[m]==e){f=!0;break}!f&&h.f.push(e)}(f[h]);return function(b){+b==+b&&(e.zIndex=+b)}};y.f=function(b){var e=[].slice.call(arguments,1);return function(){y.apply(null,
[b,null].concat(e).concat([].slice.call(arguments,0)))}};y.stop=function(){f=1};y.nt=function(b){return b?(new RegExp("(?:\\.|\\/|^)"+b+"(?:\\.|\\/|$)")).test(e):e};y.nts=function(){return e.split(l)};y.off=y.unbind=function(b,e){if(!b)return void(y._events=q={n:{}});var f=b.split(m);if(1<f.length)for(var h=0,v=f.length;v>h;h++)y.off(f[h],e);else{for(var f=b.split(l),t,z,w,H,F=[q],h=0,v=f.length;v>h;h++)for(H=0;H<F.length;H+=w.length-2){if(w=[H,1],t=F[H].n,"*"!=f[h])t[f[h]]&&w.push(t[f[h]]);else for(z in t)t.hasOwnProperty(z)&&
w.push(t[z]);F.splice.apply(F,w)}h=0;for(v=F.length;v>h;h++)for(t=F[h];t.n;){if(e){if(t.f){H=0;for(f=t.f.length;f>H;H++)if(t.f[H]==e){t.f.splice(H,1);break}!t.f.length&&delete t.f}for(z in t.n)if(t.n.hasOwnProperty(z)&&t.n[z].f){w=t.n[z].f;H=0;for(f=w.length;f>H;H++)if(w[H]==e){w.splice(H,1);break}!w.length&&delete t.n[z].f}}else for(z in delete t.f,t.n)t.n.hasOwnProperty(z)&&t.n[z].f&&delete t.n[z].f;t=t.n}}};y.once=function(b,e){var f=function(){return y.unbind(b,f),e.apply(this,arguments)};return y.on(b,
f)};y.version="0.4.2";y.toString=function(){return"You are running Eve 0.4.2"};"undefined"!=typeof module&&module.exports?module.exports=y:"function"==typeof define&&define.amd?define("eve",[],function(){return y}):b.eve=y}(this);
(function(b,e){if("function"==typeof define&&define.amd)define(["eve"],function(f){return e(b,f)});else if("undefined"!=typeof exports){var f=require("eve");module.exports=e(b,f)}else e(b,b.eve)})(window||this,function(b,e){var f=function(e){var f={},l=b.requestAnimationFrame||b.webkitRequestAnimationFrame||b.mozRequestAnimationFrame||b.oRequestAnimationFrame||b.msRequestAnimationFrame||function(b){setTimeout(b,16)},m=Array.isArray||function(b){return b instanceof Array||"[object Array]"==Object.prototype.toString.call(b)},
w=0,y="M"+(+new Date).toString(36),v=function(b){if(null==b)return this.s;var e=this.s-b;this.b+=this.dur*e;this.B+=this.dur*e;this.s=b},z=function(b){return null==b?this.spd:void(this.spd=b)},B=function(b){return null==b?this.dur:(this.s=this.s*b/this.dur,void(this.dur=b))},E=function(){delete f[this.id];this.update();e("mina.stop."+this.id,this)},D=function(){this.pdif||(delete f[this.id],this.update(),this.pdif=this.get()-this.b)},K=function(){this.pdif&&(this.b=this.get()-this.pdif,delete this.pdif,
f[this.id]=this)},J=function(){var b;if(m(this.start)){b=[];for(var e=0,f=this.start.length;f>e;e++)b[e]=+this.start[e]+(this.end[e]-this.start[e])*this.easing(this.s)}else b=+this.start+(this.end-this.start)*this.easing(this.s);this.set(b)},L=function(){var b=0,h;for(h in f)if(f.hasOwnProperty(h)){var m=f[h],q=m.get();b++;m.s=(q-m.b)/(m.dur/m.spd);1<=m.s&&(delete f[h],m.s=1,b--,function(b){setTimeout(function(){e("mina.finish."+b.id,b)})}(m));m.update()}b&&l(L)},H=function(b,e,h,m,q,t,V){b={id:y+
(w++).toString(36),start:b,end:e,b:h,s:0,dur:m-h,spd:1,get:q,set:t,easing:V||H.linear,status:v,speed:z,duration:B,stop:E,pause:D,resume:K,update:J};f[b.id]=b;var F;e=0;for(F in f)if(f.hasOwnProperty(F)&&(e++,2==e))break;return 1==e&&l(L),b};return H.time=Date.now||function(){return+new Date},H.getById=function(b){return f[b]||null},H.linear=function(b){return b},H.easeout=function(b){return Math.pow(b,1.7)},H.easein=function(b){return Math.pow(b,.48)},H.easeinout=function(b){if(1==b)return 1;if(0==
b)return 0;var e=.48-b/1.04,f=Math.sqrt(.1734+e*e);b=f-e;e=-f-e;b=Math.pow(Math.abs(b),1/3)*(0>b?-1:1)+Math.pow(Math.abs(e),1/3)*(0>e?-1:1)+.5;return 3*(1-b)*b*b+b*b*b},H.backin=function(b){return 1==b?1:b*b*(2.70158*b-1.70158)},H.backout=function(b){if(0==b)return 0;--b;return b*b*(2.70158*b+1.70158)+1},H.elastic=function(b){return b==!!b?b:Math.pow(2,-10*b)*Math.sin(2*(b-.075)*Math.PI/.3)+1},H.bounce=function(b){var e;return 1/2.75>b?e=7.5625*b*b:2/2.75>b?(b-=1.5/2.75,e=7.5625*b*b+.75):2.5/2.75>
b?(b-=2.25/2.75,e=7.5625*b*b+.9375):(b-=2.625/2.75,e=7.5625*b*b+.984375),e},b.mina=H,H}("undefined"==typeof e?function(){}:e),l=function(b){function f(b,e){if(b){if(b.nodeType)return H(b);if(m(b,"array")&&f.set)return f.set.apply(f,b);if(b instanceof D)return b;if(null==e)return b=G.doc.querySelector(String(b)),H(b)}return b=null==b?"100%":b,e=null==e?"100%":e,new L(b,e)}function l(b,e){if(e){if("#text"==b&&(b=G.doc.createTextNode(e.text||e["#text"]||"")),"#comment"==b&&(b=G.doc.createComment(e.text||
e["#text"]||"")),"string"==typeof b&&(b=l(b)),"string"==typeof e)return 1==b.nodeType?"xlink:"==e.substring(0,6)?b.getAttributeNS(ea,e.substring(6)):"xml:"==e.substring(0,4)?b.getAttributeNS(ka,e.substring(4)):b.getAttribute(e):"text"==e?b.nodeValue:null;if(1==b.nodeType)for(var f in e){if(e[I](f)){var h=Q(e[f]);h?"xlink:"==f.substring(0,6)?b.setAttributeNS(ea,f.substring(6),h):"xml:"==f.substring(0,4)?b.setAttributeNS(ka,f.substring(4),h):b.setAttribute(f,h):b.removeAttribute(f)}}else"text"in e&&
(b.nodeValue=e.text)}else b=G.doc.createElementNS(ka,b);return b}function m(b,e){return e=Q.prototype.toLowerCase.call(e),"finite"==e?isFinite(b):"array"==e&&(b instanceof Array||Array.isArray&&Array.isArray(b))?!0:"null"==e&&null===b||e==typeof b&&null!==b||"object"==e&&b===Object(b)||ha.call(b).slice(8,-1).toLowerCase()==e}function w(b){if("function"==typeof b||Object(b)!==b)return b;var e=new b.constructor,f;for(f in b)b[I](f)&&(e[f]=w(b[f]));return e}function y(b,e,f){function h(){var l=Array.prototype.slice.call(arguments,
0),m=l.join("\u2400"),q=h.cache=h.cache||{},v=h.count=h.count||[];if(q[I](m)){a:for(var l=v,v=m,t=0,z=l.length;z>t;t++)if(l[t]===v){l.push(l.splice(t,1)[0]);break a}m=f?f(q[m]):q[m]}else m=(1E3<=v.length&&delete q[v.shift()],v.push(m),q[m]=b.apply(e,l),f?f(q[m]):q[m]);return m}return h}function v(b,e,f,h,l,m){return null==l?(b-=f,e-=h,b||e?(180*V.atan2(-e,-b)/na+540)%360:0):v(b,e,l,m)-v(f,h,l,m)}function z(b){return b%360*na/180}function B(b){return b.node.ownerSVGElement&&H(b.node.ownerSVGElement)||
f.select("svg")}function E(b){m(b,"array")||(b=Array.prototype.slice.call(arguments,0));for(var e=0,f=0,h=this.node;this[e];)delete this[e++];for(e=0;e<b.length;e++)"set"==b[e].type?b[e].forEach(function(b){h.appendChild(b.node)}):h.appendChild(b[e].node);for(var l=h.childNodes,e=0;e<l.length;e++)this[f++]=H(l[e]);return this}function D(b){if(b.snap in ja)return ja[b.snap];var e;try{e=b.ownerSVGElement}catch(db){}this.node=b;e&&(this.paper=new L(e));this.type=b.tagName||b.nodeName;e=this.id=ia(this);
if(this.anims={},this._={transform:[]},b.snap=e,ja[e]=this,"g"==this.type&&(this.add=E),this.type in{g:1,mask:1,pattern:1,symbol:1})for(var f in L.prototype)L.prototype[I](f)&&(this[f]=L.prototype[f])}function K(b){this.node=b}function J(b,e){var f=l(b);e.appendChild(f);return H(f)}function L(b,e){var f,h,m,q=L.prototype;if(b&&"svg"==b.tagName){if(b.snap in ja)return ja[b.snap];var v=b.ownerDocument;f=new D(b);h=b.getElementsByTagName("desc")[0];m=b.getElementsByTagName("defs")[0];h||(h=l("desc"),
h.appendChild(v.createTextNode("Created with Snap")),f.node.appendChild(h));m||(m=l("defs"),f.node.appendChild(m));f.defs=m;for(var t in q)q[I](t)&&(f[t]=q[t]);f.paper=f.root=f}else f=J("svg",G.doc.body),l(f.node,{height:e,version:1.1,width:b,xmlns:ka});return f}function H(b){return b?b instanceof D||b instanceof K?b:b.tagName&&"svg"==b.tagName.toLowerCase()?new L(b):b.tagName&&"object"==b.tagName.toLowerCase()&&"image/svg+xml"==b.type?new L(b.contentDocument.getElementsByTagName("svg")[0]):new D(b):
b}function F(b,e){for(var f=0,h=b.length;h>f;f++){var l={type:b[f].type,attr:b[f].attr()},m=b[f].children();e.push(l);m.length&&F(m,l.childNodes=[])}}f.version="0.4.0";f.toString=function(){return"Snap v"+this.version};f._={};var G={win:b.window,doc:b.window.document};f._.glob=G;var I="hasOwnProperty",Q=String,O=parseFloat,S=parseInt,V=Math,la=V.max,ta=V.min,Z=V.abs,na=(V.pow,V.PI),qa=(V.round,""),ha=Object.prototype.toString,da=/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?%?)\s*\))\s*$/i,
fa=(f._.separator=/[,\s]+/,/[\s]*,[\s]*/),N={hs:1,rg:1},aa=/([a-z])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,ca=/([rstm])[\s,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\s]*,?[\s]*)+)/gi,T=/(-?\d*\.?\d*(?:e[\-+]?\\d+)?)[\s]*,?[\s]*/gi,ua=0,Da="S"+(+new Date).toString(36),ia=function(b){return(b&&b.type?b.type:qa)+Da+(ua++).toString(36)},ea="http://www.w3.org/1999/xlink",ka="http://www.w3.org/2000/svg",ja={};f.url=function(b){return"url('#"+b+"')"};f._.$=l;f._.id=ia;f.format=function(){var b=/\{([^\}]+)\}/g,
e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,f=function(b,f,h){var l=h;return f.replace(e,function(b,e,f,h,m){e=e||h;l&&(e in l&&(l=l[e]),"function"==typeof l&&m&&(l=l()))}),l=(null==l||l==h?b:l)+""};return function(e,h){return Q(e).replace(b,function(b,e){return f(b,e,h)})}}();f._.clone=w;f._.cacher=y;f.rad=z;f.deg=function(b){return 180*b/na%360};f.sin=function(b){return V.sin(f.rad(b))};f.tan=function(b){return V.tan(f.rad(b))};f.cos=function(b){return V.cos(f.rad(b))};f.asin=function(b){return f.deg(V.asin(b))};
f.acos=function(b){return f.deg(V.acos(b))};f.atan=function(b){return f.deg(V.atan(b))};f.atan2=function(b){return f.deg(V.atan2(b))};f.angle=v;f.len=function(b,e,h,l){return Math.sqrt(f.len2(b,e,h,l))};f.len2=function(b,e,f,h){return(b-f)*(b-f)+(e-h)*(e-h)};f.closestPoint=function(b,e,f){function h(b){var h=b.x-e;b=b.y-f;return h*h+b*b}var l,m,q,v;b=b.node;for(var t=b.getTotalLength(),z=t/b.pathSegList.numberOfItems*.125,w=1/0,y=0;t>=y;y+=z)(v=h(q=b.getPointAtLength(y)))<w&&(l=q,m=y,w=v);for(z*=
.5;.5<z;){var B,pa,E,D,S,O;0<=(E=m-z)&&(S=h(B=b.getPointAtLength(E)))<w?(l=B,m=E,w=S):(D=m+z)<=t&&(O=h(pa=b.getPointAtLength(D)))<w?(l=pa,m=D,w=O):z*=.5}return l={x:l.x,y:l.y,length:m,distance:Math.sqrt(w)}};f.is=m;f.snapTo=function(b,e,f){if(f=m(f,"finite")?f:10,m(b,"array"))for(var h=b.length;h--;){if(Z(b[h]-e)<=f)return b[h]}else{b=+b;h=e%b;if(f>h)return e-h;if(h>b-f)return e-h+b}return e};f.getRGB=y(function(b){if(!b||(b=Q(b)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Aa};
if("none"==b)return{r:-1,g:-1,b:-1,hex:"none",toString:Aa};if(!(N[I](b.toLowerCase().substring(0,2))||"#"==b.charAt())&&(b=W(b)),!b)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Aa};var e,h,l,q,v,t;return(b=b.match(da))?(b[2]&&(l=S(b[2].substring(5),16),h=S(b[2].substring(3,5),16),e=S(b[2].substring(1,3),16)),b[3]&&(l=S((v=b[3].charAt(3))+v,16),h=S((v=b[3].charAt(2))+v,16),e=S((v=b[3].charAt(1))+v,16)),b[4]&&(t=b[4].split(fa),e=O(t[0]),"%"==t[0].slice(-1)&&(e*=2.55),h=O(t[1]),"%"==t[1].slice(-1)&&
(h*=2.55),l=O(t[2]),"%"==t[2].slice(-1)&&(l*=2.55),"rgba"==b[1].toLowerCase().slice(0,4)&&(q=O(t[3])),t[3]&&"%"==t[3].slice(-1)&&(q/=100)),b[5]?(t=b[5].split(fa),e=O(t[0]),"%"==t[0].slice(-1)&&(e/=100),h=O(t[1]),"%"==t[1].slice(-1)&&(h/=100),l=O(t[2]),"%"==t[2].slice(-1)&&(l/=100),("deg"==t[0].slice(-3)||"\u00b0"==t[0].slice(-1))&&(e/=360),"hsba"==b[1].toLowerCase().slice(0,4)&&(q=O(t[3])),t[3]&&"%"==t[3].slice(-1)&&(q/=100),f.hsb2rgb(e,h,l,q)):b[6]?(t=b[6].split(fa),e=O(t[0]),"%"==t[0].slice(-1)&&
(e/=100),h=O(t[1]),"%"==t[1].slice(-1)&&(h/=100),l=O(t[2]),"%"==t[2].slice(-1)&&(l/=100),("deg"==t[0].slice(-3)||"\u00b0"==t[0].slice(-1))&&(e/=360),"hsla"==b[1].toLowerCase().slice(0,4)&&(q=O(t[3])),t[3]&&"%"==t[3].slice(-1)&&(q/=100),f.hsl2rgb(e,h,l,q)):(e=ta(V.round(e),255),h=ta(V.round(h),255),l=ta(V.round(l),255),q=ta(la(q,0),1),b={r:e,g:h,b:l,toString:Aa},b.hex="#"+(16777216|l|h<<8|e<<16).toString(16).slice(1),b.opacity=m(q,"finite")?q:1,b)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:Aa}},
f);f.hsb=y(function(b,e,h){return f.hsb2rgb(b,e,h).hex});f.hsl=y(function(b,e,h){return f.hsl2rgb(b,e,h).hex});f.rgb=y(function(b,e,f,h){if(m(h,"finite")){var l=V.round;return"rgba("+[l(b),l(e),l(f),+h.toFixed(2)]+")"}return"#"+(16777216|f|e<<8|b<<16).toString(16).slice(1)});var W=function(b){var e=G.doc.getElementsByTagName("head")[0]||G.doc.getElementsByTagName("svg")[0];return(W=y(function(b){if("red"==b.toLowerCase())return"rgb(255, 0, 0)";e.style.color="rgb(255, 0, 0)";e.style.color=b;b=G.doc.defaultView.getComputedStyle(e,
qa).getPropertyValue("color");return"rgb(255, 0, 0)"==b?null:b}))(b)},Pa=function(){return"hsb("+[this.h,this.s,this.b]+")"},Ha=function(){return"hsl("+[this.h,this.s,this.l]+")"},Aa=function(){return 1==this.opacity||null==this.opacity?this.hex:"rgba("+[this.r,this.g,this.b,this.opacity]+")"},Ba=function(b,e,h){if(null==e&&m(b,"object")&&"r"in b&&"g"in b&&"b"in b&&(h=b.b,e=b.g,b=b.r),null==e&&m(b,string))h=f.getRGB(b),b=h.r,e=h.g,h=h.b;return(1<b||1<e||1<h)&&(b/=255,e/=255,h/=255),[b,e,h]},Y=function(b,
e,h,l){b=V.round(255*b);e=V.round(255*e);h=V.round(255*h);b={r:b,g:e,b:h,opacity:m(l,"finite")?l:1,hex:f.rgb(b,e,h),toString:Aa};return m(l,"finite")&&(b.opacity=l),b};f.color=function(b){var e;return m(b,"object")&&"h"in b&&"s"in b&&"b"in b?(e=f.hsb2rgb(b),b.r=e.r,b.g=e.g,b.b=e.b,b.opacity=1,b.hex=e.hex):m(b,"object")&&"h"in b&&"s"in b&&"l"in b?(e=f.hsl2rgb(b),b.r=e.r,b.g=e.g,b.b=e.b,b.opacity=1,b.hex=e.hex):(m(b,"string")&&(b=f.getRGB(b)),m(b,"object")&&"r"in b&&"g"in b&&"b"in b&&!("error"in b)?
(e=f.rgb2hsl(b),b.h=e.h,b.s=e.s,b.l=e.l,e=f.rgb2hsb(b),b.v=e.b):(b={hex:"none"},b.r=b.g=b.b=b.h=b.s=b.v=b.l=-1,b.error=1)),b.toString=Aa,b};f.hsb2rgb=function(b,e,f,h){m(b,"object")&&"h"in b&&"s"in b&&"b"in b&&(f=b.b,e=b.s,h=b.o,b=b.h);b*=360;var l,q,t,v,z;return b=b%360/60,z=f*e,v=z*(1-Z(b%2-1)),l=q=t=f-z,b=~~b,l+=[z,v,0,0,v,z][b],q+=[v,z,z,v,0,0][b],t+=[0,0,v,z,z,v][b],Y(l,q,t,h)};f.hsl2rgb=function(b,e,f,h){m(b,"object")&&"h"in b&&"s"in b&&"l"in b&&(f=b.l,e=b.s,b=b.h);(1<b||1<e||1<f)&&(b/=360,
e/=100,f/=100);b*=360;var l,q,t,v,z;return b=b%360/60,z=2*e*(.5>f?f:1-f),v=z*(1-Z(b%2-1)),l=q=t=f-z/2,b=~~b,l+=[z,v,0,0,v,z][b],q+=[v,z,z,v,0,0][b],t+=[0,0,v,z,z,v][b],Y(l,q,t,h)};f.rgb2hsb=function(b,e,f){f=Ba(b,e,f);b=f[0];e=f[1];f=f[2];var h,l,m,q;return m=la(b,e,f),q=m-ta(b,e,f),h=0==q?null:m==b?(e-f)/q:m==e?(f-b)/q+2:(b-e)/q+4,h=(h+360)%6*60/360,l=0==q?0:q/m,{h:h,s:l,b:m,toString:Pa}};f.rgb2hsl=function(b,e,f){f=Ba(b,e,f);b=f[0];e=f[1];f=f[2];var h,l,m,q,t,v;return q=la(b,e,f),t=ta(b,e,f),v=
q-t,h=0==v?null:q==b?(e-f)/v:q==e?(f-b)/v+2:(b-e)/v+4,h=(h+360)%6*60/360,m=(q+t)/2,l=0==v?0:.5>m?v/(2*m):v/(2-2*m),{h:h,s:l,l:m,toString:Ha}};f.parsePathString=function(b){if(!b)return null;var e=f.path(b);if(e.arr)return f.path.clone(e.arr);var h={a:7,c:6,o:2,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,u:3,z:0},l=[];return m(b,"array")&&m(b[0],"array")&&(l=f.path.clone(b)),l.length||Q(b).replace(aa,function(b,e,f){var m=[];b=e.toLowerCase();if(f.replace(T,function(b,e){e&&m.push(+e)}),"m"==b&&2<m.length&&(l.push([e].concat(m.splice(0,
2))),b="l",e="m"==e?"l":"L"),"o"==b&&1==m.length&&l.push([e,m[0]]),"r"==b)l.push([e].concat(m));else for(;m.length>=h[b]&&(l.push([e].concat(m.splice(0,h[b]))),h[b]););}),l.toString=f.path.toString,e.arr=f.path.clone(l),l};var jb=f.parseTransformString=function(b){if(!b)return null;var e=[];return m(b,"array")&&m(b[0],"array")&&(e=f.path.clone(b)),e.length||Q(b).replace(ca,function(b,f,h){var l=[];f.toLowerCase();h.replace(T,function(b,e){e&&l.push(+e)});e.push([f].concat(l))}),e.toString=f.path.toString,
e};f._.svgTransform2string=function(b){var e=[];return b=b.replace(/(?:^|\s)(\w+)\(([^)]+)\)/g,function(b,f,h){return h=h.split(/\s*,\s*|\s+/),"rotate"==f&&1==h.length&&h.push(0,0),"scale"==f&&(2<h.length?h=h.slice(0,2):2==h.length&&h.push(0,0),1==h.length&&h.push(h[0],0,0)),e.push("skewX"==f?["m",1,0,V.tan(z(h[0])),1,0,0]:"skewY"==f?["m",1,V.tan(z(h[0])),0,1,0,0]:[f.charAt(0)].concat(h)),b}),e};f._.rgTransform=/^[a-z][\s]*-?\.?\d/i;f._.transform2matrix=function(b,e){var h=jb(b),l=new f.Matrix;if(h)for(var m=
0,q=h.length;q>m;m++){var t,v,z,w,y,B=h[m],E=B.length,D=Q(B[0]).toLowerCase(),S=B[0]!=D,O=S?l.invert():0;"t"==D&&2==E?l.translate(B[1],0):"t"==D&&3==E?S?(t=O.x(0,0),v=O.y(0,0),z=O.x(B[1],B[2]),w=O.y(B[1],B[2]),l.translate(z-t,w-v)):l.translate(B[1],B[2]):"r"==D?2==E?(y=y||e,l.rotate(B[1],y.x+y.width/2,y.y+y.height/2)):4==E&&(S?(z=O.x(B[2],B[3]),w=O.y(B[2],B[3]),l.rotate(B[1],z,w)):l.rotate(B[1],B[2],B[3])):"s"==D?2==E||3==E?(y=y||e,l.scale(B[1],B[E-1],y.x+y.width/2,y.y+y.height/2)):4==E?S?(z=O.x(B[2],
B[3]),w=O.y(B[2],B[3]),l.scale(B[1],B[1],z,w)):l.scale(B[1],B[1],B[2],B[3]):5==E&&(S?(z=O.x(B[3],B[4]),w=O.y(B[3],B[4]),l.scale(B[1],B[2],z,w)):l.scale(B[1],B[2],B[3],B[4])):"m"==D&&7==E&&l.add(B[1],B[2],B[3],B[4],B[5],B[6])}return l};f._unit2px=function(b,e,f){function h(b){if(null==b)return qa;if(b==+b)return b;l(z,{width:b});try{return z.getBBox().width}catch(rb){return 0}}function m(b){if(null==b)return qa;if(b==+b)return b;l(z,{height:b});try{return z.getBBox().height}catch(rb){return 0}}function q(h,
l){null==e?v[h]=l(b.attr(h)||0):h==e&&(v=l(null==f?b.attr(h)||0:f))}var t=B(b).node,v={},z=t.querySelector(".svg---mgr");switch(z||(z=l("rect"),l(z,{x:-9E9,y:-9E9,width:10,height:10,"class":"svg---mgr",fill:"none"}),t.appendChild(z)),b.type){case "rect":q("rx",h),q("ry",m);case "image":q("width",h),q("height",m);case "text":q("x",h);q("y",m);break;case "circle":q("cx",h);q("cy",m);q("r",h);break;case "ellipse":q("cx",h);q("cy",m);q("rx",h);q("ry",m);break;case "line":q("x1",h);q("x2",h);q("y1",m);
q("y2",m);break;case "marker":q("refX",h);q("markerWidth",h);q("refY",m);q("markerHeight",m);break;case "radialGradient":q("fx",h);q("fy",m);break;case "tspan":q("dx",h);q("dy",m);break;default:q(e,h)}return t.removeChild(z),v};G.doc.contains||G.doc.compareDocumentPosition?function(b,e){var f=9==b.nodeType?b.documentElement:b,h=e&&e.parentNode;return b==h||!(!h||1!=h.nodeType||!(f.contains?f.contains(h):b.compareDocumentPosition&&16&b.compareDocumentPosition(h)))}:function(b,e){if(e)for(;e;)if(e=
e.parentNode,e==b)return!0;return!1};f._.getSomeDefs=function(b){b=b.node.ownerSVGElement&&H(b.node.ownerSVGElement)||b.node.parentNode&&H(b.node.parentNode)||f.select("svg")||f(0,0);var e=b.select("defs"),e=null==e?!1:e.node;return e||(e=J("defs",b.node).node),e};f._.getSomeSVG=B;f.select=function(b){return b=Q(b).replace(/([^\\]):/g,"$1\\:"),H(G.doc.querySelector(b))};f.selectAll=function(b){b=G.doc.querySelectorAll(b);for(var e=(f.set||Array)(),h=0;h<b.length;h++)e.push(H(b[h]));return e};setInterval(function(){for(var b in ja)if(ja[I](b)){var e=
ja[b],f=e.node;("svg"!=e.type&&!f.ownerSVGElement||"svg"==e.type&&(!f.parentNode||"ownerSVGElement"in f.parentNode&&!f.ownerSVGElement))&&delete ja[b]}},1E4);D.prototype.attr=function(b,f){var h=this.node;if(!b){if(1!=h.nodeType)return{text:h.nodeValue};for(var l=h.attributes,h={},q=0,t=l.length;t>q;q++)h[l[q].nodeName]=l[q].nodeValue;return h}if(m(b,"string")){if(!(1<arguments.length))return e("snap.util.getattr."+b,this).firstDefined();h={};h[b]=f;b=h}for(l in b)b[I](l)&&e("snap.util.attr."+l,this,
b[l]);return this};f.parse=function(b){var e=G.doc.createDocumentFragment(),f=!0,h=G.doc.createElement("div");if(b=Q(b),b.match(/^\s*<\s*svg(?:\s|>)/)||(b="<svg>"+b+"</svg>",f=!1),h.innerHTML=b,b=h.getElementsByTagName("svg")[0])if(f)e=b;else for(;b.firstChild;)e.appendChild(b.firstChild);return new K(e)};f.fragment=function(){for(var b=Array.prototype.slice.call(arguments,0),e=G.doc.createDocumentFragment(),h=0,l=b.length;l>h;h++){var m=b[h];m.node&&m.node.nodeType&&e.appendChild(m.node);m.nodeType&&
e.appendChild(m);"string"==typeof m&&e.appendChild(f.parse(m).node)}return new K(e)};f._.make=J;f._.wrap=H;L.prototype.el=function(b,e){var f=J(b,this.node);return e&&f.attr(e),f};D.prototype.children=function(){for(var b=[],e=this.node.childNodes,h=0,l=e.length;l>h;h++)b[h]=f(e[h]);return b};D.prototype.toJSON=function(){var b=[];return F([this],b),b[0]};e.on("snap.util.getattr",function(){var b=e.nt(),b=b.substring(b.lastIndexOf(".")+1),f=b.replace(/[A-Z]/g,function(b){return"-"+b.toLowerCase()});
return Ma[I](f)?this.node.ownerDocument.defaultView.getComputedStyle(this.node,null).getPropertyValue(f):l(this.node,b)});var Ma={"alignment-baseline":0,"baseline-shift":0,clip:0,"clip-path":0,"clip-rule":0,color:0,"color-interpolation":0,"color-interpolation-filters":0,"color-profile":0,"color-rendering":0,cursor:0,direction:0,display:0,"dominant-baseline":0,"enable-background":0,fill:0,"fill-opacity":0,"fill-rule":0,filter:0,"flood-color":0,"flood-opacity":0,font:0,"font-family":0,"font-size":0,
"font-size-adjust":0,"font-stretch":0,"font-style":0,"font-variant":0,"font-weight":0,"glyph-orientation-horizontal":0,"glyph-orientation-vertical":0,"image-rendering":0,kerning:0,"letter-spacing":0,"lighting-color":0,marker:0,"marker-end":0,"marker-mid":0,"marker-start":0,mask:0,opacity:0,overflow:0,"pointer-events":0,"shape-rendering":0,"stop-color":0,"stop-opacity":0,stroke:0,"stroke-dasharray":0,"stroke-dashoffset":0,"stroke-linecap":0,"stroke-linejoin":0,"stroke-miterlimit":0,"stroke-opacity":0,
"stroke-width":0,"text-anchor":0,"text-decoration":0,"text-rendering":0,"unicode-bidi":0,visibility:0,"word-spacing":0,"writing-mode":0};e.on("snap.util.attr",function(b){var f=e.nt(),h={},f=f.substring(f.lastIndexOf(".")+1);h[f]=b;var m=f.replace(/-(\w)/gi,function(b,e){return e.toUpperCase()}),f=f.replace(/[A-Z]/g,function(b){return"-"+b.toLowerCase()});Ma[I](f)?this.node.style[m]=null==b?qa:b:l(this.node,h)});f.ajax=function(b,f,h,l){var q=new XMLHttpRequest,t=ia();if(q){if(m(f,"function"))l=h,
h=f,f=null;else if(m(f,"object")){var v=[],z;for(z in f)f.hasOwnProperty(z)&&v.push(encodeURIComponent(z)+"="+encodeURIComponent(f[z]));f=v.join("&")}return q.open(f?"POST":"GET",b,!0),f&&(q.setRequestHeader("X-Requested-With","XMLHttpRequest"),q.setRequestHeader("Content-type","application/x-www-form-urlencoded")),h&&(e.once("snap.ajax."+t+".0",h),e.once("snap.ajax."+t+".200",h),e.once("snap.ajax."+t+".304",h)),q.onreadystatechange=function(){4==q.readyState&&e("snap.ajax."+t+"."+q.status,l,q)},
4==q.readyState?q:(q.send(f),q)}};f.load=function(b,e,h){f.ajax(b,function(b){b=f.parse(b.responseText);h?e.call(h,b):e(b)})};return f.getElementByPoint=function(b,e){var f,h,l=(this.canvas,G.doc.elementFromPoint(b,e));if(G.win.opera&&"svg"==l.tagName){f=l;h=f.getBoundingClientRect();f=f.ownerDocument;var m=f.body,q=f.documentElement;f=h.top+(g.win.pageYOffset||q.scrollTop||m.scrollTop)-(q.clientTop||m.clientTop||0);h=h.left+(g.win.pageXOffset||q.scrollLeft||m.scrollLeft)-(q.clientLeft||m.clientLeft||
0);m=l.createSVGRect();m.x=b-h;m.y=e-f;m.width=m.height=1;f=l.getIntersectionList(m,null);f.length&&(l=f[f.length-1])}return l?H(l):null},f.plugin=function(b){b(f,D,L,G,K)},G.win.Snap=f,f}(b||this);return l.plugin(function(l,h,q,t,w){function m(b,e){if(null==e){var f=!0;if(e=b.node.getAttribute("linearGradient"==b.type||"radialGradient"==b.type?"gradientTransform":"pattern"==b.type?"patternTransform":"transform"),!e)return new l.Matrix;e=l._.svgTransform2string(e)}else e=l._.rgTransform.test(e)?D(e).replace(/\.{3}|\u2026/g,
b._.transform||""):l._.svgTransform2string(e),E(e,"array")&&(e=l.path?l.path.toString.call(e):D(e)),b._.transform=e;var h=l._.transform2matrix(e,b.getBBox(1));return f?h:void(b.matrix=h)}function v(b){function e(b,e){var f=J(b.node,e);(f=(f=f&&f.match(m))&&f[2])&&"#"==f.charAt()&&(f=f.substring(1),f&&(q[f]=(q[f]||[]).concat(function(f){var h={};h[e]=URL(f);J(b.node,h)})))}function f(b){var e=J(b.node,"xlink:href");e&&"#"==e.charAt()&&(e=e.substring(1),e&&(q[e]=(q[e]||[]).concat(function(e){b.attr("xlink:href",
"#"+e)})))}var h,l=b.selectAll("*"),m=/^\s*url\(("|'|)(.*)\1\)\s*$/;b=[];for(var q={},t=0,v=l.length;v>t;t++){h=l[t];e(h,"fill");e(h,"stroke");e(h,"filter");e(h,"mask");e(h,"clip-path");f(h);var z=J(h.node,"id");z&&(J(h.node,{id:h.id}),b.push({old:z,id:h.id}))}t=0;for(v=b.length;v>t;t++)if(h=q[b[t].old])for(l=0,z=h.length;z>l;l++)h[l](b[t].id)}function z(b,e,f){return function(h){h=h.slice(b,e);return 1==h.length&&(h=h[0]),f?f(h):h}}function B(b){return function(){var e=b?"<"+this.type:"",f=this.node.attributes,
h=this.node.childNodes;if(b)for(var l=0,m=f.length;m>l;l++)e+=" "+f[l].name+'="'+f[l].value.replace(/"/g,'\\"')+'"';if(h.length){b&&(e+=">");l=0;for(m=h.length;m>l;l++)3==h[l].nodeType?e+=h[l].nodeValue:1==h[l].nodeType&&(e+=F(h[l]).toString());b&&(e+="</"+this.type+">")}else b&&(e+="/>");return e}}h=h.prototype;var E=l.is,D=String,K=l._unit2px,J=l._.$,L=l._.make,H=l._.getSomeDefs,F=l._.wrap;h.getBBox=function(b){if(!l.Matrix||!l.path)return this.node.getBBox();var e=this,f=new l.Matrix;if(e.removed)return l._.box();
for(;"use"==e.type;)if(b||(f=f.add(e.transform().localMatrix.translate(e.attr("x")||0,e.attr("y")||0))),e.original)e=e.original;else var h=e.attr("xlink:href"),e=e.original=e.node.ownerDocument.getElementById(h.substring(h.indexOf("#")+1));var h=e._,m=l.path.get[e.type]||l.path.get.deflt;try{return b?(h.bboxwt=m?l.path.getBBox(e.realPath=m(e)):l._.box(e.node.getBBox()),l._.box(h.bboxwt)):(e.realPath=m(e),e.matrix=e.transform().localMatrix,h.bbox=l.path.getBBox(l.path.map(e.realPath,f.add(e.matrix))),
l._.box(h.bbox))}catch(Z){return l._.box()}};var G=function(){return this.string};h.transform=function(b){var e=this._;if(null==b){var f;f=this;b=new l.Matrix(this.node.getCTM());for(var h=m(this),q=[h],t=new l.Matrix,v=h.toTransformString(),e=D(h)==D(this.matrix)?D(e.transform):v;"svg"!=f.type&&(f=f.parent());)q.push(m(f));for(f=q.length;f--;)t.add(q[f]);return{string:e,globalMatrix:b,totalMatrix:t,localMatrix:h,diffMatrix:b.clone().add(h.invert()),global:b.toTransformString(),total:t.toTransformString(),
local:v,toString:G}}return b instanceof l.Matrix?(this.matrix=b,this._.transform=b.toTransformString()):m(this,b),this.node&&("linearGradient"==this.type||"radialGradient"==this.type?J(this.node,{gradientTransform:this.matrix}):"pattern"==this.type?J(this.node,{patternTransform:this.matrix}):J(this.node,{transform:this.matrix})),this};h.parent=function(){return F(this.node.parentNode)};h.append=h.add=function(b){if(b){if("set"==b.type){var e=this;return b.forEach(function(b){e.add(b)}),this}b=F(b);
this.node.appendChild(b.node);b.paper=this.paper}return this};h.appendTo=function(b){return b&&(b=F(b),b.append(this)),this};h.prepend=function(b){if(b){if("set"==b.type){var e,f=this;return b.forEach(function(b){e?e.after(b):f.prepend(b);e=b}),this}b=F(b);var h=b.parent();this.node.insertBefore(b.node,this.node.firstChild);this.add&&this.add();b.paper=this.paper;this.parent()&&this.parent().add();h&&h.add()}return this};h.prependTo=function(b){return b=F(b),b.prepend(this),this};h.before=function(b){if("set"==
b.type){var e=this;return b.forEach(function(b){var f=b.parent();e.node.parentNode.insertBefore(b.node,e.node);f&&f.add()}),this.parent().add(),this}b=F(b);var f=b.parent();return this.node.parentNode.insertBefore(b.node,this.node),this.parent()&&this.parent().add(),f&&f.add(),b.paper=this.paper,this};h.after=function(b){b=F(b);var e=b.parent();return this.node.nextSibling?this.node.parentNode.insertBefore(b.node,this.node.nextSibling):this.node.parentNode.appendChild(b.node),this.parent()&&this.parent().add(),
e&&e.add(),b.paper=this.paper,this};h.insertBefore=function(b){b=F(b);var e=this.parent();return b.node.parentNode.insertBefore(this.node,b.node),this.paper=b.paper,e&&e.add(),b.parent()&&b.parent().add(),this};h.insertAfter=function(b){b=F(b);var e=this.parent();return b.node.parentNode.insertBefore(this.node,b.node.nextSibling),this.paper=b.paper,e&&e.add(),b.parent()&&b.parent().add(),this};h.remove=function(){var b=this.parent();return this.node.parentNode&&this.node.parentNode.removeChild(this.node),
delete this.paper,this.removed=!0,b&&b.add(),this};h.select=function(b){return F(this.node.querySelector(b))};h.selectAll=function(b){b=this.node.querySelectorAll(b);for(var e=(l.set||Array)(),f=0;f<b.length;f++)e.push(F(b[f]));return e};h.asPX=function(b,e){return null==e&&(e=this.attr(b)),+K(this,b,e)};h.use=function(){var b,e=this.node.id;return e||(e=this.id,J(this.node,{id:e})),b="linearGradient"==this.type||"radialGradient"==this.type||"pattern"==this.type?L(this.type,this.node.parentNode):
L("use",this.node.parentNode),J(b.node,{"xlink:href":"#"+e}),b.original=this,b};h.clone=function(){var b=F(this.node.cloneNode(!0));return J(b.node,"id")&&J(b.node,{id:b.id}),v(b),b.insertAfter(this),b};h.toDefs=function(){return H(this).appendChild(this.node),this};h.pattern=h.toPattern=function(b,e,f,h){var l=L("pattern",H(this));return null==b&&(b=this.getBBox()),E(b,"object")&&"x"in b&&(e=b.y,f=b.width,h=b.height,b=b.x),J(l.node,{x:b,y:e,width:f,height:h,patternUnits:"userSpaceOnUse",id:l.id,
viewBox:[b,e,f,h].join(" ")}),l.node.appendChild(this.node),l};h.marker=function(b,e,f,h,l,m){var q=L("marker",H(this));return null==b&&(b=this.getBBox()),E(b,"object")&&"x"in b&&(e=b.y,f=b.width,h=b.height,l=b.refX||b.cx,m=b.refY||b.cy,b=b.x),J(q.node,{viewBox:[b,e,f,h].join(" "),markerWidth:f,markerHeight:h,orient:"auto",refX:l||0,refY:m||0,id:q.id}),q.node.appendChild(this.node),q};var I=function(b,e,h,l){"function"!=typeof h||h.length||(l=h,h=f.linear);this.attr=b;this.dur=e;h&&(this.easing=h);
l&&(this.callback=l)};l._.Animation=I;l.animation=function(b,e,f,h){return new I(b,e,f,h)};h.inAnim=function(){var b=[],e;for(e in this.anims)this.anims.hasOwnProperty(e)&&!function(e){b.push({anim:new I(e._attrs,e.dur,e.easing,e._callback),mina:e,curStatus:e.status(),status:function(b){return e.status(b)},stop:function(){e.stop()}})}(this.anims[e]);return b};l.animate=function(b,h,l,m,q,t){"function"!=typeof q||q.length||(t=q,q=f.linear);var v=f.time();b=f(b,h,v,v+m,f.time,l,q);return t&&e.once("mina.finish."+
b.id,t),b};h.stop=function(){for(var b=this.inAnim(),e=0,f=b.length;f>e;e++)b[e].stop();return this};h.animate=function(b,h,l,m){"function"!=typeof l||l.length||(m=l,l=f.linear);b instanceof I&&(m=b.callback,l=b.easing,h=b.dur,b=b.attr);var q,t,v,w,y=[],B=[],F={},K=this,H;for(H in b)if(b.hasOwnProperty(H)){K.equal?(w=K.equal(H,D(b[H])),q=w.from,t=w.to,v=w.f):(q=+K.attr(H),t=+b[H]);var J=E(q,"array")?q.length:1;F[H]=z(y.length,y.length+J,v);y=y.concat(q);B=B.concat(t)}q=f.time();var G=f(y,B,q,q+h,
f.time,function(b){var e={},f;for(f in F)F.hasOwnProperty(f)&&(e[f]=F[f](b));K.attr(e)},l);return K.anims[G.id]=G,G._attrs=b,G._callback=m,e("snap.animcreated."+K.id,G),e.once("mina.finish."+G.id,function(){delete K.anims[G.id];m&&m.call(K)}),e.once("mina.stop."+G.id,function(){delete K.anims[G.id]}),K};var Q={};h.data=function(b,f){var h=Q[this.id]=Q[this.id]||{};if(0==arguments.length)return e("snap.data.get."+this.id,this,h,null),h;if(1==arguments.length){if(l.is(b,"object")){for(var m in b)b.hasOwnProperty(m)&&
this.data(m,b[m]);return this}return e("snap.data.get."+this.id,this,h[b],b),h[b]}return h[b]=f,e("snap.data.set."+this.id,this,f,b),this};h.removeData=function(b){return null==b?Q[this.id]={}:Q[this.id]&&delete Q[this.id][b],this};h.outerSVG=h.toString=B(1);h.innerSVG=B();h.toDataURL=function(){if(b&&b.btoa){var e=this.getBBox(),e=l.format('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="{width}" height="{height}" viewBox="{x} {y} {width} {height}">{contents}</svg>',
{x:+e.x.toFixed(3),y:+e.y.toFixed(3),width:+e.width.toFixed(3),height:+e.height.toFixed(3),contents:this.outerSVG()});return"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e)))}};w.prototype.select=h.select;w.prototype.selectAll=h.selectAll}),l.plugin(function(b){function e(b,e,h,l,m,q){return null==e&&"[object SVGMatrix]"==f.call(b)?(this.a=b.a,this.b=b.b,this.c=b.c,this.d=b.d,this.e=b.e,void(this.f=b.f)):void(null!=b?(this.a=+b,this.b=+e,this.c=+h,this.d=+l,this.e=+m,this.f=+q):(this.a=
1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0))}var f=Object.prototype.toString,l=String,m=Math;!function(f){function h(b){return b[0]*b[0]+b[1]*b[1]}function q(b){var e=m.sqrt(h(b));b[0]&&(b[0]/=e);b[1]&&(b[1]/=e)}f.add=function(b,f,h,l,m,q){var t=[[],[],[]],v=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];f=[[b,h,m],[f,l,q],[0,0,1]];b&&b instanceof e&&(f=[[b.a,b.c,b.e],[b.b,b.d,b.f],[0,0,1]]);for(b=0;3>b;b++)for(h=0;3>h;h++){for(l=m=0;3>l;l++)m+=v[b][l]*f[l][h];t[b][h]=m}return this.a=
t[0][0],this.b=t[1][0],this.c=t[0][1],this.d=t[1][1],this.e=t[0][2],this.f=t[1][2],this};f.invert=function(){var b=this.a*this.d-this.b*this.c;return new e(this.d/b,-this.b/b,-this.c/b,this.a/b,(this.c*this.f-this.d*this.e)/b,(this.b*this.e-this.a*this.f)/b)};f.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)};f.translate=function(b,e){return this.add(1,0,0,1,b,e)};f.scale=function(b,e,f,h){return null==e&&(e=b),(f||h)&&this.add(1,0,0,1,f,h),this.add(b,0,0,e,0,0),(f||h)&&this.add(1,
0,0,1,-f,-h),this};f.rotate=function(e,f,h){e=b.rad(e);f=f||0;h=h||0;var l=+m.cos(e).toFixed(9);e=+m.sin(e).toFixed(9);return this.add(l,e,-e,l,f,h),this.add(1,0,0,1,-f,-h)};f.x=function(b,e){return b*this.a+e*this.c+this.e};f.y=function(b,e){return b*this.b+e*this.d+this.f};f.get=function(b){return+this[l.fromCharCode(97+b)].toFixed(4)};f.toString=function(){return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")"};f.offset=function(){return[this.e.toFixed(4),
this.f.toFixed(4)]};f.determinant=function(){return this.a*this.d-this.b*this.c};f.split=function(){var e={};e.dx=this.e;e.dy=this.f;var f=[[this.a,this.c],[this.b,this.d]];e.scalex=m.sqrt(h(f[0]));q(f[0]);e.shear=f[0][0]*f[1][0]+f[0][1]*f[1][1];f[1]=[f[1][0]-f[0][0]*e.shear,f[1][1]-f[0][1]*e.shear];e.scaley=m.sqrt(h(f[1]));q(f[1]);e.shear/=e.scaley;0>this.determinant()&&(e.scalex=-e.scalex);var l=-f[0][1],f=f[1][1];return 0>f?(e.rotate=b.deg(m.acos(f)),0>l&&(e.rotate=360-e.rotate)):e.rotate=b.deg(m.asin(l)),
e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e};f.toTransformString=function(b){b=b||this.split();return+b.shear.toFixed(9)?"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]:(b.scalex=+b.scalex.toFixed(4),b.scaley=+b.scaley.toFixed(4),b.rotate=+b.rotate.toFixed(4),(b.dx||b.dy?"t"+[+b.dx.toFixed(4),
+b.dy.toFixed(4)]:"")+(1!=b.scalex||1!=b.scaley?"s"+[b.scalex,b.scaley,0,0]:"")+(b.rotate?"r"+[+b.rotate.toFixed(4),0,0]:""))}}(e.prototype);b.Matrix=e;b.matrix=function(b,f,h,l,m,q){return new e(b,f,h,l,m,q)}}),l.plugin(function(b,f,l,t,w){function h(h){return function(l){if(e.stop(),l instanceof w&&1==l.node.childNodes.length&&("radialGradient"==l.node.firstChild.tagName||"linearGradient"==l.node.firstChild.tagName||"pattern"==l.node.firstChild.tagName)&&(l=l.node.firstChild,J(this).appendChild(l),
l=D(l)),l instanceof f)if("radialGradient"==l.type||"linearGradient"==l.type||"pattern"==l.type){l.node.id||H(l.node,{id:l.id});var m=F(l.node.id)}else m=l.attr(h);else if(m=b.color(l),m.error){var q=b(J(this).ownerSVGElement).gradient(l);q?(q.node.id||H(q.node,{id:q.id}),m=F(q.node.id)):m=l}else m=G(m);l={};l[h]=m;H(this.node,l);this.node.style[h]=Q}}function m(b){e.stop();b==+b&&(b+="px");this.node.style.fontSize=b}function q(b){var e=[];b=b.childNodes;for(var f=0,h=b.length;h>f;f++){var l=b[f];
3==l.nodeType&&e.push(l.nodeValue);"tspan"==l.tagName&&e.push(1==l.childNodes.length&&3==l.firstChild.nodeType?l.firstChild.nodeValue:q(l))}return e}function B(){return e.stop(),this.node.style.fontSize}var E=b._.make,D=b._.wrap,K=b.is,J=b._.getSomeDefs,L=/^url\(#?([^)]+)\)$/,H=b._.$,F=b.url,G=String,I=b._.separator,Q="";e.on("snap.util.attr.mask",function(b){if(b instanceof f||b instanceof w){if(e.stop(),b instanceof w&&1==b.node.childNodes.length&&(b=b.node.firstChild,J(this).appendChild(b),b=D(b)),
"mask"==b.type)var h=b;else h=E("mask",J(this)),h.node.appendChild(b.node);!h.node.id&&H(h.node,{id:h.id});H(this.node,{mask:F(h.id)})}});(function(b){e.on("snap.util.attr.clip",b);e.on("snap.util.attr.clip-path",b);e.on("snap.util.attr.clipPath",b)})(function(b){if(b instanceof f||b instanceof w){if(e.stop(),"clipPath"==b.type)var h=b;else h=E("clipPath",J(this)),h.node.appendChild(b.node),!h.node.id&&H(h.node,{id:h.id});H(this.node,{"clip-path":F(h.node.id||h.id)})}});e.on("snap.util.attr.fill",
h("fill"));e.on("snap.util.attr.stroke",h("stroke"));var O=/^([lr])(?:\(([^)]*)\))?(.*)$/i;e.on("snap.util.grad.parse",function(b){b=G(b);var e=b.match(O);if(!e)return null;b=e[1];var f=e[2],e=e[3];return f=f.split(/\s*,\s*/).map(function(b){return+b==b?+b:b}),1==f.length&&0==f[0]&&(f=[]),e=e.split("-"),e=e.map(function(b){b=b.split(":");var e={color:b[0]};return b[1]&&(e.offset=parseFloat(b[1])),e}),{type:b,params:f,stops:e}});e.on("snap.util.attr.d",function(f){e.stop();K(f,"array")&&K(f[0],"array")&&
(f=b.path.toString.call(f));f=G(f);f.match(/[ruo]/i)&&(f=b.path.toAbsolute(f));H(this.node,{d:f})})(-1);e.on("snap.util.attr.#text",function(b){e.stop();b=G(b);for(b=t.doc.createTextNode(b);this.node.firstChild;)this.node.removeChild(this.node.firstChild);this.node.appendChild(b)})(-1);e.on("snap.util.attr.path",function(b){e.stop();this.attr({d:b})})(-1);e.on("snap.util.attr.class",function(b){e.stop();this.node.className.baseVal=b})(-1);e.on("snap.util.attr.viewBox",function(b){b=K(b,"object")&&
"x"in b?[b.x,b.y,b.width,b.height].join(" "):K(b,"array")?b.join(" "):b;H(this.node,{viewBox:b});e.stop()})(-1);e.on("snap.util.attr.transform",function(b){this.transform(b);e.stop()})(-1);e.on("snap.util.attr.r",function(b){"rect"==this.type&&(e.stop(),H(this.node,{rx:b,ry:b}))})(-1);e.on("snap.util.attr.textpath",function(b){if(e.stop(),"text"==this.type){var h,l;if(!b&&this.textPath){for(l=this.textPath;l.node.firstChild;)this.node.appendChild(l.node.firstChild);return l.remove(),void delete this.textPath}K(b,
"string")?(h=J(this),b=D(h.parentNode).path(b),h.appendChild(b.node),h=b.id,b.attr({id:h})):(b=D(b),b instanceof f&&(h=b.attr("id"),h||(h=b.id,b.attr({id:h}))));if(h)if(l=this.textPath,b=this.node,l)l.attr({"xlink:href":"#"+h});else{for(l=H("textPath",{"xlink:href":"#"+h});b.firstChild;)l.appendChild(b.firstChild);b.appendChild(l);this.textPath=D(l)}}})(-1);e.on("snap.util.attr.text",function(b){if("text"==this.type){for(var f=this.node,h=function(b){var e=H("tspan");if(K(b,"array"))for(var f=0;f<
b.length;f++)e.appendChild(h(b[f]));else e.appendChild(t.doc.createTextNode(b));return e.normalize&&e.normalize(),e};f.firstChild;)f.removeChild(f.firstChild);for(b=h(b);b.firstChild;)f.appendChild(b.firstChild)}e.stop()})(-1);e.on("snap.util.attr.fontSize",m)(-1);e.on("snap.util.attr.font-size",m)(-1);e.on("snap.util.getattr.transform",function(){return e.stop(),this.transform()})(-1);e.on("snap.util.getattr.textpath",function(){return e.stop(),this.textPath})(-1);(function(){function f(f){return function(){e.stop();
var h=t.doc.defaultView.getComputedStyle(this.node,null).getPropertyValue("marker-"+f);return"none"==h?h:b(t.doc.getElementById(h.match(L)[1]))}}function h(b){return function(f){e.stop();var h="marker"+b.charAt(0).toUpperCase()+b.substring(1);if(""==f||!f)return void(this.node.style[h]="none");if("marker"==f.type){var l=f.node.id;return l||H(f.node,{id:f.id}),void(this.node.style[h]=F(l))}}}e.on("snap.util.getattr.marker-end",f("end"))(-1);e.on("snap.util.getattr.markerEnd",f("end"))(-1);e.on("snap.util.getattr.marker-start",
f("start"))(-1);e.on("snap.util.getattr.markerStart",f("start"))(-1);e.on("snap.util.getattr.marker-mid",f("mid"))(-1);e.on("snap.util.getattr.markerMid",f("mid"))(-1);e.on("snap.util.attr.marker-end",h("end"))(-1);e.on("snap.util.attr.markerEnd",h("end"))(-1);e.on("snap.util.attr.marker-start",h("start"))(-1);e.on("snap.util.attr.markerStart",h("start"))(-1);e.on("snap.util.attr.marker-mid",h("mid"))(-1);e.on("snap.util.attr.markerMid",h("mid"))(-1)})();e.on("snap.util.getattr.r",function(){return"rect"==
this.type&&H(this.node,"rx")==H(this.node,"ry")?(e.stop(),H(this.node,"rx")):void 0})(-1);e.on("snap.util.getattr.text",function(){if("text"==this.type||"tspan"==this.type){e.stop();var b=q(this.node);return 1==b.length?b[0]:b}})(-1);e.on("snap.util.getattr.#text",function(){return this.node.textContent})(-1);e.on("snap.util.getattr.viewBox",function(){e.stop();var f=H(this.node,"viewBox");return f?(f=f.split(I),b._.box(+f[0],+f[1],+f[2],+f[3])):void 0})(-1);e.on("snap.util.getattr.points",function(){var b=
H(this.node,"points");return e.stop(),b?b.split(I):void 0})(-1);e.on("snap.util.getattr.path",function(){var b=H(this.node,"d");return e.stop(),b})(-1);e.on("snap.util.getattr.class",function(){return this.node.className.baseVal})(-1);e.on("snap.util.getattr.fontSize",B)(-1);e.on("snap.util.getattr.font-size",B)(-1)}),l.plugin(function(b,e){var f=/\S+/g,h=String,l=e.prototype;l.addClass=function(b){var e,l,m,q=h(b||"").match(f)||[];b=this.node;var t=b.className.baseVal,w=t.match(f)||[];if(q.length){for(e=
0;m=q[e++];)l=w.indexOf(m),~l||w.push(m);e=w.join(" ");t!=e&&(b.className.baseVal=e)}return this};l.removeClass=function(b){var e,l,m=h(b||"").match(f)||[];b=this.node;var q=b.className.baseVal,t=q.match(f)||[];if(t.length){for(e=0;l=m[e++];)l=t.indexOf(l),~l&&t.splice(l,1);e=t.join(" ");q!=e&&(b.className.baseVal=e)}return this};l.hasClass=function(b){return!!~(this.node.className.baseVal.match(f)||[]).indexOf(b)};l.toggleClass=function(b,e){if(null!=e)return e?this.addClass(b):this.removeClass(b);
var h,l,m,q,t=(b||"").match(f)||[],v=this.node,w=v.className.baseVal,y=w.match(f)||[];for(h=0;m=t[h++];)l=y.indexOf(m),~l?y.splice(l,1):y.push(m);return q=y.join(" "),w!=q&&(v.className.baseVal=q),this}}),l.plugin(function(){function b(b){return b}function f(b){return function(e){return+e.toFixed(3)+b}}var l={"+":function(b,e){return b+e},"-":function(b,e){return b-e},"/":function(b,e){return b/e},"*":function(b,e){return b*e}},t=String,w=/[a-z]+$/i,y=/^\s*([+\-\/*])\s*=\s*([\d.eE+\-]+)\s*([^\d\s]+)?\s*$/;
e.on("snap.util.attr",function(b){var f=t(b).match(y);if(f){var h=e.nt(),h=h.substring(h.lastIndexOf(".")+1),m=this.attr(h),q={};e.stop();var v=f[3]||"",J=m.match(w),L=l[f[1]];(J&&J==v?b=L(parseFloat(m),+f[2]):(m=this.asPX(h),b=L(this.asPX(h),this.asPX(h,f[2]+v))),isNaN(m)||isNaN(b))||(q[h]=b,this.attr(q))}})(-10);e.on("snap.util.equal",function(h,m){var q=t(this.attr(h)||""),v=t(m).match(y);if(v){e.stop();var z=v[3]||"",K=q.match(w),J=l[v[1]];return K&&K==z?{from:parseFloat(q),to:J(parseFloat(q),
+v[2]),f:f(K)}:(q=this.asPX(h),{from:q,to:J(q,this.asPX(h,v[2]+z)),f:b})}})(-10)}),l.plugin(function(f,h,l,t){var m=l.prototype,q=f.is;m.rect=function(b,e,f,h,l,m){var t;return null==m&&(m=l),q(b,"object")&&"[object Object]"==b?t=b:null!=b&&(t={x:b,y:e,width:f,height:h},null!=l&&(t.rx=l,t.ry=m)),this.el("rect",t)};m.circle=function(b,e,f){var h;return q(b,"object")&&"[object Object]"==b?h=b:null!=b&&(h={cx:b,cy:e,r:f}),this.el("circle",h)};var v=function(){function b(){this.parentNode.removeChild(this)}
return function(e,f){var h=t.doc.createElement("img"),l=t.doc.body;h.style.cssText="position:absolute;left:-9999em;top:-9999em";h.onload=function(){f.call(h);h.onload=h.onerror=null;l.removeChild(h)};h.onerror=b;l.appendChild(h);h.src=e}}();m.image=function(b,e,h,l,m){var t=this.el("image");if(q(b,"object")&&"src"in b)t.attr(b);else if(null!=b){var z={"xlink:href":b,preserveAspectRatio:"none"};null!=e&&null!=h&&(z.x=e,z.y=h);null!=l&&null!=m?(z.width=l,z.height=m):v(b,function(){f._.$(t.node,{width:this.offsetWidth,
height:this.offsetHeight})});f._.$(t.node,z)}return t};m.ellipse=function(b,e,f,h){var l;return q(b,"object")&&"[object Object]"==b?l=b:null!=b&&(l={cx:b,cy:e,rx:f,ry:h}),this.el("ellipse",l)};m.path=function(b){var e;return q(b,"object")&&!q(b,"array")?e=b:b&&(e={d:b}),this.el("path",e)};m.group=m.g=function(b){var e=this.el("g");return 1==arguments.length&&b&&!b.type?e.attr(b):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e};m.svg=function(b,e,f,h,l,m,t,v){var z={};return q(b,
"object")&&null==e?z=b:(null!=b&&(z.x=b),null!=e&&(z.y=e),null!=f&&(z.width=f),null!=h&&(z.height=h),null!=l&&null!=m&&null!=t&&null!=v&&(z.viewBox=[l,m,t,v])),this.el("svg",z)};m.mask=function(b){var e=this.el("mask");return 1==arguments.length&&b&&!b.type?e.attr(b):arguments.length&&e.add(Array.prototype.slice.call(arguments,0)),e};m.ptrn=function(b,e,f,h,l,m,t,v){if(q(b,"object"))var z=b;else z={patternUnits:"userSpaceOnUse"},b&&(z.x=b),e&&(z.y=e),null!=f&&(z.width=f),null!=h&&(z.height=h),z.viewBox=
null!=l&&null!=m&&null!=t&&null!=v?[l,m,t,v]:[b||0,e||0,f||0,h||0];return this.el("pattern",z)};m.use=function(b){return null!=b?(b instanceof h&&(b.attr("id")||b.attr({id:f._.id(b)}),b=b.attr("id")),"#"==String(b).charAt()&&(b=b.substring(1)),this.el("use",{"xlink:href":"#"+b})):h.prototype.use.call(this)};m.symbol=function(b,e,f,h){var l={};return null!=b&&null!=e&&null!=f&&null!=h&&(l.viewBox=[b,e,f,h]),this.el("symbol",l)};m.text=function(b,e,f){var h={};return q(b,"object")?h=b:null!=b&&(h={x:b,
y:e,text:f||""}),this.el("text",h)};m.line=function(b,e,f,h){var l={};return q(b,"object")?l=b:null!=b&&(l={x1:b,x2:f,y1:e,y2:h}),this.el("line",l)};m.polyline=function(b){1<arguments.length&&(b=Array.prototype.slice.call(arguments,0));var e={};return q(b,"object")&&!q(b,"array")?e=b:null!=b&&(e={points:b}),this.el("polyline",e)};m.polygon=function(b){1<arguments.length&&(b=Array.prototype.slice.call(arguments,0));var e={};return q(b,"object")&&!q(b,"array")?e=b:null!=b&&(e={points:b}),this.el("polygon",
e)};(function(){function h(){return this.selectAll("stop")}function l(b,e){var h=y("stop"),l={offset:+e+"%"};return b=f.color(b),l["stop-color"]=b.hex,1>b.opacity&&(l["stop-opacity"]=b.opacity),y(h,l),this.node.appendChild(h),this}function q(){if("linearGradient"==this.type){var b=y(this.node,"x1")||0,e=y(this.node,"x2")||1,h=y(this.node,"y1")||0,l=y(this.node,"y2")||0;return f._.box(b,h,math.abs(e-b),math.abs(l-h))}b=this.node.r||0;return f._.box((this.node.cx||.5)-b,(this.node.cy||.5)-b,2*b,2*b)}
function t(b,f){function h(b,e){for(var f=(e-t)/(b-z),h=z;b>h;h++)q[h].offset=+(+t+f*(h-z)).toFixed(2);z=b;t=e}var l,m=e("snap.util.grad.parse",null,f).firstDefined();if(!m)return null;m.params.unshift(b);l="l"==m.type.toLowerCase()?v.apply(0,m.params):w.apply(0,m.params);m.type!=m.type.toLowerCase()&&y(l.node,{gradientUnits:"userSpaceOnUse"});var q=m.stops,m=q.length,t=0,z=0;m--;for(var B=0;m>B;B++)"offset"in q[B]&&h(B,q[B].offset);q[m].offset=q[m].offset||100;h(m,q[m].offset);for(B=0;m>=B;B++){var E=
q[B];l.addStop(E.color,E.offset)}return l}function v(b,e,m,t,v){b=f._.make("linearGradient",b);return b.stops=h,b.addStop=l,b.getBBox=q,null!=e&&y(b.node,{x1:e,y1:m,x2:t,y2:v}),b}function w(b,e,m,t,v,w){b=f._.make("radialGradient",b);return b.stops=h,b.addStop=l,b.getBBox=q,null!=e&&y(b.node,{cx:e,cy:m,r:t}),null!=v&&null!=w&&y(b.node,{fx:v,fy:w}),b}var y=f._.$;m.gradient=function(b){return t(this.defs,b)};m.gradientLinear=function(b,e,f,h){return v(this.defs,b,e,f,h)};m.gradientRadial=function(b,
e,f,h,l){return w(this.defs,b,e,f,h,l)};m.toString=function(){var b,e=this.node.ownerDocument,h=e.createDocumentFragment(),e=e.createElement("div"),l=this.node.cloneNode(!0);return h.appendChild(e),e.appendChild(l),f._.$(l,{xmlns:"http://www.w3.org/2000/svg"}),b=e.innerHTML,h.removeChild(h.firstChild),b};m.toDataURL=function(){return b&&b.btoa?"data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(this))):void 0};m.clear=function(){for(var b,e=this.node.firstChild;e;)b=e.nextSibling,"defs"!=
e.tagName?e.parentNode.removeChild(e):m.clear.call({node:e}),e=b}})()}),l.plugin(function(b,e){function f(b){var e=f.ps=f.ps||{};return e[b]?e[b].sleep=100:e[b]={sleep:100},setTimeout(function(){for(var f in e)e[ha](f)&&f!=b&&(e[f].sleep--,!e[f].sleep&&delete e[f])}),e[b]}function h(b,e,f,h){return null==b&&(b=e=f=h=0),null==e&&(e=b.y,f=b.width,h=b.height,b=b.x),{x:b,y:e,width:f,w:f,height:h,h:h,x2:b+f,y2:e+h,cx:b+f/2,cy:e+h/2,r1:N.min(f,h)/2,r2:N.max(f,h)/2,r0:N.sqrt(f*f+h*h)/2,path:F(b,e,f,h),vb:[b,
e,f,h].join(" ")}}function l(){return this.join(",").replace(da,"$1")}function m(b){b=qa(b);return b.toString=l,b}function v(b,e,f,h,l,m,q,t,v){if(null==v)b=J(b,e,f,h,l,m,q,t);else{if(0>v||J(b,e,f,h,l,m,q,t)<v)v=void 0;else{var w,z=.5,y=1-z;for(w=J(b,e,f,h,l,m,q,t,y);.01<Da(w-v);)z/=2,y+=(v>w?1:-1)*z,w=J(b,e,f,h,l,m,q,t,y);v=y}b=B(b,e,f,h,l,m,q,t,v)}return b}function z(f,h){function l(b){return+(+b).toFixed(3)}return b._.cacher(function(b,m,q){b instanceof e&&(b=b.attr("d"));b=la(b);for(var t,w,z,
y,E,D="",F={},G=0,W=0,K=b.length;K>W;W++){if(z=b[W],"M"==z[0])t=+z[1],w=+z[2];else{if(y=v(t,w,z[1],z[2],z[3],z[4],z[5],z[6]),G+y>m){if(h&&!F.start){if(E=v(t,w,z[1],z[2],z[3],z[4],z[5],z[6],m-G),D+=["C"+l(E.start.x),l(E.start.y),l(E.m.x),l(E.m.y),l(E.x),l(E.y)],q)return D;F.start=D;D=["M"+l(E.x),l(E.y)+"C"+l(E.n.x),l(E.n.y),l(E.end.x),l(E.end.y),l(z[5]),l(z[6])].join();G+=y;t=+z[5];w=+z[6];continue}if(!f&&!h)return v(t,w,z[1],z[2],z[3],z[4],z[5],z[6],m-G)}G+=y;t=+z[5];w=+z[6]}D+=z.shift()+z}return F.end=
D,f?G:h?F:B(t,w,z[0],z[1],z[2],z[3],z[4],z[5],1)},null,b._.clone)}function B(b,e,f,h,l,m,q,t,v){var z=1-v,w=ua(z,3),y=ua(z,2),B=v*v,E=B*v,D=w*b+3*y*v*f+3*z*v*v*l+E*q,w=w*e+3*y*v*h+3*z*v*v*m+E*t,y=b+2*v*(f-b)+B*(l-2*f+b),E=e+2*v*(h-e)+B*(m-2*h+e),F=f+2*v*(l-f)+B*(q-2*l+f),B=h+2*v*(m-h)+B*(t-2*m+h);b=z*b+v*f;e=z*e+v*h;l=z*l+v*q;m=z*m+v*t;t=90-180*N.atan2(y-F,E-B)/aa;return{x:D,y:w,m:{x:y,y:E},n:{x:F,y:B},start:{x:b,y:e},end:{x:l,y:m},alpha:t}}function E(e,f,l,m,q,t,v,z){b.is(e,"array")||(e=[e,f,l,m,
q,t,v,z]);e=V.apply(null,e);return h(e.min.x,e.min.y,e.max.x-e.min.x,e.max.y-e.min.y)}function D(b,e,f){return e>=b.x&&e<=b.x+b.width&&f>=b.y&&f<=b.y+b.height}function K(b,e){return b=h(b),e=h(e),D(e,b.x,b.y)||D(e,b.x2,b.y)||D(e,b.x,b.y2)||D(e,b.x2,b.y2)||D(b,e.x,e.y)||D(b,e.x2,e.y)||D(b,e.x,e.y2)||D(b,e.x2,e.y2)||(b.x<e.x2&&b.x>e.x||e.x<b.x2&&e.x>b.x)&&(b.y<e.y2&&b.y>e.y||e.y<b.y2&&e.y>b.y)}function J(b,e,f,h,l,m,q,t,v){null==v&&(v=1);v=(1<v?1:0>v?0:v)/2;for(var z=[-.1252,.1252,-.3678,.3678,-.5873,
.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],w=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],y=0,B=0;12>B;B++)var E=v*z[B]+v,D=E*(E*(-3*b+9*f-9*l+3*q)+6*b-12*f+6*l)-3*b+3*f,E=E*(E*(-3*e+9*h-9*m+3*t)+6*e-12*h+6*m)-3*e+3*h,y=y+w[B]*N.sqrt(D*D+E*E);return v*y}function L(b,e,f){b=la(b);e=la(e);for(var h,l,m,q,t,v,z,w,y,D,F=f?0:[],G=0,I=b.length;I>G;G++){var H=b[G];if("M"==H[0])h=t=H[1],l=v=H[2];else{"C"==H[0]?(y=[h,l].concat(H.slice(1)),h=y[6],l=y[7]):(y=[h,l,h,l,t,v,t,v],
h=t,l=v);for(var H=0,x=e.length;x>H;H++){var W=e[H];if("M"==W[0])m=z=W[1],q=w=W[2];else{"C"==W[0]?(D=[m,q].concat(W.slice(1)),m=D[6],q=D[7]):(D=[m,q,m,q,z,w,z,w],m=z,q=w);var L=y,O=D,W=f,Q=E(L),S=E(O);if(K(Q,S)){for(var Q=J.apply(0,L),S=J.apply(0,O),Q=~~(Q/8),S=~~(S/8),V=[],Ha=[],Pa={},ta=W?0:[],N=0;Q+1>N;N++){var Z=B.apply(0,L.concat(N/Q));V.push({x:Z.x,y:Z.y,t:N/Q})}for(N=0;S+1>N;N++)Z=B.apply(0,O.concat(N/S)),Ha.push({x:Z.x,y:Z.y,t:N/S});for(N=0;Q>N;N++)for(L=0;S>L;L++){var na=V[N],qa=V[N+1],O=
Ha[L],Z=Ha[L+1],aa=.001>Da(qa.x-na.x)?"y":"x",da=.001>Da(Z.x-O.x)?"y":"x",ma;b:{ma=na.x;var ea=na.y,ha=qa.x,fa=qa.y,R=O.x,ja=O.y,ia=Z.x,ka=Z.y;if(!(T(ma,ha)<ca(R,ia)||ca(ma,ha)>T(R,ia)||T(ea,fa)<ca(ja,ka)||ca(ea,fa)>T(ja,ka))){var ua=(ma-ha)*(ja-ka)-(ea-fa)*(R-ia);if(ua){var Qa=((ma*fa-ea*ha)*(R-ia)-(ma-ha)*(R*ka-ja*ia))/ua,ua=((ma*fa-ea*ha)*(ja-ka)-(ea-fa)*(R*ka-ja*ia))/ua,ya=+Qa.toFixed(2),Ra=+ua.toFixed(2);if(!(ya<+ca(ma,ha).toFixed(2)||ya>+T(ma,ha).toFixed(2)||ya<+ca(R,ia).toFixed(2)||ya>+T(R,
ia).toFixed(2)||Ra<+ca(ea,fa).toFixed(2)||Ra>+T(ea,fa).toFixed(2)||Ra<+ca(ja,ka).toFixed(2)||Ra>+T(ja,ka).toFixed(2))){ma={x:Qa,y:ua};break b}}}ma=void 0}ma&&Pa[ma.x.toFixed(4)]!=ma.y.toFixed(4)&&(Pa[ma.x.toFixed(4)]=ma.y.toFixed(4),na=na.t+Da((ma[aa]-na[aa])/(qa[aa]-na[aa]))*(qa.t-na.t),O=O.t+Da((ma[da]-O[da])/(Z[da]-O[da]))*(Z.t-O.t),0<=na&&1>=na&&0<=O&&1>=O&&(W?ta++:ta.push({x:ma.x,y:ma.y,t1:na,t2:O})))}W=ta}else W=W?0:[];if(f)F+=W;else{Q=0;for(S=W.length;S>Q;Q++)W[Q].segment1=G,W[Q].segment2=
H,W[Q].bez1=y,W[Q].bez2=D;F=F.concat(W)}}}}}return F}function H(b){var e=f(b);if(e.bbox)return qa(e.bbox);if(!b)return h();b=la(b);for(var l,m=0,q=0,t=[],v=[],z=0,w=b.length;w>z;z++)(l=b[z],"M"==l[0])?(m=l[1],q=l[2],t.push(m),v.push(q)):(m=V(m,q,l[1],l[2],l[3],l[4],l[5],l[6]),t=t.concat(m.min.x,m.max.x),v=v.concat(m.min.y,m.max.y),m=l[5],q=l[6]);b=ca.apply(0,t);l=ca.apply(0,v);t=T.apply(0,t);v=T.apply(0,v);v=h(b,l,t-b,v-l);return e.bbox=qa(v),v}function F(b,e,f,h,m){if(m)return[["M",+b+ +m,e],["l",
f-2*m,0],["a",m,m,0,0,1,m,m],["l",0,h-2*m],["a",m,m,0,0,1,-m,m],["l",2*m-f,0],["a",m,m,0,0,1,-m,-m],["l",0,2*m-h],["a",m,m,0,0,1,m,-m],["z"]];b=[["M",b,e],["l",f,0],["l",0,h],["l",-f,0],["z"]];return b.toString=l,b}function G(b,e,f,h,m){if(null==m&&null==h&&(h=f),b=+b,e=+e,f=+f,h=+h,null!=m){var q=Math.PI/180;b=[["M",b+f*Math.cos(-h*q),e+f*Math.sin(-h*q)],["A",f,f,0,+(180<m-h),0,b+f*Math.cos(-m*q),e+f*Math.sin(-m*q)]]}else b=[["M",b,e],["m",0,-h],["a",f,h,0,1,1,0,2*h],["a",f,h,0,1,1,0,-2*h],["z"]];
return b.toString=l,b}function I(e){var h=f(e);if(h.abs)return m(h.abs);if(na(e,"array")&&na(e&&e[0],"array")||(e=b.parsePathString(e)),!e||!e.length)return[["M",0,0]];var q,t=[],v=0,z=0,w=0,y=0,B=0;"M"==e[0][0]&&(v=+e[0][1],z=+e[0][2],w=v,y=z,B++,t[0]=["M",v,z]);for(var E,D=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),F=B,K=e.length;K>F;F++){if(t.push(B=[]),E=e[F],q=E[0],q!=q.toUpperCase())switch(B[0]=q.toUpperCase(),B[0]){case "A":B[1]=E[1];B[2]=E[2];B[3]=E[3];
B[4]=E[4];B[5]=E[5];B[6]=+E[6]+v;B[7]=+E[7]+z;break;case "V":B[1]=+E[1]+z;break;case "H":B[1]=+E[1]+v;break;case "R":for(var I=[v,z].concat(E.slice(1)),H=2,J=I.length;J>H;H++)I[H]=+I[H]+v,I[++H]=+I[H]+z;t.pop();t=t.concat(ta(I,D));break;case "O":t.pop();I=G(v,z,E[1],E[2]);I.push(I[0]);t=t.concat(I);break;case "U":t.pop();t=t.concat(G(v,z,E[1],E[2],E[3]));B=["U"].concat(t[t.length-1].slice(-2));break;case "M":w=+E[1]+v,y=+E[2]+z;default:for(H=1,J=E.length;J>H;H++)B[H]=+E[H]+(H%2?v:z)}else if("R"==
q)I=[v,z].concat(E.slice(1)),t.pop(),t=t.concat(ta(I,D)),B=["R"].concat(E.slice(-2));else if("O"==q)t.pop(),I=G(v,z,E[1],E[2]),I.push(I[0]),t=t.concat(I);else if("U"==q)t.pop(),t=t.concat(G(v,z,E[1],E[2],E[3])),B=["U"].concat(t[t.length-1].slice(-2));else for(I=0,H=E.length;H>I;I++)B[I]=E[I];if(q=q.toUpperCase(),"O"!=q)switch(B[0]){case "Z":v=+w;z=+y;break;case "H":v=B[1];break;case "V":z=B[1];break;case "M":w=B[B.length-2],y=B[B.length-1];default:v=B[B.length-2],z=B[B.length-1]}}return t.toString=
l,h.abs=m(t),t}function Q(b,e,f,h){return[b,e,f,h,f,h]}function O(b,e,f,h,l,m){var q=1/3,t=2/3;return[q*b+t*f,q*e+t*h,q*l+t*f,q*m+t*h,l,m]}function S(e,f,h,l,m,q,t,v,z,w){var y,B=120*aa/180,E=aa/180*(+m||0),D=[],F=b._.cacher(function(b,e,f){var h=b*N.cos(f)-e*N.sin(f);b=b*N.sin(f)+e*N.cos(f);return{x:h,y:b}});if(w)x=w[0],y=w[1],q=w[2],I=w[3];else{y=F(e,f,-E);e=y.x;f=y.y;y=F(v,z,-E);v=y.x;z=y.y;y=(N.cos(aa/180*m),N.sin(aa/180*m),(e-v)/2);x=(f-z)/2;I=y*y/(h*h)+x*x/(l*l);1<I&&(I=N.sqrt(I),h*=I,l*=I);
var I=h*h,G=l*l,I=(q==t?-1:1)*N.sqrt(Da((I*G-I*x*x-G*y*y)/(I*x*x+G*y*y)));q=I*h*x/l+(e+v)/2;var I=I*-l*y/h+(f+z)/2,x=N.asin(((f-I)/l).toFixed(9));y=N.asin(((z-I)/l).toFixed(9));x=q>e?aa-x:x;y=q>v?aa-y:y;0>x&&(x=2*aa+x);0>y&&(y=2*aa+y);t&&x>y&&(x-=2*aa);!t&&y>x&&(y-=2*aa)}if(Da(y-x)>B){var D=y,G=v,H=z;y=x+B*(t&&y>x?1:-1);v=q+h*N.cos(y);z=I+l*N.sin(y);D=S(v,z,h,l,m,0,t,G,H,[y,D,q,I])}q=y-x;m=N.cos(x);B=N.sin(x);t=N.cos(y);y=N.sin(y);q=N.tan(q/4);h=4/3*h*q;q*=4/3*l;l=[e,f];e=[e+h*B,f-q*m];f=[v+h*y,z-
q*t];v=[v,z];if(e[0]=2*l[0]-e[0],e[1]=2*l[1]-e[1],w)return[e,f,v].concat(D);D=[e,f,v].concat(D).join().split(",");w=[];v=0;for(z=D.length;z>v;v++)w[v]=v%2?F(D[v-1],D[v],E).y:F(D[v],D[v+1],E).x;return w}function V(b,e,f,h,l,m,q,t){for(var v,z,w,y,B,E,D,F=[],I=[[],[]],x=0;2>x;++x)(0==x?(z=6*b-12*f+6*l,v=-3*b+9*f-9*l+3*q,w=3*f-3*b):(z=6*e-12*h+6*m,v=-3*e+9*h-9*m+3*t,w=3*h-3*e),1E-12>Da(v))?1E-12>Da(z)||(y=-w/z,0<y&&1>y&&F.push(y)):(y=z*z-4*w*v,D=N.sqrt(y),0>y||(B=(-z+D)/(2*v),0<B&&1>B&&F.push(B),E=(-z-
D)/(2*v),0<E&&1>E&&F.push(E)));for(w=z=F.length;z--;)y=F[z],v=1-y,I[0][z]=v*v*v*b+3*v*v*y*f+3*v*y*y*l+y*y*y*q,I[1][z]=v*v*v*e+3*v*v*y*h+3*v*y*y*m+y*y*y*t;return I[0][w]=b,I[1][w]=e,I[0][w+1]=q,I[1][w+1]=t,I[0].length=I[1].length=w+2,{min:{x:ca.apply(0,I[0]),y:ca.apply(0,I[1])},max:{x:T.apply(0,I[0]),y:T.apply(0,I[1])}}}function la(b,e){var h=!e&&f(b);if(!e&&h.curve)return m(h.curve);var l=I(b),q=e&&I(e),t={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},v={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},z=
function(b,e,f){var h,l;if(!b)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(b[0]in{T:1,Q:1})&&(e.qx=e.qy=null),b[0]){case "M":e.X=b[1];e.Y=b[2];break;case "A":b=["C"].concat(S.apply(0,[e.x,e.y].concat(b.slice(1))));break;case "S":"C"==f||"S"==f?(h=2*e.x-e.bx,l=2*e.y-e.by):(h=e.x,l=e.y);b=["C",h,l].concat(b.slice(1));break;case "T":"Q"==f||"T"==f?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y);b=["C"].concat(O(e.x,e.y,e.qx,e.qy,b[1],b[2]));break;case "Q":e.qx=b[1];e.qy=b[2];b=["C"].concat(O(e.x,
e.y,b[1],b[2],b[3],b[4]));break;case "L":b=["C"].concat(Q(e.x,e.y,b[1],b[2]));break;case "H":b=["C"].concat(Q(e.x,e.y,b[1],e.y));break;case "V":b=["C"].concat(Q(e.x,e.y,e.x,b[1]));break;case "Z":b=["C"].concat(Q(e.x,e.y,e.X,e.Y))}return b},w=function(b,e){if(7<b[e].length){b[e].shift();for(var f=b[e];f.length;)B[e]="A",q&&(E[e]="A"),b.splice(e++,0,["C"].concat(f.splice(0,6)));b.splice(e,1);H=T(l.length,q&&q.length||0)}},y=function(b,e,f,h,m){b&&e&&"M"==b[m][0]&&"M"!=e[m][0]&&(e.splice(m,0,["M",h.x,
h.y]),f.bx=0,f.by=0,f.x=b[m][1],f.y=b[m][2],H=T(l.length,q&&q.length||0))},B=[],E=[],D="",F="",G=0,H=T(l.length,q&&q.length||0);for(;H>G;G++){l[G]&&(D=l[G][0]);"C"!=D&&(B[G]=D,G&&(F=B[G-1]));l[G]=z(l[G],t,F);"A"!=B[G]&&"C"==D&&(B[G]="C");w(l,G);q&&(q[G]&&(D=q[G][0]),"C"!=D&&(E[G]=D,G&&(F=E[G-1])),q[G]=z(q[G],v,F),"A"!=E[G]&&"C"==D&&(E[G]="C"),w(q,G));y(l,q,t,v,G);y(q,l,v,t,G);var K=l[G],x=q&&q[G],J=K.length,L=q&&x.length;t.x=K[J-2];t.y=K[J-1];t.bx=fa(K[J-4])||t.x;t.by=fa(K[J-3])||t.y;v.bx=q&&(fa(x[L-
4])||v.x);v.by=q&&(fa(x[L-3])||v.y);v.x=q&&x[L-2];v.y=q&&x[L-1]}return q||(h.curve=m(l)),q?[l,q]:l}function ta(b,e){for(var f=[],h=0,l=b.length;l-2*!e>h;h+=2){var m=[{x:+b[h-2],y:+b[h-1]},{x:+b[h],y:+b[h+1]},{x:+b[h+2],y:+b[h+3]},{x:+b[h+4],y:+b[h+5]}];e?h?l-4==h?m[3]={x:+b[0],y:+b[1]}:l-2==h&&(m[2]={x:+b[0],y:+b[1]},m[3]={x:+b[2],y:+b[3]}):m[0]={x:+b[l-2],y:+b[l-1]}:l-4==h?m[3]=m[2]:h||(m[0]={x:+b[h],y:+b[h+1]});f.push(["C",(-m[0].x+6*m[1].x+m[2].x)/6,(-m[0].y+6*m[1].y+m[2].y)/6,(m[1].x+6*m[2].x-
m[3].x)/6,(m[1].y+6*m[2].y-m[3].y)/6,m[2].x,m[2].y])}return f}var Z=e.prototype,na=b.is,qa=b._.clone,ha="hasOwnProperty",da=/,?([a-z]),?/gi,fa=parseFloat,N=Math,aa=N.PI,ca=N.min,T=N.max,ua=N.pow,Da=N.abs,ia=z(1),ea=z(),ka=z(0,1),ja=b._unit2px;b.path=f;b.path.getTotalLength=ia;b.path.getPointAtLength=ea;b.path.getSubpath=function(b,e,f){if(1E-6>this.getTotalLength(b)-f)return ka(b,e).end;b=ka(b,f,1);return e?ka(b,e).end:b};Z.getTotalLength=function(){return this.node.getTotalLength?this.node.getTotalLength():
void 0};Z.getPointAtLength=function(b){return ea(this.attr("d"),b)};Z.getSubpath=function(e,f){return b.path.getSubpath(this.attr("d"),e,f)};b._.box=h;b.path.findDotsAtSegment=B;b.path.bezierBBox=E;b.path.isPointInsideBBox=D;b.closest=function(e,f,l,m){for(var q=100,t=h(e-q/2,f-q/2,q,q),v=[],z=l[0].hasOwnProperty("x")?function(b){return{x:l[b].x,y:l[b].y}}:function(b){return{x:l[b],y:m[b]}},w=0;1E6>=q&&!w;){for(var y=0,B=l.length;B>y;y++){var E=z(y);if(D(t,E.x,E.y)){w++;v.push(E);break}}w||(q*=2,
t=h(e-q/2,f-q/2,q,q))}if(1E6!=q){for(var F,q=1/0,y=0,B=v.length;B>y;y++)t=b.len(e,f,v[y].x,v[y].y),q>t&&(q=t,v[y].len=t,F=v[y]);return F}};b.path.isBBoxIntersect=K;b.path.intersection=function(b,e){return L(b,e)};b.path.intersectionNumber=function(b,e){return L(b,e,1)};b.path.isPointInside=function(b,e,f){var h=H(b);return D(h,e,f)&&1==L(b,[["M",e,f],["H",h.x2+10]],1)%2};b.path.getBBox=H;b.path.get={path:function(b){return b.attr("path")},circle:function(b){b=ja(b);return G(b.cx,b.cy,b.r)},ellipse:function(b){b=
ja(b);return G(b.cx||0,b.cy||0,b.rx,b.ry)},rect:function(b){b=ja(b);return F(b.x||0,b.y||0,b.width,b.height,b.rx,b.ry)},image:function(b){b=ja(b);return F(b.x||0,b.y||0,b.width,b.height)},line:function(b){return"M"+[b.attr("x1")||0,b.attr("y1")||0,b.attr("x2"),b.attr("y2")]},polyline:function(b){return"M"+b.attr("points")},polygon:function(b){return"M"+b.attr("points")+"z"},deflt:function(b){b=b.node.getBBox();return F(b.x,b.y,b.width,b.height)}};b.path.toRelative=function(e){var h=f(e),q=String.prototype.toLowerCase;
if(h.rel)return m(h.rel);b.is(e,"array")&&b.is(e&&e[0],"array")||(e=b.parsePathString(e));var t=[],v=0,z=0,w=0,y=0,B=0;"M"==e[0][0]&&(v=e[0][1],z=e[0][2],w=v,y=z,B++,t.push(["M",v,z]));for(var E=e.length;E>B;B++){var D=t[B]=[],F=e[B];if(F[0]!=q.call(F[0]))switch(D[0]=q.call(F[0]),D[0]){case "a":D[1]=F[1];D[2]=F[2];D[3]=F[3];D[4]=F[4];D[5]=F[5];D[6]=+(F[6]-v).toFixed(3);D[7]=+(F[7]-z).toFixed(3);break;case "v":D[1]=+(F[1]-z).toFixed(3);break;case "m":w=F[1],y=F[2];default:for(var G=1,I=F.length;I>
G;G++)D[G]=+(F[G]-(G%2?v:z)).toFixed(3)}else for(t[B]=[],"m"==F[0]&&(w=F[1]+v,y=F[2]+z),D=0,G=F.length;G>D;D++)t[B][D]=F[D];F=t[B].length;switch(t[B][0]){case "z":v=w;z=y;break;case "h":v+=+t[B][F-1];break;case "v":z+=+t[B][F-1];break;default:v+=+t[B][F-2],z+=+t[B][F-1]}}return t.toString=l,h.rel=m(t),t};b.path.toAbsolute=I;b.path.toCubic=la;b.path.map=function(b,e){if(!e)return b;var f,h,l,m,q,t,v;b=la(b);l=0;for(q=b.length;q>l;l++)for(v=b[l],m=1,t=v.length;t>m;m+=2)f=e.x(v[m],v[m+1]),h=e.y(v[m],
v[m+1]),v[m]=f,v[m+1]=h;return b};b.path.toString=l;b.path.clone=m}),l.plugin(function(b){var h=Math.max,l=Math.min,m=function(b){if(this.items=[],this.bindings={},this.length=0,this.type="set",b)for(var e=0,f=b.length;f>e;e++)b[e]&&(this[this.items.length]=this.items[this.items.length]=b[e],this.length++)},w=m.prototype;w.push=function(){for(var b,e,f=0,h=arguments.length;h>f;f++)(b=arguments[f])&&(e=this.items.length,this[e]=this.items[e]=b,this.length++);return this};w.pop=function(){return this.length&&
delete this[this.length--],this.items.pop()};w.forEach=function(b,e){for(var f=0,h=this.items.length;h>f&&!1!==b.call(e,this.items[f],f);f++);return this};w.animate=function(h,l,m,q){"function"!=typeof m||m.length||(q=m,m=f.linear);h instanceof b._.Animation&&(q=h.callback,m=h.easing,l=m.dur,h=h.attr);var t=arguments;if(b.is(h,"array")&&b.is(t[t.length-1],"array"))var v=!0;var z,w=function(){z?this.b=z:z=this.b},y=0,B=this,F=q&&function(){++y==B.length&&q.call(this)};return this.forEach(function(b,
f){e.once("snap.animcreated."+b.id,w);v?t[f]&&b.animate.apply(b,t[f]):b.animate(h,l,m,F)})};w.remove=function(){for(;this.length;)this.pop().remove();return this};w.bind=function(b,e,f){var h={};if("function"==typeof e)this.bindings[b]=e;else{var l=f||b;this.bindings[b]=function(b){h[l]=b;e.attr(h)}}return this};w.attr=function(b){var e={},f;for(f in b)this.bindings[f]?this.bindings[f](b[f]):e[f]=b[f];b=0;for(f=this.items.length;f>b;b++)this.items[b].attr(e);return this};w.clear=function(){for(;this.length;)this.pop()};
w.splice=function(b,e){b=0>b?h(this.length+b,0):b;e=h(0,l(this.length-b,e));var f,q=[],t=[],v=[];for(f=2;f<arguments.length;f++)v.push(arguments[f]);for(f=0;e>f;f++)t.push(this[b+f]);for(;f<this.length-b;f++)q.push(this[b+f]);var w=v.length;for(f=0;f<w+q.length;f++)this.items[b+f]=this[b+f]=w>f?v[f]:q[f-w];for(f=this.items.length=this.length-=e-w;this[f];)delete this[f++];return new m(t)};w.exclude=function(b){for(var e=0,f=this.length;f>e;e++)if(this[e]==b)return this.splice(e,1),!0;return!1};w.insertAfter=
function(b){for(var e=this.items.length;e--;)this.items[e].insertAfter(b);return this};w.getBBox=function(){for(var b=[],e=[],f=[],m=[],q=this.items.length;q--;)if(!this.items[q].removed){var t=this.items[q].getBBox();b.push(t.x);e.push(t.y);f.push(t.x+t.width);m.push(t.y+t.height)}return b=l.apply(0,b),e=l.apply(0,e),f=h.apply(0,f),m=h.apply(0,m),{x:b,y:e,x2:f,y2:m,width:f-b,height:m-e,cx:b+(f-b)/2,cy:e+(m-e)/2}};w.clone=function(b){b=new m;for(var e=0,f=this.items.length;f>e;e++)b.push(this.items[e].clone());
return b};w.toString=function(){return"Snap\u2018s set"};w.type="set";b.Set=m;b.set=function(){var b=new m;return arguments.length&&b.push.apply(b,Array.prototype.slice.call(arguments,0)),b}}),l.plugin(function(b,f){function h(b){var e=b[0];switch(e.toLowerCase()){case "t":return[e,0,0];case "m":return[e,1,0,0,1,0,0];case "r":return 4==b.length?[e,0,b[2],b[3]]:[e,0];case "s":return 5==b.length?[e,1,1,b[3],b[4]]:3==b.length?[e,1,1]:[e,1]}}function l(e,f,l){f=L(f).replace(/\.{3}|\u2026/g,e);e=b.parseTransformString(e)||
[];f=b.parseTransformString(f)||[];for(var m,q,t,v,w=Math.max(e.length,f.length),z=[],y=[],D=0;w>D;D++){if(t=e[D]||h(f[D]),v=f[D]||h(t),t[0]!=v[0]||"r"==t[0].toLowerCase()&&(t[2]!=v[2]||t[3]!=v[3])||"s"==t[0].toLowerCase()&&(t[3]!=v[3]||t[4]!=v[4])){e=b._.transform2matrix(e,l());f=b._.transform2matrix(f,l());z=[["m",e.a,e.b,e.c,e.d,e.e,e.f]];y=[["m",f.a,f.b,f.c,f.d,f.e,f.f]];break}z[D]=[];y[D]=[];m=0;for(q=Math.max(t.length,v.length);q>m;m++)m in t&&(z[D][m]=t[m]),m in v&&(y[D][m]=v[m])}return{from:E(z),
to:E(y),f:B(z)}}function m(b){return b}function y(b){return function(e){return+e.toFixed(3)+b}}function v(b){return b.join(" ")}function z(e){return b.rgb(e[0],e[1],e[2])}function B(b){var e,f,h,l,m,q,t=0,v=[];e=0;for(f=b.length;f>e;e++){m="[";q=['"'+b[e][0]+'"'];h=1;for(l=b[e].length;l>h;h++)q[h]="val["+t++ +"]";m+=q+"]";v[e]=m}return Function("val","return Snap.path.toString.call(["+v+"])")}function E(b){for(var e=[],f=0,h=b.length;h>f;f++)for(var l=1,m=b[f].length;m>l;l++)e.push(b[f][l]);return e}
function D(e,f){return b.is(e,"array")&&b.is(f,"array")?e.toString()==f.toString():!1}var K={},J=/[a-z]+$/i,L=String;K.stroke=K.fill="colour";f.prototype.equal=function(b,f){return e("snap.util.equal",this,b,f).firstDefined()};e.on("snap.util.equal",function(e,f){var h,q,t=L(this.attr(e)||""),w=this;if(isFinite(parseFloat(t))&&isFinite(parseFloat(f)))return{from:parseFloat(t),to:parseFloat(f),f:m};if("colour"==K[e])return h=b.color(t),q=b.color(f),{from:[h.r,h.g,h.b,h.opacity],to:[q.r,q.g,q.b,q.opacity],
f:z};if("viewBox"==e)return h=this.attr(e).vb.split(" ").map(Number),q=f.split(" ").map(Number),{from:h,to:q,f:v};if("transform"==e||"gradientTransform"==e||"patternTransform"==e)return f instanceof b.Matrix&&(f=f.toTransformString()),b._.rgTransform.test(f)||(f=b._.svgTransform2string(f)),l(t,f,function(){return w.getBBox(1)});if("d"==e||"path"==e)return h=b.path.toCubic(t,f),{from:E(h[0]),to:E(h[1]),f:B(h[0])};if("points"==e)return h=L(t).split(b._.separator),q=L(f).split(b._.separator),{from:h,
to:q,f:function(b){return b}};h=t.match(J);q=L(f).match(J);return h&&D(h,q)?{from:parseFloat(t),to:parseFloat(f),f:y(h)}:{from:this.asPX(e),to:this.asPX(e,f),f:m}})}),l.plugin(function(b,f,l,t){var h=f.prototype,m="createTouch"in t.doc;f="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel".split(" ");var q={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},z=function(b,e){var f="y"==b?"scrollTop":"scrollLeft",h=e&&e.node?e.node.ownerDocument:
t.doc;return h[f in h.documentElement?"documentElement":"body"][f]},B=function(){return this.originalEvent.preventDefault()},E=function(){return this.originalEvent.stopPropagation()},D=function(b,e,f,h){var l=m&&q[e]?q[e]:e,t=function(l){var t=z("y",h),v=z("x",h);if(m&&q.hasOwnProperty(e))for(var w=0,y=l.targetTouches&&l.targetTouches.length;y>w;w++)if(l.targetTouches[w].target==b||b.contains(l.targetTouches[w].target)){y=l;l=l.targetTouches[w];l.originalEvent=y;l.preventDefault=B;l.stopPropagation=
E;break}return f.call(h,l,l.clientX+v,l.clientY+t)};return e!==l&&b.addEventListener(e,t,!1),b.addEventListener(l,t,!1),function(){return e!==l&&b.removeEventListener(e,t,!1),b.removeEventListener(l,t,!1),!0}},K=[],J=function(b){for(var f,h=b.clientX,l=b.clientY,q=z("y"),t=z("x"),v=K.length;v--;){if(f=K[v],m)for(var w,y=b.touches&&b.touches.length;y--;){if(w=b.touches[y],w.identifier==f.el._drag.id||f.el.node.contains(w.target)){h=w.clientX;l=w.clientY;(b.originalEvent?b.originalEvent:b).preventDefault();
break}}else b.preventDefault();y=f.el.node;y.nextSibling;y.parentNode;y.style.display;h+=t;l+=q;e("snap.drag.move."+f.el.id,f.move_scope||f.el,h-f.el._drag.x,l-f.el._drag.y,h,l,b)}},L=function(f){b.unmousemove(J).unmouseup(L);for(var h,l=K.length;l--;)h=K[l],h.el._drag={},e("snap.drag.end."+h.el.id,h.end_scope||h.start_scope||h.move_scope||h.el,f),e.off("snap.drag.*."+h.el.id);K=[]};for(l=f.length;l--;)!function(e){b[e]=h[e]=function(f,h){if(b.is(f,"function"))this.events=this.events||[],this.events.push({name:e,
f:f,unbind:D(this.node||document,e,f,h||this)});else for(var l=0,m=this.events.length;m>l;l++)if(this.events[l].name==e)try{this.events[l].f.call(this)}catch(S){}return this};b["un"+e]=h["un"+e]=function(b){for(var f=this.events||[],h=f.length;h--;)if(f[h].name==e&&(f[h].f==b||!b))return f[h].unbind(),f.splice(h,1),!f.length&&delete this.events,this;return this}}(f[l]);h.hover=function(b,e,f,h){return this.mouseover(b,f).mouseout(e,h||f)};h.unhover=function(b,e){return this.unmouseover(b).unmouseout(e)};
var H=[];h.drag=function(f,h,l,m,q,t){function v(v,w,y){(v.originalEvent||v).preventDefault();z._drag.x=w;z._drag.y=y;z._drag.id=v.identifier;!K.length&&b.mousemove(J).mouseup(L);K.push({el:z,move_scope:m,start_scope:q,end_scope:t});h&&e.on("snap.drag.start."+z.id,h);f&&e.on("snap.drag.move."+z.id,f);l&&e.on("snap.drag.end."+z.id,l);e("snap.drag.start."+z.id,q||m||z,w,y,v)}function w(b,f,h){e("snap.draginit."+z.id,z,b,f,h)}var z=this;if(!arguments.length){var y;return z.drag(function(b,e){this.attr({transform:y+
(y?"T":"t")+[b,e]})},function(){y=this.transform().local})}return e.on("snap.draginit."+z.id,v),z._drag={},H.push({el:z,start:v,init:w}),z.mousedown(w),z};h.undrag=function(){for(var f=H.length;f--;)H[f].el==this&&(this.unmousedown(H[f].init),H.splice(f,1),e.unbind("snap.drag.*."+this.id),e.unbind("snap.draginit."+this.id));return!H.length&&b.unmousemove(J).unmouseup(L),this}}),l.plugin(function(b,f,l){l=(f.prototype,l.prototype);var h=/^\s*url\((.+)\)/,m=String,q=b._.$;b.filter={};l.filter=function(e){var h=
this;"svg"!=h.type&&(h=h.paper);e=b.parse(m(e));var l=b._.id(),t=(h.node.offsetWidth,h.node.offsetHeight,q("filter"));return q(t,{id:l,filterUnits:"userSpaceOnUse"}),t.appendChild(e.node),h.defs.appendChild(t),new f(t)};e.on("snap.util.getattr.filter",function(){e.stop();var f=q(this.node,"filter");if(f)return(f=m(f).match(h))&&b.select(f[1])});e.on("snap.util.attr.filter",function(h){if(h instanceof f&&"filter"==h.type){e.stop();var l=h.node.id;l||(q(h.node,{id:h.id}),l=h.id);q(this.node,{filter:b.url(l)})}h&&
"none"!=h||(e.stop(),this.node.removeAttribute("filter"))});b.filter.blur=function(e,f){null==e&&(e=2);return b.format('<feGaussianBlur stdDeviation="{def}"/>',{def:null==f?e:[e,f]})};b.filter.blur.toString=function(){return this()};b.filter.shadow=function(e,f,h,l,m){return"string"==typeof h&&(l=h,m=l,h=4),"string"!=typeof l&&(m=l,l="#000"),l=l||"#000",null==h&&(h=4),null==m&&(m=1),null==e&&(e=0,f=2),null==f&&(f=e),l=b.color(l),b.format('<feGaussianBlur in="SourceAlpha" stdDeviation="{blur}"/><feOffset dx="{dx}" dy="{dy}" result="offsetblur"/><feFlood flood-color="{color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="{opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>',
{color:l,dx:e,dy:f,blur:h,opacity:m})};b.filter.shadow.toString=function(){return this()};b.filter.grayscale=function(e){return null==e&&(e=1),b.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {b} {h} 0 0 0 0 0 1 0"/>',{a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})};b.filter.grayscale.toString=function(){return this()};b.filter.sepia=function(e){return null==
e&&(e=1),b.format('<feColorMatrix type="matrix" values="{a} {b} {c} 0 0 {d} {e} {f} 0 0 {g} {h} {i} 0 0 0 0 0 1 0"/>',{a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})};b.filter.sepia.toString=function(){return this()};b.filter.saturate=function(e){return null==e&&(e=1),b.format('<feColorMatrix type="saturate" values="{amount}"/>',{amount:1-e})};b.filter.saturate.toString=function(){return this()};
b.filter.hueRotate=function(e){return e=e||0,b.format('<feColorMatrix type="hueRotate" values="{angle}"/>',{angle:e})};b.filter.hueRotate.toString=function(){return this()};b.filter.invert=function(e){return null==e&&(e=1),b.format('<feComponentTransfer><feFuncR type="table" tableValues="{amount} {amount2}"/><feFuncG type="table" tableValues="{amount} {amount2}"/><feFuncB type="table" tableValues="{amount} {amount2}"/></feComponentTransfer>',{amount:e,amount2:1-e})};b.filter.invert.toString=function(){return this()};
b.filter.brightness=function(e){return null==e&&(e=1),b.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}"/><feFuncG type="linear" slope="{amount}"/><feFuncB type="linear" slope="{amount}"/></feComponentTransfer>',{amount:e})};b.filter.brightness.toString=function(){return this()};b.filter.contrast=function(e){return null==e&&(e=1),b.format('<feComponentTransfer><feFuncR type="linear" slope="{amount}" intercept="{amount2}"/><feFuncG type="linear" slope="{amount}" intercept="{amount2}"/><feFuncB type="linear" slope="{amount}" intercept="{amount2}"/></feComponentTransfer>',
{amount:e,amount2:.5-e/2})};b.filter.contrast.toString=function(){return this()}}),l.plugin(function(b,e){var f=b._.box,h=b.is,l=/^[^a-z]*([tbmlrc])/i,m=function(){return"T"+this.dx+","+this.dy};e.prototype.getAlign=function(b,e){null==e&&h(b,"string")&&(e=b,b=null);b=b||this.paper;var q=b.getBBox?b.getBBox():f(b),t=this.getBBox(),v={};switch(e=e&&e.match(l),e?e[1].toLowerCase():"c"){case "t":v.dx=0;v.dy=q.y-t.y;break;case "b":v.dx=0;v.dy=q.y2-t.y2;break;case "m":v.dx=0;v.dy=q.cy-t.cy;break;case "l":v.dx=
q.x-t.x;v.dy=0;break;case "r":v.dx=q.x2-t.x2;v.dy=0;break;default:v.dx=q.cx-t.cx,v.dy=0}return v.toString=m,v};e.prototype.align=function(b,e){return this.transform("..."+this.getAlign(b,e))}}),l});(function(b,e){function f(e){if("function"==typeof require&&"undefined"!==typeof module&&module.exports)try{return require(e.toLowerCase())}catch(L){}else return b[e]}function l(b,e){return null===b?"null"===e:void 0===b?"undefined"===e:b.is&&b instanceof q?"element"===e:7<Object.prototype.toString.call(b).toLowerCase().indexOf(e)}function m(b){var e,f,h,q,t,v,w,y;if(b instanceof m)return b;l(b,"array")||(b=String(b).replace(/\s/g,"").toLowerCase().match(/(?:\+,|[^,])+/g));e=0;for(f=b.length;e<f;++e){l(b[e],
"array")||(b[e]=String(b[e]).match(/(?:\+\/|[^\/])+/g));v=[];for(h=b[e].length;h--;){w=b[e][h];t={jwertyCombo:String(w),shiftKey:!1,ctrlKey:!1,altKey:!1,metaKey:!1};l(w,"array")||(w=String(w).toLowerCase().match(/(?:(?:[^\+])+|\+\+|^\+$)/g));for(q=w.length;q--;)"++"===w[q]&&(w[q]="+"),w[q]in B.mods?t[z[B.mods[w[q]]]]=!0:w[q]in B.keys?t.keyCode=B.keys[w[q]]:y=w[q].match(/^\[([^-]+\-?[^-]*)-([^-]+\-?[^-]*)\]$/);if(l(t.keyCode,"undefined"))if(y&&y[1]in B.keys&&y[2]in B.keys){y[2]=B.keys[y[2]];y[1]=B.keys[y[1]];
for(q=y[1];q<y[2];++q)v.push({altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,ctrlKey:t.ctrlKey,keyCode:q,jwertyCombo:String(w)});t.keyCode=q}else t.keyCode=0;v.push(t)}this[e]=v}this.length=e;return this}var h=b.document,q=f("jquery")||f("zepto")||f("ender")||h,t,w,y,v;q===h?(t=function(b,e){return b?q.querySelector(b,e||q):q},w=function(b,e){b.addEventListener("keydown",e,!1)},y=function(b,e){b.removeEventListener("keydown",e,!1)},v=function(b,e){var f=h.createEvent("Event"),l;f.initEvent("keydown",
!0,!0);for(l in e)f[l]=e[l];return(b||q).dispatchEvent(f)}):(t=function(b,e){return q(b||h,e)},w=function(b,e){q(b).bind("keydown.jwerty",e)},y=function(b,e){q(b).unbind("keydown.jwerty",e)},v=function(b,e){q(b||h).trigger(q.Event("keydown",e))});for(var z={16:"shiftKey",17:"ctrlKey",18:"altKey",91:"metaKey"},B={mods:{"\u21e7":16,shift:16,"\u2303":17,ctrl:17,"\u2325":18,alt:18,option:18,"\u2318":91,meta:91,cmd:91,"super":91,win:91},keys:{"\u232b":8,backspace:8,"\u21e5":9,"\u21c6":9,tab:9,"\u21a9":13,
"return":13,enter:13,"\u2305":13,pause:19,"pause-break":19,"\u21ea":20,caps:20,"caps-lock":20,"\u238b":27,escape:27,esc:27,space:32,"\u2196":33,pgup:33,"page-up":33,"\u2198":34,pgdown:34,"page-down":34,"\u21df":35,end:35,"\u21de":36,home:36,ins:45,insert:45,del:46,"delete":46,"\u2190":37,left:37,"arrow-left":37,"\u2191":38,up:38,"arrow-up":38,"\u2192":39,right:39,"arrow-right":39,"\u2193":40,down:40,"arrow-down":40,"*":106,star:106,asterisk:106,multiply:106,"+":107,plus:107,"-":109,subtract:109,"num-.":110,
"num-period":110,"num-dot":110,"num-full-stop":110,"num-delete":110,";":186,semicolon:186,"=":187,equals:187,",":188,comma:188,".":190,period:190,"full-stop":190,"/":191,slash:191,"forward-slash":191,"`":192,tick:192,"back-quote":192,"[":219,"open-bracket":219,"\\":220,"back-slash":220,"]":221,"close-bracket":221,"'":222,quote:222,apostraphe:222}},E=47,D=0;106>++E;)B.keys[D]=E,B.keys["num-"+D]=E+48,++D;E=111;for(D=1;136>++E;)B.keys["f"+D]=E,++D;for(E=64;91>++E;)B.keys[String.fromCharCode(E).toLowerCase()]=
E;var K=e.jwerty={event:function(b,e,f){if(l(e,"boolean")){var h=e;e=function(){return h}}b=new m(b);var q=0,t=b.length-1,v,w;return function(h){(w=K.is(b,h,q))?q<t?++q:(v=e.call(f||this,h,w),!1===v&&h.preventDefault(),q=0):q=K.is(b,h)?1:0}},is:function(b,e,f){b=new m(b);b=b[f||0];e=e.originalEvent||e;f=b.length;for(var h=!1;f--;){var h=b[f].jwertyCombo,l;for(l in b[f])"jwertyCombo"!==l&&e[l]!=b[f][l]&&(h=!1);if(!1!==h)break}return h},key:function(e,f,h,m,q){var v=l(h,"element")||l(h,"string")?h:
m,z=v===h?b:h;h=v===h?m:q;var B=l(v,"element")?v:t(v,h),E=K.event(e,f,z);w(B,E);return{unbind:function(){y(B,E)}}},fire:function(b,e,f,h){b=new m(b);h=l(f,"number")?f:h;v(l(e,"element")?e:t(e,f),b[h||0][0])},KEYS:B}})("undefined"!==typeof global&&global.window||this,"undefined"!==typeof module&&module.exports?module.exports:this);(function(b,e){"object"===typeof exports&&exports&&"string"!==typeof exports.nodeName?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):(b.Mustache={},e(b.Mustache))})(this,function(b){function e(b){return"function"===typeof b}function f(b){return b.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function l(b,e){return null!=b&&"object"===typeof b&&e in b}function m(e,l){function m(b){"string"===typeof b&&(b=b.split(J,2));if(!z(b)||2!==b.length)throw Error("Invalid tags: "+b);
G=new RegExp(f(b[0])+"\\s*");Q=new RegExp("\\s*"+f(b[1]));ha=new RegExp("\\s*"+f("}"+b[1]))}if(!e)return[];var v=[],w=[],y=[],D=!1,I=!1,G,Q,ha;m(l||b.tags);for(var da=new t(e),fa,N,aa,ca;!da.eos();){fa=da.pos;if(aa=da.scanUntil(G)){ca=0;for(var T=aa.length;ca<T;++ca)if(N=aa.charAt(ca),B.call(E,N)?I=!0:y.push(w.length),w.push(["text",N,fa,fa+1]),fa+=1,"\n"===N){if(D&&!I)for(;y.length;)delete w[y.pop()];else y=[];I=D=!1}}if(!da.scan(G))break;D=!0;N=da.scan(F)||"name";da.scan(K);"="===N?(aa=da.scanUntil(L),
da.scan(L),da.scanUntil(Q)):"{"===N?(aa=da.scanUntil(ha),da.scan(H),da.scanUntil(Q),N="&"):aa=da.scanUntil(Q);if(!da.scan(Q))throw Error("Unclosed tag at "+da.pos);ca=[N,aa,fa,da.pos];w.push(ca);if("#"===N||"^"===N)v.push(ca);else if("/"===N){N=v.pop();if(!N)throw Error('Unopened section "'+aa+'" at '+fa);if(N[1]!==aa)throw Error('Unclosed section "'+N[1]+'" at '+fa);}else"name"===N||"{"===N||"&"===N?I=!0:"="===N&&m(aa)}if(N=v.pop())throw Error('Unclosed section "'+N[1]+'" at '+da.pos);return q(h(w))}
function h(b){for(var e=[],f,h,l=0,m=b.length;l<m;++l)if(f=b[l])"text"===f[0]&&h&&"text"===h[0]?(h[1]+=f[1],h[3]=f[3]):(e.push(f),h=f);return e}function q(b){for(var e=[],f=e,h=[],l,m=0,q=b.length;m<q;++m)switch(l=b[m],l[0]){case "#":case "^":f.push(l);h.push(l);f=l[4]=[];break;case "/":f=h.pop();f[5]=l[2];f=0<h.length?h[h.length-1][4]:e;break;default:f.push(l)}return e}function t(b){this.tail=this.string=b;this.pos=0}function w(b,e){this.view=b;this.cache={".":this.view};this.parent=e}function y(){this.cache=
{}}var v=Object.prototype.toString,z=Array.isArray||function(b){return"[object Array]"===v.call(b)},B=RegExp.prototype.test,E=/\S/,D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},K=/\s*/,J=/\s+/,L=/\s*=/,H=/\s*\}/,F=/#|\^|\/|>|\{|&|=|!/;t.prototype.eos=function(){return""===this.tail};t.prototype.scan=function(b){b=this.tail.match(b);if(!b||0!==b.index)return"";b=b[0];this.tail=this.tail.substring(b.length);this.pos+=b.length;return b};t.prototype.scanUntil=
function(b){b=this.tail.search(b);var e;switch(b){case -1:e=this.tail;this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,b),this.tail=this.tail.substring(b)}this.pos+=e.length;return e};w.prototype.push=function(b){return new w(b,this)};w.prototype.lookup=function(b){var f=this.cache,h;if(f.hasOwnProperty(b))h=f[b];else{for(var m=this,q,t,v=!1;m;){if(0<b.indexOf("."))for(h=m.view,q=b.split("."),t=0;null!=h&&t<q.length;)t===q.length-1&&(v=l(h,q[t])),h=h[q[t++]];else h=m.view[b],v=
l(m.view,b);if(v)break;m=m.parent}f[b]=h}e(h)&&(h=h.call(this.view));return h};y.prototype.clearCache=function(){this.cache={}};y.prototype.parse=function(b,e){var f=this.cache,h=f[b];null==h&&(h=f[b]=m(b,e));return h};y.prototype.render=function(b,e,f){var h=this.parse(b);e=e instanceof w?e:new w(e);return this.renderTokens(h,e,f,b)};y.prototype.renderTokens=function(b,e,f,h){for(var l="",m,q,t,v=0,w=b.length;v<w;++v)t=void 0,m=b[v],q=m[0],"#"===q?t=this.renderSection(m,e,f,h):"^"===q?t=this.renderInverted(m,
e,f,h):">"===q?t=this.renderPartial(m,e,f,h):"&"===q?t=this.unescapedValue(m,e):"name"===q?t=this.escapedValue(m,e):"text"===q&&(t=this.rawValue(m)),void 0!==t&&(l+=t);return l};y.prototype.renderSection=function(b,f,h,l){function m(b){return q.render(b,f,h)}var q=this,t="",v=f.lookup(b[1]);if(v){if(z(v))for(var w=0,y=v.length;w<y;++w)t+=this.renderTokens(b[4],f.push(v[w]),h,l);else if("object"===typeof v||"string"===typeof v||"number"===typeof v)t+=this.renderTokens(b[4],f.push(v),h,l);else if(e(v)){if("string"!==
typeof l)throw Error("Cannot use higher-order sections without the original template");v=v.call(f.view,l.slice(b[3],b[5]),m);null!=v&&(t+=v)}else t+=this.renderTokens(b[4],f,h,l);return t}};y.prototype.renderInverted=function(b,e,f,h){var l=e.lookup(b[1]);if(!l||z(l)&&0===l.length)return this.renderTokens(b[4],e,f,h)};y.prototype.renderPartial=function(b,f,h){if(h&&(b=e(h)?h(b[1]):h[b[1]],null!=b))return this.renderTokens(this.parse(b),f,h,b)};y.prototype.unescapedValue=function(b,e){var f=e.lookup(b[1]);
if(null!=f)return f};y.prototype.escapedValue=function(e,f){var h=f.lookup(e[1]);if(null!=h)return b.escape(h)};y.prototype.rawValue=function(b){return b[1]};b.name="mustache.js";b.version="2.2.1";b.tags=["{{","}}"];var G=new y;b.clearCache=function(){return G.clearCache()};b.parse=function(b,e){return G.parse(b,e)};b.render=function(b,e,f){if("string"!==typeof b)throw e=TypeError,b=z(b)?"array":typeof b,new e('Invalid template! Template should be a "string" but "'+b+'" was given as the first argument for mustache#render(template, view, partials)');
return G.render(b,e,f)};b.to_html=function(f,h,l,m){f=b.render(f,h,l);if(e(m))m(f);else return f};b.escape=function(b){return String(b).replace(/[&<>"'`=\/]/g,function(b){return D[b]})};b.Scanner=t;b.Context=w;b.Writer=y});/*
 jQuery v3.1.1 | (c) jQuery Foundation | jquery.org/license */
!function(b,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=b.document?e(b,!0):function(b){if(!b.document)throw Error("jQuery requires a window with a document");return e(b)}:e(b)}("undefined"!=typeof window?window:this,function(b,e){function f(b,e){e=e||Y;var f=e.createElement("script");f.text=b;e.head.appendChild(f).parentNode.removeChild(f)}function l(b){var e=!!b&&"length"in b&&b.length,f=x.type(b);return"function"!==f&&!x.isWindow(b)&&("array"===f||0===e||"number"==
typeof e&&0<e&&e-1 in b)}function m(b,e,f){return x.isFunction(e)?x.grep(b,function(b,h){return!!e.call(b,h,b)!==f}):e.nodeType?x.grep(b,function(b){return b===e!==f}):"string"!=typeof e?x.grep(b,function(b){return-1<cb.call(e,b)!==f}):mb.test(e)?x.filter(e,b,f):(e=x.filter(e,b),x.grep(b,function(b){return-1<cb.call(e,b)!==f&&1===b.nodeType}))}function h(b,e){for(;(b=b[e])&&1!==b.nodeType;);return b}function q(b){var e={};return x.each(b.match(xa)||[],function(b,f){e[f]=!0}),e}function t(b){return b}
function w(b){throw b;}function y(b,e,f){var h;try{b&&x.isFunction(h=b.promise)?h.call(b).done(e).fail(f):b&&x.isFunction(h=b.then)?h.call(b,e,f):e.call(void 0,b)}catch(zb){f.call(void 0,zb)}}function v(){Y.removeEventListener("DOMContentLoaded",v);b.removeEventListener("load",v);x.ready()}function z(){this.expando=x.expando+z.uid++}function B(b,e,f){var h;if(void 0===f&&1===b.nodeType)if(h="data-"+e.replace(Jb,"-$&").toLowerCase(),f=b.getAttribute(h),"string"==typeof f){try{h=f,f="true"===h||"false"!==
h&&("null"===h?null:h===+h+""?+h:Ib.test(h)?JSON.parse(h):h)}catch(zb){}Ea.set(b,e,f)}else f=void 0;return f}function E(b,e,f,h){var l,m=1,q=20,t=h?function(){return h.cur()}:function(){return x.css(b,e,"")},v=t(),M=f&&f[3]||(x.cssNumber[e]?"":"px"),w=(x.cssNumber[e]||"px"!==M&&+v)&&Qa.exec(x.css(b,e));if(w&&w[3]!==M){M=M||w[3];f=f||[];w=+v||1;do m=m||".5",w/=m,x.style(b,e,w+M);while(m!==(m=t()/v)&&1!==m&&--q)}return f&&(w=+w||+v||0,l=f[1]?w+(f[1]+1)*f[2]:+f[2],h&&(h.unit=M,h.start=w,h.end=l)),l}
function D(b,e){for(var f,h,l=[],m=0,q=b.length;m<q;m++)if(h=b[m],h.style)if(f=h.style.display,e){if("none"===f&&(l[m]=R.get(h,"display")||null,l[m]||(h.style.display="")),""===h.style.display&&Ra(h)){f=m;var t,v=void 0;t=h.ownerDocument;var M=h.nodeName;t=(h=Ab[M])?h:(v=t.body.appendChild(t.createElement(M)),h=x.css(v,"display"),v.parentNode.removeChild(v),"none"===h&&(h="block"),Ab[M]=h,h);l[f]=t}}else"none"!==f&&(l[m]="none",R.set(h,"display",f));for(m=0;m<q;m++)null!=l[m]&&(b[m].style.display=
l[m]);return b}function K(b,e){var f;return f="undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(e||"*"):"undefined"!=typeof b.querySelectorAll?b.querySelectorAll(e||"*"):[],void 0===e||e&&x.nodeName(b,e)?x.merge([b],f):f}function J(b,e){for(var f=0,h=b.length;f<h;f++)R.set(b[f],"globalEval",!e||R.get(e[f],"globalEval"))}function L(b,e,f,h,l){for(var m,q,t,v,M=e.createDocumentFragment(),w=[],z=0,y=b.length;z<y;z++)if(m=b[z],m||0===m)if("object"===x.type(m))x.merge(w,m.nodeType?[m]:
m);else if(Bb.test(m)){q=q||M.appendChild(e.createElement("div"));t=(Cb.exec(m)||["",""])[1].toLowerCase();t=za[t]||za._default;q.innerHTML=t[1]+x.htmlPrefilter(m)+t[2];for(t=t[0];t--;)q=q.lastChild;x.merge(w,q.childNodes);q=M.firstChild;q.textContent=""}else w.push(e.createTextNode(m));M.textContent="";for(z=0;m=w[z++];)if(h&&-1<x.inArray(m,h))l&&l.push(m);else if(v=x.contains(m.ownerDocument,m),q=K(M.appendChild(m),"script"),v&&J(q),f)for(t=0;m=q[t++];)Db.test(m.type||"")&&f.push(m);return M}function H(){return!0}
function F(){return!1}function G(){try{return Y.activeElement}catch(M){}}function I(b,e,f,h,l,m){var q,t;if("object"==typeof e){"string"!=typeof f&&(h=h||f,f=void 0);for(t in e)I(b,t,f,h,e[t],m);return b}if(null==h&&null==l?(l=f,h=f=void 0):null==l&&("string"==typeof f?(l=h,h=void 0):(l=h,h=f,f=void 0)),!1===l)l=F;else if(!l)return b;return 1===m&&(q=l,l=function(b){return x().off(b),q.apply(this,arguments)},l.guid=q.guid||(q.guid=x.guid++)),b.each(function(){x.event.add(this,e,l,h,f)})}function Q(b,
e){return x.nodeName(b,"table")&&x.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?b.getElementsByTagName("tbody")[0]||b:b}function O(b){return b.type=(null!==b.getAttribute("type"))+"/"+b.type,b}function S(b){var e=Ga.exec(b.type);return e?b.type=e[1]:b.removeAttribute("type"),b}function V(b,e){var f,h,l,m,q,t;if(1===e.nodeType){if(R.hasData(b)&&(f=R.access(b),h=R.set(e,f),t=f.events))for(l in delete h.handle,h.events={},t)for(f=0,h=t[l].length;f<h;f++)x.event.add(e,l,t[l][f]);Ea.hasData(b)&&(m=Ea.access(b),
q=x.extend({},m),Ea.set(e,q))}}function la(b,e,h,l){e=pa.apply([],e);var m,q,t,v,M=0,w=b.length,z=w-1,y=e[0],U=x.isFunction(y);if(U||1<w&&"string"==typeof y&&!oa.checkClone&&pb.test(y))return b.each(function(f){var m=b.eq(f);U&&(e[0]=y.call(this,f,m.html()));la(m,e,h,l)});if(w&&(m=L(e,b[0].ownerDocument,!1,b,l),q=m.firstChild,1===m.childNodes.length&&(m=q),q||l)){q=x.map(K(m,"script"),O);for(t=q.length;M<w;M++)v=m,M!==z&&(v=x.clone(v,!0,!0),t&&x.merge(q,K(v,"script"))),h.call(b[M],v,M);if(t)for(m=
q[q.length-1].ownerDocument,x.map(q,S),M=0;M<t;M++)v=q[M],Db.test(v.type||"")&&!R.access(v,"globalEval")&&x.contains(m,v)&&(v.src?x._evalUrl&&x._evalUrl(v.src):f(v.textContent.replace(ab,""),m))}return b}function ta(b,e,f){for(var h=e?x.filter(e,b):b,l=0;null!=(e=h[l]);l++)f||1!==e.nodeType||x.cleanData(K(e)),e.parentNode&&(f&&x.contains(e.ownerDocument,e)&&J(K(e,"script")),e.parentNode.removeChild(e));return b}function Z(b,e,f){var h,l,m,q,t=b.style;return f=f||Va(b),f&&(q=f.getPropertyValue(e)||
f[e],""!==q||x.contains(b.ownerDocument,b)||(q=x.style(b,e)),!oa.pixelMarginRight()&&Ia.test(q)&&Sa.test(e)&&(h=t.width,l=t.minWidth,m=t.maxWidth,t.minWidth=t.maxWidth=t.width=q,q=f.width,t.width=h,t.minWidth=l,t.maxWidth=m)),void 0!==q?q+"":q}function na(b,e){return{get:function(){return b()?void delete this.get:(this.get=e).apply(this,arguments)}}}function qa(b){if(b in Ta)return b;for(var e=b[0].toUpperCase()+b.slice(1),f=Ca.length;f--;)if(b=Ca[f]+e,b in Ta)return b}function ha(b,e,f){return(b=
Qa.exec(e))?Math.max(0,b[2]-(f||0))+(b[3]||"px"):e}function da(b,e,f,h,l){var m=0;for(e=f===(h?"border":"content")?4:"width"===e?1:0;4>e;e+=2)"margin"===f&&(m+=x.css(b,f+ya[e],!0,l)),h?("content"===f&&(m-=x.css(b,"padding"+ya[e],!0,l)),"margin"!==f&&(m-=x.css(b,"border"+ya[e]+"Width",!0,l))):(m+=x.css(b,"padding"+ya[e],!0,l),"padding"!==f&&(m+=x.css(b,"border"+ya[e]+"Width",!0,l)));return m}function fa(b,e,f){var h,l=!0,m=Va(b),q="border-box"===x.css(b,"boxSizing",!1,m);if(b.getClientRects().length&&
(h=b.getBoundingClientRect()[e]),0>=h||null==h){if(h=Z(b,e,m),(0>h||null==h)&&(h=b.style[e]),Ia.test(h))return h;l=q&&(oa.boxSizingReliable()||h===b.style[e]);h=parseFloat(h)||0}return h+da(b,e,f||(q?"border":"content"),l,m)+"px"}function N(b,e,f,h,l){return new N.prototype.init(b,e,f,h,l)}function aa(){Ja&&(b.requestAnimationFrame(aa),x.fx.tick())}function ca(){return b.setTimeout(function(){X=void 0}),X=x.now()}function T(b,e){var f,h=0,l={height:b};for(e=e?1:0;4>h;h+=2-e)f=ya[h],l["margin"+f]=
l["padding"+f]=b;return e&&(l.opacity=l.width=b),l}function ua(b,e,f){for(var h,l=(ia.tweeners[e]||[]).concat(ia.tweeners["*"]),m=0,q=l.length;m<q;m++)if(h=l[m].call(f,e,b))return h}function Da(b,e){var f,h,l,m,q;for(f in b)if(h=x.camelCase(f),l=e[h],m=b[f],x.isArray(m)&&(l=m[1],m=b[f]=m[0]),f!==h&&(b[h]=m,delete b[f]),q=x.cssHooks[h],q&&"expand"in q)for(f in m=q.expand(m),delete b[h],m)f in b||(b[f]=m[f],e[f]=l);else e[h]=l}function ia(b,e,f){var h,l=0,m=ia.prefilters.length,q=x.Deferred().always(function(){delete t.elem}),
t=function(){if(h)return!1;for(var e=X||ca(),e=Math.max(0,v.startTime+v.duration-e),f=1-(e/v.duration||0),l=0,m=v.tweens.length;l<m;l++)v.tweens[l].run(f);return q.notifyWith(b,[v,f,e]),1>f&&m?e:(q.resolveWith(b,[v]),!1)},v=q.promise({elem:b,props:x.extend({},e),opts:x.extend(!0,{specialEasing:{},easing:x.easing._default},f),originalProperties:e,originalOptions:f,startTime:X||ca(),duration:f.duration,tweens:[],createTween:function(e,f){var h=x.Tween(b,v.opts,e,f,v.opts.specialEasing[e]||v.opts.easing);
return v.tweens.push(h),h},stop:function(e){var f=0,l=e?v.tweens.length:0;if(h)return this;for(h=!0;f<l;f++)v.tweens[f].run(1);return e?(q.notifyWith(b,[v,1,0]),q.resolveWith(b,[v,e])):q.rejectWith(b,[v,e]),this}});f=v.props;for(Da(f,v.opts.specialEasing);l<m;l++)if(e=ia.prefilters[l].call(v,b,f,v.opts))return x.isFunction(e.stop)&&(x._queueHooks(v.elem,v.opts.queue).stop=x.proxy(e.stop,e)),e;return x.map(f,ua,v),x.isFunction(v.opts.start)&&v.opts.start.call(b,v),x.fx.timer(x.extend(t,{elem:b,anim:v,
queue:v.opts.queue})),v.progress(v.opts.progress).done(v.opts.done,v.opts.complete).fail(v.opts.fail).always(v.opts.always)}function ea(b){return(b.match(xa)||[]).join(" ")}function ka(b){return b.getAttribute&&b.getAttribute("class")||""}function ja(b,e,f,h){var l;if(x.isArray(e))x.each(e,function(e,l){f||ac.test(b)?h(b,l):ja(b+"["+("object"==typeof l&&null!=l?e:"")+"]",l,f,h)});else if(f||"object"!==x.type(e))h(b,e);else for(l in e)ja(b+"["+l+"]",e[l],f,h)}function W(b){return function(e,f){"string"!=
typeof e&&(f=e,e="*");var h,l=0,m=e.toLowerCase().match(xa)||[];if(x.isFunction(f))for(;h=m[l++];)"+"===h[0]?(h=h.slice(1)||"*",(b[h]=b[h]||[]).unshift(f)):(b[h]=b[h]||[]).push(f)}}function Pa(b,e,f,h){function l(t){var v;return m[t]=!0,x.each(b[t]||[],function(b,t){var M=t(e,f,h);return"string"!=typeof M||q||m[M]?q?!(v=M):void 0:(e.dataTypes.unshift(M),l(M),!1)}),v}var m={},q=b===Kb;return l(e.dataTypes[0])||!m["*"]&&l("*")}function Ha(b,e){var f,h,l=x.ajaxSettings.flatOptions||{};for(f in e)void 0!==
e[f]&&((l[f]?b:h||(h={}))[f]=e[f]);return h&&x.extend(!0,b,h),b}function Aa(b){return x.isWindow(b)?b:9===b.nodeType&&b.defaultView}var Ba=[],Y=b.document,jb=Object.getPrototypeOf,Ma=Ba.slice,pa=Ba.concat,kb=Ba.push,cb=Ba.indexOf,db={},Wa=db.toString,Na=db.hasOwnProperty,lb=Na.toString,xb=lb.call(Object),oa={},x=function(b,e){return new x.fn.init(b,e)},rb=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,wb=/^-ms-/,Gb=/-([a-z])/g,Hb=function(b,e){return e.toUpperCase()};x.fn=x.prototype={jquery:"3.1.1",constructor:x,
length:0,toArray:function(){return Ma.call(this)},get:function(b){return null==b?Ma.call(this):0>b?this[b+this.length]:this[b]},pushStack:function(b){b=x.merge(this.constructor(),b);return b.prevObject=this,b},each:function(b){return x.each(this,b)},map:function(b){return this.pushStack(x.map(this,function(e,f){return b.call(e,f,e)}))},slice:function(){return this.pushStack(Ma.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(b){var e=this.length;
b=+b+(0>b?e:0);return this.pushStack(0<=b&&b<e?[this[b]]:[])},end:function(){return this.prevObject||this.constructor()},push:kb,sort:Ba.sort,splice:Ba.splice};x.extend=x.fn.extend=function(){var b,e,f,h,l,m,q=arguments[0]||{},t=1,v=arguments.length,w=!1;"boolean"==typeof q&&(w=q,q=arguments[t]||{},t++);"object"==typeof q||x.isFunction(q)||(q={});for(t===v&&(q=this,t--);t<v;t++)if(null!=(b=arguments[t]))for(e in b)f=q[e],h=b[e],q!==h&&(w&&h&&(x.isPlainObject(h)||(l=x.isArray(h)))?(l?(l=!1,m=f&&x.isArray(f)?
f:[]):m=f&&x.isPlainObject(f)?f:{},q[e]=x.extend(w,m,h)):void 0!==h&&(q[e]=h));return q};x.extend({expando:"jQuery"+("3.1.1"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(b){throw Error(b);},noop:function(){},isFunction:function(b){return"function"===x.type(b)},isArray:Array.isArray,isWindow:function(b){return null!=b&&b===b.window},isNumeric:function(b){var e=x.type(b);return("number"===e||"string"===e)&&!isNaN(b-parseFloat(b))},isPlainObject:function(b){var e,f;return!(!b||"[object Object]"!==
Wa.call(b))&&(!(e=jb(b))||(f=Na.call(e,"constructor")&&e.constructor,"function"==typeof f&&lb.call(f)===xb))},isEmptyObject:function(b){for(var e in b)return!1;return!0},type:function(b){return null==b?b+"":"object"==typeof b||"function"==typeof b?db[Wa.call(b)]||"object":typeof b},globalEval:function(b){f(b)},camelCase:function(b){return b.replace(wb,"ms-").replace(Gb,Hb)},nodeName:function(b,e){return b.nodeName&&b.nodeName.toLowerCase()===e.toLowerCase()},each:function(b,e){var f,h=0;if(l(b))for(f=
b.length;h<f&&!1!==e.call(b[h],h,b[h]);h++);else for(h in b)if(!1===e.call(b[h],h,b[h]))break;return b},trim:function(b){return null==b?"":(b+"").replace(rb,"")},makeArray:function(b,e){var f=e||[];return null!=b&&(l(Object(b))?x.merge(f,"string"==typeof b?[b]:b):kb.call(f,b)),f},inArray:function(b,e,f){return null==e?-1:cb.call(e,b,f)},merge:function(b,e){for(var f=+e.length,h=0,l=b.length;h<f;h++)b[l++]=e[h];return b.length=l,b},grep:function(b,e,f){for(var h=[],l=0,m=b.length,q=!f;l<m;l++)f=!e(b[l],
l),f!==q&&h.push(b[l]);return h},map:function(b,e,f){var h,m,q=0,t=[];if(l(b))for(h=b.length;q<h;q++)m=e(b[q],q,f),null!=m&&t.push(m);else for(q in b)m=e(b[q],q,f),null!=m&&t.push(m);return pa.apply([],t)},guid:1,proxy:function(b,e){var f,h,l;if("string"==typeof e&&(f=b[e],e=b,b=f),x.isFunction(b))return h=Ma.call(arguments,2),l=function(){return b.apply(e||this,h.concat(Ma.call(arguments)))},l.guid=b.guid=b.guid||x.guid++,l},now:Date.now,support:oa});"function"==typeof Symbol&&(x.fn[Symbol.iterator]=
Ba[Symbol.iterator]);x.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(b,e){db["[object "+e+"]"]=e.toLowerCase()});var Xa=function(b){function e(b,e,f,h){var l,m,q,t,v,w=e&&e.ownerDocument,M=e?e.nodeType:9;if(f=f||[],"string"!=typeof b||!b||1!==M&&9!==M&&11!==M)return f;if(!h&&((e?e.ownerDocument||e:W)!==X&&Q(e),e=e||X,R)){if(11!==M&&(t=Fa.exec(b)))if(l=t[1])if(9===M){if(!(m=e.getElementById(l)))return f;if(m.id===l)return f.push(m),f}else{if(w&&(m=
w.getElementById(l))&&aa(e,m)&&m.id===l)return f.push(m),f}else{if(t[2])return ha.apply(f,e.getElementsByTagName(b)),f;if((l=t[3])&&F.getElementsByClassName&&e.getElementsByClassName)return ha.apply(f,e.getElementsByClassName(l)),f}if(!(!F.qsa||da[b+" "]||S&&S.test(b))){if(1!==M)w=e,v=b;else if("object"!==e.nodeName.toLowerCase()){(q=e.getAttribute("id"))?q=q.replace(Ga,Ha):e.setAttribute("id",q=T);m=Ca(b);for(l=m.length;l--;)m[l]="#"+q+" "+x(m[l]);v=m.join(",");w=Ea.test(b)&&z(e.parentNode)||e}if(v)try{return ha.apply(f,
w.querySelectorAll(v)),f}catch(vc){}finally{q===T&&e.removeAttribute("id")}}}return I(b.replace(pa,"$1"),e,f,h)}function f(){function b(f,h){return e.push(f+" ")>G.cacheLength&&delete b[e.shift()],b[f+" "]=h}var e=[];return b}function h(b){return b[T]=!0,b}function l(b){var e=X.createElement("fieldset");try{return!!b(e)}catch(tc){return!1}finally{e.parentNode&&e.parentNode.removeChild(e)}}function m(b,e){for(var f=b.split("|"),h=f.length;h--;)G.attrHandle[f[h]]=e}function q(b,e){var f=e&&b,h=f&&1===
b.nodeType&&1===e.nodeType&&b.sourceIndex-e.sourceIndex;if(h)return h;if(f)for(;f=f.nextSibling;)if(f===e)return-1;return b?1:-1}function t(b){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===b}}function v(b){return function(e){var f=e.nodeName.toLowerCase();return("input"===f||"button"===f)&&e.type===b}}function w(b){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===b:e.disabled===b:e.isDisabled===b||
e.isDisabled!==!b&&Nb(e)===b:e.disabled===b:"label"in e&&e.disabled===b}}function M(b){return h(function(e){return e=+e,h(function(f,h){for(var l,m=b([],f.length,e),q=m.length;q--;)f[l=m[q]]&&(f[l]=!(h[l]=f[l]))})})}function z(b){return b&&"undefined"!=typeof b.getElementsByTagName&&b}function y(){}function x(b){for(var e=0,f=b.length,h="";e<f;e++)h+=b[e].value;return h}function B(b,e,f){var h=e.dir,l=e.next,m=l||h,q=f&&"parentNode"===m,t=ea++;return e.first?function(e,f,l){for(;e=e[h];)if(1===e.nodeType||
q)return b(e,f,l);return!1}:function(e,f,v){var w,M,z,y=[Z,t];if(v)for(;e=e[h];){if((1===e.nodeType||q)&&b(e,f,v))return!0}else for(;e=e[h];)if(1===e.nodeType||q)if(z=e[T]||(e[T]={}),M=z[e.uniqueID]||(z[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[h]||e;else{if((w=M[m])&&w[0]===Z&&w[1]===t)return y[2]=w[2];if(M[m]=y,y[2]=b(e,f,v))return!0}return!1}}function E(b){return 1<b.length?function(e,f,h){for(var l=b.length;l--;)if(!b[l](e,f,h))return!1;return!0}:b[0]}function D(b,e,f,h,l){for(var m,
q=[],t=0,v=b.length,w=null!=e;t<v;t++)(m=b[t])&&(f&&!f(m,h,l)||(q.push(m),w&&e.push(t)));return q}function sa(b,f,l,m,q,t){return m&&!m[T]&&(m=sa(m)),q&&!q[T]&&(q=sa(q,t)),h(function(h,t,v,w){var M,z,y=[],x=[],B=t.length,U;if(!(U=h)){U=f||"*";for(var ba=v.nodeType?[v]:v,E=[],ob=0,sa=ba.length;ob<sa;ob++)e(U,ba[ob],E);U=E}U=!b||!h&&f?U:D(U,y,b,v,w);ba=l?q||(h?b:B||m)?[]:t:U;if(l&&l(U,ba,v,w),m)for(M=D(ba,x),m(M,[],v,w),v=M.length;v--;)(z=M[v])&&(ba[x[v]]=!(U[x[v]]=z));if(h){if(q||b){if(q){M=[];for(v=
ba.length;v--;)(z=ba[v])&&M.push(U[v]=z);q(null,ba=[],M,w)}for(v=ba.length;v--;)(z=ba[v])&&-1<(M=q?la(h,z):y[v])&&(h[M]=!(t[M]=z))}}else ba=D(ba===t?ba.splice(B,ba.length):ba),q?q(null,t,ba,w):ha.apply(t,ba)})}function K(b){var e,f,h,l=b.length,m=G.relative[b[0].type];f=m||G.relative[" "];for(var q=m?1:0,t=B(function(b){return b===e},f,!0),v=B(function(b){return-1<la(e,b)},f,!0),w=[function(b,f,h){b=!m&&(h||f!==Ta)||((e=f).nodeType?t(b,f,h):v(b,f,h));return e=null,b}];q<l;q++)if(f=G.relative[b[q].type])w=
[B(E(w),f)];else{if(f=G.filter[b[q].type].apply(null,b[q].matches),f[T]){for(h=++q;h<l&&!G.relative[b[h].type];h++);return sa(1<q&&E(w),1<q&&x(b.slice(0,q-1).concat({value:" "===b[q-2].type?"*":""})).replace(pa,"$1"),f,q<h&&K(b.slice(q,h)),h<l&&K(b=b.slice(h)),h<l&&x(b))}w.push(f)}return E(w)}function La(b,f){var l=0<f.length,m=0<b.length,q=function(h,q,t,v,w){var M,z,y,x=0,U="0",B=h&&[],ba=[],E=Ta,ob=h||m&&G.find.TAG("*",w),sa=Z+=null==E?1:Math.random()||.1,zb=ob.length;for(w&&(Ta=q===X||q||w);U!==
zb&&null!=(M=ob[U]);U++){if(m&&M){z=0;for(q||M.ownerDocument===X||(Q(M),t=!R);y=b[z++];)if(y(M,q||X,t)){v.push(M);break}w&&(Z=sa)}l&&((M=!y&&M)&&x--,h&&B.push(M))}if(x+=U,l&&U!==x){for(z=0;y=f[z++];)y(B,ba,q,t);if(h){if(0<x)for(;U--;)B[U]||ba[U]||(ba[U]=ma.call(v));ba=D(ba)}ha.apply(v,ba);w&&!h&&0<ba.length&&1<x+f.length&&e.uniqueSort(v)}return w&&(Z=sa,Ta=E),B};return l?h(q):q}var Ka,F,G,J,H,Ca,L,I,Ta,N,O,Q,X,V,R,S,Ja,Y,aa,T="sizzle"+1*new Date,W=b.document,Z=0,ea=0,fa=f(),ja=f(),da=f(),ia=function(b,
e){return b===e&&(O=!0),0},ka={}.hasOwnProperty,ca=[],ma=ca.pop,na=ca.push,ha=ca.push,oa=ca.slice,la=function(b,e){for(var f=0,h=b.length;f<h;f++)if(b[f]===e)return f;return-1},qa=RegExp("[\\x20\\t\\r\\n\\f]+","g"),pa=RegExp("^[\\x20\\t\\r\\n\\f]+|((?:^|[^\\\\])(?:\\\\.)*)[\\x20\\t\\r\\n\\f]+$","g"),ta=/^[\x20\t\r\n\f]*,[\x20\t\r\n\f]*/,wa=/^[\x20\t\r\n\f]*([>+~]|[\x20\t\r\n\f])[\x20\t\r\n\f]*/,xa=RegExp("=[\\x20\\t\\r\\n\\f]*([^\\]'\"]*?)[\\x20\\t\\r\\n\\f]*\\]","g"),Mb=/:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
Aa=/^(?:\\.|[\w-]|[^\x00-\xa0])+$/,ra={ID:/^#((?:\\.|[\w-]|[^\x00-\xa0])+)/,CLASS:/^\.((?:\\.|[\w-]|[^\x00-\xa0])+)/,TAG:/^((?:\\.|[\w-]|[^\x00-\xa0])+|[*])/,ATTR:/^\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\]/,PSEUDO:/^:((?:\\.|[\w-]|[^\x00-\xa0])+)(?:\((('((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)")|((?:\\.|[^\\()[\]]|\[[\x20\t\r\n\f]*((?:\\.|[\w-]|[^\x00-\xa0])+)(?:[\x20\t\r\n\f]*([*^$|!~]?=)[\x20\t\r\n\f]*(?:'((?:\\.|[^\\'])*)'|"((?:\\.|[^\\"])*)"|((?:\\.|[\w-]|[^\x00-\xa0])+))|)[\x20\t\r\n\f]*\])*)|.*)\)|)/,
CHILD:/^:(only|first|last|nth|nth-last)-(child|of-type)(?:\([\x20\t\r\n\f]*(even|odd|(([+-]|)(\d*)n|)[\x20\t\r\n\f]*(?:([+-]|)[\x20\t\r\n\f]*(\d+)|))[\x20\t\r\n\f]*\)|)/i,bool:/^(?:checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)$/i,needsContext:/^[\x20\t\r\n\f]*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\([\x20\t\r\n\f]*((?:-\d)?\d*)[\x20\t\r\n\f]*\)|)(?=[^-]|$)/i},Ba=/^(?:input|select|textarea|button)$/i,Da=/^h\d$/i,ua=
/^[^{]+\{\s*\[native \w/,Fa=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Ea=/[+~]/,ya=RegExp("\\\\([\\da-f]{1,6}[\\x20\\t\\r\\n\\f]?|([\\x20\\t\\r\\n\\f])|.)","ig"),za=function(b,e,f){b="0x"+e-65536;return b!==b||f?e:0>b?String.fromCharCode(b+65536):String.fromCharCode(b>>10|55296,1023&b|56320)},Ga=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,Ha=function(b,e){return e?"\x00"===b?"\ufffd":b.slice(0,-1)+"\\"+b.charCodeAt(b.length-1).toString(16)+" ":"\\"+b},Ia=function(){Q()},Nb=B(function(b){return!0===
b.disabled&&("form"in b||"label"in b)},{dir:"parentNode",next:"legend"});try{ha.apply(ca=oa.call(W.childNodes),W.childNodes),ca[W.childNodes.length].nodeType}catch(rc){ha={apply:ca.length?function(b,e){na.apply(b,oa.call(e))}:function(b,e){for(var f=b.length,h=0;b[f++]=e[h++];);b.length=f-1}}}F=e.support={};H=e.isXML=function(b){b=b&&(b.ownerDocument||b).documentElement;return!!b&&"HTML"!==b.nodeName};Q=e.setDocument=function(b){var e,f;b=b?b.ownerDocument||b:W;return b!==X&&9===b.nodeType&&b.documentElement?
(X=b,V=X.documentElement,R=!H(X),W!==X&&(f=X.defaultView)&&f.top!==f&&(f.addEventListener?f.addEventListener("unload",Ia,!1):f.attachEvent&&f.attachEvent("onunload",Ia)),F.attributes=l(function(b){return b.className="i",!b.getAttribute("className")}),F.getElementsByTagName=l(function(b){return b.appendChild(X.createComment("")),!b.getElementsByTagName("*").length}),F.getElementsByClassName=ua.test(X.getElementsByClassName),F.getById=l(function(b){return V.appendChild(b).id=T,!X.getElementsByName||
!X.getElementsByName(T).length}),F.getById?(G.filter.ID=function(b){var e=b.replace(ya,za);return function(b){return b.getAttribute("id")===e}},G.find.ID=function(b,e){if("undefined"!=typeof e.getElementById&&R){var f=e.getElementById(b);return f?[f]:[]}}):(G.filter.ID=function(b){var e=b.replace(ya,za);return function(b){return(b="undefined"!=typeof b.getAttributeNode&&b.getAttributeNode("id"))&&b.value===e}},G.find.ID=function(b,e){if("undefined"!=typeof e.getElementById&&R){var f,h,l,m=e.getElementById(b);
if(m){if(f=m.getAttributeNode("id"),f&&f.value===b)return[m];l=e.getElementsByName(b);for(h=0;m=l[h++];)if(f=m.getAttributeNode("id"),f&&f.value===b)return[m]}return[]}}),G.find.TAG=F.getElementsByTagName?function(b,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(b):F.qsa?e.querySelectorAll(b):void 0}:function(b,e){var f,h=[],l=0,m=e.getElementsByTagName(b);if("*"===b){for(;f=m[l++];)1===f.nodeType&&h.push(f);return h}return m},G.find.CLASS=F.getElementsByClassName&&function(b,
e){if("undefined"!=typeof e.getElementsByClassName&&R)return e.getElementsByClassName(b)},Ja=[],S=[],(F.qsa=ua.test(X.querySelectorAll))&&(l(function(b){V.appendChild(b).innerHTML="<a id='"+T+"'></a><select id='"+T+"-\r\\' msallowcapture=''><option selected=''></option></select>";b.querySelectorAll("[msallowcapture^='']").length&&S.push("[*^$]=[\\x20\\t\\r\\n\\f]*(?:''|\"\")");b.querySelectorAll("[selected]").length||S.push("\\[[\\x20\\t\\r\\n\\f]*(?:value|checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped)");
b.querySelectorAll("[id~="+T+"-]").length||S.push("~=");b.querySelectorAll(":checked").length||S.push(":checked");b.querySelectorAll("a#"+T+"+*").length||S.push(".#.+[+~]")}),l(function(b){b.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var e=X.createElement("input");e.setAttribute("type","hidden");b.appendChild(e).setAttribute("name","D");b.querySelectorAll("[name=d]").length&&S.push("name[\\x20\\t\\r\\n\\f]*[*^$|!~]?=");2!==b.querySelectorAll(":enabled").length&&
S.push(":enabled",":disabled");V.appendChild(b).disabled=!0;2!==b.querySelectorAll(":disabled").length&&S.push(":enabled",":disabled");b.querySelectorAll("*,:x");S.push(",.*:")})),(F.matchesSelector=ua.test(Y=V.matches||V.webkitMatchesSelector||V.mozMatchesSelector||V.oMatchesSelector||V.msMatchesSelector))&&l(function(b){F.disconnectedMatch=Y.call(b,"*");Y.call(b,"[s!='']:x");Ja.push("!=",":((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|\\[[\\x20\\t\\r\\n\\f]*((?:\\\\.|[\\w-]|[^\x00-\\xa0])+)(?:[\\x20\\t\\r\\n\\f]*([*^$|!~]?=)[\\x20\\t\\r\\n\\f]*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|((?:\\\\.|[\\w-]|[^\x00-\\xa0])+))|)[\\x20\\t\\r\\n\\f]*\\])*)|.*)\\)|)")}),
S=S.length&&new RegExp(S.join("|")),Ja=Ja.length&&new RegExp(Ja.join("|")),e=ua.test(V.compareDocumentPosition),aa=e||ua.test(V.contains)?function(b,e){var f=9===b.nodeType?b.documentElement:b,h=e&&e.parentNode;return b===h||!(!h||1!==h.nodeType||!(f.contains?f.contains(h):b.compareDocumentPosition&&16&b.compareDocumentPosition(h)))}:function(b,e){if(e)for(;e=e.parentNode;)if(e===b)return!0;return!1},ia=e?function(b,e){if(b===e)return O=!0,0;var f=!b.compareDocumentPosition-!e.compareDocumentPosition;
return f?f:(f=(b.ownerDocument||b)===(e.ownerDocument||e)?b.compareDocumentPosition(e):1,1&f||!F.sortDetached&&e.compareDocumentPosition(b)===f?b===X||b.ownerDocument===W&&aa(W,b)?-1:e===X||e.ownerDocument===W&&aa(W,e)?1:N?la(N,b)-la(N,e):0:4&f?-1:1)}:function(b,e){if(b===e)return O=!0,0;var f,h=0;f=b.parentNode;var l=e.parentNode,m=[b],t=[e];if(!f||!l)return b===X?-1:e===X?1:f?-1:l?1:N?la(N,b)-la(N,e):0;if(f===l)return q(b,e);for(f=b;f=f.parentNode;)m.unshift(f);for(f=e;f=f.parentNode;)t.unshift(f);
for(;m[h]===t[h];)h++;return h?q(m[h],t[h]):m[h]===W?-1:t[h]===W?1:0},X):X};e.matches=function(b,f){return e(b,null,null,f)};e.matchesSelector=function(b,f){if((b.ownerDocument||b)!==X&&Q(b),f=f.replace(xa,"='$1']"),!(!F.matchesSelector||!R||da[f+" "]||Ja&&Ja.test(f)||S&&S.test(f)))try{var h=Y.call(b,f);if(h||F.disconnectedMatch||b.document&&11!==b.document.nodeType)return h}catch(uc){}return 0<e(f,X,null,[b]).length};e.contains=function(b,e){return(b.ownerDocument||b)!==X&&Q(b),aa(b,e)};e.attr=function(b,
e){(b.ownerDocument||b)!==X&&Q(b);var f=G.attrHandle[e.toLowerCase()],f=f&&ka.call(G.attrHandle,e.toLowerCase())?f(b,e,!R):void 0;return void 0!==f?f:F.attributes||!R?b.getAttribute(e):(f=b.getAttributeNode(e))&&f.specified?f.value:null};e.escape=function(b){return(b+"").replace(Ga,Ha)};e.error=function(b){throw Error("Syntax error, unrecognized expression: "+b);};e.uniqueSort=function(b){var e,f=[],h=0,l=0;if(O=!F.detectDuplicates,N=!F.sortStable&&b.slice(0),b.sort(ia),O){for(;e=b[l++];)e===b[l]&&
(h=f.push(l));for(;h--;)b.splice(f[h],1)}return N=null,b};J=e.getText=function(b){var e,f="",h=0;if(e=b.nodeType)if(1===e||9===e||11===e){if("string"==typeof b.textContent)return b.textContent;for(b=b.firstChild;b;b=b.nextSibling)f+=J(b)}else{if(3===e||4===e)return b.nodeValue}else for(;e=b[h++];)f+=J(e);return f};G=e.selectors={cacheLength:50,createPseudo:h,match:ra,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},
preFilter:{ATTR:function(b){return b[1]=b[1].replace(ya,za),b[3]=(b[3]||b[4]||b[5]||"").replace(ya,za),"~="===b[2]&&(b[3]=" "+b[3]+" "),b.slice(0,4)},CHILD:function(b){return b[1]=b[1].toLowerCase(),"nth"===b[1].slice(0,3)?(b[3]||e.error(b[0]),b[4]=+(b[4]?b[5]+(b[6]||1):2*("even"===b[3]||"odd"===b[3])),b[5]=+(b[7]+b[8]||"odd"===b[3])):b[3]&&e.error(b[0]),b},PSEUDO:function(b){var e,f=!b[6]&&b[2];return ra.CHILD.test(b[0])?null:(b[3]?b[2]=b[4]||b[5]||"":f&&Mb.test(f)&&(e=Ca(f,!0))&&(e=f.indexOf(")",
f.length-e)-f.length)&&(b[0]=b[0].slice(0,e),b[2]=f.slice(0,e)),b.slice(0,3))}},filter:{TAG:function(b){var e=b.replace(ya,za).toLowerCase();return"*"===b?function(){return!0}:function(b){return b.nodeName&&b.nodeName.toLowerCase()===e}},CLASS:function(b){var e=fa[b+" "];return e||(e=new RegExp("(^|[\\x20\\t\\r\\n\\f])"+b+"([\\x20\\t\\r\\n\\f]|$)"),fa(b,function(b){return e.test("string"==typeof b.className&&b.className||"undefined"!=typeof b.getAttribute&&b.getAttribute("class")||"")}))},ATTR:function(b,
f,h){return function(l){l=e.attr(l,b);return null==l?"!="===f:!f||(l+="","="===f?l===h:"!="===f?l!==h:"^="===f?h&&0===l.indexOf(h):"*="===f?h&&-1<l.indexOf(h):"$="===f?h&&l.slice(-h.length)===h:"~="===f?-1<(" "+l.replace(qa," ")+" ").indexOf(h):"|="===f&&(l===h||l.slice(0,h.length+1)===h+"-"))}},CHILD:function(b,e,f,h,l){var m="nth"!==b.slice(0,3),q="last"!==b.slice(-4),t="of-type"===e;return 1===h&&0===l?function(b){return!!b.parentNode}:function(e,f,v){var w,M,z,y,x,U;f=m!==q?"nextSibling":"previousSibling";
var B=e.parentNode,ba=t&&e.nodeName.toLowerCase();v=!v&&!t;var E=!1;if(B){if(m){for(;f;){for(y=e;y=y[f];)if(t?y.nodeName.toLowerCase()===ba:1===y.nodeType)return!1;U=f="only"===b&&!U&&"nextSibling"}return!0}if(U=[q?B.firstChild:B.lastChild],q&&v)for(y=B,z=y[T]||(y[T]={}),M=z[y.uniqueID]||(z[y.uniqueID]={}),w=M[b]||[],E=(x=w[0]===Z&&w[1])&&w[2],y=x&&B.childNodes[x];y=++x&&y&&y[f]||(E=x=0)||U.pop();){if(1===y.nodeType&&++E&&y===e){M[b]=[Z,x,E];break}}else if(v&&(y=e,z=y[T]||(y[T]={}),M=z[y.uniqueID]||
(z[y.uniqueID]={}),w=M[b]||[],x=w[0]===Z&&w[1],E=x),!1===E)for(;(y=++x&&y&&y[f]||(E=x=0)||U.pop())&&((t?y.nodeName.toLowerCase()!==ba:1!==y.nodeType)||!++E||(v&&(z=y[T]||(y[T]={}),M=z[y.uniqueID]||(z[y.uniqueID]={}),M[b]=[Z,E]),y!==e)););return E-=l,E===h||0===E%h&&0<=E/h}}},PSEUDO:function(b,f){var l,m=G.pseudos[b]||G.setFilters[b.toLowerCase()]||e.error("unsupported pseudo: "+b);return m[T]?m(f):1<m.length?(l=[b,b,"",f],G.setFilters.hasOwnProperty(b.toLowerCase())?h(function(b,e){for(var h,l=m(b,
f),q=l.length;q--;)h=la(b,l[q]),b[h]=!(e[h]=l[q])}):function(b){return m(b,0,l)}):m}},pseudos:{not:h(function(b){var e=[],f=[],l=L(b.replace(pa,"$1"));return l[T]?h(function(b,e,f,h){var m;f=l(b,null,h,[]);for(h=b.length;h--;)(m=f[h])&&(b[h]=!(e[h]=m))}):function(b,h,m){return e[0]=b,l(e,null,m,f),e[0]=null,!f.pop()}}),has:h(function(b){return function(f){return 0<e(b,f).length}}),contains:h(function(b){return b=b.replace(ya,za),function(e){return-1<(e.textContent||e.innerText||J(e)).indexOf(b)}}),
lang:h(function(b){return Aa.test(b||"")||e.error("unsupported lang: "+b),b=b.replace(ya,za).toLowerCase(),function(e){var f;do if(f=R?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return f=f.toLowerCase(),f===b||0===f.indexOf(b+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var f=b.location&&b.location.hash;return f&&f.slice(1)===e.id},root:function(b){return b===V},focus:function(b){return b===X.activeElement&&(!X.hasFocus||X.hasFocus())&&!!(b.type||b.href||
~b.tabIndex)},enabled:w(!1),disabled:w(!0),checked:function(b){var e=b.nodeName.toLowerCase();return"input"===e&&!!b.checked||"option"===e&&!!b.selected},selected:function(b){return b.parentNode&&b.parentNode.selectedIndex,!0===b.selected},empty:function(b){for(b=b.firstChild;b;b=b.nextSibling)if(6>b.nodeType)return!1;return!0},parent:function(b){return!G.pseudos.empty(b)},header:function(b){return Da.test(b.nodeName)},input:function(b){return Ba.test(b.nodeName)},button:function(b){var e=b.nodeName.toLowerCase();
return"input"===e&&"button"===b.type||"button"===e},text:function(b){var e;return"input"===b.nodeName.toLowerCase()&&"text"===b.type&&(null==(e=b.getAttribute("type"))||"text"===e.toLowerCase())},first:M(function(){return[0]}),last:M(function(b,e){return[e-1]}),eq:M(function(b,e,f){return[0>f?f+e:f]}),even:M(function(b,e){for(var f=0;f<e;f+=2)b.push(f);return b}),odd:M(function(b,e){for(var f=1;f<e;f+=2)b.push(f);return b}),lt:M(function(b,e,f){for(e=0>f?f+e:f;0<=--e;)b.push(e);return b}),gt:M(function(b,
e,f){for(f=0>f?f+e:f;++f<e;)b.push(f);return b})}};G.pseudos.nth=G.pseudos.eq;for(Ka in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})G.pseudos[Ka]=t(Ka);for(Ka in{submit:!0,reset:!0})G.pseudos[Ka]=v(Ka);y.prototype=G.filters=G.pseudos;G.setFilters=new y;Ca=e.tokenize=function(b,f){var h,l,m,q,t,v,w;if(t=ja[b+" "])return f?0:t.slice(0);t=b;v=[];for(w=G.preFilter;t;){h&&!(l=ta.exec(t))||(l&&(t=t.slice(l[0].length)||t),v.push(m=[]));h=!1;(l=wa.exec(t))&&(h=l.shift(),m.push({value:h,type:l[0].replace(pa,
" ")}),t=t.slice(h.length));for(q in G.filter)!(l=ra[q].exec(t))||w[q]&&!(l=w[q](l))||(h=l.shift(),m.push({value:h,type:q,matches:l}),t=t.slice(h.length));if(!h)break}return f?t.length:t?e.error(b):ja(b,v).slice(0)};return L=e.compile=function(b,e){var f,h=[],l=[],m=da[b+" "];if(!m){e||(e=Ca(b));for(f=e.length;f--;)m=K(e[f]),m[T]?h.push(m):l.push(m);m=da(b,La(l,h));m.selector=b}return m},I=e.select=function(b,e,f,h){var l,m,q,t,v,w="function"==typeof b&&b,M=!h&&Ca(b=w.selector||b);if(f=f||[],1===
M.length){if(m=M[0]=M[0].slice(0),2<m.length&&"ID"===(q=m[0]).type&&9===e.nodeType&&R&&G.relative[m[1].type]){if(e=(G.find.ID(q.matches[0].replace(ya,za),e)||[])[0],!e)return f;w&&(e=e.parentNode);b=b.slice(m.shift().value.length)}for(l=ra.needsContext.test(b)?0:m.length;l--&&(q=m[l],!G.relative[t=q.type]);)if((v=G.find[t])&&(h=v(q.matches[0].replace(ya,za),Ea.test(m[0].type)&&z(e.parentNode)||e))){if(m.splice(l,1),b=h.length&&x(m),!b)return ha.apply(f,h),f;break}}return(w||L(b,M))(h,e,!R,f,!e||Ea.test(b)&&
z(e.parentNode)||e),f},F.sortStable=T.split("").sort(ia).join("")===T,F.detectDuplicates=!!O,Q(),F.sortDetached=l(function(b){return 1&b.compareDocumentPosition(X.createElement("fieldset"))}),l(function(b){return b.innerHTML="<a href='#'></a>","#"===b.firstChild.getAttribute("href")})||m("type|href|height|width",function(b,e,f){if(!f)return b.getAttribute(e,"type"===e.toLowerCase()?1:2)}),F.attributes&&l(function(b){return b.innerHTML="<input/>",b.firstChild.setAttribute("value",""),""===b.firstChild.getAttribute("value")})||
m("value",function(b,e,f){if(!f&&"input"===b.nodeName.toLowerCase())return b.defaultValue}),l(function(b){return null==b.getAttribute("disabled")})||m("checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",function(b,e,f){var h;if(!f)return!0===b[e]?e.toLowerCase():(h=b.getAttributeNode(e))&&h.specified?h.value:null}),e}(b);x.find=Xa;x.expr=Xa.selectors;x.expr[":"]=x.expr.pseudos;x.uniqueSort=x.unique=Xa.uniqueSort;x.text=Xa.getText;
x.isXMLDoc=Xa.isXML;x.contains=Xa.contains;x.escapeSelector=Xa.escape;var ra=function(b,e,f){for(var h=[],l=void 0!==f;(b=b[e])&&9!==b.nodeType;)if(1===b.nodeType){if(l&&x(b).is(f))break;h.push(b)}return h},Ua=function(b,e){for(var f=[];b;b=b.nextSibling)1===b.nodeType&&b!==e&&f.push(b);return f},wa=x.expr.match.needsContext,Fa=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,mb=/^.[^:#\[\.,]*$/;x.filter=function(b,e,f){var h=e[0];return f&&(b=":not("+b+")"),1===e.length&&1===h.nodeType?
x.find.matchesSelector(h,b)?[h]:[]:x.find.matches(b,x.grep(e,function(b){return 1===b.nodeType}))};x.fn.extend({find:function(b){var e,f,h=this.length,l=this;if("string"!=typeof b)return this.pushStack(x(b).filter(function(){for(e=0;e<h;e++)if(x.contains(l[e],this))return!0}));f=this.pushStack([]);for(e=0;e<h;e++)x.find(b,l[e],f);return 1<h?x.uniqueSort(f):f},filter:function(b){return this.pushStack(m(this,b||[],!1))},not:function(b){return this.pushStack(m(this,b||[],!0))},is:function(b){return!!m(this,
"string"==typeof b&&wa.test(b)?x(b):b||[],!1).length}});var $a,eb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(x.fn.init=function(b,e,f){var h,l;if(!b)return this;if(f=f||$a,"string"==typeof b){if(h="<"===b[0]&&">"===b[b.length-1]&&3<=b.length?[null,b,null]:eb.exec(b),!h||!h[1]&&e)return!e||e.jquery?(e||f).find(b):this.constructor(e).find(b);if(h[1]){if(e=e instanceof x?e[0]:e,x.merge(this,x.parseHTML(h[1],e&&e.nodeType?e.ownerDocument||e:Y,!0)),Fa.test(h[1])&&x.isPlainObject(e))for(h in e)x.isFunction(this[h])?
this[h](e[h]):this.attr(h,e[h]);return this}return l=Y.getElementById(h[2]),l&&(this[0]=l,this.length=1),this}return b.nodeType?(this[0]=b,this.length=1,this):x.isFunction(b)?void 0!==f.ready?f.ready(b):b(x):x.makeArray(b,this)}).prototype=x.fn;$a=x(Y);var fb=/^(?:parents|prev(?:Until|All))/,gb={children:!0,contents:!0,next:!0,prev:!0};x.fn.extend({has:function(b){var e=x(b,this),f=e.length;return this.filter(function(){for(var b=0;b<f;b++)if(x.contains(this,e[b]))return!0})},closest:function(b,e){var f,
h=0,l=this.length,m=[],q="string"!=typeof b&&x(b);if(!wa.test(b))for(;h<l;h++)for(f=this[h];f&&f!==e;f=f.parentNode)if(11>f.nodeType&&(q?-1<q.index(f):1===f.nodeType&&x.find.matchesSelector(f,b))){m.push(f);break}return this.pushStack(1<m.length?x.uniqueSort(m):m)},index:function(b){return b?"string"==typeof b?cb.call(x(b),this[0]):cb.call(this,b.jquery?b[0]:b):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(b,e){return this.pushStack(x.uniqueSort(x.merge(this.get(),x(b,
e))))},addBack:function(b){return this.add(null==b?this.prevObject:this.prevObject.filter(b))}});x.each({parent:function(b){return(b=b.parentNode)&&11!==b.nodeType?b:null},parents:function(b){return ra(b,"parentNode")},parentsUntil:function(b,e,f){return ra(b,"parentNode",f)},next:function(b){return h(b,"nextSibling")},prev:function(b){return h(b,"previousSibling")},nextAll:function(b){return ra(b,"nextSibling")},prevAll:function(b){return ra(b,"previousSibling")},nextUntil:function(b,e,f){return ra(b,
"nextSibling",f)},prevUntil:function(b,e,f){return ra(b,"previousSibling",f)},siblings:function(b){return Ua((b.parentNode||{}).firstChild,b)},children:function(b){return Ua(b.firstChild)},contents:function(b){return b.contentDocument||x.merge([],b.childNodes)}},function(b,e){x.fn[b]=function(f,h){var l=x.map(this,e,f);return"Until"!==b.slice(-5)&&(h=f),h&&"string"==typeof h&&(l=x.filter(h,l)),1<this.length&&(gb[b]||x.uniqueSort(l),fb.test(b)&&l.reverse()),this.pushStack(l)}});var xa=/[^\x20\t\r\n\f]+/g;
x.Callbacks=function(b){b="string"==typeof b?q(b):x.extend({},b);var e,f,h,l,m=[],t=[],v=-1,w=function(){l=b.once;for(h=e=!0;t.length;v=-1)for(f=t.shift();++v<m.length;)!1===m[v].apply(f[0],f[1])&&b.stopOnFalse&&(v=m.length,f=!1);b.memory||(f=!1);e=!1;l&&(m=f?[]:"")},z={add:function(){return m&&(f&&!e&&(v=m.length-1,t.push(f)),function $b(e){x.each(e,function(e,f){x.isFunction(f)?b.unique&&z.has(f)||m.push(f):f&&f.length&&"string"!==x.type(f)&&$b(f)})}(arguments),f&&!e&&w()),this},remove:function(){return x.each(arguments,
function(b,e){for(var f;-1<(f=x.inArray(e,m,f));)m.splice(f,1),f<=v&&v--}),this},has:function(b){return b?-1<x.inArray(b,m):0<m.length},empty:function(){return m&&(m=[]),this},disable:function(){return l=t=[],m=f="",this},disabled:function(){return!m},lock:function(){return l=t=[],f||e||(m=f=""),this},locked:function(){return!!l},fireWith:function(b,f){return l||(f=f||[],f=[b,f.slice?f.slice():f],t.push(f),e||w()),this},fire:function(){return z.fireWith(this,arguments),this},fired:function(){return!!h}};
return z};x.extend({Deferred:function(e){var f=[["notify","progress",x.Callbacks("memory"),x.Callbacks("memory"),2],["resolve","done",x.Callbacks("once memory"),x.Callbacks("once memory"),0,"resolved"],["reject","fail",x.Callbacks("once memory"),x.Callbacks("once memory"),1,"rejected"]],h="pending",l={state:function(){return h},always:function(){return m.done(arguments).fail(arguments),this},"catch":function(b){return l.then(null,b)},pipe:function(){var b=arguments;return x.Deferred(function(e){x.each(f,
function(f,h){var l=x.isFunction(b[h[4]])&&b[h[4]];m[h[1]](function(){var b=l&&l.apply(this,arguments);b&&x.isFunction(b.promise)?b.promise().progress(e.notify).done(e.resolve).fail(e.reject):e[h[0]+"With"](this,l?[b]:arguments)})});b=null}).promise()},then:function(e,h,l){function m(e,f,h,l){return function(){var v=this,z=arguments,M=function(){var b,M;if(!(e<q)){if(b=h.apply(v,z),b===f.promise())throw new TypeError("Thenable self-resolution");M=b&&("object"==typeof b||"function"==typeof b)&&b.then;
x.isFunction(M)?l?M.call(b,m(q,f,t,l),m(q,f,w,l)):(q++,M.call(b,m(q,f,t,l),m(q,f,w,l),m(q,f,t,f.notifyWith))):(h!==t&&(v=void 0,z=[b]),(l||f.resolveWith)(v,z))}},y=l?M:function(){try{M()}catch(Rb){x.Deferred.exceptionHook&&x.Deferred.exceptionHook(Rb,y.stackTrace),e+1>=q&&(h!==w&&(v=void 0,z=[Rb]),f.rejectWith(v,z))}};e?y():(x.Deferred.getStackHook&&(y.stackTrace=x.Deferred.getStackHook()),b.setTimeout(y))}}var q=0;return x.Deferred(function(b){f[0][3].add(m(0,b,x.isFunction(l)?l:t,b.notifyWith));
f[1][3].add(m(0,b,x.isFunction(e)?e:t));f[2][3].add(m(0,b,x.isFunction(h)?h:w))}).promise()},promise:function(b){return null!=b?x.extend(b,l):l}},m={};return x.each(f,function(b,e){var q=e[2],t=e[5];l[e[1]]=q.add;t&&q.add(function(){h=t},f[3-b][2].disable,f[0][2].lock);q.add(e[3].fire);m[e[0]]=function(){return m[e[0]+"With"](this===m?void 0:this,arguments),this};m[e[0]+"With"]=q.fireWith}),l.promise(m),e&&e.call(m,m),m},when:function(b){var e=arguments.length,f=e,h=Array(f),l=Ma.call(arguments),
m=x.Deferred(),q=function(b){return function(f){h[b]=this;l[b]=1<arguments.length?Ma.call(arguments):f;--e||m.resolveWith(h,l)}};if(1>=e&&(y(b,m.done(q(f)).resolve,m.reject),"pending"===m.state()||x.isFunction(l[f]&&l[f].then)))return m.then();for(;f--;)y(l[f],q(f),m.reject);return m.promise()}});var ma=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;x.Deferred.exceptionHook=function(e,f){b.console&&b.console.warn&&e&&ma.test(e.name)&&b.console.warn("jQuery.Deferred exception: "+e.message,
e.stack,f)};x.readyException=function(e){b.setTimeout(function(){throw e;})};var nb=x.Deferred();x.fn.ready=function(b){return nb.then(b)["catch"](function(b){x.readyException(b)}),this};x.extend({isReady:!1,readyWait:1,holdReady:function(b){b?x.readyWait++:x.ready(!0)},ready:function(b){(!0===b?--x.readyWait:x.isReady)||(x.isReady=!0,!0!==b&&0<--x.readyWait||nb.resolveWith(Y,[x]))}});x.ready.then=nb.then;"complete"===Y.readyState||"loading"!==Y.readyState&&!Y.documentElement.doScroll?b.setTimeout(x.ready):
(Y.addEventListener("DOMContentLoaded",v),b.addEventListener("load",v));var Oa=function(b,e,f,h,l,m,q){var t=0,v=b.length,w=null==f;if("object"===x.type(f))for(t in l=!0,f)Oa(b,e,t,f[t],!0,m,q);else if(void 0!==h&&(l=!0,x.isFunction(h)||(q=!0),w&&(q?(e.call(b,h),e=null):(w=e,e=function(b,e,f){return w.call(x(b),f)})),e))for(;t<v;t++)e(b[t],f,q?h:h.call(b[t],t,e(b[t],f)));return l?b:w?e.call(b):v?e(b[0],f):m},Ya=function(b){return 1===b.nodeType||9===b.nodeType||!+b.nodeType};z.uid=1;z.prototype={cache:function(b){var e=
b[this.expando];return e||(e={},Ya(b)&&(b.nodeType?b[this.expando]=e:Object.defineProperty(b,this.expando,{value:e,configurable:!0}))),e},set:function(b,e,f){var h;b=this.cache(b);if("string"==typeof e)b[x.camelCase(e)]=f;else for(h in e)b[x.camelCase(h)]=e[h];return b},get:function(b,e){return void 0===e?this.cache(b):b[this.expando]&&b[this.expando][x.camelCase(e)]},access:function(b,e,f){return void 0===e||e&&"string"==typeof e&&void 0===f?this.get(b,e):(this.set(b,e,f),void 0!==f?f:e)},remove:function(b,
e){var f,h=b[this.expando];if(void 0!==h){if(void 0!==e)for(x.isArray(e)?e=e.map(x.camelCase):(e=x.camelCase(e),e=e in h?[e]:e.match(xa)||[]),f=e.length;f--;)delete h[e[f]];(void 0===e||x.isEmptyObject(h))&&(b.nodeType?b[this.expando]=void 0:delete b[this.expando])}},hasData:function(b){b=b[this.expando];return void 0!==b&&!x.isEmptyObject(b)}};var R=new z,Ea=new z,Ib=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Jb=/[A-Z]/g;x.extend({hasData:function(b){return Ea.hasData(b)||R.hasData(b)},data:function(b,e,f){return Ea.access(b,
e,f)},removeData:function(b,e){Ea.remove(b,e)},_data:function(b,e,f){return R.access(b,e,f)},_removeData:function(b,e){R.remove(b,e)}});x.fn.extend({data:function(b,e){var f,h,l,m=this[0],q=m&&m.attributes;if(void 0===b){if(this.length&&(l=Ea.get(m),1===m.nodeType&&!R.get(m,"hasDataAttrs"))){for(f=q.length;f--;)q[f]&&(h=q[f].name,0===h.indexOf("data-")&&(h=x.camelCase(h.slice(5)),B(m,h,l[h])));R.set(m,"hasDataAttrs",!0)}return l}return"object"==typeof b?this.each(function(){Ea.set(this,b)}):Oa(this,
function(e){var f;if(m&&void 0===e){if((f=Ea.get(m,b),void 0!==f)||(f=B(m,b),void 0!==f))return f}else this.each(function(){Ea.set(this,b,e)})},null,e,1<arguments.length,null,!0)},removeData:function(b){return this.each(function(){Ea.remove(this,b)})}});x.extend({queue:function(b,e,f){var h;if(b)return e=(e||"fx")+"queue",h=R.get(b,e),f&&(!h||x.isArray(f)?h=R.access(b,e,x.makeArray(f)):h.push(f)),h||[]},dequeue:function(b,e){e=e||"fx";var f=x.queue(b,e),h=f.length,l=f.shift(),m=x._queueHooks(b,e),
q=function(){x.dequeue(b,e)};"inprogress"===l&&(l=f.shift(),h--);l&&("fx"===e&&f.unshift("inprogress"),delete m.stop,l.call(b,q,m));!h&&m&&m.empty.fire()},_queueHooks:function(b,e){var f=e+"queueHooks";return R.get(b,f)||R.access(b,f,{empty:x.Callbacks("once memory").add(function(){R.remove(b,[e+"queue",f])})})}});x.fn.extend({queue:function(b,e){var f=2;return"string"!=typeof b&&(e=b,b="fx",f--),arguments.length<f?x.queue(this[0],b):void 0===e?this:this.each(function(){var f=x.queue(this,b,e);x._queueHooks(this,
b);"fx"===b&&"inprogress"!==f[0]&&x.dequeue(this,b)})},dequeue:function(b){return this.each(function(){x.dequeue(this,b)})},clearQueue:function(b){return this.queue(b||"fx",[])},promise:function(b,e){var f,h=1,l=x.Deferred(),m=this,q=this.length,t=function(){--h||l.resolveWith(m,[m])};"string"!=typeof b&&(e=b,b=void 0);for(b=b||"fx";q--;)(f=R.get(m[q],b+"queueHooks"))&&f.empty&&(h++,f.empty.add(t));return t(),l.promise(e)}});var yb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Qa=new RegExp("^(?:([+-])=|)("+
yb+")([a-z%]*)$","i"),ya=["Top","Right","Bottom","Left"],Ra=function(b,e){return b=e||b,"none"===b.style.display||""===b.style.display&&x.contains(b.ownerDocument,b)&&"none"===x.css(b,"display")},Eb=function(b,e,f,h){var l,m={};for(l in e)m[l]=b.style[l],b.style[l]=e[l];f=f.apply(b,h||[]);for(l in e)b.style[l]=m[l];return f},Ab={};x.fn.extend({show:function(){return D(this,!0)},hide:function(){return D(this)},toggle:function(b){return"boolean"==typeof b?b?this.show():this.hide():this.each(function(){Ra(this)?
x(this).show():x(this).hide()})}});var Fb=/^(?:checkbox|radio)$/i,Cb=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,Db=/^$|\/(?:java|ecma)script/i,za={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};za.optgroup=za.option;za.tbody=za.tfoot=za.colgroup=za.caption=za.thead;za.th=za.td;var Bb=/<|&#?\w+;/;!function(){var b=
Y.createDocumentFragment().appendChild(Y.createElement("div")),e=Y.createElement("input");e.setAttribute("type","radio");e.setAttribute("checked","checked");e.setAttribute("name","t");b.appendChild(e);oa.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked;b.innerHTML="<textarea>x</textarea>";oa.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue}();var hb=Y.documentElement,sb=/^key/,Za=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,bb=/^([^.]*)(?:\.(.+)|)/;x.event={global:{},add:function(b,
e,f,h,l){var m,q,t,v,w,z,y,M,B,U;if(w=R.get(b))for(f.handler&&(m=f,f=m.handler,l=m.selector),l&&x.find.matchesSelector(hb,l),f.guid||(f.guid=x.guid++),(v=w.events)||(v=w.events={}),(q=w.handle)||(q=w.handle=function(e){return"undefined"!=typeof x&&x.event.triggered!==e.type?x.event.dispatch.apply(b,arguments):void 0}),e=(e||"").match(xa)||[""],w=e.length;w--;)t=bb.exec(e[w])||[],B=U=t[1],t=(t[2]||"").split(".").sort(),B&&(y=x.event.special[B]||{},B=(l?y.delegateType:y.bindType)||B,y=x.event.special[B]||
{},z=x.extend({type:B,origType:U,data:h,handler:f,guid:f.guid,selector:l,needsContext:l&&x.expr.match.needsContext.test(l),namespace:t.join(".")},m),(M=v[B])||(M=v[B]=[],M.delegateCount=0,y.setup&&!1!==y.setup.call(b,h,t,q)||b.addEventListener&&b.addEventListener(B,q)),y.add&&(y.add.call(b,z),z.handler.guid||(z.handler.guid=f.guid)),l?M.splice(M.delegateCount++,0,z):M.push(z),x.event.global[B]=!0)},remove:function(b,e,f,h,l){var m,q,t,v,w,z,y,M,B,U,E,D=R.hasData(b)&&R.get(b);if(D&&(v=D.events)){e=
(e||"").match(xa)||[""];for(w=e.length;w--;)if(t=bb.exec(e[w])||[],B=E=t[1],U=(t[2]||"").split(".").sort(),B){y=x.event.special[B]||{};B=(h?y.delegateType:y.bindType)||B;M=v[B]||[];t=t[2]&&new RegExp("(^|\\.)"+U.join("\\.(?:.*\\.|)")+"(\\.|$)");for(q=m=M.length;m--;)z=M[m],!l&&E!==z.origType||f&&f.guid!==z.guid||t&&!t.test(z.namespace)||h&&h!==z.selector&&("**"!==h||!z.selector)||(M.splice(m,1),z.selector&&M.delegateCount--,y.remove&&y.remove.call(b,z));q&&!M.length&&(y.teardown&&!1!==y.teardown.call(b,
U,D.handle)||x.removeEvent(b,B,D.handle),delete v[B])}else for(B in v)x.event.remove(b,B+e[w],f,h,!0);x.isEmptyObject(v)&&R.remove(b,"handle events")}},dispatch:function(b){var e=x.event.fix(b),f,h,l,m,q,t,v=Array(arguments.length);h=(R.get(this,"events")||{})[e.type]||[];var w=x.event.special[e.type]||{};v[0]=e;for(f=1;f<arguments.length;f++)v[f]=arguments[f];if(e.delegateTarget=this,!w.preDispatch||!1!==w.preDispatch.call(this,e)){t=x.event.handlers.call(this,e,h);for(f=0;(m=t[f++])&&!e.isPropagationStopped();)for(e.currentTarget=
m.elem,h=0;(q=m.handlers[h++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!e.rnamespace.test(q.namespace)||(e.handleObj=q,e.data=q.data,l=((x.event.special[q.origType]||{}).handle||q.handler).apply(m.elem,v),void 0!==l&&!1===(e.result=l)&&(e.preventDefault(),e.stopPropagation()));return w.postDispatch&&w.postDispatch.call(this,e),e.result}},handlers:function(b,e){var f,h,l,m,q,t=[],v=e.delegateCount,w=b.target;if(v&&w.nodeType&&!("click"===b.type&&1<=b.button))for(;w!==this;w=w.parentNode||
this)if(1===w.nodeType&&("click"!==b.type||!0!==w.disabled)){m=[];q={};for(f=0;f<v;f++)h=e[f],l=h.selector+" ",void 0===q[l]&&(q[l]=h.needsContext?-1<x(l,this).index(w):x.find(l,this,null,[w]).length),q[l]&&m.push(h);m.length&&t.push({elem:w,handlers:m})}return w=this,v<e.length&&t.push({elem:w,handlers:e.slice(v)}),t},addProp:function(b,e){Object.defineProperty(x.Event.prototype,b,{enumerable:!0,configurable:!0,get:x.isFunction(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[b]},
set:function(e){Object.defineProperty(this,b,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(b){return b[x.expando]?b:new x.Event(b)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==G()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===G()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&x.nodeName(this,"input"))return this.click(),!1},_default:function(b){return x.nodeName(b.target,
"a")}},beforeunload:{postDispatch:function(b){void 0!==b.result&&b.originalEvent&&(b.originalEvent.returnValue=b.result)}}}};x.removeEvent=function(b,e,f){b.removeEventListener&&b.removeEventListener(e,f)};x.Event=function(b,e){return this instanceof x.Event?(b&&b.type?(this.originalEvent=b,this.type=b.type,this.isDefaultPrevented=b.defaultPrevented||void 0===b.defaultPrevented&&!1===b.returnValue?H:F,this.target=b.target&&3===b.target.nodeType?b.target.parentNode:b.target,this.currentTarget=b.currentTarget,
this.relatedTarget=b.relatedTarget):this.type=b,e&&x.extend(this,e),this.timeStamp=b&&b.timeStamp||x.now(),void(this[x.expando]=!0)):new x.Event(b,e)};x.Event.prototype={constructor:x.Event,isDefaultPrevented:F,isPropagationStopped:F,isImmediatePropagationStopped:F,isSimulated:!1,preventDefault:function(){var b=this.originalEvent;this.isDefaultPrevented=H;b&&!this.isSimulated&&b.preventDefault()},stopPropagation:function(){var b=this.originalEvent;this.isPropagationStopped=H;b&&!this.isSimulated&&
b.stopPropagation()},stopImmediatePropagation:function(){var b=this.originalEvent;this.isImmediatePropagationStopped=H;b&&!this.isSimulated&&b.stopImmediatePropagation();this.stopPropagation()}};x.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,
toElement:!0,touches:!0,which:function(b){var e=b.button;return null==b.which&&sb.test(b.type)?null!=b.charCode?b.charCode:b.keyCode:!b.which&&void 0!==e&&Za.test(b.type)?1&e?1:2&e?3:4&e?2:0:b.which}},x.event.addProp);x.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(b,e){x.event.special[b]={delegateType:e,bindType:e,handle:function(b){var f,h=b.relatedTarget,l=b.handleObj;return h&&(h===this||x.contains(this,h))||(b.type=l.origType,
f=l.handler.apply(this,arguments),b.type=e),f}}});x.fn.extend({on:function(b,e,f,h){return I(this,b,e,f,h)},one:function(b,e,f,h){return I(this,b,e,f,h,1)},off:function(b,e,f){var h,l;if(b&&b.preventDefault&&b.handleObj)return h=b.handleObj,x(b.delegateTarget).off(h.namespace?h.origType+"."+h.namespace:h.origType,h.selector,h.handler),this;if("object"==typeof b){for(l in b)this.off(l,e,b[l]);return this}return!1!==e&&"function"!=typeof e||(f=e,e=void 0),!1===f&&(f=F),this.each(function(){x.event.remove(this,
b,f,e)})}});var ib=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,qb=/<script|<style|<link/i,pb=/checked\s*(?:[^=]|=\s*.checked.)/i,Ga=/^true\/(.*)/,ab=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;x.extend({htmlPrefilter:function(b){return b.replace(ib,"<$1></$2>")},clone:function(b,e,f){var h,l,m,q,t=b.cloneNode(!0),v=x.contains(b.ownerDocument,b);if(!(oa.noCloneChecked||1!==b.nodeType&&11!==b.nodeType||x.isXMLDoc(b)))for(q=K(t),m=K(b),h=0,l=m.length;h<
l;h++){var w=m[h],z=q[h],y=z.nodeName.toLowerCase();"input"===y&&Fb.test(w.type)?z.checked=w.checked:"input"!==y&&"textarea"!==y||(z.defaultValue=w.defaultValue)}if(e)if(f)for(m=m||K(b),q=q||K(t),h=0,l=m.length;h<l;h++)V(m[h],q[h]);else V(b,t);return q=K(t,"script"),0<q.length&&J(q,!v&&K(b,"script")),t},cleanData:function(b){for(var e,f,h,l=x.event.special,m=0;void 0!==(f=b[m]);m++)if(Ya(f)){if(e=f[R.expando]){if(e.events)for(h in e.events)l[h]?x.event.remove(f,h):x.removeEvent(f,h,e.handle);f[R.expando]=
void 0}f[Ea.expando]&&(f[Ea.expando]=void 0)}}});x.fn.extend({detach:function(b){return ta(this,b,!0)},remove:function(b){return ta(this,b)},text:function(b){return Oa(this,function(b){return void 0===b?x.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=b)})},null,b,arguments.length)},append:function(){return la(this,arguments,function(b){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Q(this,b).appendChild(b)})},prepend:function(){return la(this,
arguments,function(b){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=Q(this,b);e.insertBefore(b,e.firstChild)}})},before:function(){return la(this,arguments,function(b){this.parentNode&&this.parentNode.insertBefore(b,this)})},after:function(){return la(this,arguments,function(b){this.parentNode&&this.parentNode.insertBefore(b,this.nextSibling)})},empty:function(){for(var b,e=0;null!=(b=this[e]);e++)1===b.nodeType&&(x.cleanData(K(b,!1)),b.textContent="");return this},clone:function(b,
e){return b=null!=b&&b,e=null==e?b:e,this.map(function(){return x.clone(this,b,e)})},html:function(b){return Oa(this,function(b){var e=this[0]||{},f=0,h=this.length;if(void 0===b&&1===e.nodeType)return e.innerHTML;if("string"==typeof b&&!qb.test(b)&&!za[(Cb.exec(b)||["",""])[1].toLowerCase()]){b=x.htmlPrefilter(b);try{for(;f<h;f++)e=this[f]||{},1===e.nodeType&&(x.cleanData(K(e,!1)),e.innerHTML=b);e=0}catch(qc){}}e&&this.empty().append(b)},null,b,arguments.length)},replaceWith:function(){var b=[];
return la(this,arguments,function(e){var f=this.parentNode;0>x.inArray(this,b)&&(x.cleanData(K(this)),f&&f.replaceChild(e,this))},b)}});x.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(b,e){x.fn[b]=function(b){for(var f=[],h=x(b),l=h.length-1,m=0;m<=l;m++)b=m===l?this:this.clone(!0),x(h[m])[e](b),kb.apply(f,b.get());return this.pushStack(f)}});var Sa=/^margin/,Ia=new RegExp("^("+yb+")(?!px)[a-z%]+$","i"),Va=function(e){var f=
e.ownerDocument.defaultView;return f&&f.opener||(f=b),f.getComputedStyle(e)};!function(){function e(){if(t){t.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%";t.innerHTML="";hb.appendChild(q);var e=b.getComputedStyle(t);f="1%"!==e.top;m="2px"===e.marginLeft;h="4px"===e.width;t.style.marginRight="50%";l="4px"===e.marginRight;hb.removeChild(q);t=null}}var f,h,l,m,q=Y.createElement("div"),t=Y.createElement("div");t.style&&(t.style.backgroundClip=
"content-box",t.cloneNode(!0).style.backgroundClip="",oa.clearCloneStyle="content-box"===t.style.backgroundClip,q.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",q.appendChild(t),x.extend(oa,{pixelPosition:function(){return e(),f},boxSizingReliable:function(){return e(),h},pixelMarginRight:function(){return e(),l},reliableMarginLeft:function(){return e(),m}}))}();var sa=/^(none|table(?!-c[ea]).+)/,La={position:"absolute",visibility:"hidden",
display:"block"},Ka={letterSpacing:"0",fontWeight:"400"},Ca=["Webkit","Moz","ms"],Ta=Y.createElement("div").style;x.extend({cssHooks:{opacity:{get:function(b,e){if(e){var f=Z(b,"opacity");return""===f?"1":f}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(b,e,f,h){if(b&&3!==b.nodeType&&8!==b.nodeType&&b.style){var l,m,
q,t=x.camelCase(e),v=b.style;return e=x.cssProps[t]||(x.cssProps[t]=qa(t)||t),q=x.cssHooks[e]||x.cssHooks[t],void 0===f?q&&"get"in q&&void 0!==(l=q.get(b,!1,h))?l:v[e]:(m=typeof f,"string"===m&&(l=Qa.exec(f))&&l[1]&&(f=E(b,e,l),m="number"),null!=f&&f===f&&("number"===m&&(f+=l&&l[3]||(x.cssNumber[t]?"":"px")),oa.clearCloneStyle||""!==f||0!==e.indexOf("background")||(v[e]="inherit"),q&&"set"in q&&void 0===(f=q.set(b,f,h))||(v[e]=f)),void 0)}},css:function(b,e,f,h){var l,m,q,t=x.camelCase(e);return e=
x.cssProps[t]||(x.cssProps[t]=qa(t)||t),q=x.cssHooks[e]||x.cssHooks[t],q&&"get"in q&&(l=q.get(b,!0,f)),void 0===l&&(l=Z(b,e,h)),"normal"===l&&e in Ka&&(l=Ka[e]),""===f||f?(m=parseFloat(l),!0===f||isFinite(m)?m||0:l):l}});x.each(["height","width"],function(b,e){x.cssHooks[e]={get:function(b,f,h){if(f)return!sa.test(x.css(b,"display"))||b.getClientRects().length&&b.getBoundingClientRect().width?fa(b,e,h):Eb(b,La,function(){return fa(b,e,h)})},set:function(b,f,h){var l,m=h&&Va(b);h=h&&da(b,e,h,"border-box"===
x.css(b,"boxSizing",!1,m),m);return h&&(l=Qa.exec(f))&&"px"!==(l[3]||"px")&&(b.style[e]=f,f=x.css(b,e)),ha(b,f,h)}}});x.cssHooks.marginLeft=na(oa.reliableMarginLeft,function(b,e){if(e)return(parseFloat(Z(b,"marginLeft"))||b.getBoundingClientRect().left-Eb(b,{marginLeft:0},function(){return b.getBoundingClientRect().left}))+"px"});x.each({margin:"",padding:"",border:"Width"},function(b,e){x.cssHooks[b+e]={expand:function(f){var h=0,l={};for(f="string"==typeof f?f.split(" "):[f];4>h;h++)l[b+ya[h]+e]=
f[h]||f[h-2]||f[0];return l}};Sa.test(b)||(x.cssHooks[b+e].set=ha)});x.fn.extend({css:function(b,e){return Oa(this,function(b,e,f){var h,l={},m=0;if(x.isArray(e)){f=Va(b);for(h=e.length;m<h;m++)l[e[m]]=x.css(b,e[m],!1,f);return l}return void 0!==f?x.style(b,e,f):x.css(b,e)},b,e,1<arguments.length)}});x.Tween=N;N.prototype={constructor:N,init:function(b,e,f,h,l,m){this.elem=b;this.prop=f;this.easing=l||x.easing._default;this.options=e;this.start=this.now=this.cur();this.end=h;this.unit=m||(x.cssNumber[f]?
"":"px")},cur:function(){var b=N.propHooks[this.prop];return b&&b.get?b.get(this):N.propHooks._default.get(this)},run:function(b){var e,f=N.propHooks[this.prop];return this.options.duration?this.pos=e=x.easing[this.easing](b,this.options.duration*b,0,1,this.options.duration):this.pos=e=b,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),f&&f.set?f.set(this):N.propHooks._default.set(this),this}};N.prototype.init.prototype=N.prototype;N.propHooks=
{_default:{get:function(b){var e;return 1!==b.elem.nodeType||null!=b.elem[b.prop]&&null==b.elem.style[b.prop]?b.elem[b.prop]:(e=x.css(b.elem,b.prop,""),e&&"auto"!==e?e:0)},set:function(b){x.fx.step[b.prop]?x.fx.step[b.prop](b):1!==b.elem.nodeType||null==b.elem.style[x.cssProps[b.prop]]&&!x.cssHooks[b.prop]?b.elem[b.prop]=b.now:x.style(b.elem,b.prop,b.now+b.unit)}}};N.propHooks.scrollTop=N.propHooks.scrollLeft={set:function(b){b.elem.nodeType&&b.elem.parentNode&&(b.elem[b.prop]=b.now)}};x.easing={linear:function(b){return b},
swing:function(b){return.5-Math.cos(b*Math.PI)/2},_default:"swing"};x.fx=N.prototype.init;x.fx.step={};var X,Ja,Mb=/^(?:toggle|show|hide)$/,Nb=/queueHooks$/;x.Animation=x.extend(ia,{tweeners:{"*":[function(b,e){var f=this.createTween(b,e);return E(f.elem,b,Qa.exec(e),f),f}]},tweener:function(b,e){x.isFunction(b)?(e=b,b=["*"]):b=b.match(xa);for(var f,h=0,l=b.length;h<l;h++)f=b[h],ia.tweeners[f]=ia.tweeners[f]||[],ia.tweeners[f].unshift(e)},prefilters:[function(b,e,f){var h,l,m,q,t,v,w,z,y="width"in
e||"height"in e,B=this,M={},E=b.style,sa=b.nodeType&&Ra(b),U=R.get(b,"fxshow");f.queue||(q=x._queueHooks(b,"fx"),null==q.unqueued&&(q.unqueued=0,t=q.empty.fire,q.empty.fire=function(){q.unqueued||t()}),q.unqueued++,B.always(function(){B.always(function(){q.unqueued--;x.queue(b,"fx").length||q.empty.fire()})}));for(h in e)if(l=e[h],Mb.test(l)){if(delete e[h],m=m||"toggle"===l,l===(sa?"hide":"show")){if("show"!==l||!U||void 0===U[h])continue;sa=!0}M[h]=U&&U[h]||x.style(b,h)}if(v=!x.isEmptyObject(e),
v||!x.isEmptyObject(M))for(h in y&&1===b.nodeType&&(f.overflow=[E.overflow,E.overflowX,E.overflowY],w=U&&U.display,null==w&&(w=R.get(b,"display")),z=x.css(b,"display"),"none"===z&&(w?z=w:(D([b],!0),w=b.style.display||w,z=x.css(b,"display"),D([b]))),("inline"===z||"inline-block"===z&&null!=w)&&"none"===x.css(b,"float")&&(v||(B.done(function(){E.display=w}),null==w&&(z=E.display,w="none"===z?"":z)),E.display="inline-block")),f.overflow&&(E.overflow="hidden",B.always(function(){E.overflow=f.overflow[0];
E.overflowX=f.overflow[1];E.overflowY=f.overflow[2]})),v=!1,M)v||(U?"hidden"in U&&(sa=U.hidden):U=R.access(b,"fxshow",{display:w}),m&&(U.hidden=!sa),sa&&D([b],!0),B.done(function(){sa||D([b]);R.remove(b,"fxshow");for(h in M)x.style(b,h,M[h])})),v=ua(sa?U[h]:0,h,B),h in U||(U[h]=v.start,sa&&(v.end=v.start,v.start=0))}],prefilter:function(b,e){e?ia.prefilters.unshift(b):ia.prefilters.push(b)}});x.speed=function(b,e,f){var h=b&&"object"==typeof b?x.extend({},b):{complete:f||!f&&e||x.isFunction(b)&&b,
duration:b,easing:f&&e||e&&!x.isFunction(e)&&e};return x.fx.off||Y.hidden?h.duration=0:"number"!=typeof h.duration&&(h.duration in x.fx.speeds?h.duration=x.fx.speeds[h.duration]:h.duration=x.fx.speeds._default),null!=h.queue&&!0!==h.queue||(h.queue="fx"),h.old=h.complete,h.complete=function(){x.isFunction(h.old)&&h.old.call(this);h.queue&&x.dequeue(this,h.queue)},h};x.fn.extend({fadeTo:function(b,e,f,h){return this.filter(Ra).css("opacity",0).show().end().animate({opacity:e},b,f,h)},animate:function(b,
e,f,h){var l=x.isEmptyObject(b),m=x.speed(e,f,h);e=function(){var e=ia(this,x.extend({},b),m);(l||R.get(this,"finish"))&&e.stop(!0)};return e.finish=e,l||!1===m.queue?this.each(e):this.queue(m.queue,e)},stop:function(b,e,f){var h=function(b){var e=b.stop;delete b.stop;e(f)};return"string"!=typeof b&&(f=e,e=b,b=void 0),e&&!1!==b&&this.queue(b||"fx",[]),this.each(function(){var e=!0,l=null!=b&&b+"queueHooks",m=x.timers,q=R.get(this);if(l)q[l]&&q[l].stop&&h(q[l]);else for(l in q)q[l]&&q[l].stop&&Nb.test(l)&&
h(q[l]);for(l=m.length;l--;)m[l].elem!==this||null!=b&&m[l].queue!==b||(m[l].anim.stop(f),e=!1,m.splice(l,1));!e&&f||x.dequeue(this,b)})},finish:function(b){return!1!==b&&(b=b||"fx"),this.each(function(){var e,f=R.get(this),h=f[b+"queue"];e=f[b+"queueHooks"];var l=x.timers,m=h?h.length:0;f.finish=!0;x.queue(this,b,[]);e&&e.stop&&e.stop.call(this,!0);for(e=l.length;e--;)l[e].elem===this&&l[e].queue===b&&(l[e].anim.stop(!0),l.splice(e,1));for(e=0;e<m;e++)h[e]&&h[e].finish&&h[e].finish.call(this);delete f.finish})}});
x.each(["toggle","show","hide"],function(b,e){var f=x.fn[e];x.fn[e]=function(b,h,l){return null==b||"boolean"==typeof b?f.apply(this,arguments):this.animate(T(e,!0),b,h,l)}});x.each({slideDown:T("show"),slideUp:T("hide"),slideToggle:T("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(b,e){x.fn[b]=function(b,f,h){return this.animate(e,b,f,h)}});x.timers=[];x.fx.tick=function(){var b,e=0,f=x.timers;for(X=x.now();e<f.length;e++)b=f[e],b()||f[e]!==b||f.splice(e--,
1);f.length||x.fx.stop();X=void 0};x.fx.timer=function(b){x.timers.push(b);b()?x.fx.start():x.timers.pop()};x.fx.interval=13;x.fx.start=function(){Ja||(Ja=b.requestAnimationFrame?b.requestAnimationFrame(aa):b.setInterval(x.fx.tick,x.fx.interval))};x.fx.stop=function(){b.cancelAnimationFrame?b.cancelAnimationFrame(Ja):b.clearInterval(Ja);Ja=null};x.fx.speeds={slow:600,fast:200,_default:400};x.fn.delay=function(e,f){return e=x.fx?x.fx.speeds[e]||e:e,f=f||"fx",this.queue(f,function(f,h){var l=b.setTimeout(f,
e);h.stop=function(){b.clearTimeout(l)}})};(function(){var b=Y.createElement("input"),e=Y.createElement("select").appendChild(Y.createElement("option"));b.type="checkbox";oa.checkOn=""!==b.value;oa.optSelected=e.selected;b=Y.createElement("input");b.value="t";b.type="radio";oa.radioValue="t"===b.value})();var Sb,tb=x.expr.attrHandle;x.fn.extend({attr:function(b,e){return Oa(this,x.attr,b,e,1<arguments.length)},removeAttr:function(b){return this.each(function(){x.removeAttr(this,b)})}});x.extend({attr:function(b,
e,f){var h,l,m=b.nodeType;if(3!==m&&8!==m&&2!==m)return"undefined"==typeof b.getAttribute?x.prop(b,e,f):(1===m&&x.isXMLDoc(b)||(l=x.attrHooks[e.toLowerCase()]||(x.expr.match.bool.test(e)?Sb:void 0)),void 0!==f?null===f?void x.removeAttr(b,e):l&&"set"in l&&void 0!==(h=l.set(b,f,e))?h:(b.setAttribute(e,f+""),f):l&&"get"in l&&null!==(h=l.get(b,e))?h:(h=x.find.attr(b,e),null==h?void 0:h))},attrHooks:{type:{set:function(b,e){if(!oa.radioValue&&"radio"===e&&x.nodeName(b,"input")){var f=b.value;return b.setAttribute("type",
e),f&&(b.value=f),e}}}},removeAttr:function(b,e){var f,h=0,l=e&&e.match(xa);if(l&&1===b.nodeType)for(;f=l[h++];)b.removeAttribute(f)}});Sb={set:function(b,e,f){return!1===e?x.removeAttr(b,f):b.setAttribute(f,f),f}};x.each(x.expr.match.bool.source.match(/\w+/g),function(b,e){var f=tb[e]||x.find.attr;tb[e]=function(b,e,h){var l,m,q=e.toLowerCase();return h||(m=tb[q],tb[q]=l,l=null!=f(b,e,h)?q:null,tb[q]=m),l}});var cc=/^(?:input|select|textarea|button)$/i,dc=/^(?:a|area)$/i;x.fn.extend({prop:function(b,
e){return Oa(this,x.prop,b,e,1<arguments.length)},removeProp:function(b){return this.each(function(){delete this[x.propFix[b]||b]})}});x.extend({prop:function(b,e,f){var h,l,m=b.nodeType;if(3!==m&&8!==m&&2!==m)return 1===m&&x.isXMLDoc(b)||(e=x.propFix[e]||e,l=x.propHooks[e]),void 0!==f?l&&"set"in l&&void 0!==(h=l.set(b,f,e))?h:b[e]=f:l&&"get"in l&&null!==(h=l.get(b,e))?h:b[e]},propHooks:{tabIndex:{get:function(b){var e=x.find.attr(b,"tabindex");return e?parseInt(e,10):cc.test(b.nodeName)||dc.test(b.nodeName)&&
b.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}});oa.optSelected||(x.propHooks.selected={get:function(b){b=b.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null},set:function(b){b=b.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}});x.each("tabIndex readOnly maxLength cellSpacing cellPadding rowSpan colSpan useMap frameBorder contentEditable".split(" "),function(){x.propFix[this.toLowerCase()]=this});x.fn.extend({addClass:function(b){var e,f,h,
l,m,q,t=0;if(x.isFunction(b))return this.each(function(e){x(this).addClass(b.call(this,e,ka(this)))});if("string"==typeof b&&b)for(e=b.match(xa)||[];f=this[t++];)if(l=ka(f),h=1===f.nodeType&&" "+ea(l)+" "){for(q=0;m=e[q++];)0>h.indexOf(" "+m+" ")&&(h+=m+" ");h=ea(h);l!==h&&f.setAttribute("class",h)}return this},removeClass:function(b){var e,f,h,l,m,q,t=0;if(x.isFunction(b))return this.each(function(e){x(this).removeClass(b.call(this,e,ka(this)))});if(!arguments.length)return this.attr("class","");
if("string"==typeof b&&b)for(e=b.match(xa)||[];f=this[t++];)if(l=ka(f),h=1===f.nodeType&&" "+ea(l)+" "){for(q=0;m=e[q++];)for(;-1<h.indexOf(" "+m+" ");)h=h.replace(" "+m+" "," ");h=ea(h);l!==h&&f.setAttribute("class",h)}return this},toggleClass:function(b,e){var f=typeof b;return"boolean"==typeof e&&"string"===f?e?this.addClass(b):this.removeClass(b):x.isFunction(b)?this.each(function(f){x(this).toggleClass(b.call(this,f,ka(this),e),e)}):this.each(function(){var e,h,l,m;if("string"===f)for(h=0,l=
x(this),m=b.match(xa)||[];e=m[h++];)l.hasClass(e)?l.removeClass(e):l.addClass(e);else void 0!==b&&"boolean"!==f||(e=ka(this),e&&R.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===b?"":R.get(this,"__className__")||""))})},hasClass:function(b){var e,f=0;for(b=" "+b+" ";e=this[f++];)if(1===e.nodeType&&-1<(" "+ea(ka(e))+" ").indexOf(b))return!0;return!1}});var ec=/\r/g;x.fn.extend({val:function(b){var e,f,h,l=this[0];if(arguments.length)return h=x.isFunction(b),this.each(function(f){var l;
1===this.nodeType&&(l=h?b.call(this,f,x(this).val()):b,null==l?l="":"number"==typeof l?l+="":x.isArray(l)&&(l=x.map(l,function(b){return null==b?"":b+""})),e=x.valHooks[this.type]||x.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,l,"value")||(this.value=l))});if(l)return e=x.valHooks[l.type]||x.valHooks[l.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(f=e.get(l,"value"))?f:(f=l.value,"string"==typeof f?f.replace(ec,""):null==f?"":f)}});x.extend({valHooks:{option:{get:function(b){var e=
x.find.attr(b,"value");return null!=e?e:ea(x.text(b))}},select:{get:function(b){var e,f,h=b.options,l=b.selectedIndex,m="select-one"===b.type,q=m?null:[],t=m?l+1:h.length;for(f=0>l?t:m?l:0;f<t;f++)if(e=h[f],!(!e.selected&&f!==l||e.disabled||e.parentNode.disabled&&x.nodeName(e.parentNode,"optgroup"))){if(b=x(e).val(),m)return b;q.push(b)}return q},set:function(b,e){for(var f,h,l=b.options,m=x.makeArray(e),q=l.length;q--;)h=l[q],(h.selected=-1<x.inArray(x.valHooks.option.get(h),m))&&(f=!0);return f||
(b.selectedIndex=-1),m}}}});x.each(["radio","checkbox"],function(){x.valHooks[this]={set:function(b,e){if(x.isArray(e))return b.checked=-1<x.inArray(x(b).val(),e)}};oa.checkOn||(x.valHooks[this].get=function(b){return null===b.getAttribute("value")?"on":b.value})});var Tb=/^(?:focusinfocus|focusoutblur)$/;x.extend(x.event,{trigger:function(e,f,h,l){var m,q,t,v,w,z,y,B=[h||Y],E=Na.call(e,"type")?e.type:e;m=Na.call(e,"namespace")?e.namespace.split("."):[];if(q=t=h=h||Y,3!==h.nodeType&&8!==h.nodeType&&
!Tb.test(E+x.event.triggered)&&(-1<E.indexOf(".")&&(m=E.split("."),E=m.shift(),m.sort()),w=0>E.indexOf(":")&&"on"+E,e=e[x.expando]?e:new x.Event(E,"object"==typeof e&&e),e.isTrigger=l?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=h),f=null==f?[e]:x.makeArray(f,[e]),y=x.event.special[E]||{},l||!y.trigger||!1!==y.trigger.apply(h,f))){if(!l&&!y.noBubble&&!x.isWindow(h)){v=y.delegateType||E;for(Tb.test(v+
E)||(q=q.parentNode);q;q=q.parentNode)B.push(q),t=q;t===(h.ownerDocument||Y)&&B.push(t.defaultView||t.parentWindow||b)}for(m=0;(q=B[m++])&&!e.isPropagationStopped();)e.type=1<m?v:y.bindType||E,(z=(R.get(q,"events")||{})[e.type]&&R.get(q,"handle"))&&z.apply(q,f),(z=w&&q[w])&&z.apply&&Ya(q)&&(e.result=z.apply(q,f),!1===e.result&&e.preventDefault());return e.type=E,l||e.isDefaultPrevented()||y._default&&!1!==y._default.apply(B.pop(),f)||!Ya(h)||w&&x.isFunction(h[E])&&!x.isWindow(h)&&(t=h[w],t&&(h[w]=
null),x.event.triggered=E,h[E](),x.event.triggered=void 0,t&&(h[w]=t)),e.result}},simulate:function(b,e,f){b=x.extend(new x.Event,f,{type:b,isSimulated:!0});x.event.trigger(b,null,e)}});x.fn.extend({trigger:function(b,e){return this.each(function(){x.event.trigger(b,e,this)})},triggerHandler:function(b,e){var f=this[0];if(f)return x.event.trigger(b,e,f,!0)}});x.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),
function(b,e){x.fn[e]=function(b,f){return 0<arguments.length?this.on(e,null,b,f):this.trigger(e)}});x.fn.extend({hover:function(b,e){return this.mouseenter(b).mouseleave(e||b)}});oa.focusin="onfocusin"in b;oa.focusin||x.each({focus:"focusin",blur:"focusout"},function(b,e){var f=function(b){x.event.simulate(e,b.target,x.event.fix(b))};x.event.special[e]={setup:function(){var h=this.ownerDocument||this,l=R.access(h,e);l||h.addEventListener(b,f,!0);R.access(h,e,(l||0)+1)},teardown:function(){var h=
this.ownerDocument||this,l=R.access(h,e)-1;l?R.access(h,e,l):(h.removeEventListener(b,f,!0),R.remove(h,e))}}});var ub=b.location,Ub=x.now(),Ob=/\?/;x.parseXML=function(e){var f;if(!e||"string"!=typeof e)return null;try{f=(new b.DOMParser).parseFromString(e,"text/xml")}catch(ba){f=void 0}return f&&!f.getElementsByTagName("parsererror").length||x.error("Invalid XML: "+e),f};var ac=/\[\]$/,Vb=/\r?\n/g,fc=/^(?:submit|button|image|reset|file)$/i,gc=/^(?:input|select|textarea|keygen)/i;x.param=function(b,
e){var f,h=[],l=function(b,e){var f=x.isFunction(e)?e():e;h[h.length]=encodeURIComponent(b)+"="+encodeURIComponent(null==f?"":f)};if(x.isArray(b)||b.jquery&&!x.isPlainObject(b))x.each(b,function(){l(this.name,this.value)});else for(f in b)ja(f,b[f],e,l);return h.join("&")};x.fn.extend({serialize:function(){return x.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var b=x.prop(this,"elements");return b?x.makeArray(b):this}).filter(function(){var b=this.type;return this.name&&
!x(this).is(":disabled")&&gc.test(this.nodeName)&&!fc.test(b)&&(this.checked||!Fb.test(b))}).map(function(b,e){var f=x(this).val();return null==f?null:x.isArray(f)?x.map(f,function(b){return{name:e.name,value:b.replace(Vb,"\r\n")}}):{name:e.name,value:f.replace(Vb,"\r\n")}}).get()}});var hc=/%20/g,ic=/#.*$/,jc=/([?&])_=[^&]*/,kc=/^(.*?):[ \t]*([^\r\n]*)$/gm,lc=/^(?:GET|HEAD)$/,mc=/^\/\//,Wb={},Kb={},Xb="*/".concat("*"),Pb=Y.createElement("a");Pb.href=ub.href;x.extend({active:0,lastModified:{},etag:{},
ajaxSettings:{url:ub.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(ub.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Xb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,
"text html":!0,"text json":JSON.parse,"text xml":x.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(b,e){return e?Ha(Ha(b,x.ajaxSettings),e):Ha(x.ajaxSettings,b)},ajaxPrefilter:W(Wb),ajaxTransport:W(Kb),ajax:function(e,f){function h(e,f,h,t){var w,B,E,La,G=f;if(!z){z=!0;v&&b.clearTimeout(v);l=void 0;q=t||"";H.readyState=0<e?4:0;t=200<=e&&300>e||304===e;if(h){E=D;for(var J=H,Ca,U,L,I,Ta=E.contents,N=E.dataTypes;"*"===N[0];)N.shift(),void 0===Ca&&(Ca=E.mimeType||J.getResponseHeader("Content-Type"));
if(Ca)for(U in Ta)if(Ta[U]&&Ta[U].test(Ca)){N.unshift(U);break}if(N[0]in h)L=N[0];else{for(U in h){if(!N[0]||E.converters[U+" "+N[0]]){L=U;break}I||(I=U)}L=L||I}h=L?(L!==N[0]&&N.unshift(L),h[L]):void 0;E=h}var X;a:{h=D;Ca=E;U=H;L=t;var ba,O,Q;E={};J=h.dataTypes.slice();if(J[1])for(ba in h.converters)E[ba.toLowerCase()]=h.converters[ba];for(I=J.shift();I;)if(h.responseFields[I]&&(U[h.responseFields[I]]=Ca),!Q&&L&&h.dataFilter&&(Ca=h.dataFilter(Ca,h.dataType)),Q=I,I=J.shift())if("*"===I)I=Q;else if("*"!==
Q&&Q!==I){if(ba=E[Q+" "+I]||E["* "+I],!ba)for(X in E)if(O=X.split(" "),O[1]===I&&(ba=E[Q+" "+O[0]]||E["* "+O[0]])){!0===ba?ba=E[X]:!0!==E[X]&&(I=O[0],J.unshift(O[1]));break}if(!0!==ba)if(ba&&h["throws"])Ca=ba(Ca);else try{Ca=ba(Ca)}catch(bc){X={state:"parsererror",error:ba?bc:"No conversion from "+Q+" to "+I};break a}}X={state:"success",data:Ca}}E=X;t?(D.ifModified&&(La=H.getResponseHeader("Last-Modified"),La&&(x.lastModified[m]=La),La=H.getResponseHeader("etag"),La&&(x.etag[m]=La)),204===e||"HEAD"===
D.type?G="nocontent":304===e?G="notmodified":(G=E.state,w=E.data,B=E.error,t=!B)):(B=G,!e&&G||(G="error",0>e&&(e=0)));H.status=e;H.statusText=(f||G)+"";t?K.resolveWith(sa,[w,G,H]):K.rejectWith(sa,[H,G,B]);H.statusCode(Ka);Ka=void 0;y&&M.trigger(t?"ajaxSuccess":"ajaxError",[H,D,t?w:B]);F.fireWith(sa,[H,G]);y&&(M.trigger("ajaxComplete",[H,D]),--x.active||x.event.trigger("ajaxStop"))}}"object"==typeof e&&(f=e,e=void 0);f=f||{};var l,m,q,t,v,w,z,y,B,E,D=x.ajaxSetup({},f),sa=D.context||D,M=D.context&&
(sa.nodeType||sa.jquery)?x(sa):x.event,K=x.Deferred(),F=x.Callbacks("once memory"),Ka=D.statusCode||{},La={},G={},J="canceled",H={readyState:0,getResponseHeader:function(b){var e;if(z){if(!t)for(t={};e=kc.exec(q);)t[e[1].toLowerCase()]=e[2];e=t[b.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return z?q:null},setRequestHeader:function(b,e){return null==z&&(b=G[b.toLowerCase()]=G[b.toLowerCase()]||b,La[b]=e),this},overrideMimeType:function(b){return null==z&&(D.mimeType=b),
this},statusCode:function(b){var e;if(b)if(z)H.always(b[H.status]);else for(e in b)Ka[e]=[Ka[e],b[e]];return this},abort:function(b){b=b||J;return l&&l.abort(b),h(0,b),this}};if(K.promise(H),D.url=((e||D.url||ub.href)+"").replace(mc,ub.protocol+"//"),D.type=f.method||f.type||D.method||D.type,D.dataTypes=(D.dataType||"*").toLowerCase().match(xa)||[""],null==D.crossDomain){w=Y.createElement("a");try{w.href=D.url,w.href=w.href,D.crossDomain=Pb.protocol+"//"+Pb.host!=w.protocol+"//"+w.host}catch(Lb){D.crossDomain=
!0}}if(D.data&&D.processData&&"string"!=typeof D.data&&(D.data=x.param(D.data,D.traditional)),Pa(Wb,D,f,H),z)return H;(y=x.event&&D.global)&&0===x.active++&&x.event.trigger("ajaxStart");D.type=D.type.toUpperCase();D.hasContent=!lc.test(D.type);m=D.url.replace(ic,"");D.hasContent?D.data&&D.processData&&0===(D.contentType||"").indexOf("application/x-www-form-urlencoded")&&(D.data=D.data.replace(hc,"+")):(E=D.url.slice(m.length),D.data&&(m+=(Ob.test(m)?"&":"?")+D.data,delete D.data),!1===D.cache&&(m=
m.replace(jc,"$1"),E=(Ob.test(m)?"&":"?")+"_="+Ub++ +E),D.url=m+E);D.ifModified&&(x.lastModified[m]&&H.setRequestHeader("If-Modified-Since",x.lastModified[m]),x.etag[m]&&H.setRequestHeader("If-None-Match",x.etag[m]));(D.data&&D.hasContent&&!1!==D.contentType||f.contentType)&&H.setRequestHeader("Content-Type",D.contentType);H.setRequestHeader("Accept",D.dataTypes[0]&&D.accepts[D.dataTypes[0]]?D.accepts[D.dataTypes[0]]+("*"!==D.dataTypes[0]?", "+Xb+"; q=0.01":""):D.accepts["*"]);for(B in D.headers)H.setRequestHeader(B,
D.headers[B]);if(D.beforeSend&&(!1===D.beforeSend.call(sa,H,D)||z))return H.abort();if(J="abort",F.add(D.complete),H.done(D.success),H.fail(D.error),l=Pa(Kb,D,f,H)){if(H.readyState=1,y&&M.trigger("ajaxSend",[H,D]),z)return H;D.async&&0<D.timeout&&(v=b.setTimeout(function(){H.abort("timeout")},D.timeout));try{z=!1,l.send(La,h)}catch(Lb){if(z)throw Lb;h(-1,Lb)}}else h(-1,"No Transport");return H},getJSON:function(b,e,f){return x.get(b,e,f,"json")},getScript:function(b,e){return x.get(b,void 0,e,"script")}});
x.each(["get","post"],function(b,e){x[e]=function(b,f,h,l){return x.isFunction(f)&&(l=l||h,h=f,f=void 0),x.ajax(x.extend({url:b,type:e,dataType:l,data:f,success:h},x.isPlainObject(b)&&b))}});x._evalUrl=function(b){return x.ajax({url:b,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})};x.fn.extend({wrapAll:function(b){var e;return this[0]&&(x.isFunction(b)&&(b=b.call(this[0])),e=x(b,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var b=
this;b.firstElementChild;)b=b.firstElementChild;return b}).append(this)),this},wrapInner:function(b){return x.isFunction(b)?this.each(function(e){x(this).wrapInner(b.call(this,e))}):this.each(function(){var e=x(this),f=e.contents();f.length?f.wrapAll(b):e.append(b)})},wrap:function(b){var e=x.isFunction(b);return this.each(function(f){x(this).wrapAll(e?b.call(this,f):b)})},unwrap:function(b){return this.parent(b).not("body").each(function(){x(this).replaceWith(this.childNodes)}),this}});x.expr.pseudos.hidden=
function(b){return!x.expr.pseudos.visible(b)};x.expr.pseudos.visible=function(b){return!!(b.offsetWidth||b.offsetHeight||b.getClientRects().length)};x.ajaxSettings.xhr=function(){try{return new b.XMLHttpRequest}catch(M){}};var nc={0:200,1223:204},vb=x.ajaxSettings.xhr();oa.cors=!!vb&&"withCredentials"in vb;oa.ajax=vb=!!vb;x.ajaxTransport(function(e){var f,h;if(oa.cors||vb&&!e.crossDomain)return{send:function(l,m){var q,t=e.xhr();if(t.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(q in e.xhrFields)t[q]=
e.xhrFields[q];e.mimeType&&t.overrideMimeType&&t.overrideMimeType(e.mimeType);e.crossDomain||l["X-Requested-With"]||(l["X-Requested-With"]="XMLHttpRequest");for(q in l)t.setRequestHeader(q,l[q]);f=function(b){return function(){f&&(f=h=t.onload=t.onerror=t.onabort=t.onreadystatechange=null,"abort"===b?t.abort():"error"===b?"number"!=typeof t.status?m(0,"error"):m(t.status,t.statusText):m(nc[t.status]||t.status,t.statusText,"text"!==(t.responseType||"text")||"string"!=typeof t.responseText?{binary:t.response}:
{text:t.responseText},t.getAllResponseHeaders()))}};t.onload=f();h=t.onerror=f("error");void 0!==t.onabort?t.onabort=h:t.onreadystatechange=function(){4===t.readyState&&b.setTimeout(function(){f&&h()})};f=f("abort");try{t.send(e.hasContent&&e.data||null)}catch(Zb){if(f)throw Zb;}},abort:function(){f&&f()}}});x.ajaxPrefilter(function(b){b.crossDomain&&(b.contents.script=!1)});x.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},
converters:{"text script":function(b){return x.globalEval(b),b}}});x.ajaxPrefilter("script",function(b){void 0===b.cache&&(b.cache=!1);b.crossDomain&&(b.type="GET")});x.ajaxTransport("script",function(b){if(b.crossDomain){var e,f;return{send:function(h,l){e=x("<script>").prop({charset:b.scriptCharset,src:b.url}).on("load error",f=function(b){e.remove();f=null;b&&l("error"===b.type?404:200,b.type)});Y.head.appendChild(e[0])},abort:function(){f&&f()}}}});var Yb=[],Qb=/(=)\?(?=&|$)|\?\?/;x.ajaxSetup({jsonp:"callback",
jsonpCallback:function(){var b=Yb.pop()||x.expando+"_"+Ub++;return this[b]=!0,b}});x.ajaxPrefilter("json jsonp",function(e,f,h){var l,m,q,t=!1!==e.jsonp&&(Qb.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qb.test(e.data)&&"data");if(t||"jsonp"===e.dataTypes[0])return l=e.jsonpCallback=x.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,t?e[t]=e[t].replace(Qb,"$1"+l):!1!==e.jsonp&&(e.url+=(Ob.test(e.url)?"&":"?")+e.jsonp+
"="+l),e.converters["script json"]=function(){return q||x.error(l+" was not called"),q[0]},e.dataTypes[0]="json",m=b[l],b[l]=function(){q=arguments},h.always(function(){void 0===m?x(b).removeProp(l):b[l]=m;e[l]&&(e.jsonpCallback=f.jsonpCallback,Yb.push(l));q&&x.isFunction(m)&&m(q[0]);q=m=void 0}),"script"});oa.createHTMLDocument=function(){var b=Y.implementation.createHTMLDocument("").body;return b.innerHTML="<form></form><form></form>",2===b.childNodes.length}();x.parseHTML=function(b,e,f){if("string"!=
typeof b)return[];"boolean"==typeof e&&(f=e,e=!1);var h,l,m;return e||(oa.createHTMLDocument?(e=Y.implementation.createHTMLDocument(""),h=e.createElement("base"),h.href=Y.location.href,e.head.appendChild(h)):e=Y),l=Fa.exec(b),m=!f&&[],l?[e.createElement(l[1])]:(l=L([b],e,m),m&&m.length&&x(m).remove(),x.merge([],l.childNodes))};x.fn.load=function(b,e,f){var h,l,m,q=this,t=b.indexOf(" ");return-1<t&&(h=ea(b.slice(t)),b=b.slice(0,t)),x.isFunction(e)?(f=e,e=void 0):e&&"object"==typeof e&&(l="POST"),0<
q.length&&x.ajax({url:b,type:l||"GET",dataType:"html",data:e}).done(function(b){m=arguments;q.html(h?x("<div>").append(x.parseHTML(b)).find(h):b)}).always(f&&function(b,e){q.each(function(){f.apply(this,m||[b.responseText,e,b])})}),this};x.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(b,e){x.fn[e]=function(b){return this.on(e,b)}});x.expr.pseudos.animated=function(b){return x.grep(x.timers,function(e){return b===e.elem}).length};x.offset={setOffset:function(b,
e,f){var h,l,m,q,t,v,w=x.css(b,"position"),z=x(b),y={};"static"===w&&(b.style.position="relative");t=z.offset();m=x.css(b,"top");v=x.css(b,"left");("absolute"===w||"fixed"===w)&&-1<(m+v).indexOf("auto")?(h=z.position(),q=h.top,l=h.left):(q=parseFloat(m)||0,l=parseFloat(v)||0);x.isFunction(e)&&(e=e.call(b,f,x.extend({},t)));null!=e.top&&(y.top=e.top-t.top+q);null!=e.left&&(y.left=e.left-t.left+l);"using"in e?e.using.call(b,y):z.css(y)}};x.fn.extend({offset:function(b){if(arguments.length)return void 0===
b?this:this.each(function(e){x.offset.setOffset(this,b,e)});var e,f,h,l,m=this[0];if(m)return m.getClientRects().length?(h=m.getBoundingClientRect(),h.width||h.height?(l=m.ownerDocument,f=Aa(l),e=l.documentElement,{top:h.top+f.pageYOffset-e.clientTop,left:h.left+f.pageXOffset-e.clientLeft}):h):{top:0,left:0}},position:function(){if(this[0]){var b,e,f=this[0],h={top:0,left:0};return"fixed"===x.css(f,"position")?e=f.getBoundingClientRect():(b=this.offsetParent(),e=this.offset(),x.nodeName(b[0],"html")||
(h=b.offset()),h={top:h.top+x.css(b[0],"borderTopWidth",!0),left:h.left+x.css(b[0],"borderLeftWidth",!0)}),{top:e.top-h.top-x.css(f,"marginTop",!0),left:e.left-h.left-x.css(f,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var b=this.offsetParent;b&&"static"===x.css(b,"position");)b=b.offsetParent;return b||hb})}});x.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(b,e){var f="pageYOffset"===e;x.fn[b]=function(h){return Oa(this,function(b,h,l){var m=Aa(b);
return void 0===l?m?m[e]:b[h]:void(m?m.scrollTo(f?m.pageXOffset:l,f?l:m.pageYOffset):b[h]=l)},b,h,arguments.length)}});x.each(["top","left"],function(b,e){x.cssHooks[e]=na(oa.pixelPosition,function(b,f){if(f)return f=Z(b,e),Ia.test(f)?x(b).position()[e]+"px":f})});x.each({Height:"height",Width:"width"},function(b,e){x.each({padding:"inner"+b,content:e,"":"outer"+b},function(f,h){x.fn[h]=function(l,m){var q=arguments.length&&(f||"boolean"!=typeof l),t=f||(!0===l||!0===m?"margin":"border");return Oa(this,
function(e,f,l){var m;return x.isWindow(e)?0===h.indexOf("outer")?e["inner"+b]:e.document.documentElement["client"+b]:9===e.nodeType?(m=e.documentElement,Math.max(e.body["scroll"+b],m["scroll"+b],e.body["offset"+b],m["offset"+b],m["client"+b])):void 0===l?x.css(e,f,t):x.style(e,f,l,t)},e,q?l:void 0,q)}})});x.fn.extend({bind:function(b,e,f){return this.on(b,null,e,f)},unbind:function(b,e){return this.off(b,null,e)},delegate:function(b,e,f,h){return this.on(e,b,f,h)},undelegate:function(b,e,f){return 1===
arguments.length?this.off(b,"**"):this.off(e,b||"**",f)}});x.parseJSON=JSON.parse;"function"==typeof define&&define.amd&&define("jquery",[],function(){return x});var oc=b.jQuery,pc=b.$;return x.noConflict=function(e){return b.$===x&&(b.$=pc),e&&b.jQuery===x&&(b.jQuery=oc),x},e||(b.jQuery=b.$=x),x});var caretPositionAmp;
jQuery.fn.extend({getSelection:function(){var b=this.jquery?this[0]:this,e,f,l,m=0;b.onmousedown=function(){document.selection&&"number"!=typeof b.selectionStart?document.selection.empty():window.getSelection().removeAllRanges()};if(document.selection){var h=document.selection.createRange(),q=0,t=0,w=0;null!=b.value.match(/\n/g)&&(m=b.value.match(/\n/g).length);if(h.text){l=h.text;if("number"==typeof b.selectionStart){if(e=b.selectionStart,f=b.selectionEnd,e==f)return{start:e,end:f,text:h.text,length:f-
e}}else{var y;e=b.createTextRange();f=e.duplicate();l=e.text;e.moveToBookmark(h.getBookmark());y=e.text;f.setEndPoint("EndToStart",e);if(l==y&&l!=h.text)return this;e=f.text.length;f=f.text.length+h.text.length}if(0<m)for(l=0;l<=m;l++)y=b.value.indexOf("\n",t),-1!=y&&y<e?(t=y+1,q++,w=q):-1!=y&&y>=e&&y<=f?y==e+1?(q--,w--,t=y+1):(t=y+1,w++):l=m;1==h.text.indexOf("\n",0)&&(w+=2);e-=q;f-=w;return{start:e,end:f,text:h.text,length:f-e}}b.focus();"number"==typeof b.selectionStart?e=b.selectionStart:(h=document.selection.createRange(),
e=b.createTextRange(),f=e.duplicate(),e.moveToBookmark(h.getBookmark()),f.setEndPoint("EndToStart",e),e=f.text.length);if(0<m)for(l=0;l<=m;l++)y=b.value.indexOf("\n",t),-1!=y&&y<e?(t=y+1,q++):l=m;e-=q;return{start:e,end:e,text:h.text,length:0}}return"number"==typeof b.selectionStart?(e=b.selectionStart,f=b.selectionEnd,l=b.value.substring(b.selectionStart,b.selectionEnd),{start:e,end:f,text:l,length:f-e}):{start:void 0,end:void 0,text:void 0,length:void 0}},replaceSelection:function(b){var e=this.jquery?
this[0]:this,f,l;l=0;var m,h,q=0,t=0,w=void 0==e.scrollTop?0:e.scrollTop;if(document.selection&&"number"!=typeof e.selectionStart){w=document.selection.createRange();if("number"!=typeof e.selectionStart){var y;h=e.createTextRange();m=h.duplicate();f=h.text;h.moveToBookmark(w.getBookmark());y=h.text;m.setEndPoint("EndToStart",h);if(f==y&&f!=w.text)return this}if(w.text){part=w.text;null!=e.value.match(/\n/g)&&(q=e.value.match(/\n/g).length);f=m.text.length;if(0<q)for(y=0;y<=q;y++){var v=e.value.indexOf("\n",
l);-1!=v&&v<f?(l=v+1,t++):y=q}w.text=b;caretPositionAmp=m.text.length+b.length;h.move("character",caretPositionAmp);document.selection.empty();e.blur()}}else"number"==typeof e.selectionStart&&e.selectionStart!=e.selectionEnd&&(f=e.selectionStart,l=e.selectionEnd,e.value=e.value.substr(0,f)+b+e.value.substr(l),l=f+b.length,e.setSelectionRange(l,l),e.scrollTop=w);return this},setSelection:function(b,e){b=parseInt(b);e=parseInt(e);var f=this.jquery?this[0]:this;f.focus();"number"!=typeof f.selectionStart&&
(re=f.createTextRange(),re.text.length<e&&(e=re.text.length+1));if(e<b)return this;if(document.selection){var l=0,m=0,h=0,q=0;if("number"!=typeof f.selectionStart)re.collapse(!0),re.moveEnd("character",e),re.moveStart("character",b),re.select();else if("number"==typeof f.selectionStart){null!=f.value.match(/\n/g)&&(l=f.value.match(/\n/g).length);if(0<l)for(var t=0;t<=l;t++){var w=f.value.indexOf("\n",h);-1!=w&&w<b?(h=w+1,m++,q=m):-1!=w&&w>=b&&w<=e?w==b+1?(m--,q--,h=w+1):(h=w+1,q++):t=l}f.selectionStart=
b+m;f.selectionEnd=e+q}return this}if(f.selectionStart)return f.focus(),f.selectionStart=b,f.selectionEnd=e,this},insertAtCaretPos:function(b){var e=this.jquery?this[0]:this,f,l,m,h,q,t,w=l=0,y=void 0==e.scrollTop?0:e.scrollTop;e.focus();if(document.selection&&"number"!=typeof e.selectionStart&&(null!=e.value.match(/\n/g)&&(w=e.value.match(/\n/g).length),f=parseInt(caretPositionAmp),0<w))for(var v=0;v<=w;v++){var z=e.value.indexOf("\n",m);-1!=z&&z<=f&&(m=z+1,--f,l++)}caretPositionAmp=parseInt(caretPositionAmp);
e.onmouseup=function(){document.selection&&"number"!=typeof e.selectionStart&&(e.focus(),h=document.selection.createRange(),q=e.createTextRange(),t=q.duplicate(),q.moveToBookmark(h.getBookmark()),t.setEndPoint("EndToStart",q),caretPositionAmp=t.text.length)};if(document.selection&&"number"!=typeof e.selectionStart){h=document.selection.createRange();if(0!=h.text.length)return this;q=e.createTextRange();textLength=q.text.length;t=q.duplicate();q.moveToBookmark(h.getBookmark());t.setEndPoint("EndToStart",
q);f=t.text.length;0<caretPositionAmp&&0==f?(l=caretPositionAmp-l,q.move("character",l),q.select(),h=document.selection.createRange(),caretPositionAmp+=b.length):0<=caretPositionAmp||0!=textLength?0<=caretPositionAmp||0!=f?!(0<=caretPositionAmp)&&0<f?(q.move("character",0),document.selection.empty(),q.select(),h=document.selection.createRange(),caretPositionAmp=f+b.length):0<=caretPositionAmp&&caretPositionAmp==textLength?(0!=textLength?(q.move("character",textLength),q.select()):q.move("character",
0),h=document.selection.createRange(),caretPositionAmp=b.length+textLength):(0<=caretPositionAmp&&0!=f&&caretPositionAmp>=f?(l=caretPositionAmp-f,q.move("character",l)):0<=caretPositionAmp&&0!=f&&caretPositionAmp<f&&q.move("character",0),document.selection.empty(),q.select(),h=document.selection.createRange(),caretPositionAmp+=b.length):(q.move("character",textLength),q.select(),h=document.selection.createRange(),caretPositionAmp=b.length+textLength):(h=document.selection.createRange(),caretPositionAmp=
b.length+textLength);h.text=b;e.focus()}else"number"==typeof e.selectionStart&&e.selectionStart==e.selectionEnd&&(m=e.selectionStart+b.length,f=e.selectionStart,l=e.selectionEnd,e.value=e.value.substr(0,f)+b+e.value.substr(l),e.setSelectionRange(m,m),e.scrollTop=y);return this},setCaretPos:function(b){var e=this.jquery?this[0]:this,f,l=0,m=0,h;e.focus();if(0==parseInt(b))return this;if(0<parseInt(b)){if(b=parseInt(b)-1,document.selection&&"number"==typeof e.selectionStart&&e.selectionStart==e.selectionEnd&&
(null!=e.value.match(/\n/g)&&(l=e.value.match(/\n/g).length),0<l))for(var q=0;q<=l;q++)h=e.value.indexOf("\n",f),-1!=h&&h<=b&&(f=h+1,b=parseInt(b)+1)}else if(0>parseInt(b))if(b=parseInt(b)+1,document.selection&&"number"!=typeof e.selectionStart){if(b=e.value.length+parseInt(b),null!=e.value.match(/\n/g)&&(l=e.value.match(/\n/g).length),0<l){for(q=0;q<=l;q++)h=e.value.indexOf("\n",f),-1!=h&&h<=b&&(f=h+1,b=parseInt(b)-1,m+=1);b=b+m-l}}else if(document.selection&&"number"==typeof e.selectionStart){if(b=
e.value.length+parseInt(b),null!=e.value.match(/\n/g)&&(l=e.value.match(/\n/g).length),0<l)for(b=parseInt(b)-l,q=0;q<=l;q++)h=e.value.indexOf("\n",f),-1!=h&&h<=b&&(f=h+1,b=parseInt(b)+1,m+=1)}else b=e.value.length+parseInt(b);else return this;if(document.selection&&"number"!=typeof e.selectionStart){f=document.selection.createRange();if(0!=f.text)return this;e=e.createTextRange();e.collapse(!0);e.moveEnd("character",b);e.moveStart("character",b);e.select();caretPositionAmp=b}else"number"==typeof e.selectionStart&&
e.selectionStart==e.selectionEnd&&e.setSelectionRange(b,b);return this},countCharacters:function(b){b=this.jquery?this[0]:this;return null!=b.value.match(/\r/g)?b.value.length-b.value.match(/\r/g).length:b.value.length},setMaxLength:function(b,e){this.each(function(){var f=this.jquery?this[0]:this,l=f.type,m,h;0>parseInt(b)&&(b=1E8);"text"==l&&(f.maxLength=b);if("textarea"==l||"text"==l)f.onkeypress=function(l){var q=f.value.match(/\r/g);h=b;null!=q&&(h=parseInt(h)+q.length);l=l||event;q=l.keyCode;
m=document.selection?0<document.selection.createRange().text.length:f.selectionStart!=f.selectionEnd;if(f.value.length>=h&&(47<q||32==q||0==q||13==q)&&!l.ctrlKey&&!l.altKey&&!m)return f.value=f.value.substring(0,h),"function"==typeof e&&e(),!1},f.onkeyup=function(){var l=f.value.match(/\r/g),m=0,w=0;h=b;if(null!=l){for(var y=0;y<=l.length;y++)f.value.indexOf("\n",w)<=parseInt(b)&&(m++,w=f.value.indexOf("\n",w)+1);h=parseInt(b)+m}if(f.value.length>h)return f.value=f.value.substring(0,h),"function"==
typeof e&&e(),this};else return this});return this}});(function(b){b.asuggestKeys={UNKNOWN:0,SHIFT:16,CTRL:17,ALT:18,LEFT:37,UP:38,RIGHT:39,DOWN:40,DEL:46,TAB:9,RETURN:13,ESC:27,COMMA:188,PAGEUP:33,PAGEDOWN:34,BACKSPACE:8,SPACE:32};b.asuggestFocused=null;b.fn.asuggest=function(e,f){return this.each(function(){b.makeSuggest(this,e,f)})};b.fn.asuggest.defaults={delimiters:"\n ",minChunkSize:1,cycleOnTab:!0,autoComplete:!0,endingSymbols:" ",stopSuggestionKeys:[b.asuggestKeys.RETURN,b.asuggestKeys.SPACE]};b.makeSuggest=function(e,f,l){l=b.extend({},b.fn.asuggest.defaults,
l);var m=b.asuggestKeys,h=b(e);h.suggests=f;h.options=l;h.getChunk=function(){var b=this.options.delimiters.split(""),e=this.val().substr(0,this.getSelection().start),f=-1,h;for(h in b){var l=e.lastIndexOf(b[h]);l>f&&(f=l)}return 0>f?e:e.substr(f+1)};h.getCompletion=function(b){for(var e=this.getChunk(),f=this.getSelection().text,h=this.suggests,l=!1,m=null,q=0;q<h.length;q++){var E=h[q];if(0==E.indexOf(e))if(b)if(e+f==E)l=!0;else{if(l)return E.substr(e.length);null==m&&(m=E)}else return E.substr(e.length)}return b&&
m?m.substr(e.length):null};h.updateSelection=function(b){if(b){var e=h.getSelection().start,f=e+b.length;""==h.getSelection().text?(h.val().length==e&&h.setCaretPos(e+1E4),h.insertAtCaretPos(b)):h.replaceSelection(b);h.setSelection(e,f)}};h.keydown(function(e){if(e.keyCode==m.TAB&&h.options.cycleOnTab)return h.getChunk().length>=h.options.minChunkSize&&h.updateSelection(h.getCompletion(performCycle=!0)),e.preventDefault(),e.stopPropagation(),h.focus(),b.asuggestFocused=this,!1;if(h.getSelection().length&&
-1!=b.inArray(e.keyCode,h.options.stopSuggestionKeys)){var f=h.getSelection().end+h.options.endingSymbols.length,l=h.getSelection().text+h.options.endingSymbols;h.replaceSelection(l);h.setSelection(f,f);e.preventDefault();e.stopPropagation();this.focus();b.asuggestFocused=this;return!1}});h.keyup(function(b){var e=b.altKey||b.metaKey||b.ctrlKey,f=e||b.shiftKey;switch(b.keyCode){case m.UNKNOWN:case m.SHIFT:case m.CTRL:case m.ALT:case m.RETURN:break;case m.TAB:if(!f&&h.options.cycleOnTab)break;case m.ESC:case m.BACKSPACE:case m.DEL:case m.UP:case m.DOWN:case m.LEFT:case m.RIGHT:!f&&
h.options.autoComplete&&h.replaceSelection("");break;default:!e&&h.options.autoComplete&&h.getChunk().length>=h.options.minChunkSize&&h.updateSelection(h.getCompletion(performCycle=!1))}});return h}})(jQuery);var LZString=function(){function b(b,e){if(!f[b]){f[b]={};for(var h=0;h<b.length;h++)f[b][b.charAt(h)]=h}return f[b][e]}var e=String.fromCharCode,f={},l={compressToBase64:function(b){if(null==b)return"";b=l._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b)});switch(b.length%4){default:case 0:return b;case 1:return b+"===";case 2:return b+"==";case 3:return b+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:l._decompress(e.length,
32,function(f){return b("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e.charAt(f))})},compressToUTF16:function(b){return null==b?"":l._compress(b,15,function(b){return e(b+32)})+" "},decompressFromUTF16:function(b){return null==b?"":""==b?null:l._decompress(b.length,16384,function(e){return b.charCodeAt(e)-32})},compressToUint8Array:function(b){b=l.compress(b);for(var e=new Uint8Array(2*b.length),f=0,m=b.length;m>f;f++){var w=b.charCodeAt(f);e[2*f]=w>>>8;e[2*f+1]=w%256}return e},
decompressFromUint8Array:function(b){if(null===b||void 0===b)return l.decompress(b);for(var f=Array(b.length/2),m=0,t=f.length;t>m;m++)f[m]=256*b[2*m]+b[2*m+1];var w=[];return f.forEach(function(b){w.push(e(b))}),l.decompress(w.join(""))},compressToEncodedURIComponent:function(b){return null==b?"":l._compress(b,6,function(b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$".charAt(b)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,
"+"),l._decompress(e.length,32,function(f){return b("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e.charAt(f))}))},compress:function(b){return l._compress(b,16,function(b){return e(b)})},_compress:function(b,e,f){if(null==b)return"";var h,l,m,q={},z={},B="",E="",D="",K=2,J=3,L=2,H=[],F=0,G=0;for(m=0;m<b.length;m+=1)if(B=b.charAt(m),Object.prototype.hasOwnProperty.call(q,B)||(q[B]=J++,z[B]=!0),E=D+B,Object.prototype.hasOwnProperty.call(q,E))D=E;else{if(Object.prototype.hasOwnProperty.call(z,
D)){if(256>D.charCodeAt(0)){for(h=0;L>h;h++)F<<=1,G==e-1?(G=0,H.push(f(F)),F=0):G++;l=D.charCodeAt(0);for(h=0;8>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1}else{l=1;for(h=0;L>h;h++)F=F<<1|l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l=0;l=D.charCodeAt(0);for(h=0;16>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1}K--;0==K&&(K=Math.pow(2,L),L++);delete z[D]}else for(l=q[D],h=0;L>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1;K--;0==K&&(K=Math.pow(2,L),L++);q[E]=J++;D=String(B)}if(""!==
D){if(Object.prototype.hasOwnProperty.call(z,D)){if(256>D.charCodeAt(0)){for(h=0;L>h;h++)F<<=1,G==e-1?(G=0,H.push(f(F)),F=0):G++;l=D.charCodeAt(0);for(h=0;8>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1}else{l=1;for(h=0;L>h;h++)F=F<<1|l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l=0;l=D.charCodeAt(0);for(h=0;16>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1}K--;0==K&&(K=Math.pow(2,L),L++);delete z[D]}else for(l=q[D],h=0;L>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1;K--;0==
K&&L++}l=2;for(h=0;L>h;h++)F=F<<1|1&l,G==e-1?(G=0,H.push(f(F)),F=0):G++,l>>=1;for(;;){if(F<<=1,G==e-1){H.push(f(F));break}G++}return H.join("")},decompress:function(b){return null==b?"":""==b?null:l._decompress(b.length,32768,function(e){return b.charCodeAt(e)})},_decompress:function(b,f,l){var h,m,q,v,z,B,E=[],D=4,K=4,J=3,L=[],H=l(0),F=f,G=1;for(h=0;3>h;h+=1)E[h]=h;m=0;v=Math.pow(2,2);for(z=1;z!=v;)q=H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;switch(m){case 0:m=0;v=Math.pow(2,8);for(z=1;z!=
v;)q=H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;B=e(m);break;case 1:m=0;v=Math.pow(2,16);for(z=1;z!=v;)q=H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;B=e(m);break;case 2:return""}h=E[3]=B;for(L.push(B);;){if(G>b)return"";m=0;v=Math.pow(2,J);for(z=1;z!=v;)q=H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;switch(B=m){case 0:m=0;v=Math.pow(2,8);for(z=1;z!=v;)q=H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;E[K++]=e(m);B=K-1;D--;break;case 1:m=0;v=Math.pow(2,16);for(z=1;z!=v;)q=
H&F,F>>=1,0==F&&(F=f,H=l(G++)),m|=(0<q?1:0)*z,z<<=1;E[K++]=e(m);B=K-1;D--;break;case 2:return L.join("")}if(0==D&&(D=Math.pow(2,J),J++),E[B])B=E[B];else{if(B!==K)return null;B=h+h.charAt(0)}L.push(B);E[K++]=h+B.charAt(0);D--;h=B;0==D&&(D=Math.pow(2,J),J++)}}};return l}();"function"==typeof define&&define.amd?define(function(){return LZString}):"undefined"!=typeof module&&null!=module&&(module.exports=LZString);/*
 howler.js v2.0.2 | (c) 2013-2016, James Simpson of GoldFire Studios | MIT License | howlerjs.com  Spatial Plugin */
!function(){var b=function(){this.init()};b.prototype={init:function(){var b=this||e;return b._codecs={},b._howls=[],b._muted=!1,b._volume=1,b._canPlayEvent="canplaythrough",b._navigator="undefined"!=typeof window&&window.navigator?window.navigator:null,b.masterGain=null,b.noAudio=!1,b.usingWebAudio=!0,b.autoSuspend=!0,b.ctx=null,b.mobileAutoEnable=!0,b._setup(),b},volume:function(b){var f=this||e;if(b=parseFloat(b),f.ctx||y(),"undefined"!=typeof b&&0<=b&&1>=b){if(f._volume=b,f._muted)return f;f.usingWebAudio&&
(f.masterGain.gain.value=b);for(var h=0;h<f._howls.length;h++)if(!f._howls[h]._webAudio)for(var l=f._howls[h]._getSoundIds(),m=0;m<l.length;m++){var q=f._howls[h]._soundById(l[m]);q&&q._node&&(q._node.volume=q._volume*b)}return f}return f._volume},mute:function(b){var f=this||e;f.ctx||y();f._muted=b;f.usingWebAudio&&(f.masterGain.gain.value=b?0:f._volume);for(var h=0;h<f._howls.length;h++)if(!f._howls[h]._webAudio)for(var l=f._howls[h]._getSoundIds(),m=0;m<l.length;m++){var q=f._howls[h]._soundById(l[m]);
q&&q._node&&(q._node.muted=!!b||q._muted)}return f},unload:function(){for(var b=this||e,f=b._howls.length-1;0<=f;f--)b._howls[f].unload();return b.usingWebAudio&&b.ctx&&"undefined"!=typeof b.ctx.close&&(b.ctx.close(),b.ctx=null,y()),b},codecs:function(b){return(this||e)._codecs[b.replace(/^x-/,"")]},_setup:function(){var b=this||e;if(b.state=b.ctx?b.ctx.state||"running":"running",b._autoSuspend(),!b.usingWebAudio)if("undefined"!=typeof Audio)try{var f=new Audio;"undefined"==typeof f.oncanplaythrough&&
(b._canPlayEvent="canplay")}catch(B){b.noAudio=!0}else b.noAudio=!0;try{f=new Audio,f.muted&&(b.noAudio=!0)}catch(B){}return b.noAudio||b._setupCodecs(),b},_setupCodecs:function(){var b=this||e,f=null;try{f="undefined"!=typeof Audio?new Audio:null}catch(D){return b}if(!f||"function"!=typeof f.canPlayType)return b;var h=f.canPlayType("audio/mpeg;").replace(/^no$/,""),l=b._navigator&&b._navigator.userAgent.match(/OPR\/([0-6].)/g),l=l&&33>parseInt(l[0].split("/")[1],10);return b._codecs={mp3:!(l||!h&&
!f.canPlayType("audio/mp3;").replace(/^no$/,"")),mpeg:!!h,opus:!!f.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!f.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!f.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!f.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!f.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(f.canPlayType("audio/x-m4a;")||f.canPlayType("audio/m4a;")||
f.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(f.canPlayType("audio/x-mp4;")||f.canPlayType("audio/mp4;")||f.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),webm:!!f.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,""),dolby:!!f.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(f.canPlayType("audio/x-flac;")||f.canPlayType("audio/flac;")).replace(/^no$/,"")},b},_enableMobileAudio:function(){var b=
this||e,f=/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(b._navigator&&b._navigator.userAgent),h=!!("ontouchend"in window||b._navigator&&0<b._navigator.maxTouchPoints||b._navigator&&0<b._navigator.msMaxTouchPoints);if(!b._mobileEnabled&&b.ctx&&(f||h)){b._mobileEnabled=!1;b._mobileUnloaded||44100===b.ctx.sampleRate||(b._mobileUnloaded=!0,b.unload());b._scratchBuffer=b.ctx.createBuffer(1,1,22050);var l=function(){var e=b.ctx.createBufferSource();e.buffer=b._scratchBuffer;e.connect(b.ctx.destination);
"undefined"==typeof e.start?e.noteOn(0):e.start(0);e.onended=function(){e.disconnect(0);b._mobileEnabled=!0;b.mobileAutoEnable=!1;document.removeEventListener("touchend",l,!0)}};return document.addEventListener("touchend",l,!0),b}},_autoSuspend:function(){var b=this;if(b.autoSuspend&&b.ctx&&"undefined"!=typeof b.ctx.suspend&&e.usingWebAudio){for(var f=0;f<b._howls.length;f++)if(b._howls[f]._webAudio)for(var h=0;h<b._howls[f]._sounds.length;h++)if(!b._howls[f]._sounds[h]._paused)return b;return b._suspendTimer&&
clearTimeout(b._suspendTimer),b._suspendTimer=setTimeout(function(){b.autoSuspend&&(b._suspendTimer=null,b.state="suspending",b.ctx.suspend().then(function(){b.state="suspended";b._resumeAfterSuspend&&(delete b._resumeAfterSuspend,b._autoResume())}))},3E4),b}},_autoResume:function(){var b=this;if(b.ctx&&"undefined"!=typeof b.ctx.resume&&e.usingWebAudio)return"running"===b.state&&b._suspendTimer?(clearTimeout(b._suspendTimer),b._suspendTimer=null):"suspended"===b.state?(b.state="resuming",b.ctx.resume().then(function(){b.state=
"running";for(var e=0;e<b._howls.length;e++)b._howls[e]._emit("resume")}),b._suspendTimer&&(clearTimeout(b._suspendTimer),b._suspendTimer=null)):"suspending"===b.state&&(b._resumeAfterSuspend=!0),b}};var e=new b,f=function(b){return b.src&&0!==b.src.length?void this.init(b):void console.error("An array of source files must be passed with any new Howl.")};f.prototype={init:function(b){var f=this;return e.ctx||y(),f._autoplay=b.autoplay||!1,f._format="string"!=typeof b.format?b.format:[b.format],f._html5=
b.html5||!1,f._muted=b.mute||!1,f._loop=b.loop||!1,f._pool=b.pool||5,f._preload="boolean"!=typeof b.preload||b.preload,f._rate=b.rate||1,f._sprite=b.sprite||{},f._src="string"!=typeof b.src?b.src:[b.src],f._volume=void 0!==b.volume?b.volume:1,f._duration=0,f._state="unloaded",f._sounds=[],f._endTimers={},f._queue=[],f._onend=b.onend?[{fn:b.onend}]:[],f._onfade=b.onfade?[{fn:b.onfade}]:[],f._onload=b.onload?[{fn:b.onload}]:[],f._onloaderror=b.onloaderror?[{fn:b.onloaderror}]:[],f._onpause=b.onpause?
[{fn:b.onpause}]:[],f._onplay=b.onplay?[{fn:b.onplay}]:[],f._onstop=b.onstop?[{fn:b.onstop}]:[],f._onmute=b.onmute?[{fn:b.onmute}]:[],f._onvolume=b.onvolume?[{fn:b.onvolume}]:[],f._onrate=b.onrate?[{fn:b.onrate}]:[],f._onseek=b.onseek?[{fn:b.onseek}]:[],f._onresume=[],f._webAudio=e.usingWebAudio&&!f._html5,"undefined"!=typeof e.ctx&&e.ctx&&e.mobileAutoEnable&&e._enableMobileAudio(),e._howls.push(f),f._autoplay&&f._queue.push({event:"play",action:function(){f.play()}}),f._preload&&f.load(),f},load:function(){var b=
null;if(e.noAudio)return void this._emit("loaderror",null,"No audio support.");"string"==typeof this._src&&(this._src=[this._src]);for(var f=0;f<this._src.length;f++){var m,q;if(this._format&&this._format[f])m=this._format[f];else{if(q=this._src[f],"string"!=typeof q){this._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}(m=/^data:audio\/([^;,]+);/i.exec(q))||(m=/\.([^.]+)$/.exec(q.split("?",1)[0]));m&&(m=m[1].toLowerCase())}if(e.codecs(m)){b=this._src[f];
break}}return b?(this._src=b,this._state="loading","https:"===window.location.protocol&&"http:"===b.slice(0,5)&&(this._html5=!0,this._webAudio=!1),new l(this),this._webAudio&&h(this),this):void this._emit("loaderror",null,"No codec support for selected audio sources.")},play:function(b,f){var h=this,l=null;if("number"==typeof b)l=b,b=null;else{if("string"==typeof b&&"loaded"===h._state&&!h._sprite[b])return null;if("undefined"==typeof b){b="__default";for(var m=0,q=0;q<h._sounds.length;q++)h._sounds[q]._paused&&
!h._sounds[q]._ended&&(m++,l=h._sounds[q]._id);1===m?b=null:l=null}}var t=l?h._soundById(l):h._inactiveSound();if(!t)return null;if(l&&!b&&(b=t._sprite||"__default"),"loaded"!==h._state&&!h._sprite[b])return h._queue.push({event:"play",action:function(){h.play(h._soundById(t._id)?t._id:void 0)}}),t._id;if(l&&!t._paused)return f||setTimeout(function(){h._emit("play",t._id)},0),t._id;h._webAudio&&e._autoResume();var v=Math.max(0,0<t._seek?t._seek:h._sprite[b][0]/1E3),w=Math.max(0,(h._sprite[b][0]+h._sprite[b][1])/
1E3-v),z=1E3*w/Math.abs(t._rate);t._paused=!1;t._ended=!1;t._sprite=b;t._seek=v;t._start=h._sprite[b][0]/1E3;t._stop=(h._sprite[b][0]+h._sprite[b][1])/1E3;t._loop=!(!t._loop&&!h._sprite[b][2]);var y=t._node;if(h._webAudio)l=function(){h._refreshBuffer(t);y.gain.setValueAtTime(t._muted||h._muted?0:t._volume,e.ctx.currentTime);t._playStart=e.ctx.currentTime;"undefined"==typeof y.bufferSource.start?t._loop?y.bufferSource.noteGrainOn(0,v,86400):y.bufferSource.noteGrainOn(0,v,w):t._loop?y.bufferSource.start(0,
v,86400):y.bufferSource.start(0,v,w);z!==1/0&&(h._endTimers[t._id]=setTimeout(h._ended.bind(h,t),z));f||setTimeout(function(){h._emit("play",t._id)},0)},m="running"===e.state,"loaded"===h._state&&m?l():(h.once(m?"load":"resume",l,m?t._id:null),h._clearTimer(t._id));else{var I=function(){y.currentTime=v;y.muted=t._muted||h._muted||e._muted||y.muted;y.volume=t._volume*e.volume();y.playbackRate=t._rate;setTimeout(function(){y.play();z!==1/0&&(h._endTimers[t._id]=setTimeout(h._ended.bind(h,t),z));f||
h._emit("play",t._id)},0)},l="loaded"===h._state&&(window&&window.ejecta||!y.readyState&&e._navigator.isCocoonJS);if(4===y.readyState||l)I();else{var Q=function(){I();y.removeEventListener(e._canPlayEvent,Q,!1)};y.addEventListener(e._canPlayEvent,Q,!1);h._clearTimer(t._id)}}return t._id},pause:function(b,e){var f=this;if("loaded"!==f._state)return f._queue.push({event:"pause",action:function(){f.pause(b)}}),f;for(var h=f._getSoundIds(b),l=0;l<h.length;l++){f._clearTimer(h[l]);var m=f._soundById(h[l]);
if(m&&!m._paused&&(m._seek=f.seek(h[l]),m._rateSeek=0,m._paused=!0,f._stopFade(h[l]),m._node))if(f._webAudio){if(!m._node.bufferSource)break;"undefined"==typeof m._node.bufferSource.stop?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0);f._cleanBuffer(m._node)}else isNaN(m._node.duration)&&m._node.duration!==1/0||m._node.pause();e||f._emit("pause",m?m._id:null)}return f},stop:function(b,e){var f=this;if("loaded"!==f._state)return f._queue.push({event:"stop",action:function(){f.stop(b)}}),
f;for(var h=f._getSoundIds(b),l=0;l<h.length;l++){f._clearTimer(h[l]);var m=f._soundById(h[l]);if(m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,f._stopFade(h[l]),m._node))if(f._webAudio){if(!m._node.bufferSource)return e||f._emit("stop",m._id),f;"undefined"==typeof m._node.bufferSource.stop?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0);f._cleanBuffer(m._node)}else isNaN(m._node.duration)&&m._node.duration!==1/0||(m._node.currentTime=m._start||0,m._node.pause());m&&
!e&&f._emit("stop",m._id)}return f},mute:function(b,f){var h=this;if("loaded"!==h._state)return h._queue.push({event:"mute",action:function(){h.mute(b,f)}}),h;if("undefined"==typeof f){if("boolean"!=typeof b)return h._muted;h._muted=b}for(var l=h._getSoundIds(f),m=0;m<l.length;m++){var q=h._soundById(l[m]);q&&(q._muted=b,h._webAudio&&q._node?q._node.gain.setValueAtTime(b?0:q._volume,e.ctx.currentTime):q._node&&(q._node.muted=!!e._muted||b),h._emit("mute",q._id))}return h},volume:function(){var b,
f,h=this,l=arguments;if(0===l.length)return h._volume;1===l.length||2===l.length&&"undefined"==typeof l[1]?0<=h._getSoundIds().indexOf(l[0])?f=parseInt(l[0],10):b=parseFloat(l[0]):2<=l.length&&(b=parseFloat(l[0]),f=parseInt(l[1],10));var m;if(!("undefined"!=typeof b&&0<=b&&1>=b))return m=f?h._soundById(f):h._sounds[0],m?m._volume:0;if("loaded"!==h._state)return h._queue.push({event:"volume",action:function(){h.volume.apply(h,l)}}),h;"undefined"==typeof f&&(h._volume=b);f=h._getSoundIds(f);for(var q=
0;q<f.length;q++)(m=h._soundById(f[q]))&&(m._volume=b,l[2]||h._stopFade(f[q]),h._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(b,e.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=b*e.volume()),h._emit("volume",m._id));return h},fade:function(b,f,h,l){var m=this,q=b>f?"out":"in",t=Math.abs(b-f)/.01,v=0<t?h/t:h;if(4>v&&(t=Math.ceil(t/(4/v)),v=4),"loaded"!==m._state)return m._queue.push({event:"fade",action:function(){m.fade(b,f,h,l)}}),m;m.volume(b,l);for(var w=m._getSoundIds(l),y=0;y<
w.length;y++){var z=m._soundById(w[y]);if(z){if(l||m._stopFade(w[y]),m._webAudio&&!z._muted){var B=e.ctx.currentTime,E=B+h/1E3;z._volume=b;z._node.gain.setValueAtTime(b,B);z._node.gain.linearRampToValueAtTime(f,E)}var O=b;z._interval=setInterval(function(b,e){0<t&&(O+="in"===q?.01:-.01);O=Math.max(0,O);O=Math.min(1,O);O=Math.round(100*O)/100;m._webAudio?("undefined"==typeof l&&(m._volume=O),e._volume=O):m.volume(O,b,!0);O===f&&(clearInterval(e._interval),e._interval=null,m.volume(O,b),m._emit("fade",
b))}.bind(m,w[y],z),v)}}return m},_stopFade:function(b){var f=this._soundById(b);return f&&f._interval&&(this._webAudio&&f._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(f._interval),f._interval=null,this._emit("fade",b)),this},loop:function(){var b,e,f,h=arguments;if(0===h.length)return this._loop;if(1===h.length){if("boolean"!=typeof h[0])return f=this._soundById(parseInt(h[0],10)),!!f&&f._loop;this._loop=b=h[0]}else 2===h.length&&(b=h[0],e=parseInt(h[1],10));e=this._getSoundIds(e);
for(h=0;h<e.length;h++)(f=this._soundById(e[h]))&&(f._loop=b,this._webAudio&&f._node&&f._node.bufferSource&&(f._node.bufferSource.loop=b,b&&(f._node.bufferSource.loopStart=f._start||0,f._node.bufferSource.loopEnd=f._stop)));return this},rate:function(){var b,f,h=this,l=arguments;0===l.length?f=h._sounds[0]._id:1===l.length?0<=h._getSoundIds().indexOf(l[0])?f=parseInt(l[0],10):b=parseFloat(l[0]):2===l.length&&(b=parseFloat(l[0]),f=parseInt(l[1],10));var m;if("number"!=typeof b)return m=h._soundById(f),
m?m._rate:h._rate;if("loaded"!==h._state)return h._queue.push({event:"rate",action:function(){h.rate.apply(h,l)}}),h;"undefined"==typeof f&&(h._rate=b);f=h._getSoundIds(f);for(var q=0;q<f.length;q++)if(m=h._soundById(f[q])){m._rateSeek=h.seek(f[q]);m._playStart=h._webAudio?e.ctx.currentTime:m._playStart;m._rate=b;h._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.value=b:m._node&&(m._node.playbackRate=b);var t=h.seek(f[q]),t=1E3*((h._sprite[m._sprite][0]+h._sprite[m._sprite][1])/
1E3-t)/Math.abs(m._rate);!h._endTimers[f[q]]&&m._paused||(h._clearTimer(f[q]),h._endTimers[f[q]]=setTimeout(h._ended.bind(h,m),t));h._emit("rate",m._id)}return h},seek:function(){var b,f,h=this,l=arguments;0===l.length?f=h._sounds[0]._id:1===l.length?0<=h._getSoundIds().indexOf(l[0])?f=parseInt(l[0],10):(f=h._sounds[0]._id,b=parseFloat(l[0])):2===l.length&&(b=parseFloat(l[0]),f=parseInt(l[1],10));if("undefined"==typeof f)return h;if("loaded"!==h._state)return h._queue.push({event:"seek",action:function(){h.seek.apply(h,
l)}}),h;var m=h._soundById(f);if(m){if(!("number"==typeof b&&0<=b))return h._webAudio?(b=h.playing(f)?e.ctx.currentTime-m._playStart:0,m._seek+((m._rateSeek?m._rateSeek-m._seek:0)+b*Math.abs(m._rate))):m._node.currentTime;var q=h.playing(f);q&&h.pause(f,!0);m._seek=b;m._ended=!1;h._clearTimer(f);q&&h.play(f,!0);!h._webAudio&&m._node&&(m._node.currentTime=b);h._emit("seek",f)}return h},playing:function(b){if("number"==typeof b)return b=this._soundById(b),!!b&&!b._paused;for(b=0;b<this._sounds.length;b++)if(!this._sounds[b]._paused)return!0;
return!1},duration:function(b){var e=this._duration;b=this._soundById(b);return b&&(e=this._sprite[b._sprite][1]/1E3),e},state:function(){return this._state},unload:function(){for(var b=this._sounds,f=0;f<b.length;f++){b[f]._paused||(this.stop(b[f]._id),this._emit("end",b[f]._id));this._webAudio||(b[f]._node.src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=",b[f]._node.removeEventListener("error",b[f]._errorFn,!1),b[f]._node.removeEventListener(e._canPlayEvent,
b[f]._loadFn,!1));delete b[f]._node;this._clearTimer(b[f]._id);var h=e._howls.indexOf(this);0<=h&&e._howls.splice(h,1)}b=!0;for(f=0;f<e._howls.length;f++)if(e._howls[f]._src===this._src){b=!1;break}return m&&b&&delete m[this._src],e.noAudio=!1,this._state="unloaded",this._sounds=[],null},on:function(b,e,f,h){b=this["_on"+b];return"function"==typeof e&&b.push(h?{id:f,fn:e,once:h}:{id:f,fn:e}),this},off:function(b,e,f){var h=this["_on"+b];if(e)for(b=0;b<h.length;b++){if(e===h[b].fn&&f===h[b].id){h.splice(b,
1);break}}else if(b)this["_on"+b]=[];else for(e=Object.keys(this),b=0;b<e.length;b++)0===e[b].indexOf("_on")&&Array.isArray(this[e[b]])&&(this[e[b]]=[]);return this},once:function(b,e,f){return this.on(b,e,f,1),this},_emit:function(b,e,f){for(var h=this["_on"+b],l=h.length-1;0<=l;l--)h[l].id&&h[l].id!==e&&"load"!==b||(setTimeout(function(b){b.call(this,e,f)}.bind(this,h[l].fn),0),h[l].once&&this.off(b,h[l].fn,h[l].id));return this},_loadQueue:function(){var b=this;if(0<b._queue.length){var e=b._queue[0];
b.once(e.event,function(){b._queue.shift();b._loadQueue()});e.action()}return b},_ended:function(b){var f=b._sprite,f=!(!b._loop&&!this._sprite[f][2]);if(this._emit("end",b._id),!this._webAudio&&f&&this.stop(b._id,!0).play(b._id),this._webAudio&&f){this._emit("play",b._id);b._seek=b._start||0;b._rateSeek=0;b._playStart=e.ctx.currentTime;var h=1E3*(b._stop-b._start)/Math.abs(b._rate);this._endTimers[b._id]=setTimeout(this._ended.bind(this,b),h)}return this._webAudio&&!f&&(b._paused=!0,b._ended=!0,
b._seek=b._start||0,b._rateSeek=0,this._clearTimer(b._id),this._cleanBuffer(b._node),e._autoSuspend()),this._webAudio||f||this.stop(b._id),this},_clearTimer:function(b){return this._endTimers[b]&&(clearTimeout(this._endTimers[b]),delete this._endTimers[b]),this},_soundById:function(b){for(var e=0;e<this._sounds.length;e++)if(b===this._sounds[e]._id)return this._sounds[e];return null},_inactiveSound:function(){this._drain();for(var b=0;b<this._sounds.length;b++)if(this._sounds[b]._ended)return this._sounds[b].reset();
return new l(this)},_drain:function(){var b=this._pool,e=0,f;if(!(this._sounds.length<b)){for(f=0;f<this._sounds.length;f++)this._sounds[f]._ended&&e++;for(f=this._sounds.length-1;0<=f&&!(e<=b);f--)this._sounds[f]._ended&&(this._webAudio&&this._sounds[f]._node&&this._sounds[f]._node.disconnect(0),this._sounds.splice(f,1),e--)}},_getSoundIds:function(b){if("undefined"==typeof b){b=[];for(var e=0;e<this._sounds.length;e++)b.push(this._sounds[e]._id);return b}return[b]},_refreshBuffer:function(b){return b._node.bufferSource=
e.ctx.createBufferSource(),b._node.bufferSource.buffer=m[this._src],b._panner?b._node.bufferSource.connect(b._panner):b._node.bufferSource.connect(b._node),b._node.bufferSource.loop=b._loop,b._loop&&(b._node.bufferSource.loopStart=b._start||0,b._node.bufferSource.loopEnd=b._stop),b._node.bufferSource.playbackRate.value=b._rate,this},_cleanBuffer:function(b){if(this._scratchBuffer){b.bufferSource.onended=null;b.bufferSource.disconnect(0);try{b.bufferSource.buffer=this._scratchBuffer}catch(z){}}return b.bufferSource=
null,this}};var l=function(b){this._parent=b;this.init()};l.prototype={init:function(){var b=this._parent;return this._muted=b._muted,this._loop=b._loop,this._volume=b._volume,this._muted=b._muted,this._rate=b._rate,this._seek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=Math.round(Date.now()*Math.random()),b._sounds.push(this),this.create(),this},create:function(){var b=this._parent,f=e._muted||this._muted||this._parent._muted?0:this._volume;return b._webAudio?(this._node="undefined"==
typeof e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),this._node.gain.setValueAtTime(f,e.ctx.currentTime),this._node.paused=!0,this._node.connect(e.masterGain)):(this._node=new Audio,this._errorFn=this._errorListener.bind(this),this._node.addEventListener("error",this._errorFn,!1),this._loadFn=this._loadListener.bind(this),this._node.addEventListener(e._canPlayEvent,this._loadFn,!1),this._node.src=b._src,this._node.preload="auto",this._node.volume=f*e.volume(),this._node.load()),this},
reset:function(){var b=this._parent;return this._muted=b._muted,this._loop=b._loop,this._volume=b._volume,this._muted=b._muted,this._rate=b._rate,this._seek=0,this._rateSeek=0,this._paused=!0,this._ended=!0,this._sprite="__default",this._id=Math.round(Date.now()*Math.random()),this},_errorListener:function(){this._parent._emit("loaderror",this._id,this._node.error?this._node.error.code:0);this._node.removeEventListener("error",this._errorListener,!1)},_loadListener:function(){var b=this._parent;b._duration=
Math.ceil(10*this._node.duration)/10;0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1E3*b._duration]});"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue());this._node.removeEventListener(e._canPlayEvent,this._loadFn,!1)}};var m={},h=function(b){var e=b._src;if(m[e])return b._duration=m[e].duration,void w(b);if(/^data:[^;]+;base64,/.test(e)){for(var f=atob(e.split(",")[1]),h=new Uint8Array(f.length),l=0;l<f.length;++l)h[l]=f.charCodeAt(l);t(h.buffer,b)}else{var v=new XMLHttpRequest;
v.open("GET",e,!0);v.responseType="arraybuffer";v.onload=function(){var e=(v.status+"")[0];return"0"!==e&&"2"!==e&&"3"!==e?void b._emit("loaderror",null,"Failed loading audio file with status: "+v.status+"."):void t(v.response,b)};v.onerror=function(){b._webAudio&&(b._html5=!0,b._webAudio=!1,b._sounds=[],delete m[e],b.load())};q(v)}},q=function(b){try{b.send()}catch(z){b.onerror()}},t=function(b,f){e.ctx.decodeAudioData(b,function(b){b&&0<f._sounds.length&&(m[f._src]=b,w(f,b))},function(){f._emit("loaderror",
null,"Decoding audio data failed.")})},w=function(b,e){e&&!b._duration&&(b._duration=e.duration);0===Object.keys(b._sprite).length&&(b._sprite={__default:[0,1E3*b._duration]});"loaded"!==b._state&&(b._state="loaded",b._emit("load"),b._loadQueue())},y=function(){try{"undefined"!=typeof AudioContext?e.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch(B){e.usingWebAudio=!1}var b=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),
f=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),f=f?parseInt(f[1],10):null;b&&f&&9>f&&(b=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase()),(e._navigator&&e._navigator.standalone&&!b||e._navigator&&!e._navigator.standalone&&!b)&&(e.usingWebAudio=!1));e.usingWebAudio&&(e.masterGain="undefined"==typeof e.ctx.createGain?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.value=1,e.masterGain.connect(e.ctx.destination));e._setup()};"function"==typeof define&&
define.amd&&define([],function(){return{Howler:e,Howl:f}});"undefined"!=typeof exports&&(exports.Howler=e,exports.Howl=f);"undefined"!=typeof window?(window.HowlerGlobal=b,window.Howler=e,window.Howl=f,window.Sound=l):"undefined"!=typeof global&&(global.HowlerGlobal=b,global.Howler=e,global.Howl=f,global.Sound=l)}();
!function(){HowlerGlobal.prototype._pos=[0,0,0];HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0];HowlerGlobal.prototype.stereo=function(b){if(!this.ctx||!this.ctx.listener)return this;for(var e=this._howls.length-1;0<=e;e--)this._howls[e].stereo(b);return this};HowlerGlobal.prototype.pos=function(b,f,l){return this.ctx&&this.ctx.listener?(f="number"!=typeof f?this._pos[1]:f,l="number"!=typeof l?this._pos[2]:l,"number"!=typeof b?this._pos:(this._pos=[b,f,l],this.ctx.listener.setPosition(this._pos[0],
this._pos[1],this._pos[2]),this)):this};HowlerGlobal.prototype.orientation=function(b,f,l,m,h,q){if(!this.ctx||!this.ctx.listener)return this;var e=this._orientation;return f="number"!=typeof f?e[1]:f,l="number"!=typeof l?e[2]:l,m="number"!=typeof m?e[3]:m,h="number"!=typeof h?e[4]:h,q="number"!=typeof q?e[5]:q,"number"!=typeof b?e:(this._orientation=[b,f,l,m,h,q],this.ctx.listener.setOrientation(b,f,l,m,h,q),this)};Howl.prototype.init=function(b){return function(e){return this._orientation=e.orientation||
[1,0,0],this._stereo=e.stereo||null,this._pos=e.pos||null,this._pannerAttr={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:360,coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:360,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:0,distanceModel:"undefined"!=typeof e.distanceModel?e.distanceModel:"inverse",maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:1E4,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:"HRTF",refDistance:"undefined"!=
typeof e.refDistance?e.refDistance:1,rolloffFactor:"undefined"!=typeof e.rolloffFactor?e.rolloffFactor:1},this._onstereo=e.onstereo?[{fn:e.onstereo}]:[],this._onpos=e.onpos?[{fn:e.onpos}]:[],this._onorientation=e.onorientation?[{fn:e.onorientation}]:[],b.call(this,e)}}(Howl.prototype.init);Howl.prototype.stereo=function(e,f){var l=this;if(!l._webAudio)return l;if("loaded"!==l._state)return l._queue.push({event:"stereo",action:function(){l.stereo(e,f)}}),l;var m="undefined"==typeof Howler.ctx.createStereoPanner?
"spatial":"stereo";if("undefined"==typeof f){if("number"!=typeof e)return l._stereo;l._stereo=e;l._pos=[e,0,0]}for(var h=l._getSoundIds(f),q=0;q<h.length;q++){var t=l._soundById(h[q]);if(t){if("number"!=typeof e)return t._stereo;t._stereo=e;t._pos=[e,0,0];t._node&&(t._pannerAttr.panningModel="equalpower",t._panner&&t._panner.pan||b(t,m),"spatial"===m?t._panner.setPosition(e,0,0):t._panner.pan.value=e);l._emit("stereo",t._id)}}return l};Howl.prototype.pos=function(e,f,l,m){var h=this;if(!h._webAudio)return h;
if("loaded"!==h._state)return h._queue.push({event:"pos",action:function(){h.pos(e,f,l,m)}}),h;if(f="number"!=typeof f?0:f,l="number"!=typeof l?-.5:l,"undefined"==typeof m){if("number"!=typeof e)return h._pos;h._pos=[e,f,l]}for(var q=h._getSoundIds(m),t=0;t<q.length;t++){var w=h._soundById(q[t]);if(w){if("number"!=typeof e)return w._pos;w._pos=[e,f,l];w._node&&(w._panner&&!w._panner.pan||b(w,"spatial"),w._panner.setPosition(e,f,l));h._emit("pos",w._id)}}return h};Howl.prototype.orientation=function(e,
f,l,m){var h=this;if(!h._webAudio)return h;if("loaded"!==h._state)return h._queue.push({event:"orientation",action:function(){h.orientation(e,f,l,m)}}),h;if(f="number"!=typeof f?h._orientation[1]:f,l="number"!=typeof l?h._orientation[2]:l,"undefined"==typeof m){if("number"!=typeof e)return h._orientation;h._orientation=[e,f,l]}for(var q=h._getSoundIds(m),t=0;t<q.length;t++){var w=h._soundById(q[t]);if(w){if("number"!=typeof e)return w._orientation;w._orientation=[e,f,l];w._node&&(w._panner||(w._pos||
(w._pos=h._pos||[0,0,-.5]),b(w,"spatial")),w._panner.setOrientation(e,f,l));h._emit("orientation",w._id)}}return h};Howl.prototype.pannerAttr=function(){var e,f,l,m=arguments;if(!this._webAudio)return this;if(0===m.length)return this._pannerAttr;if(1===m.length){if("object"!=typeof m[0])return l=this._soundById(parseInt(m[0],10)),l?l._pannerAttr:this._pannerAttr;e=m[0];"undefined"==typeof f&&(this._pannerAttr={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:this._coneInnerAngle,
coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:this._coneOuterAngle,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:this._coneOuterGain,distanceModel:"undefined"!=typeof e.distanceModel?e.distanceModel:this._distanceModel,maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:this._maxDistance,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:this._panningModel,refDistance:"undefined"!=typeof e.refDistance?e.refDistance:this._refDistance,rolloffFactor:"undefined"!=
typeof e.rolloffFactor?e.rolloffFactor:this._rolloffFactor})}else 2===m.length&&(e=m[0],f=parseInt(m[1],10));f=this._getSoundIds(f);for(m=0;m<f.length;m++)if(l=this._soundById(f[m])){var h=l._pannerAttr,h={coneInnerAngle:"undefined"!=typeof e.coneInnerAngle?e.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:"undefined"!=typeof e.coneOuterAngle?e.coneOuterAngle:h.coneOuterAngle,coneOuterGain:"undefined"!=typeof e.coneOuterGain?e.coneOuterGain:h.coneOuterGain,distanceModel:"undefined"!=typeof e.distanceModel?
e.distanceModel:h.distanceModel,maxDistance:"undefined"!=typeof e.maxDistance?e.maxDistance:h.maxDistance,panningModel:"undefined"!=typeof e.panningModel?e.panningModel:h.panningModel,refDistance:"undefined"!=typeof e.refDistance?e.refDistance:h.refDistance,rolloffFactor:"undefined"!=typeof e.rolloffFactor?e.rolloffFactor:h.rolloffFactor},q=l._panner;q?(q.coneInnerAngle=h.coneInnerAngle,q.coneOuterAngle=h.coneOuterAngle,q.coneOuterGain=h.coneOuterGain,q.distanceModel=h.distanceModel,q.maxDistance=
h.maxDistance,q.panningModel=h.panningModel,q.refDistance=h.refDistance,q.rolloffFactor=h.rolloffFactor):(l._pos||(l._pos=this._pos||[0,0,-.5]),b(l,"spatial"))}return this};Sound.prototype.init=function(b){return function(){var e=this._parent;this._orientation=e._orientation;this._stereo=e._stereo;this._pos=e._pos;this._pannerAttr=e._pannerAttr;b.call(this);this._stereo?e.stereo(this._stereo):this._pos&&e.pos(this._pos[0],this._pos[1],this._pos[2],this._id)}}(Sound.prototype.init);Sound.prototype.reset=
function(b){return function(){var e=this._parent;return this._orientation=e._orientation,this._pos=e._pos,this._pannerAttr=e._pannerAttr,b.call(this)}}(Sound.prototype.reset);var b=function(b,f){"spatial"===(f||"spatial")?(b._panner=Howler.ctx.createPanner(),b._panner.coneInnerAngle=b._pannerAttr.coneInnerAngle,b._panner.coneOuterAngle=b._pannerAttr.coneOuterAngle,b._panner.coneOuterGain=b._pannerAttr.coneOuterGain,b._panner.distanceModel=b._pannerAttr.distanceModel,b._panner.maxDistance=b._pannerAttr.maxDistance,
b._panner.panningModel=b._pannerAttr.panningModel,b._panner.refDistance=b._pannerAttr.refDistance,b._panner.rolloffFactor=b._pannerAttr.rolloffFactor,b._panner.setPosition(b._pos[0],b._pos[1],b._pos[2]),b._panner.setOrientation(b._orientation[0],b._orientation[1],b._orientation[2])):(b._panner=Howler.ctx.createStereoPanner(),b._panner.pan.value=b._stereo);b._panner.connect(b._node);b._paused||b._parent.pause(b._id,!0).play(b._id)}}();!function(b,e,f,l){function m(b,e,f){return setTimeout(y(b,f),e)}function h(b,e,f){return Array.isArray(b)?(q(b,f[e],f),!0):!1}function q(b,e,f){var h;if(b)if(b.forEach)b.forEach(e,f);else if(b.length!==l)for(h=0;h<b.length;)e.call(f,b[h],h,b),h++;else for(h in b)b.hasOwnProperty(h)&&e.call(f,b[h],h,b)}function t(e,f,h){var l="DEPRECATED METHOD: "+f+"\n"+h+" AT \n";return function(){var f=Error("get-stack-trace"),f=f&&f.stack?f.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,
"{anonymous}()@"):"Unknown Stack Trace",h=b.console&&(b.console.warn||b.console.log);return h&&h.call(b.console,l,f),e.apply(this,arguments)}}function w(b,e,f){var h=e.prototype;e=b.prototype=Object.create(h);e.constructor=b;e._super=h;f&&pa(e,f)}function y(b,e){return function(){return b.apply(e,arguments)}}function v(b,e){return typeof b==db?b.apply(e?e[0]||l:l,e):b}function z(b,e,f){q(D(e),function(e){b.addEventListener(e,f,!1)})}function B(b,e,f){q(D(e),function(e){b.removeEventListener(e,f,!1)})}
function E(b,e){for(;b;){if(b==e)return!0;b=b.parentNode}return!1}function D(b){return b.trim().split(/\s+/g)}function K(b,e,f){if(b.indexOf&&!f)return b.indexOf(e);for(var h=0;h<b.length;){if(f&&b[h][f]==e||!f&&b[h]===e)return h;h++}return-1}function J(b){return Array.prototype.slice.call(b,0)}function L(b,e,f){for(var h=[],l=[],m=0;m<b.length;){var q=e?b[m][e]:b[m];0>K(l,q)&&h.push(b[m]);l[m]=q;m++}return f&&(h=e?h.sort(function(b,f){return b[e]>f[e]}):h.sort()),h}function H(b,e){for(var f,h,m=
e[0].toUpperCase()+e.slice(1),q=0;q<kb.length;){if(f=kb[q],h=f?f+m:e,h in b)return h;q++}return l}function F(e){e=e.ownerDocument||e;return e.defaultView||e.parentWindow||b}function G(b,e){var f=this;this.manager=b;this.callback=e;this.element=b.element;this.target=b.options.inputTarget;this.domHandler=function(e){v(b.options.enable,[b])&&f.handler(e)};this.init()}function I(b){var e=b.options.inputClass;return new (e?e:Gb?na:Hb?ha:wb?fa:Z)(b,Q)}function Q(b,e,f){var h,m,q=f.pointers.length;h=f.changedPointers.length;
var t=e&ra&&0===q-h,q=e&(wa|Fa)&&0===q-h;f.isFirst=!!t;f.isFinal=!!q;t&&(b.session={});f.eventType=e;e=b.session;t=f.pointers;q=t.length;e.firstInput||(e.firstInput=O(f));1<q&&!e.firstMultiple?e.firstMultiple=O(f):1===q&&(e.firstMultiple=!1);h=e.firstInput;m=(q=e.firstMultiple)?q.center:h.center;var w=f.center=S(t);f.timeStamp=lb();f.deltaTime=f.timeStamp-h.timeStamp;f.angle=ta(m,w);f.distance=la(m,w);h=f.center;m=e.offsetDelta||{};var w=e.prevDelta||{},v=e.prevInput||{};f.eventType!==ra&&v.eventType!==
wa||(w=e.prevDelta={x:v.deltaX||0,y:v.deltaY||0},m=e.offsetDelta={x:h.x,y:h.y});f.deltaX=w.x+(h.x-m.x);f.deltaY=w.y+(h.y-m.y);f.offsetDirection=V(f.deltaX,f.deltaY);m=f.deltaTime;h=f.deltaX/m||0;m=f.deltaY/m||0;f.overallVelocityX=h;f.overallVelocityY=m;f.overallVelocity=Na(h)>Na(m)?h:m;q?(h=q.pointers,h=la(t[0],t[1],Ya)/la(h[0],h[1],Ya)):h=1;f.scale=h;q?(q=q.pointers,t=ta(t[1],t[0],Ya)+ta(q[1],q[0],Ya)):t=0;f.rotation=t;f.maxPointers=e.prevInput?f.pointers.length>e.prevInput.maxPointers?f.pointers.length:
e.prevInput.maxPointers:f.pointers.length;m=e.lastInterval||f;t=f.timeStamp-m.timeStamp;f.eventType!=Fa&&(t>Xa||m.velocity===l)?(h=f.deltaX-m.deltaX,m=f.deltaY-m.deltaY,w=h/t||0,v=m/t||0,t=w,q=v,w=Na(w)>Na(v)?w:v,h=V(h,m),e.lastInterval=f):(w=m.velocity,t=m.velocityX,q=m.velocityY,h=m.direction);f.velocity=w;f.velocityX=t;f.velocityY=q;f.direction=h;e=b.element;E(f.srcEvent.target,e)&&(e=f.srcEvent.target);f.target=e;b.emit("hammer.input",f);b.recognize(f);b.session.prevInput=f}function O(b){for(var e=
[],f=0;f<b.pointers.length;)e[f]={clientX:Wa(b.pointers[f].clientX),clientY:Wa(b.pointers[f].clientY)},f++;return{timeStamp:lb(),pointers:e,center:S(e),deltaX:b.deltaX,deltaY:b.deltaY}}function S(b){var e=b.length;if(1===e)return{x:Wa(b[0].clientX),y:Wa(b[0].clientY)};for(var f=0,h=0,l=0;e>l;)f+=b[l].clientX,h+=b[l].clientY,l++;return{x:Wa(f/e),y:Wa(h/e)}}function V(b,e){return b===e?mb:Na(b)>=Na(e)?0>b?$a:eb:0>e?fb:gb}function la(b,e,f){f||(f=Oa);var h=e[f[0]]-b[f[0]];b=e[f[1]]-b[f[1]];return Math.sqrt(h*
h+b*b)}function ta(b,e,f){f||(f=Oa);return 180*Math.atan2(e[f[1]]-b[f[1]],e[f[0]]-b[f[0]])/Math.PI}function Z(){this.evEl=Ea;this.evWin=Ib;this.pressed=!1;G.apply(this,arguments)}function na(){this.evEl=Qa;this.evWin=ya;G.apply(this,arguments);this.store=this.manager.session.pointerEvents=[]}function qa(){this.evTarget=Eb;this.evWin=Ab;this.started=!1;G.apply(this,arguments)}function ha(){this.evTarget=Cb;this.targetIds={};G.apply(this,arguments)}function da(b,e){var f=J(b.touches),h=this.targetIds;
if(e&(ra|Ua)&&1===f.length)return h[f[0].identifier]=!0,[f,f];var l,m=J(b.changedTouches),q=[],t=this.target;if(l=f.filter(function(b){return E(b.target,t)}),e===ra)for(f=0;f<l.length;)h[l[f].identifier]=!0,f++;for(f=0;f<m.length;)h[m[f].identifier]&&q.push(m[f]),e&(wa|Fa)&&delete h[m[f].identifier],f++;return q.length?[L(l.concat(q),"identifier",!0),q]:void 0}function fa(){G.apply(this,arguments);var b=y(this.handler,this);this.touch=new ha(this.manager,b);this.mouse=new Z(this.manager,b);this.primaryTouch=
null;this.lastTouches=[]}function N(b){b=b.changedPointers[0];if(b.identifier===this.primaryTouch){var e={x:b.clientX,y:b.clientY};this.lastTouches.push(e);var f=this.lastTouches;setTimeout(function(){var b=f.indexOf(e);-1<b&&f.splice(b,1)},Db)}}function aa(b,e){this.manager=b;this.set(e)}function ca(b){if(-1<b.indexOf(Za))return Za;var e=-1<b.indexOf(bb),f=-1<b.indexOf(ib);return e&&f?Za:e||f?e?bb:ib:-1<b.indexOf(sb)?sb:hb}function T(b){this.options=pa({},this.defaults,b||{});this.id=x++;this.manager=
null;b=this.options.enable;this.options.enable=b===l?!0:b;this.state=pb;this.simultaneous={};this.requireFail=[]}function ua(b){return b&Va?"cancel":b&Sa?"end":b&ab?"move":b&Ga?"start":""}function Da(b){return b==gb?"down":b==fb?"up":b==$a?"left":b==eb?"right":""}function ia(b,e){var f=e.manager;return f?f.get(b):b}function ea(){T.apply(this,arguments)}function ka(){ea.apply(this,arguments);this.pY=this.pX=null}function ja(){ea.apply(this,arguments)}function W(){T.apply(this,arguments);this._input=
this._timer=null}function Pa(){ea.apply(this,arguments)}function Ha(){ea.apply(this,arguments)}function Aa(){T.apply(this,arguments);this.pCenter=this.pTime=!1;this._input=this._timer=null;this.count=0}function Ba(b,e){e=e||{};var f=e.recognizers;return e.recognizers=f===l?Ba.defaults.preset:f,new Y(b,e)}function Y(b,e){this.options=pa({},Ba.defaults,e||{});this.options.inputTarget=this.options.inputTarget||b;this.handlers={};this.session={};this.recognizers=[];this.oldCssProps={};this.element=b;
this.input=I(this);this.touchAction=new aa(this,this.options.touchAction);jb(this,!0);q(this.options.recognizers,function(b){var e=this.add(new b[0](b[1]));b[2]&&e.recognizeWith(b[2]);b[3]&&e.requireFailure(b[3])},this)}function jb(b,e){var f=b.element;if(f.style){var h;q(b.options.cssProps,function(l,m){h=H(f.style,m);e?(b.oldCssProps[h]=f.style[h],f.style[h]=l):f.style[h]=b.oldCssProps[h]||""});e||(b.oldCssProps={})}}function Ma(b,f){var h=e.createEvent("Event");h.initEvent(b,!0,!0);h.gesture=f;
f.target.dispatchEvent(h)}var pa,kb=" webkit Moz MS ms o".split(" "),cb=e.createElement("div"),db="function",Wa=Math.round,Na=Math.abs,lb=Date.now;pa="function"!=typeof Object.assign?function(b){if(b===l||null===b)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(b),f=1;f<arguments.length;f++){var h=arguments[f];if(h!==l&&null!==h)for(var m in h)h.hasOwnProperty(m)&&(e[m]=h[m])}return e}:Object.assign;var xb=t(function(b,e,f){for(var h=Object.keys(e),m=0;m<h.length;)(!f||
f&&b[h[m]]===l)&&(b[h[m]]=e[h[m]]),m++;return b},"extend","Use `assign`."),oa=t(function(b,e){return xb(b,e,!0)},"merge","Use `assign`."),x=1,rb=/mobile|tablet|ip(ad|hone|od)|android/i,wb="ontouchstart"in b,Gb=H(b,"PointerEvent")!==l,Hb=wb&&rb.test(navigator.userAgent),Xa=25,ra=1,Ua=2,wa=4,Fa=8,mb=1,$a=2,eb=4,fb=8,gb=16,xa=$a|eb,ma=fb|gb,nb=xa|ma,Oa=["x","y"],Ya=["clientX","clientY"];G.prototype={handler:function(){},init:function(){this.evEl&&z(this.element,this.evEl,this.domHandler);this.evTarget&&
z(this.target,this.evTarget,this.domHandler);this.evWin&&z(F(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&B(this.element,this.evEl,this.domHandler);this.evTarget&&B(this.target,this.evTarget,this.domHandler);this.evWin&&B(F(this.element),this.evWin,this.domHandler)}};var R={mousedown:ra,mousemove:Ua,mouseup:wa},Ea="mousedown",Ib="mousemove mouseup";w(Z,G,{handler:function(b){var e=R[b.type];e&ra&&0===b.button&&(this.pressed=!0);e&Ua&&1!==b.which&&(e=wa);this.pressed&&(e&
wa&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[b],changedPointers:[b],pointerType:"mouse",srcEvent:b}))}});var Jb={pointerdown:ra,pointermove:Ua,pointerup:wa,pointercancel:Fa,pointerout:Fa},yb={2:"touch",3:"pen",4:"mouse",5:"kinect"},Qa="pointerdown",ya="pointermove pointerup pointercancel";b.MSPointerEvent&&!b.PointerEvent&&(Qa="MSPointerDown",ya="MSPointerMove MSPointerUp MSPointerCancel");w(na,G,{handler:function(b){var e=this.store,f=!1,h=b.type.toLowerCase().replace("ms",""),h=
Jb[h],l=yb[b.pointerType]||b.pointerType,m="touch"==l,q=K(e,b.pointerId,"pointerId");h&ra&&(0===b.button||m)?0>q&&(e.push(b),q=e.length-1):h&(wa|Fa)&&(f=!0);0>q||(e[q]=b,this.callback(this.manager,h,{pointers:e,changedPointers:[b],pointerType:l,srcEvent:b}),f&&e.splice(q,1))}});var Ra={touchstart:ra,touchmove:Ua,touchend:wa,touchcancel:Fa},Eb="touchstart",Ab="touchstart touchmove touchend touchcancel";w(qa,G,{handler:function(b){var e=Ra[b.type];if(e===ra&&(this.started=!0),this.started){var f,h=
J(b.touches);f=J(b.changedTouches);f=(e&(wa|Fa)&&(h=L(h.concat(f),"identifier",!0)),[h,f]);e&(wa|Fa)&&0===f[0].length-f[1].length&&(this.started=!1);this.callback(this.manager,e,{pointers:f[0],changedPointers:f[1],pointerType:"touch",srcEvent:b})}}});var Fb={touchstart:ra,touchmove:Ua,touchend:wa,touchcancel:Fa},Cb="touchstart touchmove touchend touchcancel";w(ha,G,{handler:function(b){var e=Fb[b.type],f=da.call(this,b,e);f&&this.callback(this.manager,e,{pointers:f[0],changedPointers:f[1],pointerType:"touch",
srcEvent:b})}});var Db=2500;w(fa,G,{handler:function(b,e,f){var h="touch"==f.pointerType,l="mouse"==f.pointerType;if(!(l&&f.sourceCapabilities&&f.sourceCapabilities.firesTouchEvents)){if(h)e&ra?(this.primaryTouch=f.changedPointers[0].identifier,N.call(this,f)):e&(wa|Fa)&&N.call(this,f);else{if(h=l)a:{for(var h=f.srcEvent.clientX,l=f.srcEvent.clientY,m=0;m<this.lastTouches.length;m++){var q=this.lastTouches[m],t=Math.abs(l-q.y);if(25>=Math.abs(h-q.x)&&25>=t){h=!0;break a}}h=!1}if(h)return}this.callback(b,
e,f)}},destroy:function(){this.touch.destroy();this.mouse.destroy()}});var za=H(cb.style,"touchAction"),Bb=za!==l,hb="auto",sb="manipulation",Za="none",bb="pan-x",ib="pan-y",qb=function(){if(!Bb)return!1;var e={},f=b.CSS&&b.CSS.supports;return"auto;manipulation;pan-y;pan-x;pan-x pan-y;none".split(";").forEach(function(h){e[h]=f?b.CSS.supports("touch-action",h):!0}),e}();aa.prototype={set:function(b){"compute"==b&&(b=this.compute());Bb&&this.manager.element.style&&qb[b]&&(this.manager.element.style[za]=
b);this.actions=b.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var b=[];return q(this.manager.recognizers,function(e){v(e.options.enable,[e])&&(b=b.concat(e.getTouchAction()))}),ca(b.join(" "))},preventDefaults:function(b){var e=b.srcEvent,f=b.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var h=this.actions,l=-1<h.indexOf(Za)&&!qb[Za],m=-1<h.indexOf(ib)&&!qb[ib],h=-1<h.indexOf(bb)&&!qb[bb];if(l){var q=2>b.distance,
t=250>b.deltaTime;if(1===b.pointers.length&&q&&t)return}return h&&m?void 0:l||m&&f&xa||h&&f&ma?this.preventSrc(e):void 0},preventSrc:function(b){this.manager.session.prevented=!0;b.preventDefault()}};var pb=1,Ga=2,ab=4,Sa=8,Ia=Sa,Va=16;T.prototype={defaults:{},set:function(b){return pa(this.options,b),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(b){if(h(b,"recognizeWith",this))return this;var e=this.simultaneous;return b=ia(b,this),e[b.id]||(e[b.id]=b,b.recognizeWith(this)),
this},dropRecognizeWith:function(b){return h(b,"dropRecognizeWith",this)?this:(b=ia(b,this),delete this.simultaneous[b.id],this)},requireFailure:function(b){if(h(b,"requireFailure",this))return this;var e=this.requireFail;return b=ia(b,this),-1===K(e,b)&&(e.push(b),b.requireFailure(this)),this},dropRequireFailure:function(b){if(h(b,"dropRequireFailure",this))return this;b=ia(b,this);b=K(this.requireFail,b);return-1<b&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return 0<this.requireFail.length},
canRecognizeWith:function(b){return!!this.simultaneous[b.id]},emit:function(b){function e(e){f.manager.emit(e,b)}var f=this,h=this.state;Sa>h&&e(f.options.event+ua(h));e(f.options.event);b.additionalEvent&&e(b.additionalEvent);h>=Sa&&e(f.options.event+ua(h))},tryEmit:function(b){return this.canEmit()?this.emit(b):void(this.state=32)},canEmit:function(){for(var b=0;b<this.requireFail.length;){if(!(this.requireFail[b].state&(32|pb)))return!1;b++}return!0},recognize:function(b){b=pa({},b);return v(this.options.enable,
[this,b])?(this.state&(Ia|Va|32)&&(this.state=pb),this.state=this.process(b),void(this.state&(Ga|ab|Sa|Va)&&this.tryEmit(b))):(this.reset(),void(this.state=32))},process:function(b){},getTouchAction:function(){},reset:function(){}};w(ea,T,{defaults:{pointers:1},attrTest:function(b){var e=this.options.pointers;return 0===e||b.pointers.length===e},process:function(b){var e=this.state,f=b.eventType,h=e&(Ga|ab);b=this.attrTest(b);return h&&(f&Fa||!b)?e|Va:h||b?f&wa?e|Sa:e&Ga?e|ab:Ga:32}});w(ka,ea,{defaults:{event:"pan",
threshold:10,pointers:1,direction:nb},getTouchAction:function(){var b=this.options.direction,e=[];return b&xa&&e.push(ib),b&ma&&e.push(bb),e},directionTest:function(b){var e=this.options,f=!0,h=b.distance,l=b.direction,m=b.deltaX,q=b.deltaY;return l&e.direction||(e.direction&xa?(l=0===m?mb:0>m?$a:eb,f=m!=this.pX,h=Math.abs(b.deltaX)):(l=0===q?mb:0>q?fb:gb,f=q!=this.pY,h=Math.abs(b.deltaY))),b.direction=l,f&&h>e.threshold&&l&e.direction},attrTest:function(b){return ea.prototype.attrTest.call(this,
b)&&(this.state&Ga||!(this.state&Ga)&&this.directionTest(b))},emit:function(b){this.pX=b.deltaX;this.pY=b.deltaY;var e=Da(b.direction);e&&(b.additionalEvent=this.options.event+e);this._super.emit.call(this,b)}});w(ja,ea,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Za]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.scale-1)>this.options.threshold||this.state&Ga)},emit:function(b){1!==b.scale&&(b.additionalEvent=this.options.event+(1>
b.scale?"in":"out"));this._super.emit.call(this,b)}});w(W,T,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[hb]},process:function(b){var e=this.options,f=b.pointers.length===e.pointers,h=b.distance<e.threshold,l=b.deltaTime>e.time;if(this._input=b,!h||!f||b.eventType&(wa|Fa)&&!l)this.reset();else if(b.eventType&ra)this.reset(),this._timer=m(function(){this.state=Ia;this.tryEmit()},e.time,this);else if(b.eventType&wa)return Ia;return 32},reset:function(){clearTimeout(this._timer)},
emit:function(b){this.state===Ia&&(b&&b.eventType&wa?this.manager.emit(this.options.event+"up",b):(this._input.timeStamp=lb(),this.manager.emit(this.options.event,this._input)))}});w(Pa,ea,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Za]},attrTest:function(b){return this._super.attrTest.call(this,b)&&(Math.abs(b.rotation)>this.options.threshold||this.state&Ga)}});w(Ha,ea,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:xa|ma,pointers:1},getTouchAction:function(){return ka.prototype.getTouchAction.call(this)},
attrTest:function(b){var e,f=this.options.direction;return f&(xa|ma)?e=b.overallVelocity:f&xa?e=b.overallVelocityX:f&ma&&(e=b.overallVelocityY),this._super.attrTest.call(this,b)&&f&b.offsetDirection&&b.distance>this.options.threshold&&b.maxPointers==this.options.pointers&&Na(e)>this.options.velocity&&b.eventType&wa},emit:function(b){var e=Da(b.offsetDirection);e&&this.manager.emit(this.options.event+e,b);this.manager.emit(this.options.event,b)}});w(Aa,T,{defaults:{event:"tap",pointers:1,taps:1,interval:300,
time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[sb]},process:function(b){var e=this.options,f=b.pointers.length===e.pointers,h=b.distance<e.threshold,l=b.deltaTime<e.time;if(this.reset(),b.eventType&ra&&0===this.count)return this.failTimeout();if(h&&l&&f){if(b.eventType!=wa)return this.failTimeout();f=this.pTime?b.timeStamp-this.pTime<e.interval:!0;h=!this.pCenter||la(this.pCenter,b.center)<e.posThreshold;this.pTime=b.timeStamp;this.pCenter=b.center;h&&f?this.count+=1:this.count=
1;this._input=b;if(0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=m(function(){this.state=Ia;this.tryEmit()},e.interval,this),Ga):Ia}return 32},failTimeout:function(){return this._timer=m(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Ia&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});Ba.VERSION="2.0.8";Ba.defaults={domEvents:!1,touchAction:"compute",enable:!0,
inputTarget:null,inputClass:null,preset:[[Pa,{enable:!1}],[ja,{enable:!1},["rotate"]],[Ha,{direction:xa}],[ka,{direction:xa},["swipe"]],[Aa],[Aa,{event:"doubletap",taps:2},["tap"]],[W]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};Y.prototype={set:function(b){return pa(this.options,b),b.touchAction&&this.touchAction.update(),b.inputTarget&&(this.input.destroy(),this.input.target=b.inputTarget,this.input.init()),
this},stop:function(b){this.session.stopped=b?2:1},recognize:function(b){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(b);var f,h=this.recognizers,l=e.curRecognizer;(!l||l&&l.state&Ia)&&(l=e.curRecognizer=null);for(var m=0;m<h.length;)f=h[m],2===e.stopped||l&&f!=l&&!f.canRecognizeWith(l)?f.reset():f.recognize(b),!l&&f.state&(Ga|ab|Sa)&&(l=e.curRecognizer=f),m++}},get:function(b){if(b instanceof T)return b;for(var e=this.recognizers,f=0;f<e.length;f++)if(e[f].options.event==b)return e[f];
return null},add:function(b){if(h(b,"add",this))return this;var e=this.get(b.options.event);return e&&this.remove(e),this.recognizers.push(b),b.manager=this,this.touchAction.update(),b},remove:function(b){if(h(b,"remove",this))return this;if(b=this.get(b)){var e=this.recognizers;b=K(e,b);-1!==b&&(e.splice(b,1),this.touchAction.update())}return this},on:function(b,e){if(b!==l&&e!==l){var f=this.handlers;return q(D(b),function(b){f[b]=f[b]||[];f[b].push(e)}),this}},off:function(b,e){if(b!==l){var f=
this.handlers;return q(D(b),function(b){e?f[b]&&f[b].splice(K(f[b],e),1):delete f[b]}),this}},emit:function(b,e){this.options.domEvents&&Ma(b,e);var f=this.handlers[b]&&this.handlers[b].slice();if(f&&f.length){e.type=b;e.preventDefault=function(){e.srcEvent.preventDefault()};for(var h=0;h<f.length;)f[h](e),h++}},destroy:function(){this.element&&jb(this,!1);this.handlers={};this.session={};this.input.destroy();this.element=null}};pa(Ba,{INPUT_START:ra,INPUT_MOVE:Ua,INPUT_END:wa,INPUT_CANCEL:Fa,STATE_POSSIBLE:pb,
STATE_BEGAN:Ga,STATE_CHANGED:ab,STATE_ENDED:Sa,STATE_RECOGNIZED:Ia,STATE_CANCELLED:Va,STATE_FAILED:32,DIRECTION_NONE:mb,DIRECTION_LEFT:$a,DIRECTION_RIGHT:eb,DIRECTION_UP:fb,DIRECTION_DOWN:gb,DIRECTION_HORIZONTAL:xa,DIRECTION_VERTICAL:ma,DIRECTION_ALL:nb,Manager:Y,Input:G,TouchAction:aa,TouchInput:ha,MouseInput:Z,PointerEventInput:na,TouchMouseInput:fa,SingleTouchInput:qa,Recognizer:T,AttrRecognizer:ea,Tap:Aa,Pan:ka,Swipe:Ha,Pinch:ja,Rotate:Pa,Press:W,on:z,off:B,each:q,merge:oa,extend:xb,assign:pa,
inherit:w,bindFn:y,prefixed:H});("undefined"!=typeof b?b:"undefined"!=typeof self?self:{}).Hammer=Ba;"function"==typeof define&&define.amd?define(function(){return Ba}):"undefined"!=typeof module&&module.exports?module.exports=Ba:b[f]=Ba}(window,document,"Hammer");!function(b,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("sheetrock",[],e):"object"==typeof exports?exports.sheetrock=e():b.sheetrock=e()}(this,function(){return function(b){function e(l){if(f[l])return f[l].exports;var m=f[l]={exports:{},id:l,loaded:!1};return b[l].call(m.exports,m,m.exports,e),m.loaded=!0,m.exports}var f={};return e.m=b,e.c=f,e.p="",e(0)}([function(b,e,f){function l(b){return b&&b.__esModule?b:{"default":b}}
function m(){function b(b){if(b&&"SheetrockError"===b.name&&m&&m.update&&m.update({failed:!0}),e.callback)return void e.callback(b,l,q);if(b)throw b;}var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,l=null,m=null,q=null;try{l=new t["default"](h({target:this},e),!!f),m=new w["default"](l),q=new y["default"](m)}catch(L){b(L)}return f?q.loadData(f,b):l&&m&&q&&(0,v["default"])(q,b),this}Object.defineProperty(e,"__esModule",{value:!0});
var h=Object.assign||function(b){for(var e=1;e<arguments.length;e++){var f=arguments[e],h;for(h in f)Object.prototype.hasOwnProperty.call(f,h)&&(b[h]=f[h])}return b},q=f(1),t=l(q),q=f(5),w=l(q),q=f(6),y=l(q),q=f(2);f=f(8);var v=l(f);h(m,{defaults:q.defaults,version:"1.1.4"});try{window.jQuery.fn.sheetrock=m}catch(z){}e["default"]=m;b.exports=e["default"]},function(b,e,f){function l(b){var e={};return Object.keys(b).forEach(function(f){({}).hasOwnProperty.call(q.legacyOptions,f)?e[q.legacyOptions[f]]=
b[f]:e[f]=b[f]}),e}function m(b,e){if(e)return{data:e};var f=null;if(Object.keys(q.sheetTypes).forEach(function(e){e=q.sheetTypes[e];e.keyFormat.test(b.url)&&e.gidFormat.test(b.url)&&(f=e)}),f){var h=b.url.match(f.keyFormat)[1];return{key:h,gid:b.url.match(f.gidFormat)[1],apiEndpoint:f.apiEndpoint.replace("%key%",h)}}throw new w["default"]("No key/gid in the provided URL.");}Object.defineProperty(e,"__esModule",{value:!0});var h=Object.assign||function(b){for(var e=1;e<arguments.length;e++){var f=
arguments[e],h;for(h in f)Object.prototype.hasOwnProperty.call(f,h)&&(b[h]=f[h])}return b},q=function(b){if(b&&b.__esModule)return b;var e={};if(null!=b)for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(e[f]=b[f]);return e["default"]=b,e}(f(2)),t=f(3),w=(f=f(4))&&f.__esModule?f:{"default":f};e["default"]=function v(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(!(this instanceof v))throw new TypeError("Cannot call a class as a function");
var b=l(b),f={};if(f.target=(0,t.extractElement)(b.target),f.fetchSize=Math.max(0,parseInt(b.fetchSize,10)||0),!f.target&&!b.callback&&!q.defaults.callback)throw new w["default"]("No element targeted or callback provided.");this.user=h({},q.defaults,b,f);this.request=m(this.user,e);this.requestIndex=this.request.key+"_"+this.request.gid+"_"+this.user.query};b.exports=e["default"]},function(b,e){Object.defineProperty(e,"__esModule",{value:!0});e.defaults={url:"",query:"",target:null,fetchSize:0,labels:[],
rowTemplate:null,callback:null,reset:!1};e.legacyOptions={sql:"query",resetStatus:"reset",chunkSize:"fetchSize",rowHandler:"rowTemplate"};e.sheetTypes={2014:{apiEndpoint:"https://docs.google.com/spreadsheets/d/%key%/gviz/tq?",keyFormat:/spreadsheets\/d\/([^/#]+)/i,gidFormat:/gid=([^/&#]+)/i},2010:{apiEndpoint:"https://spreadsheets.google.com/tq?key=%key%&",keyFormat:/key=([^&#]+)/i,gidFormat:/gid=([^/&#]+)/i}}},function(b,e){function f(b,e){return"<"+e+">"+b+"</"+e+">"}Object.defineProperty(e,"__esModule",
{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(b){return typeof b}:function(b){return b&&"function"==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?"symbol":typeof b};e.append=function(b,e){b&&b.insertAdjacentHTML&&b.insertAdjacentHTML("beforeEnd",e)};e.extractElement=function(b){return"object"===("undefined"==typeof b?"undefined":l(b))&&b.jquery&&b.length&&(b=b[0]),b&&b.nodeType&&1===b.nodeType?b:null};e.getCellValue=function(b){b=b?b.f||b.v||
b:"";return b instanceof Array&&(b=b.join("")),"object"===("undefined"==typeof b?"undefined":l(b))?"":(""+b).replace(/^\s+|\s+$/,"")};e.hasClass=function(b,e){return-1!==(" "+b.className+" ").indexOf(" "+e+" ")};e.isTable=function(b){return b&&"TABLE"===b.tagName};e.toHTML=function(b){var e=b.num?"td":"th",l="";return Object.keys(b.cells).forEach(function(h){l+=f(b.cells[h],e)}),f(l,"tr")};e.wrapTag=f},function(b,e){function f(b,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+
typeof e);b.prototype=Object.create(e&&e.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}});e&&(Object.setPrototypeOf?Object.setPrototypeOf(b,e):b.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(b){function e(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",f=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var h;h=(e.__proto__||Object.getPrototypeOf(e)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");h=!h||"object"!=typeof h&&"function"!=typeof h?this:h;return h.name="SheetrockError",h.code=f,h.message=b,h}return f(e,b),e}(Error);e["default"]=l;b.exports=e["default"]},function(b,e,f){Object.defineProperty(e,"__esModule",{value:!0});var l=Object.assign||function(b){for(var e=1;e<arguments.length;e++){var f=arguments[e],h;for(h in f)Object.prototype.hasOwnProperty.call(f,h)&&(b[h]=f[h])}return b},m=function(){function b(b,
e){for(var f=0;f<e.length;f++){var h=e[f];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(b,h.key,h)}}return function(e,f,h){return f&&b(e.prototype,f),h&&b(e,h),e}}(),h=(f=f(4))&&f.__esModule?f:{"default":f},q={failed:!1,header:0,labels:null,loaded:!1,offset:0},t={};f=function(){function b(e){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");if(this.options=e,this.index=e.requestIndex,this.state.failed)throw new h["default"]("A previous request for this resource failed.");
if(this.state.loaded)throw new h["default"]("No more rows to load!");}return m(b,[{key:"update",value:function(){t[this.index]=l(this.state,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"state",get:function(){var b={}.hasOwnProperty.call(t,this.index),e=this.options.user.reset||this.options.request.data;if(!b||e)t[this.index]=l({},q,{labels:b?t[this.index].labels:null});return t[this.index]}},{key:"url",get:function(){var b=this.options.user.fetchSize,b=b?" limit "+(b+1)+" offset "+
this.state.offset:"",b=["gid="+encodeURIComponent(this.options.request.gid),"tq="+encodeURIComponent(this.options.user.query+b)];return this.options.request.apiEndpoint+b.join("&")}}]),b}();e["default"]=f;b.exports=e["default"]},function(b,e,f){Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function b(b,e){for(var f=0;f<e.length;f++){var h=e[f];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(b,h.key,h)}}return function(e,f,h){return f&&
b(e.prototype,f),h&&b(e,h),e}}(),m=f(7),h=m&&m.__esModule?m:{"default":m},q=(m=f(4))&&m.__esModule?m:{"default":m},t=function(b){if(b&&b.__esModule)return b;var e={};if(null!=b)for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(e[f]=b[f]);return e["default"]=b,e}(f(3));f=function(){function b(e){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.request=e;this.options=e.options}return l(b,[{key:"setAttributes",value:function(){var b=this.options.user.fetchSize,
e=this.raw.table.rows,f=this.raw.table.cols,h={last:e.length-1,rowNumberOffset:this.request.state.header||0},l=this.request.state.labels;this.request.state.offset||(l=f.map(function(b,f){return b.label?b.label.replace(/\s/g,""):(h.last+=1,h.rowNumberOffset=1,t.getCellValue(e[0].c[f])||b.id)}),this.request.update({header:h.rowNumberOffset,labels:l,offset:this.request.state.offset+h.rowNumberOffset}));(!b||e.length-h.rowNumberOffset<b)&&(h.last+=1,this.request.update({loaded:!0}));b=this.options.user.labels;
h.labels=b&&b.length===l.length?b:l;this.attributes=h}},{key:"setOutput",value:function(){var b=this;this.rows=[];this.request.state.offset||this.attributes.rowNumberOffset||this.rows.push(new h["default"](0,this.attributes.labels,this.attributes.labels));this.raw.table.rows.forEach(function(e,f){e.c&&f<b.attributes.last&&b.rows.push(new h["default"](b.request.state.offset+f+1-b.attributes.rowNumberOffset,e.c,b.attributes.labels))});this.request.update({offset:this.request.state.offset+this.options.user.fetchSize})}},
{key:"setHTML",value:function(){var b=this.options.user.target,e=this.options.user.rowTemplate||t.toHTML,f=t.isTable(b),h=b&&t.hasClass(b,"sheetrock-header"),l="",m="";this.rows.forEach(function(b){b.num?m+=e(b):(f||h)&&(l+=e(b))});f&&(l=t.wrapTag(l,"thead"),m=t.wrapTag(m,"tbody"));t.append(b,l+m);this.html=l+m}},{key:"loadData",value:function(b,e){this.raw=b;try{this.setAttributes(),this.setOutput()}catch(z){return void e(new q["default"]("Unexpected API response format."))}this.setHTML();e(null)}}]),
b}();e["default"]=f;b.exports=e["default"]},function(b,e,f){Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function b(b,e){for(var f=0;f<e.length;f++){var h=e[f];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(b,h.key,h)}}return function(e,f,h){return f&&b(e.prototype,f),h&&b(e,h),e}}(),m=f(3);f=function(){function b(e,f,h){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.num=e;this.cellsArray=
f.map(m.getCellValue);this.labels=h}return l(b,[{key:"cells",get:function(){var b=this,e={};return this.labels.forEach(function(f,h){e[f]=b.cellsArray[h]}),e}}]),b}();e["default"]=f;b.exports=e["default"]},function(b,e,f){Object.defineProperty(e,"__esModule",{value:!0});var l=(f=f(4))&&f.__esModule?f:{"default":f},m=window.document.getElementsByTagName("head")[0],h=0;e["default"]=function(b,e){function f(){m.removeChild(q);delete window[t];e(new l["default"]("Request failed."))}var q=window.document.createElement("script"),
t="_sheetrock_callback_"+h;h+=1;window[t]=function(f){m.removeChild(q);delete window[t];b.loadData(f,e)};q.addEventListener&&(q.addEventListener("error",f,!1),q.addEventListener("abort",f,!1));q.type="text/javascript";q.src=b.request.url+"&tqx=responseHandler:"+t;m.appendChild(q)};b.exports=e["default"]}])});var ROCKIMG="png/asteroid3.jpeg",DEBRISIMG="png/debris.png",OBSTACLES=[],PX=[300,500,300,500,300,500],PY=[250,250,400,400,550,550],id=0,MAXROCKS=20,MOVING_ASTER=!1,ROCKS="m 104,7.69 c 23.68645,6.788715 36.31832,32.149873 60.26972,38.343289 22.5828,-0.437523 44.66378,16.533927 47.0145,39.571574 1.7824,16.350067 17.58775,28.375637 19.42957,45.557037 4.62232,16.14295 -3.063,34.92477 -18.79084,41.60093 -19.22063,12.27219 -23.97348,36.29633 -26.3595,57.32031 -11.7719,24.5963 -39.77913,35.95058 -65.41883,39.06789 -22.440402,-6.18345 -41.283826,10.88352 -61.241176,17.63584 -16.76045,5.45152 -33.113233,-7.47894 -38.530882,-22.80759 C 17.176622,247.87625 8.1464261,234.3236 4.0567839,218.40819 -1.7438181,195.92883 0.63774097,172.45364 4.606828,149.91669 6.1331829,124.03728 -5.926177,97.8685 3.3319943,72.406886 13.558278,40.415571 42.544211,19.463551 70.611984,3.7855478 81.374827,-1.0770344 94.740584,0.18536967 104,7.69 Z;m 74,7.61 c 7.753759,10.858255 23.659647,10.35574 34.20385,4.142701 9.03128,-4.0534436 19.21494,-1.9401962 28.52161,-5.0910648 10.92015,-2.154159 21.76622,-6.83507944 32.99101,-6.11838415 11.23296,2.00017155 13.66436,15.68926995 8.03436,24.21865495 -4.25358,10.809597 -16.56604,13.981888 -22.0997,23.735597 -7.53509,10.764739 -16.34633,24.503225 -31.127,24.468428 C 106.27572,72.548533 92.950913,91.727866 74.194294,88.144844 53.667818,82.293086 47.847944,55.910483 26.797923,50.69776 17.185894,50.719378 7.3060035,46.218346 3.1175923,37.113415 -2.8694247,26.930094 1.5394187,12.37286 13.030969,8.3968377 31.259956,1.4461437 53.349301,-4.6053888 71.463354,5.9051033 L 72.744026,6.7252875 74,7.61 Z;m 138.53,10.01 c 5.40626,19.802152 28.87853,18.911256 43.83272,26.459905 11.82989,11.386765 31.17305,17.630966 36.42803,33.950779 2.76543,19.624152 -17.99639,27.262955 -31.52942,35.447526 -20.56062,12.50938 -15.67798,41.22927 -31.85977,56.80308 -24.38514,18.96463 -57.192913,8.68832 -83.266997,-0.73605 C 52.576398,152.8614 28.041486,160.65945 11.190678,145.71557 -10.095375,129.9042 5.6556381,104.78632 23.486247,94.500663 41.288608,78.919071 45.241114,53.068768 63.439939,37.518779 81.853911,28.422426 88.100324,1.9971094 110.1991,-0.04794856 120.29646,0.14465668 131.88206,1.3566358 138.53,10.01 Z;m 72,0.6 c 14.992071,11.950867 27.356734,30.835777 49.0539,29.052927 22.54799,4.831198 11.23093,26.179505 10.66804,40.712681 1.29041,14.474071 22.7749,29.284722 9.00205,42.809722 -13.17549,7.38011 -25.84477,-13.04589 -39.91957,-2.56419 -15.021143,8.78534 -32.001234,23.92033 -50.515361,15.66927 C 35.997216,113.15938 16.127851,106.79857 2.1855691,94.383884 -1.9388697,76.898501 4.7466217,58.441952 0.18438048,40.73882 5.806309,19.339462 29.633649,12.251672 47.490222,3.9936009 55.293323,1.1777068 63.69706,-0.47426763 72,0.6 Z;m 92,3.55 c 13.35095,8.210786 30.00977,12.329972 45.29538,7.505902 14.45246,-1.6753573 32.50637,7.379137 33.3896,23.277674 -1.16698,9.619667 0.66069,19.077557 3.44222,28.233278 2.93882,9.916384 -2.53869,19.612559 -10.66892,25.090369 -8.67744,6.76962 -19.58996,11.562362 -25.09186,21.625407 C 122.19669,126.15279 96.416289,137.714 73.363004,129.22379 55.525476,120.88068 36.083637,114.55994 21.716964,100.47179 9.4202131,92.882312 -3.2620408,80.742356 -0.20756142,64.830795 2.5853742,21.920143 51.014336,-12.142371 92,3.55 Z;m 88,2.74 c 14.89109,15.864469 2.110781,42.020731 18.2397,57.227029 14.57912,9.438869 32.69928,18.10007 37.81781,36.219188 2.33267,12.551883 -4.98332,24.138463 -6.42804,36.406793 -5.71592,28.56302 -10.66403,58.58523 -28.18426,82.73461 C 98.325691,232.46357 84.01503,250.5467 63.256996,255.54156 49.213713,255.38464 40.958093,241.00245 40.126977,228.3937 37.959362,214.06608 35.463141,199.2234 26.80698,187.16906 15.184733,168.07566 -0.3727357,148.86285 0.4410242,125.2403 -0.82700464,113.95211 0.519549,101.14315 10.224845,93.729596 20.701913,83.99428 34.545443,79.406559 46.583369,72.066911 53.792512,51.74081 50.415478,26.382572 67.670781,10.611651 73.195023,5.947624 80.084933,-1.5559468 88,2.74 Z;m 70,4.85 c 42.89941,11.006942 88.6401,43.28005 90.08216,91.521071 4.22874,32.066519 -25.2289,52.095309 -32.77045,79.371239 3.64366,27.24689 -21.21346,30.54811 -41.778085,30.6541 -21.372431,4.1684 -46.503427,26.35806 -65.567673,4.77976 C 3.3962995,181.86073 43.409531,166.1283 54.968858,144.61803 66.594281,121.17951 24.886107,110.63839 36.541486,85.749591 36.788718,57.106427 1.9022922,43.643872 0.13121547,16.51475 11.628065,-9.165748 48.972608,0.09541228 70,4.85 Z;m 96,7.07 c 22.21936,-1.2748503 43.42137,10.625131 53.9089,30.272432 8.69197,19.332889 29.14037,36.901754 25.83445,59.413289 -7.95029,18.940209 -35.1644,24.545899 -28.70496,50.351999 -1.28406,21.10408 -27.33498,25.04775 -44.12503,26.41517 C 70.449544,167.8654 53.977736,135.08707 36.549008,110.65576 24.184423,92.2867 -4.119229,80.15006 -0.04494536,54.336438 2.2215288,30.459903 28.930966,27.401092 43.204026,13.183848 57.854593,-1.7401486 77.888088,-2.5989637 96,7.07 Z;m 22.83,10.14 c 36.381764,-7.5182231 75.332367,38.705706 106.91598,1.085856 31.19487,-26.154371 64.93771,4.569675 55.83452,40.417752 1.71024,59.468512 22.98507,123.885752 -7.35227,179.631272 -25.41621,20.31663 -58.99436,-0.0606 -86.820718,-3.84368 C 51.742324,218.90308 20.026502,183.63753 28.77643,141.9493 30.362924,107.69434 -3.8628827,84.245955 1.6335787,49.436507 3.2882936,34.68249 8.8431709,17.52641 22.83,10.14 Z;m 73.35,7.1 c 0.742924,12.833017 9.807449,30.172841 25.048008,26.528143 12.599832,-3.585974 26.310422,0.221493 34.295202,10.888176 7.73658,9.139649 12.54536,20.89596 23.4449,27.005137 11.57532,7.821056 24.58954,16.721939 27.19873,31.558114 5.2342,14.71903 7.51038,37.09103 -9.77698,44.67607 -13.80015,7.13307 -29.14257,-1.25293 -43.31614,3.72193 -15.15132,5.75741 -29.03507,-4.44612 -42.634543,-9.54349 -12.876028,-7.03738 -23.708035,3.30735 -33.940389,9.99189 -10.952691,7.628 -28.068654,3.85643 -32.543364,-9.34957 C 17.241811,131.38836 19.162764,117.59989 9.6636371,108.86755 0.15964236,94.112038 1.7097107,75.919244 1.8103437,59.24479 -0.3116275,44.692966 -3.0568617,24.567133 12.428846,16.257076 26.141799,8.6801814 39.824977,-3.1474859 56.644493,-0.08206564 62.578526,1.0293171 69.0122,2.5858262 73.35,7.1 Z;m 102,0.21 c 23.61326,-4.7742217 51.16121,11.73593 53.54307,36.69987 21.13119,18.005513 53.25206,4.662235 74.55944,23.311004 22.65735,16.804037 21.00815,47.485046 21.62736,72.671856 0.43306,30.01726 26.25312,58.22 12.89012,88.29914 -18.75656,25.83353 -53.60122,25.96862 -81.62681,34.04374 C 135.5408,265.27781 81.577228,270.66209 38.232192,244.33067 6.9293937,226.26954 -10.189513,184.12625 6.784637,150.71849 17.122164,118.96541 34.809642,84.588051 21.694586,50.963708 14.927939,28.153412 35.951375,8.3332141 57.118388,5.0589238 71.860142,2.3204637 86.957794,-0.28888751 102,0.21 Z;m 89.32,24.66 c 7.9625,5.588282 18.11069,11.432752 19.47608,22.040464 0.0713,11.380458 -5.26314,22.564982 -12.989602,30.768455 -7.782536,8.131695 -21.20007,14.120957 -31.758821,7.709676 C 57.730916,81.320978 51.834067,76.247376 44.226347,75.243966 32.970122,71.801274 22.789116,63.602609 18.590866,52.405008 13.675682,45.204443 1.8028657,40.50528 4.1280348,30.087205 6.0641439,21.282435 15.670301,17.787489 23.781595,18.047675 32.363214,18.899333 39.762362,14.27495 47.323866,11.057853 54.036138,10.011348 60.080345,6.7869695 66.94239,6.5239514 73.827745,6.2832858 79.992573,10.600531 83.027632,16.625433 84.923397,19.450903 86.872053,22.276379 89.32,24.66 Z".split(";"),
DEBRISCLOUD="M 304.95954,64.376304 C 277.49277,82.276003 241.66827,69.454477 211.41731,79.85341 182.94785,87.482512 151.97474,94.154867 123.11879,83.943747 95.48938,75.99336 66.651738,70.398968 37.484081,73.398842 18.970572,78.061107 -14.137683,61.027612 8.1795392,44.831273 35.781402,29.89724 66.869667,20.316467 97.592631,11.657888 162.57714,-6.6090419 236.65056,-0.9763699 294.31725,32.566319 c 15.15677,5.196271 26.61381,20.160102 10.64229,31.809985 z;m 342.60305,45.386961 c -7.29191,22.348261 -9.66643,46.973239 -30.70022,65.744569 -9.56291,8.46772 -25.11789,12.92218 -40.59786,11.98244 C 220.12739,123.1282 171.21545,103.90824 119.65346,111.45169 79.932518,115.72011 39.481042,104.62899 9.8413502,86.727358 -3.629765,72.850491 5.3001906,54.56609 20.913419,43.453167 39.272225,29.821382 66.622062,19.233063 94.387958,22.827131 144.87655,25.920022 198.72655,22.705697 242.49463,3.6247875 c 38.9784,-6.1384604 84.97751,7.9784805 98.78833,34.5910935 0.92712,2.352947 1.12743,4.748359 1.32009,7.17108 z M 98.348381,22.576575 l 0.55403,-0.173574 -0.55403,0.173574 z m 24.424669,1.147571 0.55403,-0.173574 -0.55403,0.173574 z m 28.00812,0.08717 0.55403,-0.173574 -0.55403,0.173574 z m 22.30992,-1.125739 0.55404,-0.173574 -0.55404,0.173574 z m 2.17138,-0.213036 0.55402,-0.173574 -0.55402,0.173574 z m 0.62445,-0.238469 0.55403,-0.173575 -0.55403,0.173575 z m 1.54695,0.02544 0.55403,-0.173574 -0.55403,0.173574 z m 14.92991,-3.236843 0.55404,-0.173569 -0.55404,0.173569 z m 6.37929,-1.511898 0.55401,-0.173565 -0.55401,0.173565 z M 237.86298,5.344172 238.417,5.1706024 237.86298,5.344172 Z;M 8.6920869,121.16887 C -4.1927589,98.966912 0.90898033,72.55157 8.7041909,49.662049 14.372638,35.476035 16.326584,18.502785 30.338869,8.681508 45.825701,-3.4131758 72.656091,-5.7614358 86.844372,9.2566296 97.590533,22.345836 117.873,25.584085 134.01661,19.956304 c 11.08514,-3.247312 20.45186,-9.79416 30.54262,-14.8525666 14.11297,-5.1505053 26.8782,7.2472106 29.23156,19.2600866 4.21484,11.498886 -1.06379,24.192355 6.41451,34.874819 7.62632,15.290163 20.05159,31.543452 14.34819,49.165577 -3.03505,13.5232 -12.4538,26.30757 -27.13751,30.91577 -13.91592,5.06137 -29.79779,3.4131 -43.10475,-2.40379 -17.36813,-4.34952 -33.14526,6.4165 -46.726747,14.86036 -14.840207,9.32885 -35.077152,16.24822 -52.087702,7.44298 -16.955592,-7.9194 -28.150179,-23.00607 -36.8043201,-38.05067 z;m 91.923226,127.78997 c 5.513731,11.3981 10.972854,25.51358 4.351499,37.62239 -7.54852,11.28418 -25.767729,9.59278 -33.334473,-0.81802 C 55.622193,157.05053 54.513378,146.07813 49.726705,137.18449 41.653771,125.15429 24.823594,120.63855 20.32487,105.94528 19.390228,97.039845 28.352819,92.306256 34.653598,88.093208 45.592211,81.790657 47.006891,67.243399 43.146197,56.335555 40.153404,45.98415 32.61561,38.046886 25.958609,29.920187 21.014609,18.807726 32.47462,6.8789866 43.555566,7.023595 52.328844,7.0126986 62.046398,10.741411 69.897324,4.9841051 78.99616,-0.10794813 86.373887,-10.091033 97.644393,-9.976946 c 13.469977,1.6211714 21.001927,14.9780158 24.779587,26.68591 4.09484,12.671839 4.09866,26.180141 7.02758,39.110388 1.46634,10.045348 -1.9205,22.178303 -12.13367,26.284736 -14.87769,7.426397 -27.334214,22.427262 -27.509921,39.622562 0.182575,2.25508 -0.171998,4.82307 2.115257,6.06332 z m -4.240826,-5.7236 c -2.796123,0.46537 0.642581,1.50828 0.72337,0.29222 l -0.72337,-0.29222 z;m 53.39,17 c 8.857468,18.680274 35.638969,29.655166 53.26768,16.552682 9.4851,-13.02633 29.26144,-21.688691 42.23907,-8.10085 13.3583,12.578881 11.1836,35.187026 -1.51894,47.443912 -9.14919,9.666576 -13.28816,23.915425 -6.58545,36.100486 5.44133,14.24364 14.35173,28.50153 11.97365,44.38173 5.07893,15.66617 -15.68191,32.3177 -29.44475,22.33028 C 110.6022,169.06652 93.829496,166.42587 87.217235,151.92188 78.379044,137.89166 83.963593,119.73027 74.402737,106.12243 65.827752,92.01835 48.203264,82.689295 31.783423,87.523944 18.33036,88.28596 11.389874,73.121866 13.520578,61.502437 15.481591,47.172531 -2.1632982,36.550726 4.0544615,21.982665 9.0812944,2.1611127 40.629477,-6.3421749 51.54838,12.953159 52.291692,14.237963 52.912978,15.594107 53.39,17 Z;m 53,28.01 c 17.264267,-0.215909 32.661816,-13.369626 50.21866,-9.082602 7.22749,2.514502 14.01831,10.390153 22.24021,5.672311 11.30763,-5.596745 17.32705,-20.2041726 30.88327,-21.3792418 11.63112,0.9015139 18.09339,12.3581728 24.16953,20.9111348 8.18578,10.112096 3.95736,25.007478 -5.15698,32.980017 -6.99113,8.003235 -17.51071,9.445625 -26.92735,12.360189 -14.16502,8.412284 -13.3072,30.629892 -29.93155,36.224342 -14.8311,-2.26076 -20.970578,-21.014783 -36.475878,-21.444488 -17.53188,0.713857 -29.193332,17.645528 -32.013793,33.593988 -1.961796,8.81551 0.354193,19.03046 -6.246545,26.36422 -5.430599,7.83687 -17.165422,10.68299 -24.881498,4.42654 C 4.9530851,138.95257 4.5896229,118.11427 12.893511,104.63532 19.137393,89.506979 26.037539,72.290072 19.933499,55.997969 17.518418,48.114476 9.4615578,44.674169 5.3905151,37.988065 -0.63100116,29.32318 -1.2186853,14.692506 9.3842495,9.2505971 18.552531,3.804272 28.646946,10.231493 35.097662,16.846668 40.328121,21.512442 45.748065,26.928689 53,28.01 Z;m 168.96,92 c -18.50703,19.38046 -3.01703,54.1903 23.95617,52.99453 19.19731,4.43402 27.75181,29.62521 13.24594,43.78213 -13.678,13.91986 -28.60684,33.36373 -50.94777,25.56722 C 132.89847,209.53592 117.2191,188.40609 92.738599,190.39623 73.511926,192.25447 46.474831,188.69238 45.221174,164.12611 47.858658,139.29003 19.45257,136.80785 5.4202307,126.69731 -4.7122326,101.49779 26.120786,90.455869 44.41309,85.144865 71.708322,72.249234 58.921776,45.204494 56.456307,23.773578 65.305726,5.2763567 90.435503,10.848472 106.49066,2.9345145 133.66834,-7.4060996 133.72447,31.035544 147.59229,43.624972 161.10873,55.504323 178.34631,72.281842 168.96,92 Z;m 183.99,21 c -5.56101,14.774238 -10.2477,33.563429 0.63641,47.120851 9.17136,8.95922 24.20153,3.674604 33.84782,12.312651 17.7844,11.961888 26.62799,33.887568 27.46098,54.728648 -0.88728,13.54567 -15.82829,20.54396 -28.00934,18.62906 -12.52223,-0.58085 -23.82537,-6.85871 -33.46056,-14.40887 -23.36253,-12.84254 -51.25219,-5.20342 -74.25967,4.51817 -14.904768,6.77899 -30.771017,14.6877 -47.650424,11.46214 C 50.281769,153.28514 41.539746,142.6497 29.150367,140.78095 18.214439,137.6825 4.4568112,135.09631 -0.33046599,123.26948 -2.0525657,107.0685 14.467061,96.197332 28.643924,93.886155 c 19.97782,-4.24195 40.661561,2.422228 60.514619,-2.233597 20.492967,-8.00363 29.015007,-30.475583 35.045477,-49.885401 2.45271,-13.03661 8.61197,-25.547868 19.48849,-33.5363126 9.51432,-8.26542468 25.89966,-12.0039348 35.33904,-1.6198311 C 182.64496,10.400522 184.68305,15.755864 183.99,21 Z;m 167,10.03 c 8.61332,11.733364 24.83887,11.186348 37.52164,7.864768 11.43633,-2.298219 24.04442,-5.736899 35.00002,0.08332 12.67268,14.243207 4.59387,35.94259 -7.70045,47.589028 -7.26252,9.015314 -19.05552,9.440288 -28.61213,14.415579 -15.38504,7.593175 -28.19142,23.270189 -46.67795,22.424269 -12.57735,-0.37299 -21.05597,-12.961046 -33.9889,-11.75122 -19.17926,-0.06631 -35.334555,22.20865 -26.387033,40.00049 4.126283,9.2659 17.003503,15.67229 13.998643,27.27996 -6.45663,11.01615 -21.675732,10.64774 -32.92803,11.22868 -10.935349,-0.9392 -16.018548,16.25838 -29.314738,13.65383 -21.53893,0.66305 -36.824707,-22.96858 -31.944453,-42.86518 2.364129,-13.52708 12.077562,-28.58683 3.573383,-41.761378 C 12.106522,91.199521 3.1288265,85.121422 1.7167286,73.903193 -4.6401612,48.365802 12.28966,16.672837 39.900312,13.991916 49.325716,12.840211 57.436875,19.235805 66.624607,20.478449 87.461898,25.968426 111.74653,22.670227 127.35394,6.7895446 138.74069,-3.5031337 156.70439,-0.14037568 167,10.03 Z;M 45.017141,207.88249 C 40.489055,195.9527 25.827599,206.13858 21.94712,198.49629 19.632225,187.57903 12.847701,179.62497 6.1210952,172.45416 -2.1013702,162.80832 0.58802524,147.44145 5.4357312,136.54149 10.206078,124.65819 7.3245454,111.15212 7.3158644,98.512143 6.4050751,86.653353 5.8944066,74.363257 2.9866746,63.025517 -3.0945957,50.158376 4.6572881,34.454161 14.459331,28.196862 23.163632,22.64584 33.648155,21.461042 41.110104,13.073868 47.272935,5.5331831 57.13929,-4.6636044 64.819173,6.2087031 c 8.451474,6.9186479 19.730211,8.0459719 26.251344,18.4169699 5.623554,7.368098 10.589753,16.766842 19.405613,18.641368 8.45283,2.011794 11.72519,12.513564 17.96635,18.41878 4.74183,5.325133 10.27373,9.616207 15.91481,13.264365 1.40106,5.623733 0.31403,11.884034 0.65112,17.787681 0,16.944073 0,33.888153 0,50.832233 -10.60566,6.85851 -22.89864,11.25864 -30.94326,22.71309 -3.05232,11.23343 -8.47523,22.82921 -19.248128,23.52228 -13.193897,6.68059 -23.291218,20.29593 -36.864647,25.89708 -5.13592,0.53934 -9.196334,-4.2949 -12.935234,-7.82006 z".split(";");
function loadrock(b,e){var f,l,m=[],h;id=0;if("undefined"==typeof TEAMS[1].rocks||-1==TEAMS[1].rocks[2])TEAMS[1].rocks=[0,1,2];if("undefined"==typeof TEAMS[2].rocks||-1==TEAMS[2].rocks[2])TEAMS[2].rocks=[3,4,5];if(""!=e)for(l=e.split(";"),f=0;6>f;f++)h=l[f].split(","),m[f]=[parseInt(h[0],10),parseInt(h[1],10),parseInt(h[2],10)],4==h.length&&(3>f?TEAMS[1].rocks[f]=parseInt(h[3],10):TEAMS[2].rocks[f-3]=parseInt(h[3],10));else for(f=0;6>f;f++){do for(h=!0,m[f]=[400*Math.random()+200,400*Math.random()+
200,45*Math.random()],l=0;l<f;l++){var q=m[f][0]-m[l][0]+PX[f]-PX[l],t=m[f][0]-m[l][0]+PY[f]-PY[l];if(15E3>q*q+t*t){h=!1;break}}while(!h)}for(f=0;3>f;f++)OBSTACLES[f]=new Rock(TEAMS[1].rocks[f],m[f],1,f),OBSTACLES[f+3]=new Rock(TEAMS[2].rocks[f],m[f+3],2,f)}function saverock(){if(0==OBSTACLES.length)return"";for(var b=OBSTACLES[0].toASCII(),e=1;6>e;e++)b+=";"+OBSTACLES[e].toASCII();return b}
var Rock=function(b,e,f,l){this.o=[];this.type=b>=MAXROCKS?DEBRIS:ROCK;this.id=b;this.name=(b>=MAXROCKS?"Debris #":"Asteroid #")+(3*(f-1)+l);this.arraypts=[];this.dragged=!1;this.tx=e[0];this.ty=e[1];this.team=f;this.alpha=e[2];this.moving=MOVING_ASTER;PATTERN=s.image(b>=MAXROCKS?DEBRISIMG:ROCKIMG,0,0,256,256).pattern(0,0,256,256);l=b>=MAXROCKS?DEBRISCLOUD:ROCKS;this.inside=s.path(l[b%MAXROCKS]).attr({fill:PATTERN,strokeWidth:0,stroke:"#888","class":"ASTEROID"+f});this.outline=s.path(l[b%MAXROCKS]).attr({fill:"rgba(0,0,0,0)",
strokeWidth:2,stroke:"#888"});this.g=s.group(this.inside,this.outline);for(f=0;f<this.outline.getTotalLength();f+=5)this.arraypts.push(this.outline.getPointAtLength(f));0==REPLAY.length&&this.addDrag();this.path="";this.outlinepts=[];this.g.hover(function(){this.outline.attr({strokeWidth:6,stroke:"#F00"})}.bind(this),function(){this.outline.attr({strokeWidth:2,stroke:"#888"})}.bind(this));this.g.addClass("unit");l=this.g.getBBox();this.o=[];var m=.27;b>=MAXROCKS&&(m=.4);b%=MAXROCKS;for(f=1;4>f;f++)this.o[f]=
s.ellipse(l.x+l.width/2,l.y+l.height/2,200/m/2*f+l.width/2,200/m/2*f+l.height/2).attr({pointerEvents:"none",display:"none",fill:WHITE,opacity:.3,strokeWidth:2});this.m=(new Snap.Matrix).translate(e[0],e[1]).rotate(e[2],0,0).scale(m,m);this.getOutlineString();this.g.transform(this.m);this.g.appendTo(VIEWPORT);this.show()};Rock.prototype.addDrag=function(){this.g.drag(this.dragmove.bind(this),this.dragstart.bind(this),this.dragstop.bind(this))};Rock.prototype.unDrag=function(){this.g.undrag()};
Rock.prototype.getBall=function(){var b=this.g.getBBox();return{x:b.x+b.width/2,y:b.y+b.height/2,diam:Math.max(b.width/2,b.height/2)}};Rock.prototype.toASCII=function(){return Math.floor(this.tx)+","+Math.floor(this.ty)+","+Math.floor(this.alpha)+","+this.id};Rock.prototype.getrangeallunits=function(){return Unit.prototype.getrangeallunits.call(this)};Rock.prototype.getrange=function(b){return Unit.prototype.getrange.call(this,b)};Rock.prototype.gethitrangeallunits=function(){return[[],[],[],[]]};
Rock.prototype.togglehitsector=function(){};Rock.prototype.togglerange=function(){};Rock.prototype.getOutlinePoints=function(){var b;this.outlinepts=[];for(b=0;b<this.arraypts.length;b+=5)this.outlinepts.push(transformPoint(this.m,{x:this.arraypts[b].x,y:this.arraypts[b].y}));return this.outlinepts};Rock.prototype.getBox=function(){};Rock.prototype.getOutline=function(){var b=s.path(this.path);b.appendTo(s);return b};
Rock.prototype.getOutlineString=function(){var b;this.getOutlinePoints();this.path="M ";for(b=0;b<this.outlinepts.length;b++){var e=this.outlinepts[b];this.path+=e.x+" "+e.y+" ";0==b&&(this.path+="L ")}this.path+="Z";return{s:this.path,p:this.outlinepts}};Rock.prototype.turn=function(b){this.m.add(MR(b,0,0));this.alpha+=b;this.show()};Rock.prototype.unselect=function(){};Rock.prototype.select=function(){if(phase==SETUP_PHASE){var b=activeunit;activeunit=this;b.unselect();this.showpanel()}};
Rock.prototype.showpanel=function(){Unit.prototype.showpanel.call(this);$("#positiondial button").show()};Rock.prototype.dragmove=function(b,e,f,l){Unit.prototype.dragmove.call(this,b,e,f,l)};Rock.prototype.dragstart=function(b,e,f){activeunit.unselect();activeunit=this;Unit.prototype.dragstart.call(this,b,e,f);Unit.prototype.showpanel.call(this);$("#positiondial button").show();this.dragshow()};
Rock.prototype.dragshow=function(){for(var b=1;4>b;b++)this.o[b].transform(this.dragMatrix).attr({display:"block"}).appendTo(VIEWPORT);this.g.transform(this.dragMatrix);this.g.appendTo(VIEWPORT)};Rock.prototype.showhitsector=function(){};Rock.prototype.dragstop=function(b){for(var e=1;4>e;e++)this.o[e].attr({display:"none"});Unit.prototype.dragstop.call(this,b)};
Rock.prototype.endphase=function(){if(this.moving){var b=P.F4.path,e=b.getTotalLength(),f=this.m,l;Snap.animate(0,e,function(e){l=Unit.prototype.getmatrixwithmove(f,b,e);this.g.transform(l)}.bind(this),TIMEANIM*e/200,mina.linear,function(){this.m=Unit.prototype.getmatrixwithmove(f,b,e);this.g.transform(this.m)}.bind(this))}};Rock.prototype.show=function(){this.g.transform(this.m)};Rock.prototype.setclickhandler=function(b){this.g.unmousedown();this.g.mousedown(b)};
Rock.prototype.setdefaultclickhandler=function(){this.g.unmousedown();this.g.mousedown(function(){this.select()}.bind(this))};
Rock.prototype.selectrocks=function(){$(".aster").empty();var b=Snap(".aster"),e=[],f=TEAMS[this.team].rocks,l=b.g(),m=0;$(".aster").height();$(".aster").width();for(var h=.27,q=0,t=0,w=this,y=f.indexOf(this.id),v=[this.tx,this.ty,this.alpha],z=b.image(DEBRISIMG,0,0,256,256).pattern(0,0,256,256),B=b.image(ROCKIMG,0,0,256,256).pattern(0,0,256,256),E=OBSTACLES.indexOf(this),D=0;D<ROCKS.length+DEBRISCLOUD.length;D++){D<ROCKS.length?(h=.27,e[m]=b.path(ROCKS[D]).attr({strokeWidth:3}),e[m].attr({fill:B,
stroke:"#a00",id:"aster"+D,idk:m}).click(function(){var b=parseInt(this.attr("id").match(/\d+/)[0],10);f[y]=b;OBSTACLES[E].g.remove();OBSTACLES[E]=new Rock(b,v,w.team,y);console.log("change for rock "+this.attr("id")+" "+v[0]+" "+v[1]+" "+v[2]);activeunit=OBSTACLES[E];window.location="#"}).hover(function(){e[parseInt(this.attr("idk"),10)].attr({fill:"#a00"})},function(){e[parseInt(this.attr("idk"),10)].attr({fill:B})})):(h=.4,e[m]=b.path(DEBRISCLOUD[D-ROCKS.length]).attr({strokeWidth:3}),e[m].attr({fill:z,
stroke:"#a00",id:"deb"+(D-ROCKS.length),idk:m}).click(function(){var b=parseInt(this.attr("id").match(/\d+/)[0],10)+MAXROCKS;f[y]=b;OBSTACLES[E].g.remove();OBSTACLES[E]=new Rock(b,v,w.team,y);console.log("change for debris "+this.attr("id")+" "+D);activeunit=OBSTACLES[E];window.location="#"}).hover(function(){e[parseInt(this.attr("idk"),10)].attr({fill:"#a00"})},function(){e[parseInt(this.attr("idk"),10)].attr({fill:z})}));var K=0,J=0;if(13==m||12==m)K=45,J=-40;h=MT(80*t+10,10+J+80*q).rotate(K,0,
0).scale(h,h);e[m].transform(h);e[m].appendTo(l);m++;t+=1;5<t&&(t=0,q+=1)}};var V1="v1",V2="v2",CURRENT_DECK=V2;function Critical(b,e){this.lethal=!1;$.extend(this,CRITICAL_DECK[e]);this.no=this.name+e;b.criticals.push(this);this.isactive=!1;this.unit=b}
Critical.prototype={toString:function(){var b;if(!this.isactive)return"";var e=this.name;"undefined"!=typeof CRIT_translation[this.name].name&&(e=CRIT_translation[this.name].name);b="<td class='tdstat'>"+e+"</td>";e="";"undefined"!=typeof CRIT_translation[this.name].text&&(e=formatstring(CRIT_translation[this.name].text));d="<td class='tooltip outoverflow'>"+e+"</td>";return 1==this.unit.team?"<tr >"+b+"<td><code class='Criticalupg upgrades'></code></td>"+d+"</tr>":"<tr ><td><code class='Criticalupg upgrades'></code></td>"+
b+d+"</tr>"},log:function(){this.unit.log("Critical: %0",this.name);var b;"undefined"!=typeof CRIT_translation[this.name].text?(b=formatstring(CRIT_translation[this.name].text),log("<ul><li>"+b+"</li></ul>")):log("no translation:"+this.name)}};
var CRITICAL_DECK=[{type:"ship",count:2,init:2,name:"Structural Damage",version:[V2],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getagility",this,function(b){return 0<b?b-1:b})},facedown:function(){this.isactive&&(this.unit.getagility.unwrap(this),this.unit.log("%0 repaired",this.name),this.unit.showstats());this.isactive=!1},action:function(b){var e=this.unit.rollattackdie(1,this,"hit")[0];"hit"==e||"critical"==e?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Structural Damage (original)",version:[V1],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getagility",this,function(b){return 0<b?b-1:b})},facedown:function(){this.isactive&&(this.unit.getagility.unwrap(this),this.unit.log("%0 repaired",this.name),this.unit.showstats());this.isactive=!1},action:function(b){"hit"==this.unit.rollattackdie(1,this,"hit")[0]?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",name:"Damaged Engine",version:[V1,V2],count:2,init:2,faceup:function(){this.log();this.isactive=!0;var b=[];this.unit.wrap_after("getdial",this,function(e){if(0==b.length)for(var f=0;f<e.length;f++)b[f]={move:e[f].move,difficulty:e[f].difficulty},e[f].move.match(/TL\d|TR\d/)&&(b[f].difficulty="RED");return b})},facedown:function(){this.isactive&&this.unit.getdial.unwrap(this);this.isactive=!1}},{type:"ship",name:"Console Fire",count:2,init:2,version:[V1,
V2],lethal:!0,faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("begincombatphase",this,function(){"hit"==this.rollattackdie(1,b,"blank")[0]&&(this.log("+1 %HIT% [%0]",this.name),this.resolvehit(1),this.checkdead())})},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")},facedown:function(){this.isactive&&(this.unit.log("%0 repaired",this.name),this.unit.begincombatphase.unwrap(this));this.isactive=!1}},{type:"ship",count:2,name:"Weapon Malfunction",version:[V1],
faceup:function(){this.log();this.isactive=!0;for(var b=0;b<this.unit.weapons.length&&!this.unit.weapons[b].isprimary;b++);this.w=b;this.unit.weapons[b].wrap_after("getattack",this,function(b){return 0<b?b-1:b})},facedown:function(){this.isactive&&(this.unit.weapons[this.w].getattack.unwrap(this),this.unit.log("%0 repaired",this.unit.weapons[this.w].name),this.isactive=!1)},action:function(b){var e=this.unit.rollattackdie(1,this,"hit")[0];"critical"==e||"hit"==e?this.facedown():this.unit.log("%0 not repaired",
this.name);this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Damaged Sensor Array (original)",version:[V1],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getactionbarlist",this,function(){return[]})},facedown:function(){this.isactive&&(this.unit.getactionbarlist.unwrap(this),this.unit.log("%0 repaired",this.name),this.isactive=!1)},action:function(b){"hit"==this.unit.rollattackdie(1,this,"hit")[0]?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{type:"ship",count:2,init:2,name:"Damaged Sensor Array",version:[V2],faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("getactionbarlist",this,function(){return[]})},facedown:function(){this.isactive&&(this.unit.getactionbarlist.unwrap(this),this.unit.log("%0 repaired",this.name),this.isactive=!1)},action:function(b){var e=this.unit.rollattackdie(1,this,"hit")[0];"hit"==e||"critical"==e?this.facedown():this.unit.log("%0 not repaired",this.name);
this.unit.endaction(b,"CRITICAL")}},{name:"Minor Explosion",count:2,init:2,type:"ship",lethal:!0,version:[V1],faceup:function(){this.log();var b=this.unit.rollattackdie(1,this,"blank")[0];this.isactive=!1;"hit"==b&&this.unit.removehull(1)},facedown:function(){this.isactive=!1}},{name:"Thrust Control Fire",count:2,init:2,version:[V1,V2],type:"ship",faceup:function(){this.log();this.unit.addstress();this.isactive=!1},facedown:function(){this.isactive=!1}},{name:"Direct Hit!",count:7,init:2,version:[V1,
V2],type:"ship",lethal:!0,faceup:function(){this.log();this.unit.removehull(1)},facedown:function(){this.isactive=!1;this.unit.hull++}},{name:"Munitions Failure",count:2,init:2,type:"ship",version:[V1],lethal:!0,faceup:function(){this.log();var b=[];for(i=0;i<this.unit.weapons.length;i++)this.unit.weapons[i].issecondary&&b.push(this.unit.weapons[i]);this.isactive=!1;if(0!=b.length){var e=this.unit.rand(b.length);this.wp=b[e];this.wp.isactive=!1;this.unit.log(this.wp.name+" not functioning anymore");
this.unit.show()}},facedown:function(){this.isactive=!1}},{name:"Minor Hull Breach",count:2,init:2,type:"ship",lethal:!0,version:[V1],faceup:function(){var b=this;this.log();this.isactive=!0;this.hd=this.unit.handledifficulty;this.unit.wrap_after("handledifficulty",this,function(e){"hit"==this.rollattackdie(1,b,"blank")[0]&&"RED"==e&&(this.log("+1 %HIT% [%0]",b.name),this.removehull(1))})},facedown:function(){this.isactive&&(this.unit.handledifficulty.unwrap(this),this.isactive=!1,this.unit.log("%0 repaired",
this.name))}},{name:"Damaged Cockpit",count:2,init:2,type:"pilot",version:[V1,V2],faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("endround",this,function(){this.wrap_after("getskill",b,function(){return 0});filltabskill();this.showstats()}.bind(this.unit))},facedown:function(){this.isactive&&(this.isactive=!1,this.unit.getskill.unwrap(this),filltabskill(),this.unit.showstats())}},{name:"Blinded Pilot",count:2,init:2,version:[V1,V2],type:"pilot",faceup:function(){var b=
this;this.log();this.isactive=!0;this.unit.wrap_after("getattackstrength",this,function(e,f,l){this.getattackstrength.unwrap(b);b.isactive=!1;return 0})},facedown:function(){this.isactive=!1}},{name:"Injured Pilot",count:2,init:2,type:"pilot",lethal:!0,version:[V1],faceup:function(){this.log();var b;this.isactive=!0;for(b=0;b<this.unit.upgrades.length;b++){var e=this.unit.upgrades[b];e.type==ELITE&&e.desactivate()}this.unit.desactivate();this.unit.show()},facedown:function(){if(this.isactive){var b;
"undefined"!=typeof this.unit.init&&this.unit.init();for(b=0;b<this.unit.upgrades.length;b++){var e=this.unit.upgrades[b];e.type==ELITE&&(e.isactive=!0,"undefined"!=typeof e.init&&e.init(this.unit))}this.unit.show()}this.isactive=!1}},{name:"Stunned Pilot",count:2,init:2,version:[V1,V2],type:"pilot",lethal:!0,faceup:function(){var b=this;this.log();this.isactive=!0;this.unit.wrap_before("resolvecollision",this,function(){this.log("+1 %HIT% [%0]",b.name);this.resolvehit(1)});this.unit.wrap_before("resolveocollision",
this,function(){this.log("+1 %HIT% [%0]",b.name);this.resolvehit(1)})},facedown:function(){this.isactive&&(this.unit.resolvecollision.unwrap(this),this.unit.resolveocollision.unwrap(this),this.unit.log("no longer stunned"));this.isactive=!1}},{name:"Loose Stabilizer",count:2,init:2,type:"ship",faceup:function(){this.log();this.isactive=!0;this.unit.wrap_after("handledifficulty",this,function(b){"WHITE"==b&&this.addstress()})},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")},facedown:function(){this.isactive&&
(this.unit.handledifficulty.unwrap(this),this.unit.log("%0 repaired",this.name));this.isactive=!1},version:[V2]},{name:"Major Explosion",count:2,init:2,type:"ship",lethal:!0,faceup:function(){this.log();"hit"==this.unit.rollattackdie(1,this,"blank")[0]&&(this.unit.log("+1 %CRIT% [%0]",this.name),this.unit.resolvecritical(1));this.isactive=!1},facedown:function(){},version:[V2]},{name:"Major Hull Breach",count:2,init:2,type:"ship",lethal:!0,version:[V2],faceup:function(){var b=round;this.log();this.isactive=
!0;this.unit.wrap_after("deal",this,function(e,f,l){if(round==b)return l;var m=$.Deferred();l.done(function(b){b.face=FACEUP;m.resolve(b)});return m.promise()})},facedown:function(){this.isactive&&this.unit.deal.unwrap(this);this.isactive=!1},action:function(b){this.facedown();this.unit.endaction(b,"CRITICAL")}},{name:"Shaken Pilot",count:2,init:2,type:"pilot",faceup:function(){this.log();this.isactive=!0;var b=[],e=this;this.unit.wrap_after("getdial",this,function(e){if(0==b.length)for(var f=0;f<
e.length;f++)e[f].move.match(/F1|F2|F3|F4|F5/)||b.push({move:e[f].move,difficulty:e[f].difficulty});return b});this.unit.wrap_after("timeformaneuver",this,function(b){b&&!this.hasionizationeffect()&&e.facedown();return b})},facedown:function(){this.isactive&&(this.isactive=!1,this.unit.getdial.unwrap(this),this.unit.timeformaneuver.unwrap(this))},version:[V2]},{name:"Weapons Failure",count:2,init:2,type:"ship",faceup:function(){for(var b in this.weapons)this.weapons[b].wrap_after("getattack",this,
function(b){return 0<b?b-1:b})},facedown:function(){for(var b in this.weapons)this.weapons[b].getattack.unwrap(this)},action:function(b){var e=this.unit.rollattackdie(1,this,"hit")[0];"hit"==e||"critical"==e?this.facedown():this.unit.log("%0 not repaired",this.name);this.unit.endaction(b,"CRITICAL")},version:[V2]}];function Condition(b,e,f){this.name=f;this.org=e;f in TEAMS[b.team].conditions&&TEAMS[b.team].conditions[f].remove();$.extend(this,CONDITIONS[f]);console.log("new condition: "+f+" to "+b.name+" from "+this.org.name);b.conditions[f]=this;TEAMS[b.team].conditions[f]=this;this.unit=b;this.isactive=!0;this.assign(b);activeunit=b;b.show();activeunit=e}
Condition.prototype={toString:function(){if(!this.isactive)return"";this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;return Mustache.render(TEMPLATES.condition,this)},remove:function(){var b=this.unit;Unit.prototype.desactivate.call(this);delete b.conditions[this.name];delete TEAMS[b.team].conditions[this.name];b.show()}};
var CONDITIONS={"I'll Show You The Dark Side":{assign:function(b){for(var e=this,f=[],l=0;l<CRITICAL_DECK.length;l++)-1<CRITICAL_DECK[l].version.indexOf(CURRENT_DECK)&&"pilot"==CRITICAL_DECK[l].type&&0<CRITICAL_DECK[l].count&&f.push(l);this.org.selectcritical(f,function(f){CRITICAL_DECK[f].count--;b.darkside=new Critical(b,f);f=CRITICAL_DECK[f].name;"undefined"!=typeof CRIT_translation[f].name&&(f=CRIT_translation[f].name);e.name+=" ["+f+"]"});b.wrap_after("deal",this,function(b,f,l){return f==FACEUP?
(b=$.Deferred(),e.remove(),b.resolve({crit:this.darkside,face:f})):l}).unwrapper("deal")}},"Suppressive Fire":{assign:function(b){var e=this;b.wrap_after("getattackstrength",this,function(b,l,m){return l.name!=e.org.name&&e.isactive&&e.unit==this?m-1:m});b.wrap_after("declareattack",this,function(b,l,m){m&&l.name==e.org.name&&e.isactive&&e.unit==this&&e.remove();return m});this.org.wrap_before("dies",this,function(){e.remove()});this.org.wrap_before("endcombatphase",this,function(){0==this.hasfired&&
e.remove()})}},"A Debt To Pay":{assign:function(b){var e=this;b.adebttopay=e;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return"undefined"!=typeof targetunit.ascoretosettle?targetunit.ascoretosettle.isactive:!1},f:function(b,l){this.log("1 %FOCUS% -> 1 %CRIT% [%0]",e.name);return b=b-FCH_FOCUS+FCH_CRIT}.bind(b),str:"elite"})}},"Fanatical Devotion":{assign:function(b){var e=this;b.wrap_before("isattackedby",this,function(){this.wrap_after("canusefocus",e,function(){return!1}).unwrapper("endbeingattacked")});
b.wrap_before("endround",this,function(){e.remove()});b.wrap_after("declareattack",this,function(b,l,m){m&&this.wrap_after("removefocustoken",e,function(){Unit.prototype.wrap_after("cancelcritical",e,function(b,e,f){return{ch:f.ch+FCH_HIT,e:f.e}}).unwrap("endbeingattacked")}).unwrap("endattack");return m}).unwrap("endattack")}}};var FAST=!1,s,BLACK="#111",GREEN="#0F0",RED="#F00",WHITE="#FFF",BLUE="#0AF",YELLOW="#FF0",GREY="#888",HALFBLACK="#222",HALFGREEN="#080",HALFRED="#800",HALFWHITE="#888",HALFBLUE="#058",HALFYELLOW="#880",HALFGREY="#444",TIMEANIM=FAST?0:1E3,FACE=["focus","hit","critical","evade","blank"],ATTACKDICE=[0,0,1,1,1,2,4,4],DEFENSEDICE=[0,0,3,3,3,4,4,4],MPOS={F0:[0,3],RL1:[0,2],RR1:[0,4],RF1:[0,3],F1:[1,3],F2:[2,3],F3:[3,3],F4:[4,3],F5:[5,3],BL1:[1,2],BL2:[2,2],BL3:[3,2],TL1:[1,1],TL2:[2,1],TL3:[3,1],BR1:[1,
4],BR2:[2,4],BR3:[3,4],TR1:[1,5],TR2:[2,5],TR3:[3,5],K1:[1,7],K2:[2,7],K3:[3,7],K4:[4,7],K5:[5,7],SL2:[2,0],SL3:[3,0],SR2:[2,6],SR3:[3,6],TRL3:[3,0],TRR3:[3,6],TRL2:[2,0],TRR2:[2,6]},REBEL="REBEL",EMPIRE="EMPIRE",SCUM="SCUM",ILLICIT="Illicit",ELITE="Elite",TURRET="Turret",MISSILE="Missile",ASTROMECH="Astromech",TORPEDO="Torpedo",CANNON="Cannon",BOMB="Bomb",TECH="Tech",CREW="Crew",SYSTEM="System",SALVAGED="Salvaged",MOD="Mod",TITLE="Title",ROCK="Rock",DEBRIS="Debris",NONE="None",CONDITION="Condition",
NOLOG=!1,generics=[],gid=0,REROLL_M=0,ADD_M=1,MOD_M=2,ATTACK_M=0,DEFENSE_M=1,ATTACKCOMPARE_M=2,FACEUP=1,FACEDOWN=2,DISCARD=0,xws_lookup=function(b){for(var e in PILOT_dict)if(PILOT_dict[e]==b)return e;return""},upg_lookup=function(b){for(var e in UPGRADE_dict)if(UPGRADE_dict[e]==b)return e;return""},activeunit,unitlist,pilotlist,squadron=[],active=0,globalid=1,targetunit,PATTERN,SOUND_DIR="ogg/",SOUND_FILES="cloak_romulan decloak_romulan EXPLODE3 KX9_laser_cannon TIE-Fire Slave1-Guns Falcon-Guns XWing-Fly1 TIE-Fly2 Slave1-Fly1 Falcon-Fly1 Falcon-Fly3 YWing-Fly2 ISD-Fly missile XWing-Fly2 DStar-Gun4 TIE-Fly6 Slave1-Fly2 ghost".split(" "),
SOUNDS={},SOUND_NAMES="cloak decloak explode xwing_fire tie_fire slave_fire falcon_fire xwing_fly tie_fly slave_fly falcon_fly yt2400_fly ywing_fly isd_fly missile xwing2_fly dstar_gun tie2_fly slave2_fly ghost".split(" ");
function loadsound(){var b,e,f={explode:2,cloak:0,decloak:1};for(b=0;b<squadron.length;b++){var l=squadron[b].ship.firesnd;f[l]=SOUND_NAMES.indexOf(l);-1==SOUND_NAMES.indexOf(l)&&console.log("cannot find fire sound for "+l+"/"+squadron[b].ship.name);l=squadron[b].ship.flysnd;f[l]=SOUND_NAMES.indexOf(l);-1==SOUND_NAMES.indexOf(l)&&console.log("cannot find sound for "+l+"/"+squadron[b].ship.name);for(e=1;e<squadron[b].weapons.length;e++)l=squadron[b].weapons[e].firesnd,f[l]=SOUND_NAMES.indexOf(l),-1==
SOUND_NAMES.indexOf(l)&&console.log("cannot find fire sound for "+l+"/"+squadron[b].weapons[e].name)}for(b in f)SOUNDS[b]=new Howl({src:[SOUND_DIR+SOUND_FILES[f[b]]+".ogg",SOUND_DIR+SOUND_FILES[f[b]]+".m4a",SOUND_DIR+SOUND_FILES[f[b]]+".wav"],autoplay:!1,loop:!1})}function transformPoint(b,e){var f=e.x*b.a+e.y*b.c+b.e;e.y=e.x*b.b+e.y*b.d+b.f;e.x=f;return e}function halftone(b){return b==GREEN?HALFGREEN:b==RED?HALFRED:b==WHITE?HALFWHITE:b==BLUE?HALFBLUE:b==YELLOW?HALFYELLOW:b==GREY?HALFGREY:b}
var MS=function(b,e){return(new Snap.Matrix).scale(b,e)},MT=function(b,e){return(new Snap.Matrix).translate(b,e)},MR=function(b,e,f){return(new Snap.Matrix).rotate(b,e,f)},C={GREEN:"#0F0",RED:"#F00",WHITE:"#FFF"},P,A={CONDITION:{key:"R",color:YELLOW},ARCROTATE:{key:"R",color:GREEN},ROLL:{key:"r",color:GREEN},SLAM:{key:"s",color:BLUE},COORDINATE:{key:"o",color:GREEN},FOCUS:{key:"f",color:GREEN},TARGET:{key:"l",color:BLUE},EVADE:{key:"e",color:GREEN},BOOST:{key:"b",color:GREEN},STRESS:{key:"?",color:RED},
CLOAK:{key:"k",color:BLUE},ISTARGETED:{key:"l",color:RED},ASTROMECH:{key:"A",color:YELLOW},CANNON:{key:"C",color:YELLOW},CREW:{key:"W",color:YELLOW},MISSILE:{key:"M",color:YELLOW},TORPEDO:{key:"P",color:YELLOW},ELITE:{key:"E",color:YELLOW},TURRET:{key:"U",color:YELLOW},UPGRADE:{key:"S",color:YELLOW},CRITICAL:{key:"c",color:RED},SALVAGED:{key:"V",color:YELLOW},BOMB:{key:"B",color:YELLOW},TITLE:{key:"t",color:YELLOW},MOD:{key:"m",color:YELLOW},SYSTEM:{key:"S",color:YELLOW},ILLICIT:{key:"I",color:YELLOW},
LASER:{key:"%",color:RED},TURRETLASER:{key:"$",color:RED},BILASER:{key:"<",color:RED},MOBILELASER:{key:"<",color:RED},LASER180:{key:">",color:RED},NOTHING:{key:"&nbsp;",color:WHITE},HIT:{key:"d",color:WHITE},SHIELD:{key:"v",color:YELLOW},TECH:{key:"X",color:WHITE}},AINDEX="ROLL FOCUS TARGET EVADE BOOST STRESS CLOAK ISTARGETED ASTRO CANNON CREW MISSILE TORPEDO ELITE TURRET UPGRADE CRITICAL NOTHING".split(" ");function repeat(b,e){for(var f="",l=0;l<e;l++)f+=b;return f}
function dist(b,e){return(b.x-e.x)*(b.x-e.x)+(b.y-e.y)*(b.y-e.y)}function changeia(b){for(var e in squadron)squadron[e].behavior=b}
function Unit(b,e){var f;this.behavior=JOUSTER;this.isdocked=this.dead=!1;this.ship={};this.id=gid;this.life=1;this.arcrotation=180;this.wrapping=[];var l=this.id;generics["u"+gid]=this;gid++;this.maxupg=[];this.exclupg=[];this.team=b;this.faction=TEAMS[b].faction;this.shipactionList=[];this.dial=[];this.ordnance=!1;this.dialselect="<table class='dial' id='dial"+l+"'></table>";this.text="<span id='text"+l+"' class='details'></span>";this.upgradesno=0;this.upgrades=[];this.criticals=[];this.conditions=
{};this.DEFENSEREROLLD=[];this.ATTACKREROLLA=[];this.ATTACKMODA=[];this.ATTACKADD=[];this.DEFENSEMODD=[];this.DEFENSEADD=[];this.tx=this.ty=this.alpha=0;if("undefined"==typeof PILOTS[e])this.error("pilot does not exists "+e);else{l=unitlist[PILOTS[e].unit];this.ship={shield:l.shield,hull:l.hull,firesnd:l.firesnd,flysnd:l.flysnd,name:PILOTS[e].unit,hastitle:l.hastitle,code:l.code};"undefined"==typeof PILOTS[e].shipimg?(f=l.faction.indexOf(this.faction),-1==f&&(f=0),this.shipimg=l.img[f]):this.shipimg=
PILOTS[e].shipimg;this.scale=l.scale;this.islarge=1==l.islarge?!0:!1;this.hull=l.hull;this.shield=l.shield;this.agility=l.evade;this.hasmobilearc="Mobilelaser"==l.weapon_type;for(f=0;f<l.dial.length;f++)this.dial[f]={move:l.dial[f].move,difficulty:l.dial[f].difficulty};this.shipactionList=l.actionList.slice(0);this.weapons=[];this.upgrades=[];this.criticals=[];this.conditions={};this.bombs=[];this.lastdrop=-1;Laser(this,l.weapon_type,l.fire);this.name=PILOTS[e].name;this.pilotid=e;this.unique=1==
PILOTS[e].unique?!0:!1;this.skill=PILOTS[e].skill;this.install="undefined"!=typeof PILOTS[e].install?PILOTS[e].install:function(){};this.uninstall="undefined"!=typeof PILOTS[e].uninstall?PILOTS[e].uninstall:function(){};l=PILOTS[e].upgrades;this.upg=[];this.upgbonus=[];for(j=0;10>j;j++)this.upg[j]=-1;this.upgradetype=[];for(k=0;k<l.length;k++)this.upgradetype[k]=l[k];this.upgradetype[k++]=MOD;unitlist[this.ship.name].hastitle&&(this.upgradetype[k++]=TITLE);this.upgradesno=k;this.points=PILOTS[e].points;
this.activeweapon=this.usedweapon=this.addedattack2=this.noattack=this.addedattack=-1;this.touching=[];this.action=this.maneuver=-1;this.actionsdone=[];this.hasdecloaked=this.hasmoved=!1;this.tractorbeam=this.focus=this.reroll=0;this.lastmaneuver=-1;this.iscloaked=!1;this.istargeted=[];this.targeting=[];this.hasfired=this.evade=this.ionized=this.stress=0;this.maxfired=1;this.criticalresolved=this.hitresolved=0;this.m=new Snap.Matrix;this.collision=!1;this.oldoverlap=-1;this.ocollision={overlap:-1,
template:[],mine:[]};this.install(this);0<=this.team&&3>this.team&&TEAMS[this.team].updatepoints();"undefined"!=typeof this.init&&this.init()}}
Unit.prototype={tosquadron:function(b){var e,f=this.upg,l=[];for(e in f)-1<f[e]&&l.push(Upgradefromid(this,f[e]));this.color="REBEL"==this.faction?RED:"EMPIRE"==this.faction?GREEN:YELLOW;e=this.shipimg;this.islarge?this.img="undefined"==typeof e?b.text(0,0,this.ship.code).transform("r -90 0 0 "+("EMPIRE"==this.faction||this.faction==SCUM?"s 2 -2":"s 2 2")+"t -15 5").attr({"class":"xwingship"}):b.image("png/"+this.shipimg+".png",-50*this.scale,-50*this.scale,100*this.scale,100*this.scale).transform("r 90 0 0"):
("undefined"!=typeof this.shipimg&&(e=this.shipimg),this.img="undefined"==typeof e?b.text(-10,10,this.ship.code).transform("r -90 0 0 "+("EMPIRE"==this.faction||this.faction==SCUM?"r -1 1":"")).attr({"class":"xwingship"}):b.image("png/"+e+".png",-20*this.scale,-20*this.scale,40*this.scale,40*this.scale).transform("r 90 0 0").attr({pointerEvents:"none"}));this.imgsmoke=b.image("png/smoke.gif",-20,-60,30,50).transform("r 180 0 0").attr({display:"none"});this.imgflame=b.image("png/out.gif",-15,-40,20,
40).transform("r 180 0 0").attr({display:"none"});f=this.islarge?40:20;this.outline=b.rect(-f,-f,2*f,2*f).attr({fill:"rgba(8,8,8,0.5)",strokeWidth:2});this.border=b.rect(-f,-f,2*f,2*f).attr({fill:"rgba(0,0,0,0)",strokeWidth:2,stroke:halftone(this.color)});this.tohitstats={};this.tohit=b.text(-f,f-30,"0").attr({"class":"tohit",strokeWidth:1});this.meanhit=b.text(-f,f-15,"0").attr({"class":"tohit",strokeWidth:1});this.meanhitsymbol=b.text(-f+40,f-15,"0").attr({"class":"symbols",strokeWidth:0,text:"d"});
this.meancrit=b.text(-f,f,"0").attr({"class":"tohit",strokeWidth:1});this.meancritsymbol=b.text(-f+40,f,"0").attr({"class":"symbols",strokeWidth:0,text:"c"});this.gproba=b.group(this.tohit,this.meanhit,this.meanhitsymbol,this.meancrit,this.meancritsymbol).attr({display:"none",fontSize:"15",stroke:"#fff",fill:"#fff",opacity:1});this.skillbar=b.text(1-f,3-f,repeat("u",this.skill)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#fa0"});this.firebar=b.text(1-f,5-f,repeat("u",this.weapons[0].attack)).transform("r -90 0 0").attr({"class":"xsymbols",
fill:"#f00"});this.evadebar=b.text(1-f,7-f,repeat("u",this.agility)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#0f0"});this.hullbar=b.text(1-f,9-f,repeat("u",this.hull)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#cc0"});this.shieldbar=b.text(1-f,9-f,repeat("u",this.shield+this.hull)).transform("r -90 0 0").attr({"class":"xsymbols",fill:"#0af"});this.gstat=b.group(this.skillbar,this.firebar,this.evadebar,this.shieldbar,this.hullbar,this.gproba).attr({pointerEvents:"none"});
this.dialspeed=b.text(2+f,3-f,"").attr({"class":"dialspeed",pointerEvents:"none"});this.dialdirection=b.text(f+8,3-f,"").attr({"class":"symbols",pointerEvents:"none"});this.actionicon=b.text(f+2,-7,"").attr({pointerEvents:"none","class":"symbols",strokeWidth:0});this.sector=b.polygon(3-f,-f,0,0,f-3,-f).attr({fill:this.color,opacity:.5,strokeWidth:0});this.ranges=[];this.sectors=[];this.infoicon=[];for(e=0;6>e;e++)this.infoicon[e]=b.text(f-7,6-f+7*e,A[AINDEX[e+2]].key).attr({pointerEvents:"none","class":"xsymbols",
fill:A[AINDEX[e+2]].color,strokeWidth:0});this.geffect=b.group(this.imgflame,this.imgsmoke).attr({pointerEvents:"none"});this.g=b.group(this.sector,this.outline,this.img,this.border,this.dialspeed,this.dialdirection,this.actionicon,this.infoicon[0],this.infoicon[1],this.infoicon[2],this.infoicon[3],this.infoicon[4],this.infoicon[5],this.gstat);VIEWPORT.add(this.g);VIEWPORT.add(this.geffect);this.g.addClass("unit");this.g.hover(function(){this.setinfo(translate(this.name))}.bind(this),function(){$(".info").hide()}.bind(this));
this.setdefaultclickhandler();this.upgrades.sort(function(b,e){var f=(b.isWeapon()?4:0)+(b.isBomb()?1:0);return(e.isWeapon()?4:0)+(e.isBomb()?1:0)-f});this.g.drag(this.dragmove.bind(this),this.dragstart.bind(this),this.dragstop.bind(this))},setinfo:function(b){var e=VIEWPORT.m.clone(),f=$("#svgout").width(),l=$("#svgout").height(),m=0,h=0;l>f?h=(l-f)/2:m=(f-l)/2;var q=Math.max(900/f,900/l),t=this.g.getBBox(),f=$("#svgout").offset();$("#playmat").width();$("#playmat").height();l=e.x(t.x,t.y-20)/q;
l+=f.left+m;e=e.y(t.x,t.y-20)/q;e+=f.top+h;return $(".info").css({left:l,top:e}).attr({pointerEvents:"none"}).html(formatstring(b)).appendTo("body").show()},wrap_after:function(b,e,f,l){var m=this,h=m[b];"undefined"==typeof m[b].save&&this!=Bomb.prototype&&this!=Unit.prototype&&this!=Weapon.prototype&&(m[b].save=m.__proto__[b]);"undefined"==typeof h&&console.log("name"+b+" undefined");var q=function(){var b=Array.prototype.slice.call(arguments),e;e=h.apply(this,b);return e=f.apply(this,b.concat([e]))};
q.save=h;q.org=e;"undefined"==typeof e.wrapping&&(e.wrapping=[]);e.wrapping.push({name:b,wrap:this});q.vanilla="undefined"!=typeof h.vanilla?h.vanilla:h;q.unwrapper=function(b){var f=m.wrap_before(b,e,function(b){q.unwrap(e);f.unwrap(e);m.show();return b})};h.next=q;q.unwrap=function(e){if(q.org==e)return q.save.next=q.next,"undefined"==typeof q.next&&(m[b]=q.save),"getskill"==b&&filltabskill(),m.show(),q.save;"function"==typeof q.save.unwrap&&(q.save=q.save.unwrap(e));m.show();return q};this[b]=
q;"getskill"==b&&filltabskill();return q},desactivate:function(){for(var b in this.wrapping){var e=this.wrapping[b];"function"==typeof e.wrap[e.name].unwrap&&e.wrap[e.name].unwrap(this)}this.isactive=!1},wrap_before:function(b,e,f,l){var m=this,h=m[b];"undefined"==typeof m[b].save&&this!=Bomb.prototype&&this!=Unit.prototype&&this!=Weapon.prototype&&(m[b].save=m.__proto__[b]);"undefined"==typeof h&&console.log("name"+b+" undefined");var q=function(){var b=Array.prototype.slice.call(arguments);f.apply(this,
b);return h.apply(this,b)};q.save=h;q.org=e;"undefined"==typeof h&&console.error("org:"+e.name+" "+b);"undefined"==typeof e.wrapping&&(e.wrapping=[]);e.wrapping.push({name:b,wrap:this});q.vanilla="undefined"!=typeof h.vanilla?h.vanilla:h;q.unwrapper=function(b){var f=m.wrap_before(b,e,function(){q.unwrap(e);f.unwrap(e);m.show()})};h.next=q;q.unwrap=function(e){if(q.org==e)return q.save.next=q.next,"undefined"==typeof q.next&&(m[b]=q.save),m.show(),q.save;"function"==typeof q.save.unwrap&&(q.save=
q.save.unwrap(e));return q};return this[b]=q},toJSON:function(){var b={};b.name=xws_lookup(this.name);b.points=PILOTS[this.pilotid].points;b.ship=xws_lookup(this.ship.name);for(var e={},f={},l=0;l<this.upg.length;l++){var m=this.upg[l];if(-1<m&&"undefined"!=typeof m){var h=UPGRADES[m];"undefined"==typeof e[upg_lookup(h.type)]&&(e[upg_lookup(h.type)]=[]);b.points+=h.points;if("undefined"!=typeof UPGRADES[m].pointsupg)for(var q=0;q<UPGRADES[m].upgrades.length;q++)f[UPGRADES[m].upgrades[q]]=UPGRADES[m].pointsupg;
e[upg_lookup(h.type)].push(upg_lookup(h.name))}}for(l=0;l<this.upg.length;l++)m=this.upg[l],-1<m&&"undefined"!=typeof m&&"undefined"!=typeof f[UPGRADES[m].type]&&(h=f[UPGRADES[m].type],b.points=0<UPGRADES[m].points+h?b.points+h:b.points-UPGRADES[m].points);this.points=b.points;b.upgrades=e;return b},toJuggler:function(b,e){var f=this.name;1==b&&(f=translate(this.name));f=f.replace(/\'/g,"");1==PILOTS[this.pilotid].ambiguous&&"undefined"!=typeof PILOTS[this.pilotid].edition&&1!=e&&(f=f+"("+PILOTS[this.pilotid].edition+
")");e&&"undefined"!=typeof this.ship.code&&(f="<span class='ship'>"+this.ship.code+"</span> <span class='"+(this.faction==REBEL?"HALFRED":this.faction==EMPIRE?"HALFGREEN":"HALFYELLOW")+"'>"+f+"</span>");for(var l=0;l<this.upg.length;l++){var m=this.upg[l];if(-1<m){var h=UPGRADES[m].name;1==b&&(h=translate(UPGRADES[m].name));f=e?f+(" <span class='"+UPGRADES[m].type+"'></span> "):f+" + ";f+=h.replace(/\(Crew\)/g,"").replace(/\'/g,"")}}return f},toASCII:function(){var b=this.pilotid,e,f;for(e=0;e<this.upg.length;e++)f=
this.upg[e],-1<f&&(b+=","+f);return b+=":"+Math.floor(this.tx)+","+Math.floor(this.ty)+","+Math.floor(this.alpha)},toKey:function(){for(var b=("00"+this.pilotid.toString(32)).slice(-2),e=[],f=0;f<this.upg.length;f++)-1<this.upg[f]&&e.push(this.upg[f]);e.sort();for(f=0;f<e.length;f++)b+=("00"+e[f].toString(32)).slice(-2);return b},setpriority:function(b){var e={FOCUS:3,EVADE:1,CLOAK:4,TARGET:2,CRITICAL:100}[b.type];"undefined"==typeof e&&(e=0);b.priority=e;e=[];"BOOST"==b.type&&(e=this.getboostmatrix(this.m));
"ROLL"==b.type&&(e=this.getrollmatrix(this.m));if(0<e.length){var f=this.m,l=this.evaluateposition(),m=l-1;for(i=0;i<e.length;i++)this.m=e[i],m=Math.max(m,this.evaluateposition());this.m=f;m>l&&(b.priority=2*(m-l))}},getstatstring:function(){var b;b=""+("<div class='xsymbols RED'>"+repeat("u",this.weapons[0].getattack())+"</div>");b+="<div class='xsymbols GREEN'>"+repeat("u",this.getagility())+"</div>";b+="<div class='xsymbols YELLOW'>"+repeat("u",this.hull)+"</div>";return b+="<div class='xsymbols BLUE'>"+
repeat("u",this.shield)+"</div>"},getupgradeaddstring:function(){for(var b="",e=0;e<this.upgradetype.length;e++)-1==this.upg[e]&&(b+="<button num="+e+" class='upgrades "+this.upgradetype[e].replace(/\|/g,"")+"'><sup class='label'>"+this.getupgradelist(this.upgradetype[e]).length+"</sup></button>");return b},showskill:function(){$("#unit"+this.id+" .statskill").html(this.getskill())},showupgradeadd:function(){$("#unit"+this.id+" .upgavail").html(this.getupgradeaddstring());addupgradeaddhandler(this)},
getagility:function(){return phase==COMBAT_PHASE?this.agility-this.tractorbeam:this.agility},getskill:function(){return this.skill},getdial:function(){return this.hasionizationeffect()?[{move:"F1",difficulty:"WHITE"}]:this.dial},doplan:function(){this.showdial();return this.deferred},getdialstring:function(){var b=[],e="";for(j=0;5>=j;j++)for(b[j]=[],k=0;7>=k;k++)b[j][k]="<td></td>";var f=this.getdial();for(j=0;j<f.length;j++)d=f[j],b[MPOS[d.move][0]][MPOS[d.move][1]]="<td class='symbols "+d.difficulty+
"' move='"+d.move+"'>"+P[d.move].key+"</td>";for(j=5;0<=j;j--){e+="<tr>";e=0<j&&5>j?e+("<td>"+j+"</td>"):e+"<td></td>";for(k=0;7>=k;k++)e+=b[j][k];e+="</tr>\n"}return e},canreveal:function(b){return"RED"!=b.difficulty||0==this.stress},showdial:function(){var b=[],e,f,l=this.getdial();if(phase==PLANNING_PHASE||phase==SELECT_PHASE){for(e=0;5>=e;e++)for(b[e]=[],f=0;7>=f;f++)b[e][f]="<td></td>";$("#select"+this.id).val();for(e=0;e<l.length;e++){f=l[e];var m=MPOS[f.move][0],h=MPOS[f.move][1];this.canreveal(f)?
(b[m][h]="<td",phase==PLANNING_PHASE&&(b[m][h]+=" onclick='activeunit.setmaneuver("+e+")'"),b[m][h]+=" class='symbols maneuver "+f.difficulty,this.maneuver==e&&(b[m][h]+=" selected"),b[m][h]+="' >"+P[f.move].key+"</td>"):b[m][h]="<td></td>"}l="";for(e=5;0<=e;e--){l+="<tr>";l=0<e&&5>e?l+("<td>"+e+"</td>"):l+"<td></td>";for(f=0;7>=f;f++)l+=b[e][f];l+="</tr>\n"}phase==SELECT_PHASE?$("#dial"+this.id).html(l):$("#maneuverdial").html(l)}phase>=PLANNING_PHASE&&(-1==this.maneuver||this.hasmoved)&&this.clearmaneuver()},
getupgradelist:function(b){for(var e=[],f=0;f<UPGRADES.length;f++){var l=UPGRADES[f];if(!("undefined"!=typeof l.faction&&null==this.faction.match(l.faction)||"undefined"!=typeof l.ship&&-1==this.ship.name.search(l.ship)||"undefined"!=typeof l.ishuge||"undefined"!=typeof l.islarge&&this.islarge!=l.islarge||"undefined"!=typeof l.skillmin&&this.getskill()<l.skillmin||"undefined"!=typeof l.agilitymax&&this.getagility()>=l.agilitymax||"undefined"!=typeof l.noupgrades&&-1<this.upgradetype.indexOf(l.noupgrades)||
"undefined"!=typeof l.actionrequired&&-1==this.shipactionList.indexOf(l.actionrequired.toUpperCase())||"undefined"!=typeof this.maxupg[l.type]&&this.maxupg[l.type]<l.points)){if("undefined"!=typeof l.requiredupg){for(var m=!0,h=0;h<l.requiredupg.length;h++)if(-1==this.upgradetype.indexOf(l.requiredupg[h])){m=!1;break}if(!m)continue}!b.match(l.type)||1==l.takesdouble&&this.upgradetype.indexOf(l.type)==this.upgradetype.lastIndexOf(l.type)||e.push(f)}}e.sort(function(b,e){return translate(UPGRADES[b].name)>
translate(UPGRADES[e].name)});return e},turn:function(b){this.alpha+=b;this.m.rotate(b,0,0);this.show()},getactionstring:function(){for(var b="",e=0;e<this.shipactionList.length;e++)b+="<span class='s"+this.shipactionList[e]+"'></span>";return b},showactionlist:function(){var b=this.getactionstring();$("#unit"+this.id+" .actionlist").html(b)},getattacktable:function(b){return ATTACK[b]},attackroll:function(b){var e,f,l,m,h=this.getattacktable(b),q=0,t=Math.random();if(0==b)return 0;for(f=0;f<=b;f++)for(l=
0;l<=b-f;l++)for(m=0;m<=b-f-l;m++)if(e=f*FCH_FOCUS+l+FCH_CRIT*m,q+=h[e],q>t)return FCH_FOCUS*f+m*FCH_CRIT+l;return 0},confirm:function(b){return confirm(b)},rollattackdie:function(b,e,f){e=[];for(f=0;f<b;f++)e.push(FACE[ATTACKDICE[this.rand(8)]]);return e},rolldefensedie:function(b,e,f){e=[];for(f=0;f<b;f++)e.push(FACE[DEFENSEDICE[this.rand(8)]]);return e},rand:function(b){return Math.floor(Math.random()*b)},getdefensetable:function(b){return DEFENSE[b]},defenseroll:function(b){var e,f,l,m=$.Deferred(),
h=this.getdefensetable(b),q=0,t=Math.random();if(0==b)return m.resolve({dice:b,roll:0}).promise();"undefined"==typeof h&&this.error("P undefined for n="+b);for(l=0;l<=b;l++)for(f=0;f<=b-l;f++)if(e=l*FE_FOCUS+f*FE_EVADE,q+=h[e],q>t)return m.resolve({dice:b,roll:FE_FOCUS*l+f*FE_EVADE}).promise();return m.resolve({dice:b,roll:0}).promise()},getdicemodifiers:function(){return[{from:ATTACK_M,type:MOD_M,to:ATTACK_M,org:this,req:function(){return this.canusefocus()}.bind(this),aiactivate:function(b,e){return 0<
FCH_focus(b)},f:function(b,e){this.removefocustoken();var f=FCH_focus(b);0<f&&(b=b-FCH_FOCUS*f+FCH_HIT*f);return b}.bind(this),str:"focus",token:!0,noreroll:"focus"},{from:ATTACK_M,type:REROLL_M,to:ATTACK_M,org:this,req:function(b,e,f){return this.canusetarget(f)}.bind(this),n:function(){return 9},dice:["blank","focus"],f:function(){activeunit.removetarget(targetunit)},str:"target",token:!0},{from:DEFENSE_M,type:MOD_M,to:DEFENSE_M,org:this,req:function(){return this.canusefocus()}.bind(this),aiactivate:function(b,
e){mm=getattackvalue();return 0<FE_focus(b)&&FCH_hit(mm)+FCH_crit(mm)>FE_evade(b)},f:function(b,e){this.removefocustoken();var f=FE_focus(b);0<f&&(b=b-FE_FOCUS*f+FE_EVADE*f);return b}.bind(this),str:"focus",token:!0},{from:DEFENSE_M,type:ADD_M,to:DEFENSE_M,org:this,req:function(){return this.canuseevade()}.bind(this),aiactivate:function(b,e){mm=getattackvalue();return FCH_hit(mm)+FCH_crit(mm)>FE_evade(b)},f:function(b,e){this.removeevadetoken();return{m:b+FE_EVADE,n:e+1}}.bind(this),str:"evade",token:!0,
noreroll:"focus"}]},adddicemodifier:function(b,e,f,l,m){m.org=l;m.type=e;m.from=b;m.to=f;this.wrap_after("getdicemodifiers",l,function(b){return b.concat(m)})},setclickhandler:function(b){this.g.unmousedown();this.g.mousedown(b)},setdefaultclickhandler:function(){this.g.unmousedown();this.g.mousedown(function(){this.select()}.bind(this))},dragshow:function(){this.g.transform(this.dragMatrix);this.geffect.transform(this.dragMatrix)},dragmove:function(b,e,f,l){f=VIEWPORT.m.split();l=Math.max(900/$("#svgout").width(),
900/$("#svgout").height());b=b*l/f.scalex;e=e*l/f.scalex;this.dragMatrix=MT(b,e).add(this.m);this.dx=b;this.dy=e;this.dragged=!0;$(".phasepanel").hide();this.dragshow()},dragstart:function(b,e,f){this.showhitsector(!1);this.dragMatrix=this.m;this.dragged=!1},dragstop:function(b){this.dragged&&(this.m=this.dragMatrix,this.showpanel(),this.tx+=this.dx,this.ty+=this.dy);this.dragged=!1},isinzone:function(b){b=this.getOutlinePoints(b);var e;e=2>=this.team?SETUP["playzone"+this.team]:SETUP.playzone1;return Snap.path.isPointInside(e,
b[0].x,b[0].y)&&Snap.path.isPointInside(e,b[1].x,b[1].y)&&Snap.path.isPointInside(e,b[2].x,b[2].y)&&Snap.path.isPointInside(e,b[3].x,b[3].y)?!0:!1},getOutlinePoints:function(b){var e=this.islarge?40:20;"undefined"==typeof b&&(b=this.m);return[{x:b.x(-e,-e),y:b.y(-e,-e)},{x:b.x(e,-e),y:b.y(e,-e)},{x:b.x(e,e),y:b.y(e,e)},{x:b.x(-e,e),y:b.y(-e,e)}]},getOutlineString:function(b){b=this.getOutlinePoints(b);return{s:"M "+b[0].x+" "+b[0].y+" L "+b[1].x+" "+b[1].y+" "+b[2].x+" "+b[2].y+" "+b[3].x+" "+b[3].y+
" Z",p:b}},getOutline:function(b){var e=this.islarge?40:20,f=s.rect(-e,-e,2*e,2*e),e=s.text(e+8,3-e,"8").attr({"class":"symbols",fontSize:"1.3em"});return s.g(e,f).transform(b).attr({fill:this.color,opacity:.3,display:"none"})},getSectorPoints:function(b,e){var f=this.islarge?40:20;if(this.hasmobilearc)return this.getQuarterSectorPoints(b,e);var l=Math.sqrt((f-3)*(f-3)+f*f);return $.map([{x:-(l+100*b)/l*(f-3),y:-(l+100*b)/l*f},{x:-f+3,y:-f-100*b},{x:f-3,y:-f-100*b},{x:(l+100*b)/l*(f-3),y:-(l+100*
b)/l*f}],function(b,f){return transformPoint(e,b)})},getQuarterSectorPoints:function(b,e){var f=this.islarge?40:20,l=Math.sqrt(2),m=l*f;return $.map([{x:-(m+100*b)/l,y:-(m+100*b)/l},{x:-f,y:-f-100*b},{x:f,y:-f-100*b},{x:(m+100*b)/l,y:-(m+100*b)/l}],function(b,f){return transformPoint(e,b)})},getRangePoints:function(b,e){var f=this.islarge?40:20;return $.map([{x:-f,y:-100*b-f},{x:f,y:-100*b-f},{x:100*b+f,y:-f},{x:100*b+f,y:f},{x:f,y:100*b+f},{x:-f,y:100*b+f},{x:-100*b-f,y:f},{x:-100*b-f,y:-f}],function(b,
f){return transformPoint(e,b)})},getHalfRangePoints:function(b,e){var f=this.islarge?40:20;return $.map([{x:100*b+f,y:0},{x:100*b+f,y:-f},{x:f,y:-100*b-f},{x:-f,y:-100*b-f},{x:-100*b-f,y:-f},{x:-100*b-f,y:0}],function(b,f){return transformPoint(e,b)})},getRangeString:function(b,e){var f=" A "+100*b+" "+100*b+" 0 0 1 ",l=this.getRangePoints(b,e);return"M "+l[1].x+" "+l[1].y+f+l[2].x+" "+l[2].y+" L "+l[3].x+" "+l[3].y+f+l[4].x+" "+l[4].y+" L "+l[5].x+" "+l[5].y+f+l[6].x+" "+l[6].y+" L "+l[7].x+" "+
l[7].y+f+l[0].x+" "+l[0].y+" Z"},getHalfRangeString:function(b,e){var f=" A "+100*b+" "+100*b+" 0 0 0 ",l=this.getHalfRangePoints(b,e);return"M "+l[0].x+" "+l[0].y+" L "+l[1].x+" "+l[1].y+f+l[2].x+" "+l[2].y+" L "+l[3].x+" "+l[3].y+f+l[4].x+" "+l[4].y+" L "+l[5].x+" "+l[5].y+" Z"},getSubRangeString:function(b,e,f){var l=" A "+100*b+" "+100*b+" 0 0 1 ";b=this.getRangePoints(b,f);var m="M "+b[0].x+" "+b[0].y+" L "+b[1].x+" "+b[1].y+l+b[2].x+" "+b[2].y+" L "+b[3].x+" "+b[3].y+l+b[4].x+" "+b[4].y+" L "+
b[5].x+" "+b[5].y+l+b[6].x+" "+b[6].y+" L "+b[7].x+" "+b[7].y+l+b[0].x+" "+b[0].y,l=" A "+100*e+" "+100*e+" 0 0 0 ";b=this.getRangePoints(e,f);return m+=" L "+b[0].x+" "+b[0].y+l+b[7].x+" "+b[7].y+" L "+b[6].x+" "+b[6].y+l+b[5].x+" "+b[5].y+" L "+b[4].x+" "+b[4].y+l+b[3].x+" "+b[3].y+" L "+b[2].x+" "+b[2].y+l+b[1].x+" "+b[1].y+" L "+b[0].x+" "+b[0].y},getHalfSubRangeString:function(b,e,f){var l=" A "+100*b+" "+100*b+" 0 0 0 ";b=this.getHalfRangePoints(b,f);var m="M "+b[0].x+" "+b[0].y+" L "+b[1].x+
" "+b[1].y+l+b[2].x+" "+b[2].y+" L "+b[3].x+" "+b[3].y+l+b[4].x+" "+b[4].y+" L "+b[5].x+" "+b[5].y,l=" A "+100*e+" "+100*e+" 0 0 1 ";b=this.getHalfRangePoints(e,f);return m+=" L "+b[5].x+" "+b[5].y+" L "+b[4].x+" "+b[4].y+l+b[3].x+" "+b[3].y+" L "+b[2].x+" "+b[2].y+l+b[1].x+" "+b[1].y+" L "+b[0].x+" "+b[0].y+" Z"},getPrimarySectorString:function(b,e){var f;f=this.getSectorPoints(b,e);var l=" A "+100*b+" "+100*b+" 0 0 1 ",m=transformPoint(e,{x:0,y:0});return"M "+m.x+" "+m.y+" L "+f[0].x+" "+f[0].y+
l+f[1].x+" "+f[1].y+" L "+f[2].x+" "+f[2].y+l+f[3].x+" "+f[3].y+" Z"},getPrimarySubSectorString:function(b,e,f){var l=" A "+100*b+" "+100*b+" 0 0 1 ";b=this.getSectorPoints(b,f);var m="M "+b[0].x+" "+b[0].y+l+b[1].x+" "+b[1].y+" L "+b[2].x+" "+b[2].y+l+b[3].x+" "+b[3].y;b=this.getSectorPoints(e,f);l=" A "+100*e+" "+100*e+" 0 0 0 ";return m+="L "+b[3].x+" "+b[3].y+l+b[2].x+" "+b[2].y+" L "+b[1].x+" "+b[1].y+l+b[0].x+" "+b[0].y+" Z"},setmaneuver:function(b){this.lastmaneuver=this.maneuver;this.maneuver=
b;this.showdial();this.showmaneuver();"undefined"==typeof this.deferred&&this.error("undefined deferred");nextplanning()},select:function(){if(this.dead||this.isdocked)return activeunit;if(phase<ACTIVATION_PHASE||phase==ACTIVATION_PHASE||phase==COMBAT_PHASE){var b=activeunit;activeunit=this;b!=this&&b.unselect();$("#"+this.id).addClass("selected");this.show();center(this)}return activeunit},unselect:function(){this.showoutline();this.showmaneuver();$(".team div").removeClass("selected")},getmcollisions:function(b){var e,
f,l=[];e=this.getOutlineString(b);b=e.s;f=e.p;for(e=0;e<OBSTACLES.length;e++)if(OBSTACLES[e].type!=NONE){var m=OBSTACLES[e].getOutlineString();if(OBSTACLES[e].type==BOMB&&(0<Snap.path.intersection(m.s,b).length||this.isPointInside(m.s,f)||this.isPointInside(b,m.p))){l.push(e);break}}return l},getBall:function(b){return{x:b.x(0,0),y:b.y(0,0),diam:this.islarge?56:28}},guessevades:function(b,e){var f=function(f){f==FE_evade(b.roll)&&(this.log("guessed correctly ! +1 %EVADE% [%0]",self.name),b.roll+=
FE_EVADE,b.dice+=1);$("#actiondial").empty();e.resolve(b)}.bind(this);this.log("guess the number of evades out of %0 dice [%1]",b.dice,self.name);$("#actiondial").empty();for(var l=0;l<=b.dice;l++)(function(b){var e=$("<button>").html(b+" <code class='xevadetoken'></code>").on("touch click",function(){f(b)}.bind(this));$("#actiondial").append(e)}).call(this,l)},guessmove:function(b){var e=b.getdial(),f;for(f in e)(function(e){var f=d.move.substr(-1),f=$("<button>").html("<span class='symbols maneuver>"+
P[d.move].key+"</span>"+f).on("touch click",function(){e==b&&console.log(">> guess correctly!")}.bind(this));$("#actiondial").append(f)}).call(this,f)},fastgetocollisions:function(b,e,f,l){var m,h=[],q=this.getBall(e);if("undefined"==typeof f&&(m=b.invert(),f=e.x(0,0),l=e.y(0,0),e=m.x(f,l),m=m.y(f,l),f=s.path("M 0 0 L "+e+" "+m).appendTo(VIEWPORT).attr({display:"none"}),l=f.getTotalLength(),0==l))return!1;for(e=m=0;m<=l;m+=l/5,e++){var t=f.getPointAtLength(m);h[e]={x:b.x(t.x,t.y),y:b.y(t.x,t.y)}}for(e=
0;e<OBSTACLES.length;e++)if(OBSTACLES[e].type!=BOMB&&OBSTACLES[e].type!=NONE){b=OBSTACLES[e].getBall();m=b.diam+q.diam;f=m*m;if((b.x-q.x)*(b.x-q.x)+(b.y-q.y)*(b.y-q.y)<f)return!0;for(m=0;m<h.length;m++)if((b.x-h[m].x)*(b.x-h[m].x)+(b.y-h[m].y)*(b.y-h[m].y)<f)return!0}return!1},getocollisions:function(b,e,f,l){var m,h=[],q,t={overlap:-1,template:[],mine:[]};e=this.getOutlineString(e);m=e.s;q=e.p;for(e=0;e<OBSTACLES.length;e++){var w=OBSTACLES[e];if(w.type!=NONE){var y=w.getOutlineString();(0<Snap.path.intersection(y.s,
m).length||this.isPointInside(y.s,q)||this.isPointInside(m,y.p))&&this.oldoverlap!=e&&(w.type!=BOMB?t.overlap=e:t.mine.push(w))}}if("undefined"!=typeof f){for(e=m=0;m<=l;m+=5,e++)w=f.getPointAtLength(m),h[e]={x:b.x(w.x,w.y),y:b.y(w.x,w.y)};for(b=0;b<h.length;b++)for(e=0;e<OBSTACLES.length;e++)if(w=OBSTACLES[e],w.type!=NONE&&e!=t.overlap&&e!=this.oldoverlap&&-1==t.template.indexOf(e)&&-1==t.mine.indexOf(w))for(f=w.getOutlineString().p,m=0;m<f.length;m++)if(l=f[m].x-h[b].x,q=f[m].y-h[b].y,100>=l*l+
q*q){w.type!=BOMB?t.template.push(e):t.mine.push(OBSTACLES[e]);break}}return t},iscollidingunit:function(b,e){var f=this.getOutlineString(b).s,l=e.getOutlineString(e.m).s,m=0<Snap.path.intersection(f,l).length;this.islarge&&(m=m||this.isinoutline(f,e,e.m));e.islarge&&(m=m||e.isinoutline(l,this,b));return m},getcollidingunits:function(b){var e,f=[];for(e in squadron){var l=squadron[e];l!=this&&this.iscollidingunit(b,l)&&f.push(l)}return f},getpathmatrix:function(b,e,f){"undefined"==typeof P[e]&&console.log("***Undefined maneuver "+
e);var l=P[e].path,m=l.getTotalLength();this.islarge&&(m+=40);b=b.clone();e.match(/RF1|RR1|RL1/)&&(b=b.rotate(180,0,0));m=this.getmatrixwithmove(b,l,m);(e.match(/K\d|SR\d|SL\d/)||1==f)&&m.rotate(180,0,0);e.match(/TRL\d/)&&m.rotate(-90,0,0);e.match(/TRR\d/)&&m.rotate(90,0,0);e.match(/RF1|RR1|RL1/)&&m.rotate(180,0,0);l.remove();return m},getmovecolor:function(b,e,f,l,m,h){var q,t=!1;if(!this.isinzone(b))return RED;f&&(f=this.ocollision,this.ocollision=this.getocollisions(this.m,b,l,m),this.hascollidedobstacle()&&
(t=!0),this.ocollision=f);if(t)return YELLOW;if(e)for(q in e=this.getOutlineString(b),this.getskill(),squadron)if(l=squadron[q],l!=this&&(b=h?l.futurem:l.m,b=l.getOutlineString(b),0<Snap.path.intersection(b.s,e.s).length||this.islarge&&!l.islarge&&this.isPointInside(e.s,b.p)||!this.islarge&&l.islarge&&this.isPointInside(b.s,e.p)))return WHITE;return GREEN},isTurret:function(b){return"Turretlaser"==b.type},candoactivation:function(){return-1!=this.maneuver},candoroll:function(){for(var b=this.getrollmatrix(this.m),
e=!1,f=this.canmoveonobstacles("ROLL"),l=0;l<b.length;l++)var m=this.getmovecolor(b[l],!0,!0),e=e||m==GREEN||m==YELLOW&&f;return e},candoboost:function(){for(var b=this.getboostmatrix(this.m),e=!1,f=this.canmoveonobstacles("BOOST"),l=0;l<b.length;l++)var m=this.getmovecolor(b[l],!0,!0),e=e||m==GREEN||m==YELLOW&&f;return e},candocoordinate:function(){return 0<this.selectnearbyally(2).length},newaction:function(b,e){return{action:b,org:this,type:e,name:e}},getactionbarlist:function(b){var e,f=[];for(e=
0;e<this.shipactionList.length;e++){var l=this.shipactionList[e];if(!this.isactiondone(l))switch(l){case "CLOAK":this.candocloak()&&f.push(this.newaction(this.addcloak,"CLOAK"));break;case "FOCUS":this.candofocus()&&f.push(this.newaction(this.addfocus,"FOCUS"));break;case "EVADE":this.candoevade()&&f.push(this.newaction(this.addevade,"EVADE"));break;case "TARGET":this.candotarget()&&f.push(this.newaction(this.resolvetarget,"TARGET"));break;case "ARCROTATE":this.candoarcrotate()&&f.push(this.newaction(this.resolvearcrotate,
"ARCROTATE"));break;case "BOOST":this.candoboost()&&f.push(this.newaction(this.resolveboost,"BOOST"));break;case "ROLL":this.candoroll()&&f.push(this.newaction(this.resolveroll,"ROLL"));break;case "SLAM":b&&f.push(this.newaction(this.resolveslam,"SLAM"));break;case "COORDINATE":this.candocoordinate()&&f.push(this.newaction(this.resolvecoordinate,"COORDINATE"))}}return f},getupgactionlist:function(){var b,e=[];for(b=0;b<this.upgrades.length;b++){var f=this.upgrades[b];!this.isactiondone(f.name)&&f.isactive&&
"function"==typeof f.action&&f.candoaction()&&e.push({org:f,action:f.action,type:f.type.toUpperCase(),name:f.name});!this.isactiondone(f.name+"/2")&&f.isactive&&"function"==typeof f.action2&&f.candoaction2()&&e.push({org:f,action:f.action2,type:f.type.toUpperCase(),name:f.name+"/2"})}return e},getcritactionlist:function(){var b,e=[];for(b=0;b<this.criticals.length;b++){var f=this.criticals[b];!this.isactiondone(f.name)&&f.isactive&&"function"==typeof f.action&&(f.type="CRITICAL",f.org=f,e.push(f))}return e},
getactionlist:function(b){b=this.getactionbarlist(b);var e=this.getupgactionlist(),f=this.getcritactionlist();return b.concat(e).concat(f)},addevadetoken:function(){this.evade++;this.animateaddtoken("xevadetoken");this.movelog("E");this.show()},addevade:function(b){this.addevadetoken();this.endaction(b,"EVADE")},addfocustoken:function(){this.focus++;this.animateaddtoken("xfocustoken");this.movelog("FO");this.show()},addtractorbeam:function(b){this.addtractorbeamtoken();if(1==this.tractorbeam&&!this.islarge){var e=
this.m,f=Unit.prototype.getrollmatrix.call(this,this.m).concat(this.getpathmatrix(this.m,"F1"));b.doselection(function(l){b.resolveactionmove.call(this,f,function(b,h){b.ocollision=b.getocollisions(e,f[h]);b.endnoaction(l,"BOOST")},!0,!0)}.bind(this))}},addtractorbeamtoken:function(){this.tractorbeam++;this.animateaddtoken("xtractorbeamtoken");this.movelog("TB");this.show()},removetractorbeamtoken:function(){this.tractorbeam--;this.animateremovetoken("xtractorbeamtoken");this.movelog("tb");this.show()},
addfocus:function(b){this.addfocustoken();this.endaction(b,"FOCUS")},addstress:function(){this.stress++;this.animateaddtoken("xstresstoken");this.movelog("ST");this.show()},addiontoken:function(){this.ionized++;this.animateaddtoken("xionizedtoken");this.movelog("I");this.show()},removeiontoken:function(){this.ionized--;this.animateremovetoken("xionizedtoken");this.movelog("i");this.show()},warndeath:function(b,e,f){},dies:function(){this.movelog("d-0");$("#"+this.id).attr("onclick","");$("#"+this.id).addClass("dead");
$("#"+this.id).html(""+this);$("#"+this.id+" .outoverflow").each(function(b){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")});i=squadron.indexOf(this);for(i in squadron)squadron[i]==this?delete squadron[i]:squadron[i].team==this.team&&squadron[i].warndeath(this.hull,this.shield,this);filltabskill();for(i=0;i<this.targeting.length;i++){var b=this.targeting[i];n=b.istargeted.indexOf(this);-1<n&&b.istargeted.splice(n,1);b.show()}for(i=0;i<this.istargeted.length;i++)b=
this.istargeted[i],n=b.targeting.indexOf(this),-1<n&&b.targeting.splice(n,1),b.show();this.targeting=[];this.g.attr({display:"none"});this.imgsmoke.attr("display","none");this.imgflame.attr("display","none");this.imgexplosion=this.islarge?s.image("png/explosion3.gif",-80,-80,160,160):s.image("png/explosion3.gif#"+Math.random(),-40,-40,80,80);this.geffect.add(this.imgexplosion);this.show();FAST||SOUNDS.explode.play();this.dead=!0;this==this.captain&&this.electcaptain();this.log("has exploded!");setTimeout(function(){this.geffect.attr({display:"none"});
this.show();TEAMS[this.team].checkdead()&&win(this.team)}.bind(this),FAST?0:1E3)},canbedestroyed:function(){return skillturn!=this.getskill()?!0:!1},checkdead:function(){if(!this.dead&&(0>=this.hull||!this.isinzone(this.m))){this.dies();var b=TEAMS[this.team].history.rawdata;"undefined"==typeof b[round]&&(b[round]={hits:0,dead:""});b[round].dead+=this.name+" ";return!0}return!1},cancelhit:function(b,e){var f=FCH_hit(b.ch);return f>=b.e?{ch:b.ch-b.e*FCH_HIT,e:0}:{ch:b.ch-f*FCH_HIT,e:b.e-f}},cancelcritical:function(b,
e){var f=FCH_crit(b.ch);return f>=b.e?{ch:b.ch-b.e*FCH_CRIT,e:0}:{ch:b.ch-f*FCH_CRIT,e:b.e-f}},attackrerolls:function(b,e){return 0},evadeattack:function(b){var e=getdefenseresult(),f=getattackresult();displayattackroll(getattackdice(),f);e=this.cancelhit({ch:f,e:e},b);e=this.cancelcritical(e,b);"undefined"==typeof e&&this.error("undefined cancel critical");return e.ch},declareattack:function(b,e){targetunit=e;this.activeweapon=b;if(this.weapons[b].declareattack(e))return this.log("attacks %0 with %1",
e.name,this.weapons[b].name),e.isattackedby(b,this),!0;this.log("cannot attack %0 [%1]",e.name,this.weapons[b].name);return!1},isattackedby:function(b,e){},endmodifydefensestep:function(){},endmodifyattackstep:function(){},modifydamageassigned:function(b,e){return b},modifydefenseroll:function(b,e,f){return e},modifyattackroll:function(b,e,f){return b},resolveishit:function(){},hashit:function(b){return 0<this.criticalresolved+this.hitresolved},resolvedamage:function(){$(".fireline").remove();FAST||
this.playfiresnd();var b=targetunit.evadeattack(this),b=this.weapons[this.activeweapon].modifydamageassigned(b,targetunit),b=targetunit.modifydamageassigned(b,this);TEAMS[this.team].allred+=getattackdice();TEAMS[targetunit.team].allgreen+=getdefensedice();TEAMS[this.team].allhits+=FCH_hit(b);TEAMS[this.team].allcrits+=FCH_crit(b);TEAMS[targetunit.team].allevade+=FE_evade(getdefenseresult());var e=FCH_crit(b),f=FCH_hit(b);this.hasdamaged=!0;this.hitresolved=f;this.criticalresolved=e;this.hashit(targetunit)&&
(targetunit.resolveishit(this),this.weapons[this.activeweapon].prehit(targetunit,e,f),this.hitresolved+this.criticalresolved<targetunit.shield?targetunit.log("-%0 %SHIELD%",this.criticalresolved+this.hitresolved):0<targetunit.shield&&targetunit.log("-%0 %SHIELD%",targetunit.shield),this.hitresolved=targetunit.resolvehit(this.hitresolved),this.criticalresolved=targetunit.resolvecritical(this.criticalresolved),this.weapons[this.activeweapon].posthit(targetunit,e,f));this.weapons[this.activeweapon].endattack(e,
f);this.usedweapon=this.activeweapon;this.weapons[this.activeweapon].hasdoubleattack()?(this.latedeferred=this.deferred,targetunit.canbedestroyed(skillturn)&&targetunit.checkdead(),targetunit.dead||this.newlock().done(function(){this.deferred=this.latedeferred;this.log("+1 attack with %0",this.weapons[this.activeweapon].name);this.resolveattack(this.activeweapon,targetunit)}.bind(this)),this.cleanupattack()):TEAMS[targetunit.team].initiative?(targetunit.afterdefenseeffect(e,f,this),barrier(function(){this.afterattackeffect(e,
f);targetunit.canbedestroyed(skillturn)&&targetunit.checkdead();targetunit.endbeingattacked(e,f,this);this.endattack(e,f,targetunit);this.cleanupattack()}.bind(this))):(this.afterattackeffect(e,f),barrier(function(){targetunit.afterdefenseeffect(e,f,this);targetunit.canbedestroyed(skillturn)&&targetunit.checkdead();this.endattack(e,f,targetunit);targetunit.endbeingattacked(e,f,this);this.cleanupattack()}.bind(this)))},afterattackeffect:function(b,e){},afterdefenseeffect:function(b,e){},postattack:function(b){},
cleanupattack:function(){this.actionbarrier();ENGAGED=!1},resetfocus:function(){return 0},resetevade:function(){return 0},resettractorbeam:function(){return 0},endround:function(){for(var b=0;b<this.upgrades.length;b++)this.upgrades[b].endround();this.focus=this.resetfocus();this.evade=this.resetevade();this.hasfired=0;this.maxfired=1;this.tractorbeam=this.resettractorbeam();this.oldoverlap=this.ocollision.overlap;this.ocollision.overlap=-1;this.ocollision.template=[];this.ocollision.mine=[];this.collision=
!1;this.touching=[];this.showinfo()},playfiresnd:function(){var b=targetunit.g.getBBox(),e=transformPoint(this.m,{x:0,y:-(this.islarge?40:20)}),f=s.path("M "+e.x+" "+e.y+" L "+(b.x+b.w/2)+" "+(b.y+b.h/2)).appendTo(VIEWPORT).attr({stroke:this.color,strokeWidth:2}),l=setInterval(function(){f.remove();clearInterval(l)},200);this.movelog("f-"+targetunit.id+"-"+this.activeweapon);"undefined"!=typeof this.weapons[this.activeweapon]&&"undefined"!=typeof this.weapons[this.activeweapon].firesnd?SOUNDS[this.weapons[this.activeweapon].firesnd].play():
SOUNDS[this.ship.firesnd].play()},endattack:function(b,e,f){for(i=0;i<DICES.length;i++)$("."+DICES[i]+"dice").remove();this.show()},endbeingattacked:function(b,e,f){},showpositions:function(b){var e,f=[];this.evaluatemoves(!0,!0);for(e=0;e<b.length;e++)f[e]=this.getOutline(b[e].m).attr({title:b[e].move,opacity:.4,fill:halftone(b[e].color),display:"block","class":"possible"}).appendTo(VIEWPORT),function(e){f[e].hover(function(){f[e].attr({stroke:b[e].color,strokeWidth:4})}.bind(this),function(){f[e].attr({strokeWidth:0})}.bind(this))}.call(this,
e)},showmeanposition:function(){this.getdial();this.evaluatemoves(!0,!0);this.showpositions([{color:GREEN,move:"mean",m:this.meanm}])},shownextpositions:function(){var b=this.getdial();this.evaluatemoves(!0,!0);var e=[];for(i=0;i<b.length;i++)e[i]=b[i].next;this.showpositions(e)},showpossiblepositions:function(){this.evaluatemoves(!0,!0);var b=this.getdial();this.showpositions(b)},electcaptain:function(){var b=this,e,f,l,m=[];f="";l=this.selectnearbyunits(2,function(b,e){return b.team==e.team&&!b.dead&&
!b.isdocked&&!b.islarge&&b.behavior!=ALONE&&b.getorientation()==e.getorientation()});for(e in l){var h=l[e];m.push(h);f+=h.name+" ";if(h.skill>b.skill||h.skill==b.skill&&h.id<b.id)b=h}if(1>=m.length)this.behavior=ALONE,this.captain=null;else{console.log("CAPTAIN ELECTED:"+b.name+"("+f+")");b.captain=b;b.squad=m;for(e in m)m[e].captain=b,m[e].squad=m;m.sort(function(b,e){var f;for(f=1;3>=f;f++){if(b.isinsector(b.m,f,e,this.getHalfSubRangeString,this.getHalfRangeString))return-1;if(e.isinsector(e.m,
f,b,this.getHalfSubRangeString,this.getHalfRangeString))return 1}for(f=1;3>=f;f++){if(b.isinsector(b.m.clone().rotate(90,0,0),f,e,this.getHalfSubRangeString,this.getHalfRangeString))return-1;if(e.isinsector(e.m.clone().rotate(90,0,0),f,b,this.getHalfSubRangeString,this.getHalfRangeString))return 1}return 0}.bind(this));u=m[0];for(e=1;e<m.length&&(f=!1,f|=m[e].isinsector(m[e].m,1,u,this.getHalfSubRangeString,this.getHalfRangeString),f|=m[e].isinsector(m[e].m,2,u,this.getHalfSubRangeString,this.getHalfRangeString),
f);e++);b.firstrow=e;h=[];b.captaingd=[];l=m.length;for(f=0;f<m.length;f++){var q=m[f].getdial();for(e=0;e<q.length;e++)"undefined"==typeof h[q[e].move]&&(h[q[e].move]=[]),h[q[e].move].push(e)}q=m=f=0;for(e in h)h[e].length==l&&("BL1"==e&&m++,"BL2"==e&&(m+=2),"BL3"==e&&(m+=3),"TL1"==e&&q++,"TL3"==e&&(q+=3),b.captaingd[f++]={move:e,idx:h[e],color:GREEN})}},showgrouppositions:function(){"undefined"==typeof this.captain&&this.electcaptain();this.captain.evaluategroupmoves();this.showpositions(this.captain.captaingd)},
evaluateposition:function(){var b=0,e=0,f=0,l,m,h=0,q=0;NOLOG=!0;for(m in squadron){var t=squadron[m];if(this.isenemy(t)){var w=0;for(l=0;l<t.weapons.length;l++){var y=t.weapons[l].getrange(this);0<y&&4>y&&(w=Math.max(w,t.getattackstrength(l,this)))}b+=w;for(l=0;l<this.weapons.length;l++)y=this.weapons[l].getrange(t),0<y&&4>y&&(e=Math.max(e,this.getattackstrength(l,t)));h+=Math.sqrt(this.getdist(this.m,t)/1E4);f++;0<w&&q++}}NOLOG=!1;return{self:e,enemy:b,dist:h/f}},evaluategroupmoves:function(){var b=
[GREEN,WHITE,YELLOW,RED,BLACK],e=["GREEN","WHITE","RED"],f,l,m,h,q,t=this.captaingd,w={"#000":0,"#F00":1,"#FF0":2,"#FFF":3,"#0F0":4},y=this.squad.length;for(f=0;f<y;f++)this.squad[f].evaluatemoves(!0,!0);for(l=0;l<t.length;l++)t[l].m=this.getpathmatrix(this.m,t[l].move);for(f=0;f<t.length;f++){m=t[f].idx;var v=q=0;for(l=0;l<m.length;l++){h=this.squad[l].getdial()[m[l]].color;var z=this.squad[l].getdial()[m[l]].difficulty;b.indexOf(h)>q&&(q=b.indexOf(h));e.indexOf(z)>v&&(v=e.indexOf(z))}t[f].color=
b[q];t[f].difficulty=e[v]}NOLOG=!0;for(f=0;f<t.length;f++)t[f].path=P[t[f].move].path,t[f].len=t[f].path.getTotalLength()+(this.islarge?40:0);for(f=0;f<t.length;f++){e=[];m=t[f];m.color=GREEN;for(b=0;b<y;b++)if(l=this.squad[b],e[b]=l.getpathmatrix(l.m,m.move),!l.canreveal(m)){m.color=BLACK;break}if(m.color!=BLACK){for(b=0;b<y;b++)l=this.squad[b],q=l.getmovecolor(e[b],!0,!0,m.path,m.len,!0),w[m.color]>w[q]&&(m.color=q);if(m.color!=RED&&m.color!=BLACK){h=RED;for(l=0;l<t.length;l++)if("F0"!=t[l].move&&
("RED"!=t[l].difficulty||"RED"!=t[f].difficulty)){v=[];for(b=0;b<y;b++)v[b]=this.squad[b].getmatrixwithmove(e[b],t[l].path,t[l].len);for(b=0;b<y&&this.squad[b].isinzone(v[b]);b++);if(!(b<y)){q=GREEN;for(b=0;b<y;b++)if(this.squad[b].fastgetocollisions(e[b],v[b],t[l].path,t[l].len)){q=YELLOW;break}w[q]>w[h]&&(h=q);if(h==GREEN)break}}w[h]<w[m.color]&&(m.color=h)}}}},getorientation:function(){return(this.m.split().rotate+360+180)%360-180},evaluatemoves:function(b,e){this.meanmround=round;var f=this.getdial(),
l=0,m=0,h=0,q=0,t,w=RED,y={"#000":0,"#F00":1,"#FF0":2,"#FFF":3,"#0F0":4};NOLOG=!0;var v=this.getorientation();for(t=0;t<f.length;t++)f[t].path=P[f[t].move].path,f[t].len=f[t].path.getTotalLength()+(this.islarge?40:0);for(t=0;t<f.length;t++){var z=this.getpathmatrix(this.m,f[t].move);f[t].m=z;if(this.canreveal(f[t])){var B=this.getmovecolor(z,b,e,f[t].path,f[t].len,!0);f[t].color=B;if(B!=RED&&B!=BLACK&&b&&e){for(var E=RED,D=this.ocollision,K=0;K<f.length;K++){var J;if("F0"!=f[K].move&&("RED"!=f[K].difficulty||
(this.hasnostresseffect()||"GREEN"==f[t].difficulty)&&"RED"!=f[t].difficulty)){var L=this.getmatrixwithmove(z,f[K].path,f[K].len);J=GREEN;this.isinzone(L)?e&&(this.fastgetocollisions(z,L,f[K].path,f[K].len)?this.ocollision.overlap=1:this.ocollision.overlap=-1,this.hascollidedobstacle()&&(J=YELLOW)):J=RED;y[J]>y[E]&&(E=J)}}this.ocollision=D;y[E]<y[B]&&(f[t].color=E)}}else f[t].color=BLACK;y[w]>y[f[t].color]&&(w=f[t].color);f[t].color!=GREEN&&f[t].color!=WHITE||f[t].move.match(/K\d|SR\d|SL\d|TRL\d|TRR\d/)||
(z=z.split(),q++,z.rotate=(z.rotate-v+180)%360-180,l+=z.dx,m+=z.dy,h+=z.rotate)}for(t=0;t<f.length;t++)"F0"==f[t].move&&(f[t].color=w);0==q&&(q=1);l/=q;m/=q;h/=q;this.meanm=(new Snap.Matrix).translate(l,m).rotate(h+v,0,0);NOLOG=!1},removetarget:function(b){var e;e=b.istargeted.indexOf(this);-1<e&&b.istargeted.splice(e,1);e=this.targeting.indexOf(b);-1<e&&(this.targeting.splice(e,1),this.movelog("t-"+b.id),b.show(),this.show());0==this.targeting.length&&$("#atokens > .xtargettoken").remove()},removeevadetoken:function(){this.animateremovetoken("xevadetoken");
this.evade--;this.movelog("e");this.show()},removefocustoken:function(){this.animateremovetoken("xfocustoken");this.focus--;this.movelog("fo");this.show()},resolveactionmove:function(b,e,f,l){var m;this.pos=[];var h=function(b,e,h){for(m=0;m<this.pos.length;m++)this.pos[m].ol.remove();if(f){var q=b.split(),t=this.m.split();s.path("M "+t.dx+" "+t.dy+" L "+q.dx+" "+q.dy).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",strokeLinecap:"round",strokeDasharray:"1, 30",opacity:.2,
fill:"rgba(0,0,0,0)"}).addClass("trace").appendTo(VIEWPORT);this.m=b}q=this.getmcollisions(this.m);if(0<q.length)for(m=0;m<q.length;m++)t=OBSTACLES[q[m]],t.type==BOMB&&"function"==typeof t.detonate?t.detonate(this,!1):(this.ocollision.overlap=m,this.log("colliding with obstacle"),l||this.resolveocollision(1,[]));f&&(q=b.split(),this.movelog("am-"+Math.floor(300+q.dx)+"-"+Math.floor(300+q.dy)+"-"+Math.floor((360+Math.floor(q.rotate))%360)));h(this,e);this.show()}.bind(this);for(m=b.length-1;0<=m;m--){var q=
this.getmovecolor(b[m],!0,!0);if(l&&(q==YELLOW||q==RED)||q==GREEN||l&&!f)p=this.getOutline(b[m]).attr({display:"block"}).appendTo(VIEWPORT),this.pos.push({ol:p,k:m})}if(0<this.pos.length)if(1==this.pos.length)h(b[this.pos[0].k],this.pos[0].k,e);else for(m=0;m<this.pos.length;m++)(function(f){var l=this.pos[f];l.ol.hover(function(){this.pos[f].ol.attr({stroke:this.color,strokeWidth:4})}.bind(this),function(){this.pos[f].ol.attr({strokeWidth:0})}.bind(this));l.ol.click(function(){h(b[this.pos[f].k],
this.pos[f].k,e)}.bind(this));l.ol.touchend(function(){h(b[this.pos[f].k],this.pos[f].k,e)}.bind(this))}).call(this,m);else h(this.m,-1,e)},resolveactionselection:function(b,e){var f;this.pos=[];var l=function(l){for(f=0;f<b.length;f++)b[f].outline.removeClass("outline"),b[f].outline.attr({fill:"rgba(8,8,8,0.5)"}),b[f].setdefaultclickhandler();e(l)}.bind(this);if(0==b.length)l(-1);else if(1==b.length)l(0);else for(f=0;f<b.length;f++)b[f].outline.attr({fill:"rgba(100,100,100,0.8)"}),b[f].outline.addClass("outline"),
function(e){b[e].setclickhandler(function(){l(e)})}(f)},getboostmatrix:function(b){return[this.getpathmatrix(b,"F1"),this.getpathmatrix(b,"BL1"),this.getpathmatrix(b,"BR1")]},resolveboost:function(b){this.resolveactionmove(this.getboostmatrix(this.m),function(e,f){e.endaction(b,"BOOST")},!0,this.canmoveonobstacles("BOOST"))},resolvecoordinate:function(b){var e=this,f=this.selectnearbyally(2);0<f.length&&this.resolveactionselection(f,function(l){f[l].select();f[l].doaction(f[l].getactionlist(),"+1 free action").done(function(){return e.select()});
e.endaction(b,"COORDINATE")})},candoarcrotate:function(){return this.hasmobilearc},setarcrotate:function(b){this.arcrotation=90*b},resolvearcrotate:function(b,e){for(var f=this.weapons[0].auxiliary,l=[],m=["front","right side","back","left side"],h=this,q=0;4>q;q++)l[q]=s.path(f.call(this,1,this.m.clone().rotate(90*q-this.arcrotation,0,0))).attr({fill:this.color,stroke:this.color,opacity:.1}).appendTo(VIEWPORT);for(q=0;4>q;q++)(function(f){l[f].hover(function(){l[f].attr({opacity:.4})},function(){l[f].attr({opacity:.1})});
l[f].click(function(){h.setarcrotate(f);h.movelog("R-"+f);h.log("Moving firing arc rotated to the %0",m[f]);for(var q=0;4>q;q++)l[q].attr({display:"none"});1==e?h.endnoaction(b,"ARCMOBILE"):h.endaction(b,"ARCMOBILE")})})(q)},canmoveonobstacles:function(b){return!1},getdecloakmatrix:function(b){var e=this.getpathmatrix(b.clone().rotate(90,0,0),"F2").translate(0,this.islarge?20:0).rotate(-90,0,0),f=this.getpathmatrix(b.clone().rotate(-90,0,0),"F2").translate(0,this.islarge?20:0).rotate(90,0,0);return[b.clone(),
e.clone().translate(0,-20),e,e.clone().translate(0,20),f.clone().translate(0,-20),f,f.clone().translate(0,20),this.getpathmatrix(b.clone(),"F2")]},removecloaktoken:function(){this.agility-=2;this.iscloaked=!1;this.animateremovetoken("xcloaktoken");this.movelog("ct");FAST||SOUNDS.decloak.play()},resolvedecloak:function(b){var e="(or self to cancel)";1==b&&(e="(or self)");this.log("select position to decloak "+e);this.doselection(function(e){this.resolveactionmove(this.getdecloakmatrix(this.m),function(f,
m){(0<m||1==b)&&this.removecloaktoken();this.hasdecloaked=!0;this.endnoaction(e,"DECLOAK")}.bind(this),!0,this.canmoveonobstacles("DECLOAK"))}.bind(this));return!0},gettallonrollmatrix:function(b,e){var f=this.getpathmatrix(b,e);return[f.clone().translate(0,-20),f,f.clone().translate(0,20)]},getrollmatrix:function(b){var e=this.getpathmatrix(b.clone().rotate(90,0,0),"F1").translate(0,this.islarge?20:0).rotate(-90,0,0);b=this.getpathmatrix(b.clone().rotate(-90,0,0),"F1").translate(0,this.islarge?20:
0).rotate(90,0,0);p=[e.clone().translate(0,-20),e,e.clone().translate(0,20),b.clone().translate(0,-20),b,b.clone().translate(0,20)];this.islarge&&(p=p.concat([e.clone().translate(0,-40),e.clone().translate(0,40),b.clone().translate(0,-40),b.clone().translate(0,40)]));return p},resolveroll:function(b){this.resolveactionmove(this.getrollmatrix(this.m),function(e,f){e.endaction(b,"ROLL")},!0,this.canmoveonobstacles("ROLL"))},boundtargets:function(b){if(-1<this.targeting.indexOf(b))return!0;for(b=this.targeting.length-
1;0<=b;b--)this.removetarget(this.targeting[b]);return!1},addtarget:function(b){this.boundtargets(b)||(this.targeting.push(b),this.animateaddtoken("xtargettoken"),b.istargeted.push(this),b.animateaddtoken("xtargetedtoken"),this.movelog("T-"+b.id),b.show(),this.show())},gettargetableunits:function(b){return this.selectnearbyenemy(b)},selectnearbyunits:function(b,e){var f=[],l;for(l in squadron)e(this,squadron[l])&&this.getrange(squadron[l])<=b&&f.push(squadron[l]);return f},selectnearbyobstacle:function(b){var e=
[],f=9E4;1==b?f=1E4:2==b&&(f=4E4);for(b=0;b<OBSTACLES.length;b++){var l=OBSTACLES[b];(l.type==DEBRIS||l.type==ROCK)&&this.getdist(this.m,l)<=f&&e.push(l)}return e},selectnearbyally:function(b,e){return this.selectnearbyunits(b,function(b,l){var f=!0;"function"==typeof e&&(f=e(b,l));return b.isally(l)&&b!=l&&f})},selectnearbyenemy:function(b,e){return this.selectnearbyunits(b,function(b,l){var f=!0;"function"==typeof e&&(f=e(b,l));return b.isenemy(l)&&f})},isally:function(b){return b.team==this.team},
isenemy:function(b){return b.team!=this.team},resolvetargetnoaction:function(b,e){var f=this.gettargetableunits(3);this.resolveactionselection(f,function(l){0<=l&&this.addtarget(f[l]);1==e?this.endnoaction(b,"TARGET"):this.endaction(b,"TARGET")}.bind(this))},resolvetarget:function(b){this.resolvetargetnoaction(b,!1)},addcloaktoken:function(){this.iscloaked=!0;this.agility+=2;this.animateaddtoken("xcloaktoken");this.movelog("CT");FAST||SOUNDS.cloak.play()},addcloak:function(b){this.addcloaktoken();
this.endaction(b,"CLOAK")},resolveslam:function(b){var e=this.getdial();e.length<=this.lastmaneuver&&(this.lastmaneuver=0);for(var f=e[this.lastmaneuver].move.substr(-1),l=[],m=[],h=0;h<e.length;h++)e[h].move.substr(-1)==f&&(l.push(this.getpathmatrix(this.m,e[h].move)),m.push(h));this.log("select maneuver for SLAM");this.noattack=round;this.wrap_after("getdial",this,function(b){for(var e=[],f=0;f<b.length;f++)e[f]={move:b[f].move,difficulty:"WHITE"};return e}).unwrapper("endmaneuver");this.wrap_after("endmaneuver",
this,function(){this.endaction(b,"SLAM")}).unwrapper("endactivationphase");this.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("endphase");this.resolveactionmove(l,function(b,e){this.maneuver=m[e];this.resolvemaneuver()}.bind(this),!1,!0)},enqueueaction:function(b,e){actionr.push($.Deferred());var f=actionr.length-1;"undefined"==typeof e&&(e="undefined");actionr[f].name=e;0==f?b(f):actionr[f-1].done(function(){b(f)}.bind(this));return actionr[f]},endnoaction:function(b,e){actionr[b].resolve(e);
b==actionr.length-1&&actionrlock.resolve();this.show()},endaction:function(b,e){phase==ACTIVATION_PHASE&&$("#activationdial").show();this.clearaction();this.endnoaction(b,e)},resolveaction:function(b,e){$("#actiondial").empty();null==b?this.endaction(e,null):(this.actionsdone.push(b.name),b.action.call(b.org,e))},resolvenoaction:function(b,e){$("#actiondial").empty();null==b?this.endnoaction(e,null):b.action.call(b.org,e)},getrequirements:function(b){return b.getrequirements()},evaluatetohit:function(b,
e){var f=this.gethitrange(b,e);if(e!=this&&3>=f&&0<f){var l=this.getattackstrength(b,e),m=e.getdefensestrength(b,this),f=this.focus,h=this.reroll,q=this.weapons[b];-1<this.targeting.indexOf(e)&&(this.reroll=10);1==q.consumes&&"Target".match(this.getrequirements(q))&&this.canusetarget(e)&&(this.reroll=0);1==q.consumes&&"Focus".match(this.getrequirements(q))&&this.canusefocus()&&this.focus--;l=tohitproba(this,this.weapons[b],e,this.getattacktable(l),e.getdefensetable(m),l,m);f&&(this.focus=f);h&&(this.reroll=
h);return l}return{proba:[],tohit:0,meanhit:0,meancritical:0,tokill:0}},isfireobstructed:function(){return-1<this.ocollision.overlap&&OBSTACLES[this.ocollision.overlap].type==ROCK},hascollidedobstacle:function(){return-1<this.ocollision.overlap||0<this.ocollision.template.length},canfire:function(){return this.noattack<round&&this.hasfired<this.maxfired&&!this.iscloaked&&!this.isfireobstructed()},modifyattackdefense:function(b,e,f,l){return{a:b,d:e}},getattackstrength:function(b,e){return this.weapons[b].getattack()+
this.weapons[b].getrangeattackbonus(e)},getobstructiondef:function(b){return this.getoutlinerange(this.m,b).o?1:0},getdefensestrength:function(b,e){var f=this.getagility(),l=e.getobstructiondef(this);0<l&&this.log("+%0 defense for obstacle",l);return f+e.weapons[b].getrangedefensebonus(this)+l},hasnorerollmodifiers:function(b,e,f,l,m){for(var h=this.getdicemodifiers(),q=0;q<h.length;q++){var t=h[q];if(t.from==b&&t.to==e&&t.type==MOD_M&&t.req(f,l)&&t.noreroll==m)return!0}return!1},getresultmodifiers:function(b,
e,f,l){var m,h=function(b,e){var h=b.str+(f==DEFENSE_M?"modtokend":"modtokena");"undefined"!=typeof b.token&&(h="x"+b.str+"token");h=$("<span>").addClass(h).attr({id:"mod"+e,title:"modify roll ["+b.org.name+"]"}).html("");h.click(function(){modroll(this.f,e,l)}.bind(b));return h},q=function(b,e){var h=b.str+(f==DEFENSE_M?"modtokend":"modtokena");"undefined"!=typeof b.token&&(h="x"+b.str+"token");h=$("<span>").addClass(h).attr({id:"mod"+e,title:"add result ["+b.org.name+"]"}).html("");h.click(function(){addroll(this.f,
e,l)}.bind(b));return h},t=function(b,e){var h=b.n(),m="R"+h,q="tokens",t;b.str&&(q="x"+b.str+"token",m="");t="undefined"!=typeof b.side?b.side:function(){};m=$("<span>").addClass(q).attr({id:"reroll"+e,title:h+" rerolls["+b.org.name+"]"}).html(m);m.click(function(){t();reroll(h,f,l,b,e)});return m},w=this.getdicemodifiers(),y=[];for(m=0;m<w.length;m++){var v=w[m];v.from==f&&v.to==l&&(v.type==MOD_M&&v.req.call(this,b,e)&&y.push(h(v,m)),v.type==ADD_M&&v.req.call(this,b,e)&&y.push(q(v,m)),v.type==REROLL_M&&
v.req.call(this,activeunit,activeunit.weapons[activeunit.activeweapon],targetunit)&&y.push(t(v,m)))}return y},addhasfired:function(){this.hasfired++},resolveattack:function(b,e){var f;this.gethitrange(b,e);this.addhasfired();this.hasdamaged=!1;displaycombatdial();var l=e.g.getBBox(),m=transformPoint(this.m,{x:0,y:-(this.islarge?40:20)});s.path("M "+m.x+" "+m.y+" L "+(l.x+l.w/2)+" "+(l.y+l.h/2)).appendTo(VIEWPORT).attr({stroke:this.color,strokeWidth:2,strokeDasharray:100,"class":"animated fireline"});
this.select();for(f in squadron)if(squadron[f]==this)break;this.preattackroll(b,e);this.doselection(function(h){var l=this.getattackstrength(b,e);this.doattackroll(this.attackroll(l),l,b,f,h)}.bind(this),"in combat")},preattackroll:function(b,e){},predefenseroll:function(b,e){},doattack:function(b,e){this.activeweapons=b;this.activeenemies=e;this.showattack(b,e)},doattackroll:function(b,e,f,l,m){b=this.weapons[f].modifydamagegiven(b);displayattackroll(b,e);this.ar=b;this.ad=e;displayattacktokens(this,
function(b){targetunit.predefenseroll(f,b);targetunit.defenseroll(targetunit.getdefensestrength(f,b)).done(function(b){targetunit.dodefenseroll(b.roll,b.dice,l,m)})})},dodefenseroll:function(b,e,f,l){this.dr=b;this.dd=e;displaydefenseroll(b,e);displaydefensetokens(this,function(){this.resolvedamage();this.endnoaction(l,"in combat")}.bind(squadron[f]))},drawpathmove:function(b,e,f,l){FAST||("undefined"!=typeof l&&(s=l),this.islarge?(l=b.clone(),s.path("M 0 0 l 0 -20").transform(l).appendTo(VIEWPORT).attr({stroke:this.color,
display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),e=s.path(e.getSubpath(0,f-40)).attr("display","none"),e.clone().transform(l.translate(0,-20)).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),s.path("M 0 0 l 0 -20").transform(this.getmatrixwithmove(b,e,f-20)).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,
fill:"rgba(0,0,0,0)"}).addClass("trace")):s.path(e.getSubpath(0,f)).transform(b).attr({stroke:this.color,display:TRACE?"block":"none",strokeWidth:"20px",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace").appendTo(VIEWPORT),this.show())},getmatrixwithmove:function(b,e,f){var l=e.getTotalLength();b=b.clone();if(0==l)return b;this.islarge?20>=f?b.translate(0,-f):(l=f>l+20?f-l-20:0,e=e.getPointAtLength(f-l-20),b.translate(e.x,-20+e.y).rotate(e.alpha-90,0,0).translate(0,-l)):(e=e.getPointAtLength(f),
b.translate(e.x,e.y).rotate(e.alpha-90,0,0));return b},removestresstoken:function(){0<this.stress&&(this.stress--,this.animateremovetoken("xstresstoken"),this.movelog("st"),this.show())},handledifficulty:function(b){"RED"==b?this.addstress():"GREEN"==b&&0<this.stress&&this.removestresstoken()},premove:function(){},revealmaneuver:function(b){},completemaneuver:function(b,e,f,l){var m=P[b].path,h,q=m.getTotalLength(),t=this.m.clone();b.match(/RF1|RR1|RL1/)&&(t=t.rotate(180,0,0));this.islarge&&(q+=40);
this.moves=[this.getmatrixwithmove(t,m,q)];this.moves[0].move=b;this.maneuverdifficulty=e;if("F0"==b)this.hasmoved=!0,f&&(this.m.rotate(180,0,0),this.movelog("m-"+b+"-180-"+Math.floor(q))),this.handledifficulty(e),this.lastmaneuver=this.maneuver,this.endmaneuver(),this.touching=[];else{this.collision=!1;this.showhitsector(!1);h=this.moves[0];var w=this.getcollidingunits(h),y=[];if(0<w.length)for(this.log("collides with %0: no action",w[0].name),this.collision=!0;0<q&&0<w.length;)y=w,--q,h=this.getmatrixwithmove(t,
m,q),w=this.getcollidingunits(h);this.drawpathmove(t,m,q);for(i=0;i<this.touching.length;i++)w=this.touching[i],w.touching.splice(w.touching.indexOf(this),1);this.touching=y;this.ocollision=this.getocollisions(t,h,m,q);this.isfireobstructed()&&this.log("overlaps obstacle: cannot attack");this.hascollidedobstacle()&&this.log("unit or template overlaps obstacle: no action");0<q&&(this.m=h);var v=0;0<q?(this.hasmoved=!0,$("#activationdial").empty(),FAST||SOUNDS[this.ship.flysnd].play(),Snap.animate(0,
q,function(e){h=this.getmatrixwithmove(t,m,e);b.match(/RF1|RR1|RL1/)&&h.rotate(180,0,0);this.g.transform(h);this.geffect.transform(h)}.bind(this),TIMEANIM*q/200,mina.linear,function(){this.collision||(b.match(/K\d|SR\d|SL\d|RF1|RR1|RL1/)||1==f?(this.m.rotate(180,0,0),v=180):b.match(/TRL\d/)?(this.m.rotate(-90,0,0),v=-90):b.match(/TRR\d/)&&("undefined"!=typeof l?this.m=l:this.m.rotate(90,0,0),v=90));this.movelog("m-"+b+"-"+(360+v)%360+"-"+Math.floor(q));this.handledifficulty(e);this.lastmaneuver=this.maneuver;
this.hascollidedobstacle()&&this.resolveocollision(this.ocollision.overlap,this.ocollision.template);if(0<this.ocollision.mine.length)for(i=0;i<this.ocollision.mine.length;i++)this.ocollision.mine[i].detonate(this,!1);this.collision&&this.resolvecollision();this.endmaneuver()}.bind(this))):(this.hasmoved=!0,this.log("cannot move"),this.handledifficulty(e),this.lastmaneuver=this.maneuver,this.collision&&this.resolvecollision(),this.endmaneuver())}},getmaneuverlist:function(){var b=this.getmaneuver(),
e={};e[b.move]=b;return"undefined"!=typeof b?e:{}},resolvemaneuver:function(){$("#activationdial").empty();if(!(0>this.maneuver)){var b=[],e=[],f=this.getmaneuverlist(),l;for(l in f)if(e.push(f[l]),f[l].move.match(/TRR\d|TRL\d/))for(var m=this.gettallonrollmatrix(this.m,f[l].move),h=0;h<m.length;h++)b.push(m[h]),0<h&&e.push(f[l]);else 1!=f[l].halfturn||f[l].move.match(/K\d|SR\d|SL\d/)?b.push(this.getpathmatrix(this.m,f[l].move)):b.push(this.getpathmatrix(this.m,f[l].move).rotate(180,0,0));this.resolveactionmove(b,
function(f,h){-1==h&&(h=0);var l=e[h].move,m=e[h].difficulty;1!=e[h].halfturn&&(e[h].halfturn=!1);this.completemaneuver(l,m,e[h].halfturn,b[h])}.bind(this),!1,!0)}},endmaneuver:function(){var b=this.ionized;if(this.hasionizationeffect())for(var e=0;e<b;e++)this.removeiontoken();this.maneuver=-1;this.hasmoved=!0;this.show();this.moves=[];this.checkdead()?this.shield=this.hull=0:this.doendmaneuveraction();this.cleanupmaneuver()},cleanupmaneuver:function(){this.actionbarrier()},unlock:function(b){this.show();
return this.deferred.resolve(b)},newlock:function(){this.deferred=$.Deferred();return this.deferred.promise()},enddecloak:function(){return this.newlock()},candomaneuver:function(){return-1<this.maneuver},addafterattackeffect:function(b,e){this.wrap_after("afterattackeffect",b,e)},addafterdefenseeffect:function(b,e){this.wrap_after("afterdefenseeffect",b,e)},isattacktwice:function(){return!1},addattack:function(b,e,f,l,m,h,q){var t=this;"undefined"==typeof h&&(h="endattack");"undefined"==typeof q&&
(q=!1);(q?Unit.prototype:this).wrap_after(h,e,function(q,y){var w=!1;"removeshield"==h||"endattack"==h||"warndeath"==h?attacker=activeunit:"undefined"==typeof attacker&&(attacker=this);for(i in f)if(f[i].isactive){w=!0;break}if(b.call(t,q,y,attacker)&&t.noattack<round&&w&&!t.iscloaked&&!t.isfireobstructed()){var z=attacker.deferred,w=function(){var h,t=[];this.deferred=z;h="function"==typeof m?m.call(this):this.selectnearbyenemy(3);for(var w in f)f[w].isactive&&0<f[w].getenemiesinrange(h).length&&
t.push(f[w]);0==t.length?(this.log("no available target for %0",e.name),this.cleanupattack()):b.call(this,q,y,attacker)?(this.log("+1 attack [%0]",e.name),"function"==typeof l&&this.wrap_before("resolveattack",this,function(){l.call(this)}.bind(this)).unwrapper("cleanupattack"),this.maxfired++,this.doattack(t,h)):this.cleanupattack()}.bind(t);"endcombatphase"!=h&&"warndeath"!=h&&phase==COMBAT_PHASE?attacker.newlock().done(w):w()}})},candoendmaneuveraction:function(){return this.candoaction()&&!this.collision&&
!this.hascollidedobstacle()},doendmaneuveraction:function(){return this.doaction(this.getactionlist(!0),"",this.candoendmaneuveraction)},doselection:function(b,e){return this.enqueueaction(b,e)},isactiondone:function(b){return-1!=this.actionsdone.indexOf(b)},doaction:function(b,e,f){"undefined"==typeof f&&(f=this.candoaction);return 0==b.length?(this.log("no action available"),this.enqueueaction(function(b){this.endnoaction(b)}.bind(this),this.name)):this.enqueueaction(function(l){var m;$("#actiondial").empty();
if(f.call(this)){this.select();"undefined"!=typeof e&&""!=e&&this.log(e);$("#actiondial").html($("<div>"));for(m=0;m<b.length;m++)this.isactiondone(b[m].name)||function(e,f){var h=$("<div>").addClass("symbols").text(A[e.type].key).click(function(){this.resolveaction(e,l)}.bind(this));"BOMB"==e.type&&h.addClass("bombs");h.attr("title",b[m].name);"/2"==b[m].name.slice(-2)&&h.css("color","yellow");$("#actiondial > div").append(h)}.call(this,b[m],m);var h=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){this.resolveaction(null,
l)}.bind(this));$("#actiondial > div").append(h)}else this.endaction(l,null)}.bind(this),b[0].name)},donoaction:function(b,e,f,l){return 0==b.length?(this.log("no action available"),this.enqueueaction(function(b){this.endnoaction(b)}.bind(this),this.name)):this.enqueueaction(function(m){var h;"undefined"!=typeof e&&""!=e&&this.log(e);this.select();$("#actiondial").html($("<div>"));for(h=0;h<b.length;h++)(function(b,e){var f=$("<div title='"+b.name+"'>").addClass("symbols").text(A[b.type].key).click(function(){this.resolvenoaction(b,
m)}.bind(this));$("#actiondial > div").append(f)}).call(this,b[h],h);1==f&&(h=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){"function"==typeof l&&l();this.resolvenoaction(null,m)}.bind(this)),$("#actiondial > div").append(h))}.bind(this),b[0].name)},hasnostresseffect:function(){return 0==this.stress},candoaction:function(){return this.hasnostresseffect()},candecloak:function(){return this.iscloaked&&phase==ACTIVATION_PHASE&&!this.hasdecloaked},selecttargetforattack:function(b,
e){var f;ENGAGED=!0;f=this.weapons[b].getenemiesinrange(e);if(0==f.length)return this.log("no target for %0",this.weapons[b].name),this.cleanupattack(),!1;$("#attackdial").empty();this.selectunit(f,function(e,f){this.declareattack(b,e[f])?this.resolveattack(b,e[f]):this.cleanupattack()},[""],!1);return!0},showattack:function(b,e){var f=[],l,m;$("#attackdial").show();"undefined"==typeof b&&(b=this.weapons);var h=this.getenemiesinrange(b,e),q=$("<div>");for(l=m=0;m<b.length;m++)0<h[m].length&&(f[l++]=
this.weapons.indexOf(b[m]));var t=this;for(l=0;l<f.length;l++)(function(b){var f=A[t.weapons[b].type.toUpperCase()];q.append($("<div>").attr({"class":"symbols "+b.color}).html(f.key).click(function(){t.selecttargetforattack(b,e)}))})(f[l]);q.append($("<button>").attr({"class":"m-skip wbutton"}).click(function(){this.cancelattack()}.bind(this)));$("#attackdial").html(q)},cancelattack:function(){this.addhasfired();this.show();this.cleanupattack()},candotarget:function(){return 0<this.gettargetableunits(3).length},
candofocus:function(){return!0},candoevade:function(){return!0},candropbomb:function(){return this.lastdrop!=round&&this.getskill()==skillturn},addactivationdial:function(b,e,f,l){this.activationdial.push({pred:b,action:e,html:f,elt:l})},actionbarrier:function(){actionrlock=$.Deferred();this.areactionspending()?actionrlock.done(function(){this.unlock()}.bind(this)):(actionrlock.resolve(),this.unlock())},addafteractions:function(b){actionrlock.done(b)},areactionspending:function(){for(var b=0;b<actionr.length;b++)if("pending"==
actionr[b].state())return!0;return!1},dodecloak:function(){this.iscloaked?this.resolvedecloak():this.hasdecloaked=!0;this.actionbarrier()},getbomblocation:function(){return["F1"]},getbombposition:function(b,e){for(var f=[],l=0;l<b.length;l++)f.push(this.getpathmatrix(this.m.clone().rotate(180,0,0),b[l]).translate(0,(this.islarge?40:20)-e));return f},bombdropped:function(){},updateactivationdial:function(){var b=this;this.activationdial=[];if(!(this.candropbomb()&&this.hasionizationeffect()||b.lastdrop==
round))switch(this.bombs.length){case 3:this.bombs[2].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[2].canbedropped()},function(){b.lastdrop=round;$(".bombs").remove();b.bombs[2].actiondrop()},A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[2].name}));case 2:this.bombs[1].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[1].canbedropped()},function(){b.lastdrop=round;$(".bombs").remove();b.bombs[1].actiondrop()},
A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[1].name}));case 1:this.bombs[0].canbedropped()&&this.addactivationdial(function(){return b.lastdrop!=round&&b.bombs[0].canbedropped()},function(){b.lastdrop=round;$(".bombs").remove();b.bombs[0].actiondrop()},A.BOMB.key,$("<div>").attr({"class":"symbols bombs",title:b.bombs[0].name}))}return this.activationdial},doactivation:function(){this.hasionizationeffect()||this.revealmaneuver(this.maneuver);this.showactivation()},showactivation:function(){$("#activationdial").html("<div></div>");
if(this.timeformaneuver()&&!this.areactionspending()){for(var b=this.updateactivationdial(),e=0;e<b.length;e++)(function(e){var f=b[e];f.pred()&&f.elt.appendTo("#activationdial > div").click(function(){$("#activationdial").html("<div></div>");f.action()}).html(f.html)})(e);$("<button>").addClass("m-move").addClass("wbutton").click(function(){this.resolvemaneuver()}.bind(this)).appendTo("#activationdial > div")}},movelog:function(b){b.match(/L-%%.*/)&&this.setinfo(decodeURIComponent(b.substring(4,
b.length-2))).delay(1500).fadeOut(400);ANIM+="_"+this.id+"-"+b},computepoints:function(){},error:function(b){b=formatstring(b);log("<div><span style='color:red;font-weight:bold;'>**ERROR** ["+this.name+"]</span> "+b+"</div>")},log:function(b,e,f,l){NOLOG||("undefined"!=typeof UI_translation[b]&&(b=UI_translation[b]),"string"==typeof e&&(e=translate(e)),b=b.replace(/%0/g,e),"string"==typeof f&&(f=translate(f)),b=b.replace(/%1/g,f),"string"==typeof l&&(l=translate(l)),b=b.replace(/%2/g,l),b=formatstring(b),
log("<div><span style='color:"+this.color+"'>["+this.name+"]</span> "+b+"</div>"))},candocloak:function(){return!this.iscloaked},clearaction:function(){this.action=-1},showaction:function(){if(this.action<this.actionList.length&&-1<this.action){var b=A[this.actionList[this.action].type].color;this.actionicon.attr({fill:this==activeunit?b:halftone(b)})}else this.actionicon.attr({text:""})},showinfo:function(){var b=0,e=$("#"+this.id+" .usabletokens").html(),f=this.getusabletokens();$("#"+this.id+" .usabletokens").html(f);
if(e!=f)for(var l in squadron)e=squadron[l],this.isally(e)&&this.getskill()>=e.getskill()&&e.showoverflow();0<this.focus&&this.infoicon[b++].attr({text:A.FOCUS.key,fill:A.FOCUS.color});0<this.evade&&this.infoicon[b++].attr({text:A.EVADE.key,fill:A.EVADE.color});1==this.iscloaked&&this.infoicon[b++].attr({text:A.CLOAK.key,fill:A.CLOAK.color});0<this.targeting.length&&6>b&&this.infoicon[b++].attr({text:A.TARGET.key,fill:A.TARGET.color});0<this.istargeted.length&&this.infoicon[b++].attr({text:A.ISTARGETED.key,
fill:A.ISTARGETED.color});0<this.stress&&6>b&&this.infoicon[b++].attr({text:A.STRESS.key,fill:A.STRESS.color});0<this.ionized&&6>b&&this.infoicon[b++].attr({text:"Z",fill:A.STRESS.color});0<this.tractorbeam&&6>b&&this.infoicon[b++].attr({text:"Y",fill:A.STRESS.color});for(l=b;6>l;l++)this.infoicon[b++].attr({text:""})},showoutline:function(){this.border.attr({stroke:activeunit==this?this.color:halftone(this.color)})},dock:function(b){this.isdocked=!0;$("#"+this.id).attr("onclick","");$("#"+this.id).addClass("docked");
$("#"+this.id).html(""+this);this.g.attr({display:"none"});this.geffect.attr({display:"none"});this.log("docked on %0",b.name);this.show();b.docked=this},deploy:function(b,e){this.movelog("DPY");$("#"+this.id).removeClass("docked");$("#"+this.id).html(""+this);$("#"+this.id+" .outoverflow").each(function(b){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")});$("#"+this.id).click(function(){this.select()}.bind(this));this.g.attr({display:"block"});this.geffect.attr({display:"block"});
this.m=b.m.clone();this.isdocked=!1;this.log("deploying from %0",b.name);this.show();b.docked=null;this.log("select maneuver for deployment");b.doselection(function(f){this.resolveactionmove(e,function(b,e){var f=this.getdial().length;e>=f?(this.m.translate(0,-20),e-=f):this.m.translate(0,20).rotate(180,0,0);this.maneuver=e;this.resolvemaneuver()}.bind(this),!1,!0);b.endnoaction(f,"DEPLOY")}.bind(this))},endcombatphase:function(){$(".fireline").remove()},endphase:function(){},beginsetupphase:function(){},
endsetupphase:function(){},beginplanningphase:function(){this.actionsdone=[];return this.newlock()},beginactivationphase:function(){return this.newlock()},timetoshowmaneuver:function(){return-1<this.maneuver&&phase<=ACTIVATION_PHASE},getmaneuver:function(){return this.hasionizationeffect()?{move:"F1",difficulty:"WHITE"}:this.getdial()[this.maneuver]},showmaneuver:function(){if(this.timetoshowmaneuver()){var b=this.getmaneuver(),e=C["undefined"!=typeof this.forceddifficulty?this.forceddifficulty:b.difficulty];
activeunit!=this&&(e=halftone(e));this.dialspeed.attr({text:P[b.move].speed,fill:e});this.dialdirection.attr({text:P[b.move].key,fill:e})}},clearmaneuver:function(){this.dialspeed.attr({text:""});this.dialdirection.attr({text:""})},beginactivation:function(){this.showmaneuver();this.show()},endactivationphase:function(){},endplanningphase:function(){},hasionizationeffect:function(){return 0<this.ionized&&!this.islarge||1<this.ionized},begincombatphase:function(){return this.newlock()},beginattack:function(){},
toString:function(){var b,e;this.shipname=SHIP_translation[this.ship.name];"undefined"==typeof SHIP_translation[this.ship.name]&&(this.shipname=this.ship.name);this.translatedname=translate(this.name);if(phase==SELECT_PHASE)return e=PILOTS[this.pilotid].dict,1==PILOTS[this.pilotid].ambiguous&&"undefined"!=typeof PILOTS[this.pilotid].edition&&(e+="-"+PILOTS[this.pilotid].edition.toLowerCase().replace(" ","")),this.imgname=e,this.isunique=1==PILOTS[this.pilotid].unique?!1:!0,this.fire=this.weapons[0].getattack(),
this.diallist=dial2JSON(this.getdial()),Mustache.render(TEMPLATES["unit-creation"],this);b=formatstring(getpilottexttranslation(this,this.faction));this.id=squadron.indexOf(this);this.tooltip=""!=b?[b]:[];b=8+2*this.upgrades.length;this.shieldpts3=this.hullpts3=this.shieldpts2=this.hullpts2="";this.hull+this.shield<=b?(this.hullpts=repeat("u ",this.hull),this.shieldpts=repeat("u ",this.shield)):this.hull>b?(this.hullpts=repeat("u ",this.hull),this.shieldpts="",this.hull<=2*b?(this.hullpts2=repeat("u ",
this.hull-b),this.shield+this.hull<=2*b?this.shieldpts2=repeat("u ",this.shield):(this.shieldpts2=repeat("u ",2*b-this.hull),this.shieldpts3=repeat("u ",this.shield-2*b))):(this.hullpts2=repeat("u ",b),this.hullpts3=repeat("u ",this.hull-2*b),this.shieldpts3=repeat("u ",this.shield))):(this.hullpts=repeat("u ",this.hull),this.shieldpts=repeat("u ",b-this.hull),this.shieldpts2=repeat("u ",this.shield-b+this.hull));this.isinleft=1==this.team;this.conds=[];for(e in this.conditions)this.conds.push(this.conditions[e]);
return Mustache.render(TEMPLATES["unit-combat"],this)},canusefocus:function(){return 0<this.focus},canuseevade:function(){return 0<this.evade},canusetarget:function(b){return 0<this.targeting.length&&("undefined"==typeof b||-1<this.targeting.indexOf(b))},getusabletokens:function(){this.focuses=1<this.focus?[this.focus]:[];this.evades=1<this.evade?[this.evade]:[];this.stresses=1<this.stress?[this.stress]:[];this.ionizedes=1<this.ionized?[this.ionized]:[];this.tractorbeames=1<this.tractorbeam?[this.tractorbeam]:
[];this.targetedname=[];this.targetingname=[];this.nomoreattack=this.noattack==round;for(var b=0;b<this.istargeted.length;b++)this.targetedname[b]=this.istargeted[b].name.replace(/\'/g,"");for(b=0;b<this.targeting.length;b++)this.targetingname[b]=this.targeting[b].name.replace(/\'/g,"");return Mustache.render(TEMPLATES.usabletokens,this)},showstats:function(){$("#unit"+this.id+" .statevade .val").html(this.getagility());if(phase==SELECT_PHASE)$("#unit"+this.id+" .stathull .val").html(this.ship.hull),
$("#unit"+this.id+" .statshield .val").html(this.ship.shield);else{this.skillbar.attr({text:repeat("u",this.getskill())});this.firebar.attr({text:repeat("u",this.weapons[0].getattack())});this.evadebar.attr({text:repeat("u",this.getagility())});this.hullbar.attr({text:repeat("u",this.hull)});this.shieldbar.attr({text:repeat("u",this.shield+this.hull)});var b=8+2*this.upgrades.length;this.hull+this.shield<=b?($("#"+this.id+" .stat .hull").html(repeat("u ",this.hull)),$("#"+this.id+" .stat .shield").html(repeat("u ",
this.shield))):this.hull>b?($("#"+this.id+" .stat .hull").html(repeat("u ",b)),this.hull<=2*b?($("#"+this.id+" .stat2 .hull").html(repeat("u ",this.hull-b)),this.shield+this.hull<=2*b?$("#"+this.id+" .stat2 .shield").html(repeat("u ",this.shield)):($("#"+this.id+" .stat2 .shield").html(repeat("u ",2*b-this.hull)),$("#"+this.id+" .stat3 .shield").html(repeat("u ",this.shield-2*b+this.hull)))):($("#"+this.id+" .stat2 .hull").html(repeat("u ",b)),$("#"+this.id+" .stat3 .hull").html(repeat("u ",this.hull-
2*b)),$("#"+this.id+" .stat3 .shield").html(repeat("u ",this.shield)))):($("#"+this.id+" .stat .hull").html(repeat("u ",this.hull)),$("#"+this.id+" .stat .shield").html(repeat("u ",b-this.hull)),$("#"+this.id+" .stat2 .shield").html(repeat("u ",this.shield-b+this.hull)))}},showpanel:function(){var b=VIEWPORT.m.clone(),e=this.g.getBBox(),f=$("#svgout").width(),l=$("#svgout").height(),m=0,h=0;l>f?h=(l-f)/2:m=(f-l)/2;f=Math.min(f/900,l/900);m+=(b.x(e.x,e.y)+e.width/2)*f;e=h+b.y(e.x,e.y)*f;b=b.split().scalex;
$(".phasepanel").css({left:m+b*(this.islarge?40:20),top:e}).show()},timeformaneuver:function(){return this==activeunit&&-1<this.maneuver&&!this.hasmoved&&this.getskill()==skillturn&&phase==ACTIVATION_PHASE&&subphase==ACTIVATION_PHASE},showoverflow:function(){this.dead||($("#"+this.id).html(""+this),$("#"+this.id+" .outoverflow").each(function(b){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")}))},show:function(){phase==SELECT_PHASE?$("#unit"+this.id).html(this.toString()):
"undefined"!=typeof this.g&&(this.g.transform(this.m),this.g.appendTo(VIEWPORT),this.geffect.transform(this.m),this.geffect.appendTo(VIEWPORT),this.showoutline(),this.flameno++,this.showstats(),this.showinfo(),activeunit==this&&(this.showpanel(),this.showdial(),this.showmaneuver(),phase==ACTIVATION_PHASE&&this.showactivation(),ENGAGED||phase!=COMBAT_PHASE||(!this.canfire()||this.areactionspending()||INREPLAY?$("#attackdial").empty():this.showattack(this.activeweapons,this.activeenemies)),this.showoverflow()))},
updatetohit:function(b,e){var f=this.weapons[e],l=f.getenemiesinrange();if(b)for(m in l)l[m].tohitstats[this.id]={unit:this,weapon:e};else for(var m in l)delete l[m].tohitstats[this.id];for(m in l){var h=l[m];NOLOG=!0;var q=1,t=0,w=0,y=h.focus,v=h.evade,z,B;for(B in h.tohitstats){var E=h.tohitstats[B],f=E.weapon;if("undefined"!=typeof E.unit){var D=E.unit.evaluatetohit(E.weapon,h),q=q*(1-D.tohit/100),t=t+D.meanhit,w=w+D.meancritical;0<h.focus&&h.focus--;0<h.evade&&h.evade--;for(z=[];"function"==typeof E.unit.weapons[f].followupattack&&
-1==z.indexOf(f);)z.push(f),f=E.unit.weapons[f].followupattack(),D=E.unit.evaluatetohit(f,h),q*=1-D.tohit/100,t+=D.meanhit,w+=D.meancritical,0<h.focus&&h.focus--,0<h.evade&&h.evade--}}h.tohitstats.tohit=q;h.tohitstats.meanhit=t;h.tohitstats.meancrit=w;h.evade=v;h.focus=y;NOLOG=!1}},displaytohit:function(b){b=this.weapons[b].getenemiesinrange();for(var e in b){var f=b[e],l=1-f.tohitstats.tohit,m=f.tohitstats.meanhit,h=f.tohitstats.meancrit;if(0==m)f.gproba.attr({display:"none"});else{var q=-f.m.split().rotate;
f.gproba.transform("r "+q+" 0 0").attr({display:"block"});f.tohit.attr({text:Math.floor(100*l)+"%"});f.meanhit.attr({text:Math.floor(100*m)/100});f.meancrit.attr({text:Math.floor(100*h)/100})}f.show()}},showhitsector:function(b,e){this.select();"undefined"==typeof e&&(e=0);var f=this.weapons[e];if(b){var l=f.getlowrange(),m=f.gethighrange();if(f.isTurret()||this.isTurret(f))this.showrange(b,l,m);else{var h;if(1==l){for(h=l;h<=m;h++)this.sectors.push(s.path(this.getPrimarySectorString(h,this.m)).attr({fill:this.color,
stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));if("undefined"!=typeof f.auxiliary)for(f=f.auxiliary,h=l;h<=m;h++)this.sectors.push(s.path(f.call(this,h,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT))}else{for(h=l;h<=m;h++)this.sectors.push(s.path(this.getPrimarySubSectorString(l-1,h,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));if("undefined"!=typeof f.subauxiliary)for(f=
f.subauxiliary,h=l;h<=m;h++)this.sectors.push(s.path(f.call(this,l-1,h,this.m.clone())).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT))}}}else{for(h=0;h<this.sectors.length;h++)this.sectors[h].remove();for(h=0;h<this.ranges.length;h++)this.ranges[h].remove();this.ranges=[];this.sectors=[]}this.updatetohit(b,e);this.displaytohit(e)},showrange:function(b,e,f){this.select();if(b)if(1==e)for(b=e;b<=f;b++)this.ranges.push(s.path(this.getRangeString(b,this.m)).attr({fill:this.color,
stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));else for(b=e;b<=f;b++)this.ranges.push(s.path(this.getSubRangeString(e-1,b,this.m)).attr({fill:this.color,stroke:this.color,opacity:.1,pointerEvents:"none"}).appendTo(VIEWPORT));else{for(b=0;b<this.ranges.length;b++)this.ranges[b].remove();this.ranges=[]}},togglehitsector:function(b){this.showhitsector(0<this.sectors.length+this.ranges.length?!1:!0,b)},togglerange:function(){this.showrange(0<this.ranges.length?!1:!0,1,3)},isPointInside:function(b,
e){for(var f=0;f<e.length;f++)if(Snap.path.isPointInside(b,e[f].x,e[f].y))return!0;return!1},isinsector:function(b,e,f,l,m,h){f=f.getOutlineString(f.m);b=1<e?l.call(this,e-1,e,b):m.call(this,e,b);return null!=b&&(0<Snap.path.intersection(f.s,b).length||this.isPointInside(b,f.p))},isinfiringarc:function(b){return 3>=this.getsector(b)},isinprimaryfiringarc:function(b){return 3>=this.getprimarysector(b)},isinauxiliaryfiringarc:function(b){return 3>=this.getauxiliarysector(b)},getsector:function(b,e){return this.weapons[0].getsector(b)},
getprimarysector:function(b,e){var f;"undefined"==typeof e&&(e=this.m);var l=this.getoutlinerange(e,b).d;for(f=l;f<=l+1&&3>=f;f++)if(this.isinsector(e,f,b,this.getPrimarySubSectorString,this.getPrimarySectorString))return f;return 4},getauxiliarysector:function(b,e,f,l){var m;"undefined"==typeof e&&(e=this.m);"undefined"==typeof f&&(f=this.weapons[0].subauxiliary,l=this.weapons[0].auxiliary);var h=this.getoutlinerange(e,b).d;for(m=h;m<=h+1&&3>=m;m++)if(this.isinsector(e,m,b,f,l))return m;return 4},
isinoutline:function(b,e,f){return this.isPointInside(b,e.getOutlinePoints(f))},checkcollision:function(b){return-1<this.touching.indexOf(b)},resolvecollision:function(){var b;"undefined"==typeof this.touching&&(this.touching=[]);for(b=0;b<this.touching.length;b++){var e=this.touching[b];-1==e.touching.indexOf(this)&&(e.touching.push(this),e.collidedby(this))}},collidedby:function(b){},canhavehitocollision:function(){return!0},canhavecriticalocollision:function(){return!0},resolveocollision:function(b,
e){var f;-1==e.indexOf(b)&&-1<b&&e.push(b);for(f=0;f<e.length;f++){var l=this.rollattackdie(1,OBSTACLES[e[f]],"blank")[0];switch(l){case "focus":this.log("roll for collision: <span class='focusreddice'></span>");break;case "hit":this.log("roll for collision: <span class='hitreddice'></span>");break;case "blank":this.log("roll for collision: <span class='blankreddice'></span>");break;case "critical":this.log("roll for collision: <span class='criticalreddice'></span>")}OBSTACLES[e[f]].type==ROCK?"hit"==
l&&this.canhavehitocollision()?(this.log("+1 %HIT% [collision]"),this.resolvehit(1),this.checkdead()):"critical"==l&&this.canhavecriticalocollision()&&(this.log("+1 %CRIT% [collision]"),this.resolvecritical(1),this.checkdead()):OBSTACLES[e[f]].type==DEBRIS&&(this.addstress(),"critical"==l&&(this.log("+1 %CRIT% [debris collision]"),this.resolvecritical(1),this.checkdead()))}},addshield:function(b){this.movelog("S-"+b);this.shield<this.ship.shield&&this.animateaddtoken("cshield");this.shield+=b;return this.shield>
this.ship.shield?(this.shield=this.ship.shield,!0):!1},addhull:function(b){this.movelog("H-"+b);this.hull<this.ship.hull&&this.animateaddtoken("chull");this.hull+=b;this.hull>this.ship.hull&&(this.hull=this.ship.hull)},animateremovetoken:function(b){if(!FAST){var e=VIEWPORT.m.clone(),f=$("#svgout").width(),l=$("#svgout").height(),m=0,h=0;l>f?h=(l-f)/2:m=(f-l)/2;var q=Math.max(900/f,900/l),t=this.g.getBBox(),f=$("#svgout").offset();$("#playmat").width();$("#playmat").height();l=e.x(t.x,t.y)/q;l+=f.left+
m;e=e.y(t.x,t.y)/q;e+=f.top+h;$("<div>").addClass("upanim").css({left:l,top:e}).html("<code class='"+b+"'></code>").appendTo("body").show()}},animateaddtoken:function(b){if(!FAST){var e=VIEWPORT.m.clone(),f=$("#svgout").width(),l=$("#svgout").height(),m=0,h=0;l>f?h=(l-f)/2:m=(f-l)/2;var q=Math.max(900/f,900/l),t=this.g.getBBox(),f=$("#svgout").offset();$("#playmat").width();$("#playmat").height();l=e.x(t.x,t.y)/q;l+=f.left+m;e=e.y(t.x,t.y)/q;e+=f.top+h;$("<div>").addClass("downanim").css({left:l,
top:e}).html("<code class='"+b+"'></code>").appendTo("body").show()}},removeshield:function(b){0<this.shield&&this.animateremovetoken("cshield");this.shield-=b;this.movelog("s-"+b);0>this.shield&&(this.shield=0);var e=TEAMS[this.team].history.rawdata;"undefined"==typeof e[round]&&(e[round]={hits:0,dead:""});e[round].hits+=b},resolvehit:function(b){var e=0;if(0==b)return 0;this.shield>b?this.removeshield(b):(e=b-this.shield,this.removeshield(this.shield),0<e&&this.applydamage(e));this.show();return e},
resolvecritical:function(b){var e=0;if(0==b)return 0;this.shield>b?this.removeshield(b):(e=b-this.shield,this.removeshield(this.shield),0<e&&this.applycritical(e));this.show();return e},removehull:function(b){0<this.hull&&this.animateremovetoken("chull");this.hull-=b;this.movelog("h-"+b);var e=TEAMS[this.team].history.rawdata;"undefined"==typeof e[round]&&(e[round]={hits:0,dead:""});e[round].hits+=b;this.log("-%0 %HULL%",b);this.hull<=this.ship.hull/2&&this.imgsmoke.attr({display:"block"});1==this.hull&&
(this.imgsmoke.attr({display:"none"}),this.imgflame.attr({display:"block"}))},selectunit:function(b,e,f,l){l&&b.push(this);0<b.length&&this.doselection(function(m){"undefined"!=typeof f&&""!=f[0]&&this.log.apply(this,f);this.resolveactionselection(b,function(f){l&&this==b[f]||e.call(this,b,f);this.endnoaction(m,"SELECT")}.bind(this))}.bind(this),"selectunit")},selectcritical:function(b,e){var f=function(b,f){$("#actiondial").empty();e(b);this.endnoaction(f,"CRITICAL")}.bind(this);this.doselection(function(e){var l;
$("#actiondial").empty();for(l=0;l<b.length;l++)(function(h){var l=$("<button>").text(CRITICAL_DECK[b[h]].name).click(function(){f(b[h],e)}.bind(this));$("#actiondial").append(l)}).call(this,l);$("#actiondial").show()}.bind(this),"critical")},selectupgradetodesactivate:function(b,e){var f=function(b,f){$("#actiondial").empty();null!=b&&(b.desactivate(),b.unit.show(),e.desactivate(),this.log("desactivating %0 [%1]",b.name,this.name));this.endnoaction(f,"CREW")}.bind(this);this.doselection(function(e){var l;
$("#actiondial").empty();for(l=0;l<b.length;l++)(function(h){var l=$("<button>").text(b[h].name).click(function(){f(b[h],e)});$("#actiondial").append(l)}).call(this,l);l=$("<button>").addClass("m-skip").addClass("wbutton").click(function(){f(null,e)});$("#actiondial").append(l);$("#actiondial").show()}.bind(this),"upgrade")},selectdamage:function(){var b,e=0;for(b=0;b<CRITICAL_DECK.length;b++)-1<CRITICAL_DECK[b].version.indexOf(CURRENT_DECK)&&(e+=CRITICAL_DECK[b].count);var f=this.rand(e);for(b=e=
0;b<CRITICAL_DECK.length;b++)if(-1<CRITICAL_DECK[b].version.indexOf(CURRENT_DECK)&&(e+=CRITICAL_DECK[b].count,e>f))return b;return 0},applydamage:function(b){var e,f;for(f=0;f<b;f++){e=this.selectdamage();CRITICAL_DECK[e].count--;var l=new Critical(this,e);this.deal(l,FACEDOWN).done(function(b){switch(b.face){case FACEUP:b.crit.faceup(),this.movelog("c-"+e);case FACEDOWN:this.removehull(1);this.checkdead();break;case DISCARD:this.criticals.slice(this.criticals.indexOf(l),1)}this.show()}.bind(this))}},
applycritical:function(b){var e,f;for(f=0;f<b;f++){e=this.selectdamage();CRITICAL_DECK[e].count--;var l=new Critical(this,e);this.deal(l,FACEUP).done(function(b){switch(b.face){case FACEUP:b.crit.faceup(),this.movelog("c-"+e);case FACEDOWN:this.removehull(1);break;case DISCARD:this.criticals.slice(this.criticals.indexOf(l),1)}this.show()}.bind(this))}},deal:function(b,e){return $.Deferred().resolve({crit:b,face:e})},gethitrange:function(b,e){return this.isally(e)?0:this.weapons[b].getrange(e)},getenemiesinrange:function(b,
e){var f,l=[];"undefined"==typeof b&&(b=this.weapons);for(f=0;f<b.length;f++)l[f]=b[f].getenemiesinrange(e);return l},getrange:function(b){return this.getoutlinerange(this.m,b).d},getdist:function(b,e){var f=this.getOutlinePoints(b),l=e.getOutlinePoints(e.m),m=-1,h,q;for(h=0;h<f.length;h++)for(q=0;q<l.length;q++){var t=dist(l[q],f[h]);if(t<m||-1==m)m=t}return m},getoutlinerange:function(b,e){var f=this.getOutlinePoints(b),l=e.getOutlinePoints(e.m),m=90001,h,q,t=0,w=!1,y,v;for(h=0;4>h;h++)for(q=0;4>
q;q++){var z=dist(l[q],f[h]);z<m&&(m=z,y=h,v=q)}if(9E4<m)return{d:4,o:!1};q=l[v].x-f[y].x;var z=l[v].y-f[y].y,B=-f[y].x*z+f[y].y*q;if(0<OBSTACLES.length)for(t=0;t<OBSTACLES.length;t++)if(OBSTACLES[t].type!=NONE){var E=OBSTACLES[t].getOutlineString().p;if(0==E.length||OBSTACLES[t].type==BOMB)break;var D=E[0].x*z-E[0].y*q+B,K=D;for(h=1;h<E.length&&!(dist(l[v],E[h])<1.2*m&&dist(f[y],E[h])<1.2*m&&(K=E[h].x*z-E[h].y*q+B,0>K*D));h++);if(0>K*D)break}t<OBSTACLES.length&&(w=!0);return 1E4>=m?{d:1,o:w}:4E4>=
m?{d:2,o:w}:{d:3,o:w}},getrangeallunits:function(){var b=[[],[],[],[],[]],e;for(e in squadron){var f=squadron[e];f!=this&&(f=this.getrange(f),b[f].push({unit:e}))}return b}};var IACOMPUTING=0,JOUSTER=0,ALONE=1;function IAUnit(){}
IAUnit.prototype={IAinit:function(){this.init={shield:this.shield,hull:this.hull,m:this.m}},confirm:function(b){return!0},guessevades:function(b,e){this.rand(b.dice+1)==FE_evade(b.roll)&&(this.log("guessed correctly the number of evades ! +1 %EVADE% [%0]",self.name),b.roll+=FE_EVADE,b.dice+=1);e.resolve(b)},findpositions:function(b){var e=[],f,l=[GREEN,WHITE,YELLOW,RED];for(f=0;f<b.length;f++){var m=b[f];if(m.color!=BLACK){var h=this.getpathmatrix(this.m,b[f].move),q=24-8*l.indexOf(m.color);m.color==
RED&&(q-=20);m.color==BLACK&&(q=-100);var t=this.m;this.m=h;h=this.evaluateposition();q+=h.self-h.enemy-h.dist;"RED"==m.difficulty&&(q-=1.5);this.m=t;e.push({n:q,m:f})}}return e},findallpositions:function(b){var e,f,l,m=[],h=[GREEN,WHITE,YELLOW,RED,BLACK];for(f=0;f<b.length;f++){e=b[f];l=24-8*h.indexOf(e.color);e.color==WHITE&&(l+=8);e.color==RED&&(l-=20);e.color==BLACK&&(l=-100);"RED"==e.difficulty&&(l-=1.5);l*=this.squad.length;for(e=0;e<this.squad.length;e++){var q=this.squad[e],t=q.getpathmatrix(q.m,
b[f].move),w=q.m;q.m=t;t=q.evaluateposition();l+=t.self-1*t.enemy-t.dist;q.m=w}m.push({n:l,m:f})}return m},computeallmaneuvers:function(){var b,e=[];this.getdial();var f=this.getskill();for(b in squadron){var e=squadron[b],l=e.getskill();e.oldm=e.m;l<f&&(e.team!=this.team?(e.meanmround!=round&&e.evaluatemoves(!1,!1),e.m=e.meanm):("undefined"==typeof e.futurem&&(e.futurem=e.m),e.m=e.futurem))}this.evaluategroupmoves();e=this.findallpositions(this.captaingd);for(b in squadron)squadron[b].m=squadron[b].oldm;
if(0<e.length){e.sort(function(b,e){return e.n-b.n});f=this.captaingd[e[0].m].idx;l=this.captaingd[e[0].m].move;for(b=0;b<f.length;b++)e=this.squad[b],e.lastmaneuver=e.maneuver,e.maneuver=f[b],e.futurem=e.getpathmatrix(e.m,l);nextplanning()}else console.log("(q=vide) UNDEFINED GD FOR "+this.name);this.log("Group maneuver set")},computemaneuver:function(){var b,e=0,e=[],f=this.getdial(),e=this.getskill();for(b in squadron){var l=squadron[b],m=l.getskill();l.oldm=l.m;m<e&&(l.team!=this.team?(l.meanmround!=
round&&l.evaluatemoves(!1,!1),l.m=l.meanm):("undefined"==typeof l.futurem&&(l.futurem=l.m),l.m=l.futurem))}this.evaluatemoves(!0,!0);e=this.findpositions(f);for(b in squadron)squadron[b].m=squadron[b].oldm;if(0<e.length)e.sort(function(b,e){return e.n-b.n}),e=e[0].m;else{for(b=0;b<f.length&&"RED"==f[b].difficulty&&!f[b].move.match(/F\d/);b++);e=b}this.futurem=this.getpathmatrix(this.m,f[e].move);this.log("Maneuver set");return e},resolveactionselection:function(b,e){e(0)},selectcritical:function(b,
e){for(var f=0;f<b.length;f++)if(0==CRITICAL_DECK[b[f]].lethal){e(b[f]);return}e(b[0])},resolveactionmove:function(b,e,f,l,m){var h,q=!1,t=-1E3;l=-1;var w=this.m;for(h=0;h<b.length;h++)if(this.getmovecolor(b[h],!0,!0)==GREEN){var y,q=!0;"array"==typeof m?y=m[h]:(this.m=b[h],y=this.evaluateposition(),y=y.self-y.enemy-y.dist);t<y&&(t=y,l=h)}this.m=w;if(q&&-1<l){f&&(f=b[l].split(),m=this.m.split(),s.path("M "+m.dx+" "+m.dy+" L "+f.dx+" "+f.dy).appendTo(VIEWPORT).attr({stroke:this.color,display:TRACE?
"block":"none",strokeWidth:"20px",strokeLinecap:"round",strokeDasharray:"1, 30",opacity:.2,fill:"rgba(0,0,0,0)"}).addClass("trace"),this.show(),this.m=b[l],f=this.m.split(),this.movelog("am-"+Math.floor(300+f.dx)+"-"+Math.floor(300+f.dy)+"-"+Math.floor((360+Math.floor(f.rotate))%360)));b=this.getmcollisions(this.m);if(0<b.length)for(h=0;h<b.length;h++)"function"==typeof OBSTACLES[b[h]].detonate?OBSTACLES[b[h]].detonate(this):(this.log("colliding with obstacle"),this.resolveocollision(1,[]));e(this,
l)}else this.m=w,e(this,-1)},doplan:function(){$("#move").css({display:"none"});$("#maneuverdial").empty();this.squad=[];if(this.behavior==JOUSTER){for(var b in this.squad)this.captain=null,this.squad=[];this.electcaptain()}if(this.behavior==JOUSTER)if(this==this.captain){console.log("captain for team "+this.team+" is:"+this.name);console.log("surrounded by "+this.selectnearbyally(3).length+" units");IACOMPUTING++;1==IACOMPUTING&&($("#npimg").hide(),$("#npimgwait").show());var e;e=setInterval(function(){this.computeallmaneuvers();
IACOMPUTING--;0==IACOMPUTING&&($("#npimg").show(),$("#npimgwait").hide());clearInterval(e)}.bind(this),0)}else-1==this.maneuver&&(this.maneuver=0),nextplanning();else phase==PLANNING_PHASE&&-1==this.maneuver&&(IACOMPUTING++,1==IACOMPUTING&&($("#npimg").hide(),$("#npimgwait").show()),e=setInterval(function(){var b=this.computemaneuver();IACOMPUTING--;0==IACOMPUTING&&($("#npimg").show(),$("#npimgwait").hide());this.newm=this.getpathmatrix(this.m,this.getdial()[b].move);this.setmaneuver(b);clearInterval(e)}.bind(this),
0));return this.deferred},showdial:function(){$("#maneuverdial").empty();phase>=PLANNING_PHASE&&(-1==this.maneuver||this.hasmoved)&&this.clearmaneuver()},resolvedecloak:function(){for(var b=this.getdecloakmatrix(this.m),e=this.getdial()[this.maneuver].move,f=[],l=this.m,m=0;m<b.length;m++){this.m=this.getpathmatrix(b[m],e);var h=this.evaluateposition();f[m]=h.self-h.enemy-h.dist}this.m=l;this.resolveactionmove(b,function(b,e){0<e&&(this.removecloaktoken(),b.show());this.hasdecloaked=!0}.bind(this),
!0,f)},showactivation:function(){},timetoshowmaneuver:function(){return-1<this.maneuver&&skillturn>=this.getskill()&&phase==ACTIVATION_PHASE&&subphase==ACTIVATION_PHASE},doactivation:function(){this.updateactivationdial();this.timeformaneuver()&&this.resolvemaneuver()},showaction:function(){$("#actiondial").empty();if(-1<this.action&&this.action<this.actionList.length){var b=A[this.actionList[this.action]].color;this.actionicon.attr({fill:this==activeunit?b:halftone(b)})}else this.actionicon.attr({text:""})},
donoaction:function(b,e){b.sort(function(b,e){return"CRITICAL"==b.type?-1:"CRITICAL"==e.type?1:"EVADE"==b.type?-1:"EVADE"==e.type?1:"FOCUS"==b.type?-1:"FOCUS"==e.type?1:0});return this.enqueueaction(function(f){this.select();"undefined"!=typeof e&&""!=e&&this.log(e);var l=null;for(i=0;i<b.length;i++)if("CRITICAL"==b[i].type){l=b[i];break}else if("EVADE"==b[i].type&&this.candoevade()){var m=!0,h=this.getenemiesinrange();for(i=0;i<h.length;i++)if(0<h[i].length){m=!1;break}if(m){l=b[i];break}}else if("FOCUS"==
b[i].type){if(this.candofocus()){l=b[i];break}}else{l=b[i];break}this.resolvenoaction(l,f)}.bind(this),"donoaction ia")},doaction:function(b,e,f){var l;"undefined"==typeof f&&(f=this.candoaction);for(l=0;l<b.length;l++)this.setpriority(b[l]);b.sort(function(b,e){return e.priority-b.priority});return 0==b.length?this.enqueueaction(function(b){this.endnoaction(b)}.bind(this)):this.enqueueaction(function(l){var h;if(f.call(this)){this.select();"undefined"!=typeof e&&""!=e&&this.log(e);var m=null;for(h=
0;h<b.length;h++)if("CRITICAL"==b[h].type){m=b[h];break}else if("CLOAK"==b[h].type&&this.candocloak()){m=b[h];break}else if("EVADE"==b[h].type&&this.candoevade()){m=b[h];break}else if("FOCUS"==b[h].type){if(this.candofocus()){m=b[h];break}}else{m=b[h];break}this.resolveaction(m,l)}else this.endaction(l)}.bind(this),"doaction ia")},showattack:function(){},doattack:function(b,e){var f=0,l=null,m,h,q;NOLOG=!0;"undefined"==typeof b&&(b=this.weapons);var t=this.getenemiesinrange(b,e);for(h=0;h<b.length;h++){var w=
t[h];q=this.weapons.indexOf(b[h]);for(m=0;m<w.length;m++){var y=this.evaluatetohit(q,w[m]).tohit;y>f&&!w[m].isdocked&&(l=w[m],f=y,this.activeweapon=q)}}NOLOG=!1;if(null!=l)return this.selecttargetforattack(this.activeweapon,[l]);this.addhasfired();this.cleanupattack();return!1},getresultmodifiers:function(b,e,f,l){var m=this.getdicemodifiers();NOLOG=!1;for(var h=0;h<m.length;h++){var q=m[h];q.from==f&&q.to==l&&(q.type==MOD_M&&q.req(b,e)&&("function"==typeof q.aiactivate&&1!=q.aiactivate(b,e)||modroll(q.f,
h,l)),q.type==ADD_M&&q.req(b,e)&&("function"==typeof q.aiactivate&&1!=q.aiactivate(b,e)||addroll(q.f,h,l)),q.type!=REROLL_M||!q.req(activeunit,activeunit.weapons[activeunit.activeweapon],targetunit)||"function"==typeof q.aiactivate&&1!=q.aiactivate(b,e)||("function"==typeof q.f&&q.f(),reroll(e,f,l,q,h)))}return[]}};function metaUnit(){this.ordnance=!1;this.touching=[];this.evade=this.stress=this.focus=0;this.targeting=[]}
metaUnit.prototype={resolveactionselection:function(b,e){e(0)},selectcritical:function(b,e){for(var f=0;f<b.length;f++)if(0==CRITICAL_DECK[b[f]].lethal){e(b[f]);return}e(b[0])},animateaddtoken:function(){},animateremovetoken:function(){},dodecloak:function(){-1<this.shipactionList.indexOf("CLOAK")&&this.resolvedecloak()},resolvedecloak:function(){for(var b=[],e=0,f=0;f<this.moves.length;f++)for(var l=this.getdecloakmatrix(this.moves[f]),m=0;m<l.length;m++)b[e++]=l[m];this.moves=b},isactiondone:function(b){return!1},
addiontoken:function(){},addstress:function(){this.stress++},addevadetoken:function(){this.evade++},removeevadetoken:function(){this.evade--},removestresstoken:function(){this.stress--},addtarget:function(b){for(b=0;b<this.moves.length;b++)this.moves[b].targeting=[targetunit];this.targeting=[targetunit]},removetarget:function(b){console.log("removetarget meta");b=this.targeting.indexOf(b);-1<b&&this.targeting.splice(b,1)},addfocustoken:function(){this.focus++},removefocustoken:function(){this.focus--},
initcounters:function(b){b.BOOST=!1;b.ROLL=!1;b.focus=0;b.stress=0;b.evade=0;b.move="";b.reroll=0;b.targeting=[];this.m=b},resolvemaneuver:function(){var b,e,f;this.reroll=this.focus=this.evade=this.stress=this.maneuver=f=0;this.targeting=[];var l=this.getmaneuverlist(),m=[];for(b in l){var h=l[b];for(e=0;e<this.moves.length;e++){var q;this.evade=this.focus=this.stress=0;this.targeting=[];q=this.getpathmatrix(this.moves[e],h.move,h.halfturn);this.initcounters(q);this.handledifficulty(h.difficulty);
q.stress=this.stress;q.focus=this.focus;q.evade=this.evade;q.reroll=0;q.targeting=this.targeting;q.move=h.move;m[f++]=q}}this.moves=m;this.endmaneuver()},endmaneuver:function(){this.candoendmaneuveraction()&&this.doendmaneuveraction()},candoendmaneuveraction:function(){return!0},doendmaneuveraction:function(){this.doaction(this.getactionlist(!0))},movelog:function(){},showdial:function(){},showactivation:function(){},timetoshowmaneuver:function(){},doactivation:function(){this.beginactivation();this.premove();
this.dodecloak();this.resolvemaneuver();this.endactivationphase()},log:function(){},beginactivation:function(){},endactivationphase:function(){},showaction:function(){},donoaction:function(b,e){this.doaction(b,e)},resolveboost:function(){for(var b=[],e=0,f=0;f<this.moves.length;f++){var l=this.moves[f];if(!l.BOOST)for(var m=this.getboostmatrix(l),h=0;h<m.length;h++)m[h].BOOST=!0,m[h].ROLL=l.ROLL,m[h].reroll=0,m[h].stress=l.stress,m[h].focus=l.focus,m[h].evade=l.evade,m[h].move=l.move,m[h].targeting=
l.targeting,b[e++]=m[h];b[e++]=l}this.moves=b;this.endaction(0,"BOOST")},resolvefocus:function(){for(var b=[],e=0;e<this.moves.length;e++)b[e]=this.moves[e].clone(),b[e].stress=this.moves[e].stress,b[e].move=this.moves[e].move,b[e].evade=this.moves[e].evade,b[e].targeting=this.targeting,b[e].reroll=0,b[e].focus=1;this.moves=b;this.endaction(0,"FOCUS")},resolveevade:function(){for(var b=[],e=0;e<this.moves.length;e++)b[e]=this.moves[e].clone(),b[e].stress=this.moves[e].stress,b[e].move=this.moves[e].move,
b[e].targeting=this.targeting,b[e].reroll=0,b[e].focus=this.moves[e].evade,b[e].evade=1;this.moves=b;this.endaction(0,"EVADE")},resolvetargetnoaction:function(b,e){for(var f=[],l=0;l<this.moves.length;l++)f[l]=this.moves[l].clone(),f[l].move=this.moves[l].move,f[l].targeting=[targetunit],f[l].focus=this.moves[l].focus,f[l].evade=this.moves[l].evade,f[l].reroll=0,f[l].stress=this.moves[l].stress;this.moves=f;this.endaction(0,"TARGET")},gettargetableunits:function(b){return b==this.range?[targetunit]:
[]},selectunit:function(b,e){0<b.length&&e.call(this,b,0)},resolveroll:function(){for(var b=[],e=0,f=0;f<this.moves.length;f++){var l=this.moves[f];if(!l.ROLL)for(var m=this.getrollmatrix(l),h=0;h<m.length;h++)m[h].ROLL=!0,m[h].BOOST=l.BOOST,m[h].reroll=0,m[h].focus=l.focus,m[h].evade=l.evade,m[h].stress=l.stress,m[h].move=l.move,m[h].targeting=l.targeting,b[e++]=m[h];b[e++]=l}this.moves=b;this.endaction(0,"ROLL")},uniquearray:function(b){for(var e={},f=[],l=0,m=b.length;l<m;++l)e.hasOwnProperty(b[l])||
(f.push(b[l]),e[b[l]]=1);return f},doaction:function(b,e,f){e=[];f=[];var l=0,m=0,h=[],q;for(q=0;q<this.moves.length;q++)this.stress=0,0<this.moves[q].stress&&(this.stress=this.moves[q].stress),this.hasnostresseffect()?e[l++]=this.moves[q]:f[m++]=this.moves[q];for(q=0;q<b.length;q++){this.moves=e;switch(b[q].type){case "ROLL":this.resolveroll();break;case "BOOST":this.resolveboost();break;case "FOCUS":this.resolvefocus();this.addfocustoken();break;case "TARGET":this.resolvetarget(0,!1);break;case "ELITE":b[q].action.call(b[q].org,
0);break;case "EVADE":this.resolveevade(),this.addevadetoken()}h=h.concat(this.moves)}this.moves=h.concat(f);return $.Deferred().resolve().promise()},resolveactionmove:function(b,e){for(var f=0;f<b.length;f++)console.log("ram:"+b[f])},candotarget:function(){return!0},candoaction:function(){return!0},candoroll:function(){return!0},candoboost:function(){return!0},endaction:function(b,e){},getmaneuverlist:function(){for(var b=this.getdial(),e={},f=0;f<b.length;f++)e[b[f].move]=b[f];return e},getrange:function(){return this.range},
getsector:function(){return this.range},getoutlinerange:function(b,e){return{d:this.range}},isinsector:function(){return!0},checkcollision:function(){return!1},isally:function(){return!1},isenemy:function(b){return b==targetunit||this==targetunit},begincombatphase:function(){},selectnearbyenemy:function(b){return this.range==b?[targetunit]:[]},doselection:function(){},setinfo:function(b,e){$("#unit"+this.id+" .statisticsvg").width();$("#unit"+this.id+" .statisticsvg").height();$("#unit"+this.id+" .statisticsvg").offset();
var f=e.pageX+20,l=e.pageY;return $(".info").css({left:f,top:l}).html(formatstring(b)).appendTo("body").show()},resolveattack:function(b,e){},cleanupattack:function(){},computeproba:function(b,e,f){this.evade=Math.floor(f/60);this.targeting=1==Math.floor(f/10)%2?[targetunit]:[];this.focus=Math.floor(f/20)%2;this.stress=Math.floor(f/40)%2;if(0==b.getrange(targetunit))return null;b.declareattack(targetunit);this.resolveattack(b,targetunit);var l=this.getattackstrength(e,targetunit),m=targetunit.getdefensestrength(e,
this);e=this.modifyattackdefense(l,m,targetunit,e);l=e.a;console.log("attack:"+e.a+" "+e.d);m=e.d;this.reroll=0<this.targeting.length?9:f%10;b=tohitproba(this,b,targetunit,ATTACK[l],DEFENSE[m],l,m);targetunit.cleanupattack();return b},showattack:function(b,e){for(var f,l=[],m=0,h,q,t=this.getprimarysector,w=this.getauxiliarysector,y=3;1<=y;y--){this.range=y;this.begincombatphase();f=this.moves;q=[];for(h=0;h<f.length;h++){var v=10*(8*f[h].evade+4*f[h].stress+2*f[h].focus+(0<f[h].targeting.length?
1:0))+f[h].reroll;q[v]=[]}for(var z=0;z<b.length;z++){var B=b[z],E;activeweapon=z;if(B.isactive){B.isTurret()||this.isTurret(B)?E=this.getSubRangeString:(E=this.getPrimarySubSectorString,this.getprimarysector=t,this.getauxiliarysector=function(){return 4});for(h in q)v=this.computeproba(B,z,h),null!=v&&(q[h][z]=v);for(h=0;h<f.length;h++)v=10*(8*f[h].evade+4*f[h].stress+2*f[h].focus+(0<f[h].targeting.length?1:0))+f[h].reroll,"undefined"!=typeof q[v][z]&&(l[m++]={f:E,proba:q[v][z],m:f[h],range:y});
if("undefined"!=typeof B.subauxiliary){E=B.subauxiliary;this.getprimarysector=function(){return 4};this.getauxiliarysector=w;for(h in q)v=this.computeproba(B,z,h),null!=v&&(q[h][z]=v);for(h=0;h<f.length;h++)v=10*(8*f[h].evade+4*f[h].stress+2*f[h].focus+(0<f[h].targeting.length?1:0))+f[h].reroll,"undefined"!=typeof q[v][z]&&(l[m++]={f:E,proba:q[v][z],m:f[h],range:y})}}}}this.focus=0;this.targeting=[];this.evade=this.stress=0;this.getprimarysector=t;this.getauxiliarysector=w;l.sort(function(b,e){var f=
b.proba.tohit-e.proba.tohit;return 0<f?1:0>f?-1:0});for(m=0;m<l.length;m++)f=l[m],h=50,q=100,50>f.proba.tohit&&(h=Math.round(f.proba.tohit/2+25)),80<f.proba.tohit&&(q=100-(f.proba.tohit-80)),h="hsl("+Math.round(1.2*(100-f.proba.tohit))+","+q+","+h+")",f.parent=this,f=e.path(f.f.call(this,f.range-1,f.range,f.m)).hover(function(b){$(".info").show();var e=this.m.move;this.parent.setinfo(this.proba.tohit+"%<br/>"+P[e].speed+"<span class='symbols'>"+P[e].key+"</span>"+(this.m.focus?"+%FOCUS%":"")+(this.m.BOOST?
"+%BOOST%":"")+(this.m.ROLL?"+%ROLL%":"")+(this.m.evade?"+%EVADE%":"")+(0<this.m.targeting.length?"+%TARGET%":""),b)}.bind(f),function(){$(".info").hide()}.bind(this)).attr({fill:h});return!1}};(function(){var b=function(){var b=[];!this.hasionizationeffect()&&this.candoaction()&&(this.candoboost()&&b.push(this.newaction(this.resolveboost,"BOOST")),this.candoroll()&&b.push(this.newaction(this.resolveroll,"ROLL")),this.doaction(b,"free %BOOST% or %ROLL% action"))},e=function(b,e){this.log("cancel %CRIT% first");b=this.cancelcritical(b,e);return b=Unit.prototype.cancelhit(b,e)},f=function(){var b=this;Unit.prototype.wrap_after("deal",this,function(e,f,h){var l=$.Deferred();h.then(function(e){if(e.face==
FACEUP&&activeunit==b&&targetunit==this){e=this.selectdamage();CRITICAL_DECK[e].count--;var f=this.selectdamage();CRITICAL_DECK[f].count--;var h=this.selectdamage();CRITICAL_DECK[h].count--;sc=[e,f,h];b.log("select one critical");b.selectcritical(sc,function(b){l.resolve({crit:new Critical(this,b),face:FACEUP})}.bind(this))}else l.resolve(e)}.bind(this));return l.promise()})},l=function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){0<FCH_focus(l)&&(l=l-FCH_FOCUS+FCH_HIT);return l}.bind(this));
this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return 0<this.focus}.bind(this),aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,e){return 0<FCH_focus(b)?(this.log("1 %FOCUS% -> 1 %HIT%"),b-FCH_FOCUS+FCH_HIT):b}.bind(this),str:"focus"});this.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,this,{req:function(b,e){return 0<this.focus}.bind(this),aiactivate:function(b,e){return 0<FE_focus(b)},f:function(b,e){return 0<FE_focus(b)?(this.log("1 %FOCUS% -> 1 %EVADE%"),b-FE_FOCUS+
FE_EVADE):b}.bind(this),str:"focus"})},m=function(b){var e,f=this.getdial(),h;for(h in b)if(e=b[h],("RED"==e.difficulty||"GREEN"==e.difficulty)&&!this.hasionizationeffect())for(h=0;h<f.length;h++)f[h].difficulty==e.difficulty&&(b[f[h].move]=f[h]);return b};window.PILOTS=[{name:"Contracted Scout",faction:SCUM,pilotid:0,done:!0,unit:"JumpMaster 5000",skill:3,points:25,upgrades:[ELITE,TORPEDO,TORPEDO,CREW,SALVAGED,ILLICIT]},{name:"Wedge Antilles",done:!0,unique:!0,faction:REBEL,unit:"X-Wing",skill:9,
init:function(){this.wrap_before("resolveattack",this,function(b,e){e.log("-1 defense [%0]",this.name);e.wrap_after("getagility",this,function(b){return 0<b?b-1:b}).unwrapper("cleanupattack");e.showstats()})},pilotid:1,points:29,upgrades:[ELITE,TORPEDO,ASTROMECH]},{name:"Garven Dreis",done:!0,faction:REBEL,unique:!0,unit:"X-Wing",init:function(){this.wrap_after("removefocustoken",this,function(){this.selectunit(this.selectnearbyally(2),function(b,e){b[e].log("+1 %FOCUS%");b[e].addfocustoken()}.bind(this),
["select unit for free %FOCUS%"],!1)})},pilotid:2,skill:6,points:26,upgrades:[TORPEDO,ASTROMECH]},{name:"Red Squadron Pilot",done:!0,unit:"X-Wing",faction:REBEL,skill:4,points:23,pilotid:3,upgrades:[TORPEDO,ASTROMECH]},{name:"Rookie Pilot",done:!0,unit:"X-Wing",faction:REBEL,skill:2,points:21,pilotid:4,upgrades:[TORPEDO,ASTROMECH]},{name:"Turbolaser",done:!0,unit:"Turbolaser",faction:EMPIRE,skill:0,points:4,pilotid:5,upgrades:[MISSILE,MISSILE,TORPEDO,TORPEDO,TURRET]},{name:"Thermal Exhaust Port",
done:!0,unit:"Exhaust Port",faction:EMPIRE,skill:0,points:49,pilotid:6,upgrades:[],init:function(){this.wrap_before("dies",this,function(){for(var b in squadron)squadron[b].team==this.team&&Unit.prototype.dies.call(squadron[b])})}},{name:"Biggs Darklighter",done:!0,pilotid:7,init:function(){var b=this;Weapon.prototype.wrap_after("getenemiesinrange",this,function(e,f){"undefined"==typeof f&&(f=e,this.unit.selectnearbyenemy(3));if(1==this.unit.foundbiggs){for(var h=[],l=0;l<f.length;l++){var m=f[l];
(m==b||1<m.getrange(b))&&h.push(m)}f=h}return f});Unit.prototype.wrap_after("getenemiesinrange",this,function(e,f,h){this.foundbiggs=!1;f=[];for(var l=0;l<e.length;l++)if(-1<h[l].indexOf(b)){this.foundbiggs=!0;break}if(this.foundbiggs)for(l=0;l<e.length;l++){f[l]=[];for(var m=0;m<h[l].length;m++){var q=h[l][m];(q==b||1<q.getrange(b))&&f[l].push(q)}}else f=h;return f})},unique:!0,unit:"X-Wing",faction:REBEL,skill:5,points:25,upgrades:[TORPEDO,ASTROMECH]},{name:"Luke Skywalker",done:!0,pilotid:8,faction:REBEL,
init:function(){this.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,this,{req:function(b,e){return!0},aiactivate:function(b,e){return 0<FE_focus(b)},f:function(b,e){0<FE_focus(b)&&(this.log("1 %FOCUS% -> 1 %EVADE%"),b=b-FE_FOCUS+FE_EVADE);return b}.bind(this),str:"focus"})},unique:!0,unit:"X-Wing",skill:8,points:28,upgrades:[ELITE,TORPEDO,ASTROMECH]},{name:"Gray Squadron Pilot",done:!0,faction:REBEL,unit:"Y-Wing",skill:4,pilotid:9,points:20,upgrades:[TURRET,TORPEDO,TORPEDO,ASTROMECH]},{name:"'Dutch' Vander",
done:!0,pilotid:10,init:function(){this.wrap_after("addtarget",this,function(b){this.selectunit(this.selectnearbyally(2),function(b,e){b[e].selectunit(b[e].gettargetableunits(3),function(b,e){-1<this.gettargetableunits(3).indexOf(b[e])&&this.addtarget(b[e])},["select target to lock"],!1)},["select unit for free %TARGET% (or self to cancel)"],!0)})},faction:REBEL,unique:!0,unit:"Y-Wing",skill:6,points:23,upgrades:[TURRET,TORPEDO,TORPEDO,ASTROMECH]},{name:"Horton Salm",done:!0,pilotid:11,faction:REBEL,
unique:!0,unit:"Y-Wing",skill:8,points:25,init:function(){unit=this;this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank"],n:function(){return 9},req:function(b,e,f){b=this.getrange(f);return 2<=b&&3>=b?(this.log("reroll any blank result"),!0):!1}.bind(this)})},upgrades:[TURRET,TORPEDO,TORPEDO,ASTROMECH]},{name:"Gold Squadron Pilot",done:!0,pilotid:12,unit:"Y-Wing",faction:REBEL,skill:2,points:18,upgrades:[TURRET,TORPEDO,TORPEDO,ASTROMECH]},{name:"Academy Pilot",done:!0,pilotid:13,unit:"TIE Fighter",
faction:EMPIRE,skill:1,points:12,upgrades:[]},{name:"Obsidian Squadron Pilot",done:!0,pilotid:14,unit:"TIE Fighter",faction:EMPIRE,skill:3,points:13,upgrades:[]},{name:"Black Squadron Pilot",done:!0,pilotid:15,unit:"TIE Fighter",faction:EMPIRE,skill:4,points:14,upgrades:[ELITE]},{name:"'Scourge'",unique:!0,beta:!0,done:!0,pilotid:16,unit:"TIE Fighter",faction:EMPIRE,skill:7,wave:["epic"],points:17,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){return 0<e.criticals.length?
(this.log("+1 attack die for attacking damaged unit"),f+1):f})},upgrades:[ELITE]},{name:"'Winged Gundark'",faction:EMPIRE,pilotid:17,init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){0<FCH_hit(l)&&(l=l-FCH_HIT+FCH_CRIT);return l});this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return 1==this.getrange(targetunit)}.bind(this),aiactivate:function(b,e){return 0<FCH_hit(b)},f:function(b,e){0<FCH_hit(b)&&(this.log("1 %HIT% -> 1 %CRIT%"),b=b-FCH_HIT+FCH_CRIT);
return b}.bind(this),str:"hit"})},done:!0,unique:!0,unit:"TIE Fighter",skill:5,points:15,upgrades:[]},{name:"'Night Beast'",faction:EMPIRE,done:!0,pilotid:18,init:function(){this.wrap_after("handledifficulty",this,function(b){"GREEN"==b&&this.candofocus()&&this.candoaction()&&this.doaction([this.newaction(this.addfocus,"FOCUS")],"green maneuver -> free focus action")})},unique:!0,unit:"TIE Fighter",skill:5,points:15,upgrades:[]},{name:"'Backstabber'",unique:!0,done:!0,pilotid:19,faction:EMPIRE,init:function(){this.wrap_after("getattackstrength",
this,function(b,e,f){e.isinfiringarc(this)||(f+=1,this.log("+1 attack against %0",e.name));return f})},unit:"TIE Fighter",skill:6,points:16,upgrades:[]},{name:"'Dark Curse'",done:!0,pilotid:20,faction:EMPIRE,unique:!0,init:function(){var b=this;this.wrap_after("isattackedby",this,function(e,f){f.wrap_after("canusefocus",b,function(){return!1}).unwrapper("afterdefenseeffect");f.wrap_after("canusetarget",b,function(b){return!1}).unwrapper("afterdefenseeffect");f.wrap_after("getdicemodifiers",b,function(b){for(var e=
[],f=0;f<b.length;f++)b[f].type!=REROLL_M&&e.push(b[f]);return e}).unwrapper("afterdefenseeffect")})},unit:"TIE Fighter",skill:6,points:16,upgrades:[]},{name:"'Mauler Mithel'",faction:EMPIRE,done:!0,pilotid:21,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){1==this.gethitrange(b,e)&&(this.log("+1 attack against %0",e.name),f+=1);return f})},unique:!0,unit:"TIE Fighter",skill:7,points:17,upgrades:[ELITE]},{name:"'Howlrunner'",unique:!0,done:!0,pilotid:22,faction:EMPIRE,unit:"TIE Fighter",
skill:8,init:function(){Unit.prototype.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(b,e,f){return b!=this&&!this.dead&&1==b.getrange(this)&&b.isally(this)&&e.isprimary?(b.log("+%1 reroll(s) [%0]",this.name,1),!0):!1}.bind(this)})},points:18,upgrades:[ELITE]},{name:"Maarek Stele",unique:!0,done:!0,pilotid:23,ambiguous:!0,faction:EMPIRE,edition:"TIE Advanced",unit:"TIE Advanced",skill:7,points:27,init:f,upgrades:[ELITE,MISSILE]},{name:"Maarek Stele",
unique:!0,done:!0,pilotid:24,ambiguous:!0,edition:"TIE Defender",faction:EMPIRE,unit:"TIE Defender",skill:7,points:35,init:f,shipimg:"tie-defender-red",upgrades:[ELITE,CANNON,MISSILE]},{name:"Tempest Squadron Pilot",faction:EMPIRE,done:!0,pilotid:25,unit:"TIE Advanced",skill:2,points:21,upgrades:[MISSILE]},{name:"Storm Squadron Pilot",faction:EMPIRE,done:!0,pilotid:26,unit:"TIE Advanced",skill:4,points:23,upgrades:[MISSILE]},{name:"Darth Vader",faction:EMPIRE,unique:!0,done:!0,pilotid:27,unit:"TIE Advanced",
skill:9,init:function(){this.wrap_before("doendmaneuveraction",this,function(){this.log("+1 action [%0]",this.name);this.doaction(this.getactionlist(),"",this.candoendmaneuveraction)})},secaction:-1,points:29,upgrades:[ELITE,MISSILE]},{name:"Alpha Squadron Pilot",faction:EMPIRE,done:!0,pilotid:28,unit:"TIE Interceptor",skill:1,points:18,upgrades:[]},{name:"Avenger Squadron Pilot",faction:EMPIRE,done:!0,pilotid:29,unit:"TIE Interceptor",skill:3,points:20,upgrades:[]},{name:"Saber Squadron Pilot",faction:EMPIRE,
done:!0,pilotid:30,unit:"TIE Interceptor",skill:4,points:21,wave:["aces",2],upgrades:["Elite"]},{name:"'Fel's Wrath'",faction:EMPIRE,unique:!0,unit:"TIE Interceptor",skill:5,pilotid:31,done:!0,init:function(){this.wrap_after("endcombatphase",this,function(){this.hasfired=0;this.checkdead()});this.wrap_after("canbedestroyed",this,function(b,e){return-1==b})},points:23,upgrades:[]},{name:"Turr Phennir",faction:EMPIRE,unique:!0,done:!0,pilotid:32,unit:"TIE Interceptor",skill:7,init:function(){this.addafterattackeffect(this,
function(){var b=[];this.candoboost()&&b.push(this.newaction(this.resolveboost,"BOOST"));this.candoroll()&&b.push(this.newaction(this.resolveroll,"ROLL"));this.doaction(b,"free %BOOST% or %ROLL% action")})},points:25,upgrades:[ELITE]},{name:"Soontir Fel",faction:EMPIRE,unique:!0,done:!0,pilotid:33,init:function(){this.wrap_after("addstress",this,function(){this.log("+1 %STRESS% -> +1 %FOCUS%");this.addfocustoken()})},unit:"TIE Interceptor",skill:9,points:27,upgrades:[ELITE]},{name:"Tycho Celchu",
faction:REBEL,unique:!0,pilotid:34,done:!0,init:function(){this.wrap_after("hasnostresseffect",this,function(){return!0})},unit:"A-Wing",skill:8,points:26,upgrades:[ELITE,MISSILE]},{name:"Arvel Crynyd",faction:REBEL,pilotid:35,unique:!0,done:!0,unit:"A-Wing",init:function(){this.wrap_after("checkcollision",this,function(b){return!1})},skill:6,points:23,upgrades:[MISSILE]},{name:"Green Squadron Pilot",faction:REBEL,done:!0,wave:["aces",2],unit:"A-Wing",skill:3,pilotid:36,points:19,upgrades:[ELITE,
MISSILE]},{name:"Prototype Pilot",faction:REBEL,done:!0,pilotid:37,wave:["aces",2],unit:"A-Wing",skill:1,points:17,upgrades:[MISSILE]},{name:"Outer Rim Smuggler",faction:REBEL,unit:"YT-1300",done:!0,pilotid:38,install:function(){this.hull=6;this.shield=4;this.weapons[0].attack=2},uninstall:function(){this.hull=8;this.shield=5;this.weapons[0].attack=3},skill:1,points:27,upgrades:[CREW,CREW]},{name:"Chewbacca",unique:!0,done:!0,ambiguous:!0,faction:REBEL,unit:"YT-1300",skill:5,pilotid:39,points:42,
deal:function(b,e){var f=$.Deferred();return e==FACEUP?(this.log("turn faceup damage facedown"),f.resolve({crit:b,face:FACEDOWN}).promise()):f.resolve({crit:b,face:e}).promise()},upgrades:[ELITE,MISSILE,CREW,CREW]},{name:"Lando Calrissian",faction:REBEL,unique:!0,unit:"YT-1300",skill:7,pilotid:40,points:44,init:function(){this.wrap_after("handledifficulty",this,function(b){"GREEN"==b&&this.selectunit(this.selectnearbyally(1),function(b,e){b[e].log("+1 action [%0]",this.name);b[e].doaction(b[e].getactionbarlist(),
"")}.bind(this),["select unit (or self to cancel) [%0]",this.name],!0)})},done:!0,upgrades:[ELITE,MISSILE,CREW,CREW]},{name:"Han Solo",unique:!0,done:!0,faction:REBEL,unit:"YT-1300",skill:9,pilotid:41,points:46,init:function(){this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus","hit","critical"],n:function(){return 9},req:function(b,e,f){return!0},mustreroll:!0})},upgrades:[ELITE,MISSILE,CREW,CREW]},{name:"Kath Scarlet",unique:!0,faction:EMPIRE,unit:"Firespray-31",skill:7,
pilotid:42,done:!0,init:function(){this.wrap_before("resolveattack",this,function(b,e){var f=this;e.wrap_after("cancelcritical",f,function(b,e,h){FCH_crit(b.ch)>FCH_crit(h.ch)&&(this.log("+1 %STRESS% for cancelling %CRIT% [%0]",f.name),this.addstress());return h}).unwrapper("afterdefenseeffect")})},points:38,upgrades:[ELITE,CANNON,BOMB,CREW,MISSILE]},{name:"Boba Fett",unique:!0,done:!0,pilotid:43,faction:EMPIRE,init:function(){this.wrap_after("getmaneuverlist",this,function(b){if(this.hasionizationeffect())return b;
for(var e=1;3>=e;e++)"undefined"!=typeof b["BL"+e]?(this.log("select %BANKLEFT% or %BANKRIGHT% turn"),b["BR"+e]={move:"BR"+e,difficulty:b["BL"+e].difficulty}):"undefined"!=typeof b["BR"+e]&&(this.log("select %BANKLEFT% or %BANKRIGHT% turn"),b["BL"+e]={move:"BL"+e,difficulty:b["BR"+e].difficulty});return b})},unit:"Firespray-31",skill:8,points:39,upgrades:[ELITE,CANNON,BOMB,CREW,MISSILE]},{name:"Krassis Trelix",unique:!0,done:!0,pilotid:44,faction:EMPIRE,unit:"Firespray-31",attackrerolls:function(b,
e){return weapon.isprimary?0:1},init:function(){this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(b,e,f){return e.isprimary?!1:(b.log("+%1 reroll(s) [%0]",b.name,1),!0)}})},skill:5,points:36,upgrades:[CANNON,BOMB,CREW,MISSILE]},{name:"Bounty Hunter",unit:"Firespray-31",skill:3,pilotid:45,done:!0,faction:EMPIRE,points:33,upgrades:[CANNON,BOMB,CREW,MISSILE]},{name:"Ten Numb",faction:REBEL,unique:!0,done:!0,pilotid:46,unit:"B-Wing",skill:8,
shipimg:"b-wing-1",init:function(){var b=this;this.wrap_before("resolveattack",this,function(e,f){f.wrap_after("cancelcritical",b,function(b,e,h){return 0<FCH_crit(b.ch)&&0==FCH_crit(h.ch)?(f.log("cannot cancel 1 %CRIT% [%0]",this.name),{ch:h.ch+FCH_CRIT,e:h.e+1}):h}.bind(this)).unwrapper("afterdefenseeffect")})},points:31,upgrades:[ELITE,SYSTEM,CANNON,TORPEDO,TORPEDO]},{name:"Ibtisam",unique:!0,done:!0,faction:REBEL,unit:"B-Wing",skill:6,pilotid:47,points:28,shipimg:"b-wing-1",attackrerolls:function(b){return 0<
this.stress?1:0},init:function(){var b={dice:["blank","focus"],n:function(){return 1},req:function(b,e,f){return 0<this.stress?(this.log("+%0 reroll",1),!0):!1}.bind(this)};this.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,b);this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,$.extend({},b))},upgrades:[ELITE,SYSTEM,CANNON,TORPEDO,TORPEDO]},{name:"Dagger Squadron Pilot",unit:"B-Wing",done:!0,wave:["aces",3],pilotid:48,faction:REBEL,skill:4,points:24,upgrades:[SYSTEM,CANNON,TORPEDO,TORPEDO]},
{name:"Blue Squadron Pilot",unit:"B-Wing",done:!0,wave:["aces",3],faction:REBEL,skill:2,pilotid:49,points:22,upgrades:[SYSTEM,CANNON,TORPEDO,TORPEDO]},{name:"Rebel Operative",unit:"HWK-290",done:!0,faction:REBEL,skill:2,pilotid:50,points:16,upgrades:[TURRET,CREW]},{name:"Roark Garnet",unique:!0,faction:REBEL,unit:"HWK-290",skill:4,pilotid:51,init:function(){this.wrap_after("begincombatphase",this,function(b){var e=this;this.selectunit(this.selectnearbyally(3),function(b,f){b[f].log("has PS of 12");
b[f].wrap_after("getskill",e,function(b){return 12}).unwrapper("endcombatphase")},["select unit [%0]",this.name],!1);return b})},done:!0,points:19,upgrades:[TURRET,CREW]},{name:"Kyle Katarn",faction:REBEL,unique:!0,done:!0,unit:"HWK-290",skill:6,pilotid:52,points:21,init:function(){this.wrap_after("begincombatphase",this,function(b){this.canusefocus()&&this.selectunit(this.selectnearbyally(3),function(b,e){this.removefocustoken();b[e].addfocustoken();b[e].log("+1 %FOCUS%")},["select unit for free %FOCUS% (or self to cancel)"],
!0);return b})},upgrades:[ELITE,TURRET,CREW]},{name:"Jan Ors",faction:REBEL,unique:!0,done:!0,pilotid:53,unit:"HWK-290",skill:8,init:function(){var b=this;Unit.prototype.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(e,f){return 0==b.stress&&!b.dead&&activeunit.isally(b)&activeunit!=b&&3>=b.getrange(activeunit)},f:function(e,f){var h=b.rollattackdie(1,b,"critical")[0];b.addstress();activeunit.log("+1 attack die [%0]",b.name);return"focus"==h?{m:e+FCH_FOCUS,n:f+1}:"hit"==h?{m:e+FCH_HIT,
n:f+1}:"critical"==h?{m:e+FCH_CRIT,n:f+1}:{m:e,n:f+1}},str:"hit"})},points:25,upgrades:[ELITE,TURRET,CREW]},{name:"Scimitar Squadron Pilot",done:!0,unit:"TIE Bomber",skill:2,pilotid:54,faction:EMPIRE,points:16,upgrades:[TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB]},{name:"Gamma Squadron Pilot",done:!0,pilotid:55,unit:"TIE Bomber",faction:EMPIRE,skill:4,points:18,upgrades:[TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB]},{name:"Captain Jonus",faction:EMPIRE,done:!0,pilotid:56,init:function(){Unit.prototype.adddicemodifier(ATTACK_M,
REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 2},req:function(b,e,f){return b!=this&&!this.dead&&1==b.getrange(this)&&b.isally(this)&&1!=e.isprimary?(b.log("+%1 reroll(s) [%0]",this.name,2),!0):!1}.bind(this)})},unique:!0,unit:"TIE Bomber",skill:6,points:22,upgrades:[ELITE,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB]},{name:"Major Rhymer",done:!0,pilotid:57,faction:EMPIRE,init:function(){for(var b=0;b<this.weapons.length;b++)this.weapons[b].wrap_after("getlowrange",this,function(b){1<
b&&--b;return b}),this.weapons[b].wrap_after("gethighrange",this,function(b){3>b&&(b+=1);return b});this.log("extending weapon ranges")},unique:!0,unit:"TIE Bomber",skill:7,points:26,upgrades:[ELITE,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB]},{name:"Captain Kagi",faction:EMPIRE,unique:!0,done:!0,pilotid:58,init:function(){var b=this;Unit.prototype.wrap_after("gettargetableunits",this,function(e,f){-1<f.indexOf(b)&&!b.dead&&(f=[b]);return f})},unit:"Lambda-Class Shuttle",skill:8,points:27,upgrades:[SYSTEM,
CANNON,CREW,CREW]},{name:"Colonel Jendon",faction:EMPIRE,pilotid:59,init:function(){this.wrap_after("begincombatphase",this,function(b){0<this.targeting.length&&this.selectunit(this.selectnearbyally(1),function(b,e){var f=this.targeting[0];b[e].addtarget(f);this.removetarget(f);b[e].log("+%1 %TARGET% / %0",f.name,1)},["select unit to move %TARGET% (or self to cancel)"],!0);return b})},done:!0,unique:!0,unit:"Lambda-Class Shuttle",skill:6,points:26,upgrades:[SYSTEM,CANNON,CREW,CREW]},{name:"Captain Yorr",
faction:EMPIRE,pilotid:60,unique:!0,done:!0,unit:"Lambda-Class Shuttle",skill:4,init:function(){var b=this;Unit.prototype.wrap_after("addstress",this,function(){-1<this.selectnearbyally(2).indexOf(b)&&2>=b.stress&&!b.dead&&(this.log("%STRESS% -> %0 [%0]",b.name),this.removestresstoken(),this.showinfo(),b.addstress(),b.showinfo())})},points:24,upgrades:[SYSTEM,CANNON,CREW,CREW]},{name:"Omicron Group Pilot",faction:EMPIRE,done:!0,unit:"Lambda-Class Shuttle",skill:2,pilotid:61,points:21,upgrades:[SYSTEM,
CANNON,CREW,CREW]},{name:"Lieutenant Lorrir",faction:EMPIRE,unique:!0,done:!0,pilotid:62,wave:["aces"],unit:"TIE Interceptor",skill:5,points:23,init:function(){this.wrap_after("getrollmatrix",this,function(b,e){for(var f=-20;20>=f;f+=20){var h=this.m.clone().translate(0,f).rotate(90,0,0),l=this.m.clone().translate(0,f).rotate(-90,0,0);e=e.concat([this.getpathmatrix(h,"BR1").rotate(-90,0,0),this.getpathmatrix(l,"BR1").rotate(90,0,0),this.getpathmatrix(h,"BL1").rotate(-90,0,0),this.getpathmatrix(l,
"BL1").rotate(90,0,0)])}return e});this.wrap_before("endaction",this,function(b,e){"ROLL"==e&&this.addstress()})},upgrades:[]},{name:"Royal Guard Pilot",faction:EMPIRE,done:!0,pilotid:63,unit:"TIE Interceptor",skill:6,points:22,wave:["aces"],upgrades:[ELITE]},{name:"Tetran Cowall",faction:EMPIRE,unique:!0,done:!0,pilotid:64,wave:["aces"],init:function(){this.wrap_after("getmaneuverlist",this,function(b){var e=!1,f,h;for(h in b)if(h.match(/K/)){e=!0;f=b[h];break}if(e&&!this.hasionizationeffect())for(this.log("select %UTURN% speed"),
h=1;5>=h;h+=2)"undefined"==typeof b["K"+h]&&(b["K"+h]={move:"K"+h,difficulty:f.difficulty,halfturn:!1});return b})},unit:"TIE Interceptor",skill:7,points:24,upgrades:[ELITE]},{name:"Kir Kanos",faction:EMPIRE,pilotid:65,wave:["aces"],shipimg:"tie-interceptor-1",init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){0<this.evade&&(l+=FCH_HIT);return l});this.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,e){var f=this.getrange(targetunit);return 3>=f&&2<=f&&this.canuseevade()}.bind(this),
f:function(b,e){this.removeevadetoken();this.log("+1 %HIT% for attacking at range 2-3");return{m:b+FCH_HIT,n:e+1}}.bind(this),str:"evade"})},done:!0,unique:!0,unit:"TIE Interceptor",skill:6,points:24,upgrades:[]},{name:"Carnor Jax",faction:EMPIRE,pilotid:66,wave:["aces"],init:function(){var b=this;Unit.prototype.wrap_after("canusefocus",this,function(e){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:e});Unit.prototype.wrap_after("canuseevade",this,function(e){return 1==this.getrange(b)&&
this.isenemy(b)&&!b.dead?!1:e});Unit.prototype.wrap_after("candofocus",this,function(e){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:e});Unit.prototype.wrap_after("candoevade",this,function(e){return 1==this.getrange(b)&&this.isenemy(b)&&!b.dead?!1:e})},unique:!0,done:!0,unit:"TIE Interceptor",skill:8,points:26,upgrades:[ELITE]},{name:"Bandit Squadron Pilot",faction:REBEL,pilotid:67,done:!0,unit:"Z-95 Headhunter",skill:2,points:12,upgrades:[MISSILE]},{name:"Tala Squadron Pilot",faction:REBEL,
pilotid:68,done:!0,unit:"Z-95 Headhunter",skill:4,points:13,upgrades:[MISSILE]},{name:"Lieutenant Blount",faction:REBEL,pilotid:69,done:!0,init:function(){this.wrap_after("hashit",this,function(b,e){0==this.criticalresolved+this.hitresolved&&this.log("%0 is hit",targetunit.name);return!0})},unique:!0,unit:"Z-95 Headhunter",skill:6,points:17,upgrades:[ELITE,MISSILE]},{name:"Airen Cracken",faction:REBEL,pilotid:70,done:!0,init:function(){this.addafterattackeffect(this,function(){var b=this.selectnearbyally(1,
function(b,e){return e.candoaction()});0<b.length&&this.doselection(function(e){this.log("select unit for a free action"+b.length);this.resolveactionselection(b,function(f){var h=b[f].getactionlist();0<h.length?b[f].doaction(h,"").done(function(){this.select()}.bind(this)):this.select();this.endnoaction(e,"")}.bind(this))}.bind(this))})},unique:!0,unit:"Z-95 Headhunter",skill:8,points:19,upgrades:[ELITE,MISSILE]},{name:"Delta Squadron Pilot",faction:EMPIRE,pilotid:71,done:!0,unit:"TIE Defender",skill:1,
points:30,upgrades:[CANNON,MISSILE]},{name:"Glaive Squadron Pilot",faction:EMPIRE,done:!0,pilotid:72,unit:"TIE Defender",skill:6,points:34,wave:["aces"],upgrades:[ELITE,CANNON,MISSILE],shipimg:"tie-defender-red"},{name:"Onyx Squadron Pilot",done:!0,faction:EMPIRE,pilotid:73,unit:"TIE Defender",skill:3,points:32,upgrades:[CANNON,MISSILE]},{name:"Colonel Vessery",done:!0,pilotid:74,faction:EMPIRE,init:function(){this.wrap_after("attackroll",this,function(b,e){0<targetunit.istargeted.length&&0==this.targeting.length&&
(this.addtarget(targetunit),this.log("+%1 %TARGET% / %0",targetunit.name,1));return e})},unique:!0,unit:"TIE Defender",skill:6,points:35,upgrades:[ELITE,CANNON,MISSILE]},{name:"Rexler Brath",faction:EMPIRE,done:!0,pilotid:75,init:function(){this.addafterattackeffect(this,function(b,e){this.canusefocus()&&0<this.hitresolved&&(this.log("-1 %FOCUS%, %0 damage -> %0 critical(s)",e),this.donoaction([{name:this.name,org:this,type:"FOCUS",action:function(b){var e=targetunit.criticals.length-1;this.removefocustoken();
for(var f=0;f<this.hitresolved;f++)this.log(targetunit.criticals[e-f-this.criticalresolved].name),targetunit.criticals[e-f-this.criticalresolved].faceup();targetunit.checkdead();targetunit.show();this.endnoaction(b,"")}.bind(this)}],"",!0))})},unique:!0,unit:"TIE Defender",skill:8,wave:["aces"],points:37,upgrades:[ELITE,CANNON,MISSILE]},{name:"Knave Squadron Pilot",faction:REBEL,done:!0,pilotid:76,unit:"E-Wing",skill:1,points:27,upgrades:[SYSTEM,TORPEDO,ASTROMECH]},{name:"Blackmoon Squadron Pilot",
pilotid:77,faction:REBEL,done:!0,unit:"E-Wing",skill:3,points:29,upgrades:[SYSTEM,TORPEDO,ASTROMECH]},{name:"Etahn A'baht",done:!0,pilotid:78,faction:REBEL,init:function(){var b=this;Unit.prototype.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(e,f){return b.isally(activeunit)&&!b.dead&&b.isinfiringarc(targetunit)},aiactivate:function(b,e){return FCH_hit(b)},f:function(e,f){return 0<FCH_hit(e)?(this.log("1 %HIT% -> 1 %CRIT% [%0]",b.name),e+FCH_CRIT-FCH_HIT):e},str:"hit"})},unique:!0,unit:"E-Wing",
skill:5,points:32,upgrades:[ELITE,SYSTEM,TORPEDO,ASTROMECH]},{name:"Corran Horn",faction:REBEL,done:!0,pilotid:79,init:function(){this.addattack(function(){return!0},this,this.weapons,function(){this.log("no attack next round");this.noattack=round+1},null,"endcombatphase")},unique:!0,unit:"E-Wing",skill:8,points:35,upgrades:[ELITE,SYSTEM,TORPEDO,ASTROMECH]},{name:"Sigma Squadron Pilot",faction:EMPIRE,pilotid:80,done:!0,unit:"TIE Phantom",skill:3,points:25,upgrades:[SYSTEM,CREW]},{name:"Shadow Squadron Pilot",
done:!0,faction:EMPIRE,pilotid:81,unit:"TIE Phantom",skill:5,points:27,upgrades:[SYSTEM,CREW]},{name:"'Echo'",faction:EMPIRE,done:!0,pilotid:82,getdecloakmatrix:function(b){var e;e=this.getpathmatrix(b,"BL2");var f=this.getpathmatrix(b,"BR2"),f=[b,e,f];for(e=-20;20>=e;e+=20)var h=b.clone().translate(0,e).rotate(90,0,0),l=b.clone().translate(0,e).rotate(-90,0,0),f=f.concat([this.getpathmatrix(h,"BL2").rotate(-90,0,0),this.getpathmatrix(h,"BR2").rotate(-90,0,0),this.getpathmatrix(l,"BL2").rotate(90,
0,0),this.getpathmatrix(l,"BR2").rotate(90,0,0)]);return f},unique:!0,unit:"TIE Phantom",skill:6,points:30,upgrades:[ELITE,SYSTEM,CREW]},{name:"'Whisper'",faction:EMPIRE,done:!0,pilotid:83,init:function(){this.wrap_after("hashit",this,function(b,e){e&&(this.log("+1 %FOCUS%"),this.addfocustoken());return e})},unique:!0,unit:"TIE Phantom",skill:7,points:32,upgrades:[ELITE,SYSTEM,CREW]},{name:"Wes Janson",done:!0,wave:["epic"],pilotid:84,init:function(){this.wrap_before("cleanupattack",this,function(){0<
targetunit.targeting.length?(targetunit.log("-1 %TARGET% [%0]",this.name),targetunit.removetarget(targetunit.targeting[0])):0<targetunit.focus?(targetunit.log("-1 %FOCUS% [%0]",this.name),targetunit.removefocustoken()):0<targetunit.evade&&(targetunit.log("-1 %EVADE% [%0]",this.name),targetunit.removeevadetoken())})},faction:REBEL,unique:!0,unit:"X-Wing",skill:8,points:29,upgrades:[ELITE,TORPEDO,ASTROMECH]},{name:"Jek Porkins",done:!0,pilotid:85,wave:["epic"],init:function(){this.wrap_after("addstress",
this,function(){this.removestresstoken();var b=this.rollattackdie(1,this,"blank")[0];this.log("-1 %STRESS%, roll 1 attack dice");"hit"==b&&(this.applyhit(1),this.checkdead())})},faction:REBEL,unique:!0,unit:"X-Wing",skill:7,points:26,upgrades:[ELITE,TORPEDO,ASTROMECH]},{name:"'Hobbie' Klivian",faction:REBEL,done:!0,wave:["epic"],pilotid:86,init:function(){this.wrap_before("removetarget",this,function(b){this.stress&&(this.log("-1 %TARGET% -> -1 %STRESS%"),this.removestresstoken())});this.wrap_before("addtarget",
this,function(b){this.stress&&(this.removestresstoken(),this.log("+1 %TARGET% -> -1 %STRESS%"))})},unique:!0,unit:"X-Wing",skill:5,points:25,upgrades:[TORPEDO,ASTROMECH]},{name:"Tarn Mison",done:!0,pilotid:87,wave:["epic"],init:function(){this.wrap_after("isattackedby",this,function(b,e){if(0==this.targeting.length||this.getskill()<e.getskill())this.log("+%1 %TARGET% / %0",e.name,1),this.addtarget(e)})},faction:REBEL,unique:!0,unit:"X-Wing",skill:3,points:23,upgrades:[TORPEDO,ASTROMECH]},{name:"Jake Farrell",
faction:REBEL,done:!0,pilotid:88,wave:["aces"],freemove:function(){var b=[];this.candoboost()&&b.push(this.newaction(this.resolveboost,"BOOST"));this.candoroll()&&b.push(this.newaction(this.resolveroll,"ROLL"));this.doaction(b,"free %BOOST% or %ROLL% action")},init:function(){this.wrap_before("addfocustoken",this,function(){this.candoaction()&&this.freemove()})},unique:!0,unit:"A-Wing",skill:7,points:24,upgrades:[ELITE,MISSILE]},{name:"Gemmer Sojan",done:!0,pilotid:89,wave:["aces"],init:function(){this.wrap_after("getagility",
this,function(b){0<this.selectnearbyenemy(1).length&&(b+=1);return b})},faction:REBEL,unique:!0,unit:"A-Wing",skill:5,points:22,upgrades:[MISSILE]},{name:"Keyan Farlander",faction:REBEL,done:!0,pilotid:90,wave:["aces"],shipimg:"b-wing-1",init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){b=FCH_focus(l);0<this.stress&&(l=l-FCH_FOCUS*b+FCH_HIT*b);return l});this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return 0<this.stress}.bind(this),aiactivate:function(b,
e){return!0},f:function(b,e){var f=FCH_focus(b);this.removestresstoken();return 0<f?(this.log("%0 %FOCUS% -> %0 %HIT%, -1 %STRESS%",f),b-FCH_FOCUS*f+FCH_HIT*f):b}.bind(this),str:"stress",noreroll:"focus"})},unique:!0,unit:"B-Wing",skill:7,points:29,upgrades:[ELITE,SYSTEM,CANNON,TORPEDO,TORPEDO]},{name:"Nera Dantels",faction:REBEL,done:!0,pilotid:91,wave:["aces"],shipimg:"b-wing-1",init:function(){this.log("can fire %TORPEDO% at 360 degrees");this.wrap_after("isTurret",this,function(b,e){return b.type==
TORPEDO?!0:e})},unique:!0,unit:"B-Wing",skill:5,points:26,upgrades:[ELITE,SYSTEM,CANNON,TORPEDO,TORPEDO]},{name:"Wild Space Fringer",done:!0,pilotid:92,faction:REBEL,unit:"YT-2400",skill:2,points:30,upgrades:[CANNON,MISSILE,CREW]},{name:"Eaden Vrill",done:!0,pilotid:93,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){0<e.stress&&this.weapons[b].isprimary&&(this.log("+1 attack die"),f+=1);return f})},faction:REBEL,unit:"YT-2400",unique:!0,skill:3,points:32,upgrades:[CANNON,
MISSILE,CREW]},{name:"'Leebo'",faction:REBEL,done:!0,pilotid:94,init:function(){this.wrap_after("deal",this,function(b,e,f){var h=$.Deferred();f.then(function(b){if(b.face==FACEUP){b=this.selectdamage();CRITICAL_DECK[b].count--;var e=this.selectdamage();CRITICAL_DECK[e].count--;b=[b,e];this.log("select one critical");this.selectcritical(b,function(b){h.resolve({crit:new Critical(this,b),face:FACEUP})}.bind(this))}else h.resolve(b)}.bind(this));return h.promise()})},unit:"YT-2400",unique:!0,skill:5,
points:34,upgrades:[ELITE,CANNON,MISSILE,CREW]},{name:"Dash Rendar",faction:REBEL,pilotid:95,unit:"YT-2400",unique:!0,skill:7,done:!0,init:function(){this.wrap_after("hascollidedobstacle",this,function(b){return!1});this.wrap_after("canmoveonobstacles",this,function(){return!0})},points:36,upgrades:[ELITE,CANNON,MISSILE,CREW]},{name:"Patrol Leader",faction:EMPIRE,done:!0,pilotid:96,unit:"VT-49 Decimator",skill:3,points:40,upgrades:[TORPEDO,CREW,CREW,CREW,BOMB]},{name:"Captain Oicunn",faction:EMPIRE,
unit:"VT-49 Decimator",skill:4,points:42,pilotid:97,unique:!0,done:!0,init:function(){this.wrap_before("resolvecollision",this,function(){for(var b=0;b<this.touching.length;b++){var e=this.touching[b];e.isenemy(this)&&(e.log("+1 %HIT% [%0]",this.name),e.resolvehit(1),e.checkdead())}})},upgrades:[ELITE,TORPEDO,CREW,CREW,CREW,BOMB]},{name:"Commander Kenkirk",faction:EMPIRE,pilotid:98,init:function(){this.wrap_after("getagility",this,function(b){0<this.criticals.length&&(b+=1);return b})},done:!0,unit:"VT-49 Decimator",
skill:6,points:44,unique:!0,upgrades:[ELITE,TORPEDO,CREW,CREW,CREW,BOMB]},{name:"Rear Admiral Chiraneau",pilotid:99,init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){0<FCH_focus(l)&&2>=this.range&&(l=l-FCH_FOCUS+FCH_CRIT);return l});this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return 2>=this.getrange(targetunit)}.bind(this),aiactivate:function(b,e){return FCH_focus(b)},f:function(b,e){return 0<FCH_focus(b)?(this.log("1 %FOCUS% -> 1 %CRIT%"),b-FCH_FOCUS+
FCH_CRIT):b}.bind(this),str:"hit"})},faction:EMPIRE,unit:"VT-49 Decimator",skill:8,points:46,done:!0,unique:!0,upgrades:[ELITE,TORPEDO,CREW,CREW,CREW,BOMB]},{name:"Prince Xizor",faction:SCUM,pilotid:100,modifydamageassigned:function(b,e){var f=[];if(0==b)return 0;f=this.selectnearbyally(1);if(0<f.length){f.sort(function(b,e){hpa=b.hull+b.shield;hpb=e.hull+e.shield;return hpa<hpb?1:hpa>hpb?-1:0});if(10<=b)return f[0].resolvecritical(1),this.log("-1 %CRIT%"),f[0].log("+1 %CRIT% [%0]",this.name),b-10;
f[0].resolvehit(1);f[0].checkdead();this.log("-1 %HIT%");f[0].log("+%1 %HIT% [%0]",this.name,1);return b-1}return b},unique:!0,done:!0,unit:"StarViper",skill:7,points:31,upgrades:[ELITE,TORPEDO]},{name:"Guri",faction:SCUM,pilotid:101,modifyattackroll:function(b,e,f){1==this.getrange(targetunit)&&(b+=FCH_FOCUS);return b},init:function(){this.wrap_after("begincombatphase",this,function(b){0<this.selectnearbyenemy(1).length&&(this.log("+1 %FOCUS%, ennemy at range 1"),this.addfocustoken());return b})},
done:!0,unique:!0,unit:"StarViper",skill:5,points:30,upgrades:[ELITE,TORPEDO]},{name:"Black Sun Vigo",faction:SCUM,done:!0,pilotid:102,unit:"StarViper",skill:3,points:27,upgrades:[TORPEDO]},{name:"Black Sun Enforcer",faction:SCUM,pilotid:103,done:!0,unit:"StarViper",skill:1,points:25,upgrades:[TORPEDO]},{name:"Serissu",faction:SCUM,pilotid:104,done:!0,init:function(){var b=this;Unit.prototype.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["blank","focus"],n:function(){return 1},req:function(e,
f,h){return h==this||b.dead||this.dead||1!=h.getrange(this)||!h.isally(this)?!1:(h.log("+%1 reroll(s) [%0]",this.name,1),!0)}.bind(this)})},unit:"M3-A Interceptor",skill:8,points:20,unique:!0,upgrades:[ELITE]},{name:"Laetin A'shera",faction:SCUM,pilotid:105,init:function(){this.addafterdefenseeffect(this,function(b,e,f){0==b+e&&(this.log("0 %HIT%, +1 %EVADE%"),this.addevadetoken())})},done:!0,unit:"M3-A Interceptor",skill:6,points:18,unique:!0,upgrades:[]},{name:"Tansarii Point Veteran",faction:SCUM,
pilotid:106,done:!0,unit:"M3-A Interceptor",skill:5,points:17,upgrades:[ELITE]},{name:"Cartel Spacer",faction:SCUM,pilotid:107,done:!0,unit:"M3-A Interceptor",skill:2,points:14,upgrades:[]},{name:"IG-88A",faction:SCUM,pilotid:108,unique:!0,unit:"Aggressor",skill:6,points:36,init:function(b){this.addafterattackeffect(this,function(e,f){("undefined"==typeof b||!b.dead)&&targetunit.dead&&this.shield<this.ship.shield&&(this.addshield(1),this.showstats(),this.log("+1 %SHIELD% for a kill"))})},done:!0,
upgrades:[ELITE,SYSTEM,CANNON,CANNON,BOMB,ILLICIT]},{name:"IG-88B",faction:SCUM,pilotid:109,done:!0,init:function(b){var e=[];this.ig88battack=-1;for(var f=0;f<this.weapons.length;f++){var h=this.weapons[f];"Cannon"==h.type&&h.isWeapon()&&e.push(h)}if(0!=e.length)for(f in this.weapons.indexOf(e[0]),this.weapons)this.addattack(function(e,f){return 0==e+f&&this.ig88battack<round&&("undefined"==typeof b||!b.dead)},{name:"IG-88B"},e,function(){this.ig88battack=round},function(){return squadron})},unique:!0,
unit:"Aggressor",skill:6,points:36,upgrades:[ELITE,SYSTEM,CANNON,CANNON,BOMB,ILLICIT]},{name:"IG-88C",faction:SCUM,pilotid:110,init:function(b){this.wrap_before("resolveboost",this,function(){"undefined"!=typeof b&&b.dead||(this.log("free %EVADE% action [%0]","IG-88C"),this.doselection(function(b){this.addevade(b)}.bind(this)))})},done:!0,unique:!0,unit:"Aggressor",skill:6,points:36,upgrades:[ELITE,SYSTEM,CANNON,CANNON,BOMB,ILLICIT]},{name:"IG-88D",faction:SCUM,pilotid:111,init:function(b){this.wrap_after("getmaneuverlist",
this,function(e){"undefined"==typeof e.SL3||"undefined"!=typeof b&&b.dead||(this.log("%SLOOPLEFT% or %TURNLEFT% maneuver"),e.TL3={move:"TL3",halfturn:!0,difficulty:e.SL3.difficulty});"undefined"!=typeof e.SR3&&(this.log("%SLOOPRIGHT% or %TURNRIGHT% maneuver"),e.TR3={move:"TR3",halfturn:!0,difficulty:e.SR3.difficulty});return e})},unique:!0,done:!0,unit:"Aggressor",skill:6,points:36,upgrades:[ELITE,SYSTEM,CANNON,CANNON,BOMB,ILLICIT]},{name:"N'Dru Suhlak",unique:!0,done:!0,wave:["6"],pilotid:112,faction:SCUM,
init:function(){var b=this.getattackstrength;this.getattackstrength=function(e,f){var h=b.call(this,e,f);0==this.selectnearbyally(2).length&&("undefined"!=typeof f&&this.log("+1 attack against %0, at range >=3 of friendly ships",f.name),h+=1);return h}.bind(this)},unit:"Z-95 Headhunter",skill:7,points:17,upgrades:[ELITE,MISSILE,ILLICIT]},{name:"Kaa'To Leeachos",unique:!0,pilotid:113,faction:SCUM,done:!0,wave:["6"],init:function(){this.wrap_after("begincombatphase",this,function(b){var e=this.selectnearbyally(2);
this.selectunit(e,function(b,e){0<b[e].evade?(b[e].removeevadetoken(),this.addevadetoken(),b[e].log("-1 %EVADE% [%0]",this.name),this.log("+1 %EVADE%")):0<b[e].focus&&(b[e].removefocustoken(),this.addfocustoken(),b[e].log("-1 %FOCUS% [%0]",this.name),this.log("+1 %FOCUS%"))},["select %FOCUS%/%EVADE% to take (or self to cancel)"],!0);return b})},unit:"Z-95 Headhunter",skill:5,points:15,upgrades:[ELITE,MISSILE,ILLICIT]},{name:"Black Sun Soldier",faction:SCUM,pilotid:114,done:!0,wave:["6"],unit:"Z-95 Headhunter",
skill:3,points:13,upgrades:[MISSILE,ILLICIT]},{name:"Binayre Pirate",faction:SCUM,pilotid:115,done:!0,wave:["6"],unit:"Z-95 Headhunter",skill:1,points:12,upgrades:[MISSILE,ILLICIT]},{name:"Boba Fett",faction:SCUM,pilotid:116,wave:["6"],unit:"Firespray-31",skill:8,points:39,modifyattackroll:function(b,e,f){1==this.getrange(targetunit)&&(b+=1);return b},init:function(){var b={dice:["blank","focus"],n:function(){var b=0,e;for(e in squadron){var f=squadron[e];1==this.getrange(f)&&this.isenemy(f)&&b++}return b}.bind(this),
req:function(b,e,f){return!0}};this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,b);this.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,$.extend({},b))},done:!0,unique:!0,upgrades:[ELITE,CANNON,BOMB,CREW,MISSILE,ILLICIT]},{name:"Kath Scarlet",done:!0,wave:["6"],pilotid:117,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){4>this.weapons[b].getauxiliarysector(e)&&(this.log("+1 attack die against %0 in auxiliary arc",e.name),f+=1);return f})},unique:!0,faction:SCUM,unit:"Firespray-31",
skill:7,points:38,upgrades:[ELITE,CANNON,BOMB,CREW,MISSILE,ILLICIT]},{name:"Emon Azzameen",done:!0,unique:!0,wave:["6"],pilotid:118,getbomblocation:function(){return["F1","TL3","TR3","F3"]},faction:SCUM,unit:"Firespray-31",skill:6,points:36,upgrades:[CANNON,BOMB,CREW,MISSILE,ILLICIT]},{name:"Mandalorian Mercenary",faction:SCUM,pilotid:119,done:!0,unit:"Firespray-31",skill:5,points:35,wave:["6"],upgrades:[ELITE,CANNON,BOMB,CREW,MISSILE,ILLICIT]},{name:"Kavil",unique:!0,done:!0,wave:["6"],pilotid:120,
init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){this.isinprimaryfiringarc(e)||(this.log("+1 attack die against %0 outside firing arc",e.name),f+=1);return f})},faction:SCUM,unit:"Y-Wing",skill:7,points:24,upgrades:[ELITE,TURRET,TORPEDO,TORPEDO,SALVAGED]},{name:"Drea Renthal",unique:!0,pilotid:121,faction:SCUM,unit:"Y-Wing",skill:5,done:!0,wave:["6"],init:function(){this.wrap_before("removetarget",this,function(b){this.selectunit(this.gettargetableunits(3),function(b,e){-1==
this.targeting.indexOf(b[e])&&(this.addtarget(b[e]),this.addstress())},["select unit to target, +1 %STRESS% (or self to cancel)"],!0)})},points:22,upgrades:[TURRET,TORPEDO,TORPEDO,SALVAGED]},{name:"Hired Gun",faction:SCUM,pilotid:122,done:!0,unit:"Y-Wing",skill:4,points:20,wave:["6"],upgrades:[TURRET,TORPEDO,TORPEDO,SALVAGED]},{name:"Syndicate Thug",faction:SCUM,pilotid:123,done:!0,wave:["6"],unit:"Y-Wing",skill:2,points:18,upgrades:[TURRET,TORPEDO,TORPEDO,SALVAGED]},{name:"Dace Bonearm",unique:!0,
pilotid:124,faction:SCUM,unit:"HWK-290",done:!0,wave:["6"],init:function(){var b=this;Unit.prototype.wrap_after("addiontoken",this,function(){!b.dead&&3>=this.getrange(b)&&b.isenemy(this)&&0==b.stress&&(b.addstress(),this.resolvehit(1),b.log("+1 %STRESS%"),this.log("+%1 %HIT% [%0]",b.name,1),this.checkdead())})},skill:7,points:23,upgrades:[ELITE,TURRET,CREW,ILLICIT]},{name:"Palob Godalhi",unique:!0,pilotid:125,wave:["6"],faction:SCUM,unit:"HWK-290",init:function(){this.wrap_after("begincombatphase",
this,function(b){this.selectunit(this.selectnearbyenemy(2),function(b,e){0<b[e].evade?(b[e].removeevadetoken(),this.addevadetoken(),b[e].log("-1 %EVADE% [%0]",this.name),this.log("+1 %EVADE%")):0<b[e].focus&&(b[e].removefocustoken(),this.addfocustoken(),b[e].log("-1 %FOCUS% [%0]",this.name),this.log("+1 %FOCUS%"))},["select %FOCUS%/%EVADE% to take (or self to cancel)"],!0);return b})},done:!0,skill:5,points:20,upgrades:[ELITE,TURRET,CREW,ILLICIT]},{name:"Torkil Mux",unique:!0,pilotid:126,done:!0,
wave:["6"],init:function(){this.wrap_after("endactivationphase",this,function(){this.selectunit(this.selectnearbyenemy(2),function(b,e){b[e].wrap_after("getskill",this,function(b){return 0}).unwrapper("endcombatphase")},["select unit for a 0 PS"],!1)})},faction:SCUM,unit:"HWK-290",skill:3,points:19,upgrades:[TURRET,CREW,ILLICIT]},{name:"Spice Runner",faction:SCUM,pilotid:127,done:!0,unit:"HWK-290",skill:1,points:16,wave:["6"],upgrades:[TURRET,CREW,ILLICIT]},{name:"Commander Alozen",faction:EMPIRE,
pilotid:128,unit:"TIE Advanced",unique:!0,done:!0,skill:5,wave:["epic"],points:25,init:function(){this.wrap_after("begincombatphase",this,function(b){this.selectunit(this.gettargetableunits(1),function(b,e){this.addtarget(b[e]);this.log("+%1 %TARGET% / %0",b[e].name,1)},["select unit to lock (or self to cancel)"],!0);return b})},upgrades:[ELITE,MISSILE]},{name:"Juno Eclipse",unique:!0,pilotid:129,done:!0,faction:EMPIRE,unit:"TIE Advanced",skill:8,wave:["epic"],points:28,init:function(){this.wrap_after("getmaneuverlist",
this,function(b){if(this.hasionizationeffect())return b;var e={},f,h=[];for(f in b)for(var l=b[f],m=parseInt(l.move.substr(-1),10),z=-1;1>=z;z++){var B=l.move.replace(/\d/,m+z+""),E;!(E="undefined"==typeof P[B])&&(E="undefined"!=typeof e[B])&&(E=l.difficulty,E=!("GREEN"==E||"WHITE"==E&&"GREEN"!=e[B].difficulty));E||(e[B]={move:B,difficulty:l.difficulty,halfturn:l.halfturn})}for(f in e)h.push(e[f]);return h})},upgrades:[ELITE,MISSILE]},{name:"Zertik Strom",unique:!0,pilotid:130,done:!0,faction:EMPIRE,
unit:"TIE Advanced",skill:6,wave:["epic"],init:function(){var b=this;Weapon.prototype.wrap_after("getrangeattackbonus",this,function(e,f){this.unit.isenemy(b)&&1==b.getrange(this.unit)&&(this.unit.log("0 attack range bonus [%0]",b.name),f=0);return f})},points:26,upgrades:[ELITE,MISSILE]},{name:"Lieutenant Colzet",unique:!0,pilotid:131,faction:EMPIRE,unit:"TIE Advanced",skill:3,points:23,upgrades:[MISSILE],done:!0,wave:["epic"],init:function(){this.wrap_before("endphase",this,function(){this.selectunit(this.targeting,
function(b,e){if(this.canusetarget(b[e])){var f=b[e].criticals;this.removetarget(b[e]);0<f.length&&f[rand(f.length)].faceup()}},["select unit (or self to cancel)"],!0)})}},{name:"Bossk",faction:SCUM,pilotid:132,unit:"YV-666",unique:!0,skill:7,points:35,done:!0,init:function(){this.wrap_after("hashit",this,function(b,e){var f=this.criticalresolved+this.hitresolved;e&&0<this.criticalresolved&&(f<=b.shield||2>=b.hull&&f>b.shield?(this.criticalresolved--,this.hitresolved+=2,this.log("1 %CRIT% -> 2 %HIT%")):
this.log("%0 %SHIELD% are down, more than 2 %HULL%: keeping critical",b.name));return e})},upgrades:[ELITE,CANNON,MISSILE,CREW,CREW,CREW,ILLICIT]},{name:"Moralo Eval",faction:SCUM,pilotid:133,unit:"YV-666",unique:!0,skill:6,points:34,done:!0,init:function(){for(var b=0;b<this.weapons.length;b++)"Cannon"==this.weapons[b].type&&(this.log("can fire %0 in auxiliary firing arc",this.weapons[b].name),this.weapons[b].auxiliary=this.weapons[0].auxiliary,this.weapons[b].subauxiliary=this.weapons[0].subauxiliary)},
upgrades:[CANNON,MISSILE,CREW,CREW,CREW,ILLICIT]},{name:"Latts Razzi",faction:SCUM,pilotid:134,unit:"YV-666",unique:!0,skill:5,points:33,done:!0,init:function(){var b=this;Unit.prototype.wrap_after("declareattack",this,function(e,f,h){if(!h)return h;!b.dead&&b.isally(this)&&b.canusetarget(f)&&b.donoaction([this.newaction(function(e){this.removetarget(f);f.wrap_after("getdefensestrength",b,function(b,e,f){return 0<f?f-1:f}).unwrapper("afterdefenseeffect");this.endnoaction(e,"TARGET")}.bind(b),"TARGET")],
b.name+": -1 agility for "+f.name,!0);return h})},upgrades:[CANNON,MISSILE,CREW,CREW,CREW,ILLICIT]},{name:"Trandoshan Slaver",faction:SCUM,pilotid:135,unit:"YV-666",done:!0,skill:2,points:29,upgrades:[CANNON,MISSILE,CREW,CREW,CREW,ILLICIT]},{name:"Talonbane Cobra",unique:!0,faction:SCUM,pilotid:136,unit:"Kihraxz Fighter",skill:9,upgrades:[ELITE,MISSILE,ILLICIT],done:!0,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){return f+this.weapons[b].getrangeattackbonus(e)});this.wrap_after("getdefensestrength",
this,function(b,e,f){return f+e.weapons[b].getrangedefensebonus(this)})},points:28},{name:"Graz the Hunter",unique:!0,pilotid:137,faction:SCUM,unit:"Kihraxz Fighter",skill:6,upgrades:[MISSILE,ILLICIT],init:function(){this.wrap_after("getdefensestrength",this,function(b,e,f){3>=this.weapons[b].getsector(e)&&(f+=1,this.log("+1 defense die for defending in firing arc"));return f})},done:!0,points:25},{name:"Black Sun Ace",faction:SCUM,pilotid:138,unit:"Kihraxz Fighter",done:!0,skill:5,upgrades:[ELITE,
MISSILE,ILLICIT],points:23},{name:"Cartel Marauder",done:!0,pilotid:139,faction:SCUM,unit:"Kihraxz Fighter",skill:2,upgrades:[MISSILE,ILLICIT],points:20},{name:"Miranda Doni",unique:!0,pilotid:140,done:!0,faction:REBEL,unit:"K-Wing",skill:8,upgrades:[TURRET,TORPEDO,TORPEDO,MISSILE,CREW,BOMB,BOMB],mirandaturn:-1,preattackroll:function(b,e){if(this.mirandaturn!=round){var f={org:this,name:this.name,type:"SHIELD",action:function(b){this.mirandaturn=round;this.log("-1 attack die");this.wrap_after("getattackstrength",
this,function(b,e,f){b=this.weapons[b].getrangeattackbonus(e);0<f-b&&--f;return f}).unwrapper("attackroll");this.shield<this.ship.shield&&(this.addshield(1),this.log("+1 %SHIELD%"));this.endnoaction(b,"SHIELD")}.bind(this)},h={org:this,name:this.name,type:"HIT",action:function(b){this.log("-1 %SHIELD%");this.log("+1 attack die");this.mirandaturn=round;this.wrap_after("getattackstrength",this,function(b,e,f){return 1+f}).unwrapper("attackroll");this.removeshield(1);this.endnoaction(b,"HIT")}.bind(this)},
l=[];0<this.shield&&l.push(h);this.shield<this.ship.shield&&l.push(f);this.donoaction(l,"select to add shield/roll 1 fewer die or remove shield/roll 1 additional die",!0)}},points:29},{name:"Esege Tuketu",unique:!0,pilotid:141,faction:REBEL,unit:"K-Wing",skill:6,upgrades:[TURRET,TORPEDO,TORPEDO,MISSILE,CREW,BOMB,BOMB],points:28,done:!0,init:function(){var b=this;Unit.prototype.wrap_before("beginattack",this,function(){!b.dead&&this!=b&&this.isally(b)&&(this.wrap_after("canusefocus",b,function(e){return e||
b.canusefocus()&&2>=this.getrange(b)}).unwrapper("endattack"),this.wrap_before("removefocustoken",b,function(){2>=this.getrange(b)&&(this.focus++,b.log("-1 %FOCUS% [%0]",this.name),b.removefocustoken())}).unwrapper("endattack"))})}},{name:"Guardian Squadron Pilot",faction:REBEL,pilotid:142,done:!0,unit:"K-Wing",skill:4,upgrades:[TURRET,TORPEDO,TORPEDO,MISSILE,CREW,BOMB,BOMB],points:25},{name:"Warden Squadron Pilot",faction:REBEL,pilotid:143,done:!0,unit:"K-Wing",skill:2,upgrades:[TURRET,TORPEDO,TORPEDO,
MISSILE,CREW,BOMB,BOMB],points:23},{name:"'Redline'",unique:!0,pilotid:144,faction:EMPIRE,unit:"TIE Punisher",skill:7,done:!0,init:function(){this.wrap_after("addtarget",this,function(b){this.log("+%1 %TARGET% / %0",b.name,2);this.targeting.push(b);b.istargeted.push(this);this.movelog("T-"+b.id);b.show();this.show()})},boundtargets:function(b){var e=this.targeting;if(-1<this.targeting.indexOf(b))return!0;for(b=e.length-2;0<=b;b++)this.removetarget(e[b]);return!1},upgrades:[SYSTEM,TORPEDO,TORPEDO,
MISSILE,MISSILE,BOMB,BOMB],points:27},{name:"'Deathrain'",unique:!0,pilotid:145,faction:EMPIRE,unit:"TIE Punisher",skill:6,done:!0,init:function(){this.wrap_after("getbombposition",this,function(b,e,f){for(var h=0;h<b.length;h++)f.push(this.getpathmatrix(this.m.clone(),b[h]).translate(0,-e+20));return f});this.wrap_after("bombdropped",this,function(){this.candoroll()&&this.candoaction()&&($("#activationdial").hide(),this.doaction([this.newaction(this.resolveroll,"ROLL")],"free %ROLL% action"))})},
upgrades:[SYSTEM,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB,BOMB],points:26},{name:"Black Eight Squadron Pilot",faction:EMPIRE,pilotid:146,done:!0,unit:"TIE Punisher",skill:4,upgrades:[SYSTEM,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB,BOMB],points:23},{name:"Cutlass Squadron Pilot",faction:EMPIRE,done:!0,pilotid:147,unit:"TIE Punisher",skill:2,upgrades:[SYSTEM,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB,BOMB],points:21},{name:"Poe Dameron",faction:REBEL,pilotid:148,unit:"T-70 X-Wing",unique:!0,done:!0,ambiguous:!0,
skill:8,upgrades:[ELITE,TORPEDO,ASTROMECH,TECH],init:l,points:31},{name:"'Blue Ace'",faction:REBEL,done:!0,pilotid:149,unit:"T-70 X-Wing",skill:5,unique:!0,getboostmatrix:function(b){return[this.getpathmatrix(b,"TR1"),this.getpathmatrix(b,"TL1")].concat(Unit.prototype.getboostmatrix.call(this,b))},upgrades:[TORPEDO,ASTROMECH,TECH],points:27},{name:"Ello Asty",faction:REBEL,done:!0,pilotid:150,beta:!0,unit:"T-70 X-Wing",skill:7,unique:!0,init:function(){var b=[];this.wrap_after("getdial",this,function(e){if(0==
b.length)for(var f=0;f<e.length;f++){var h=e[f].move,l=e[f].difficulty;h.match(/TR[RL]\d/)&&(l="WHITE");b[f]={move:h,difficulty:l}}return 0==this.stress?b:e})},upgrades:[ELITE,TORPEDO,ASTROMECH,TECH],points:30},{name:"'Red Ace'",faction:REBEL,done:!0,pilotid:151,beta:!0,unit:"T-70 X-Wing",skill:6,unique:!0,init:function(){this.sr=-1;this.wrap_after("removeshield",this,function(b){this.sr<round&&(this.log("+1 %SHIELD%"),this.sr=round,this.addevadetoken())})},upgrades:[TORPEDO,ASTROMECH,TECH],points:29},
{name:"Blue Squadron Novice",faction:REBEL,done:!0,unit:"T-70 X-Wing",wave:["aces",8],skill:2,pilotid:152,upgrades:[TORPEDO,ASTROMECH,TECH],points:24},{name:"Red Squadron Veteran",faction:REBEL,pilotid:153,done:!0,unit:"T-70 X-Wing",wave:["aces",8],skill:4,upgrades:[ELITE,TORPEDO,ASTROMECH,TECH],points:26},{name:"Omega Squadron Pilot",faction:EMPIRE,done:!0,pilotid:154,unit:"TIE/FO Fighter",skill:4,upgrades:[TECH,ELITE],points:17},{name:"Zeta Squadron Pilot",faction:EMPIRE,done:!0,pilotid:155,unit:"TIE/FO Fighter",
skill:3,upgrades:[TECH],points:16},{name:"Epsilon Squadron Pilot",faction:EMPIRE,done:!0,pilotid:156,unit:"TIE/FO Fighter",skill:1,upgrades:[TECH],points:15},{name:"'Zeta Ace'",faction:EMPIRE,done:!0,pilotid:157,unique:!0,unit:"TIE/FO Fighter",skill:5,getrollmatrix:function(b){var e=this.getpathmatrix(b.clone().rotate(90,0,0),"F2").translate(0,this.islarge?20:0).rotate(-90,0,0),f=this.getpathmatrix(b.clone().rotate(-90,0,0),"F2").translate(0,this.islarge?20:0).rotate(90,0,0);return[e.clone().translate(0,
-20),e,e.clone().translate(0,20),f.clone().translate(0,-20),f,f.clone().translate(0,20)].concat(Unit.prototype.getrollmatrix.call(this,b))},upgrades:[ELITE,TECH],points:18},{name:"'Epsilon Leader'",faction:EMPIRE,done:!0,pilotid:158,unique:!0,unit:"TIE/FO Fighter",skill:6,init:function(){this.wrap_after("begincombatphase",this,function(b){var e=this.selectnearbyally(1);e.push(this);for(var f=0;f<e.length;f++)e[f].removestresstoken();return b})},upgrades:[TECH],points:19},{name:"'Epsilon Ace'",faction:EMPIRE,
done:!0,pilotid:159,unique:!0,unit:"TIE/FO Fighter",skill:4,init:function(){this.wrap_after("getskill",this,function(b){return 0==this.criticals.length?12:b})},upgrades:[TECH],points:17},{name:"'Omega Ace'",faction:EMPIRE,done:!0,pilotid:160,unique:!0,unit:"TIE/FO Fighter",skill:7,init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){0<this.focus&&0<this.targeting.length&&(l=e*FCH_CRIT);return l});this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return this.canusefocus()&&
-1<this.targeting.indexOf(targetunit)}.bind(this),f:function(b,e){this.removefocustoken();this.removetarget(targetunit);this.log("all results are %CRIT%");return e*FCH_CRIT}.bind(this),str:"critical"})},upgrades:[ELITE,TECH],points:20},{name:"'Omega Leader'",faction:EMPIRE,beta:!0,pilotid:161,unique:!0,unit:"TIE/FO Fighter",skill:8,upgrades:[ELITE,TECH],points:21,done:!0,init:function(){var b=this;this.wrap_after("isattackedby",this,function(e,f){-1<b.targeting.indexOf(f)&&f.wrap_after("getdicemodifiers",
b,function(b){for(var e=[],f=0;f<b.length;f++)b[f].from!=ATTACK_M&&e.push(b[f]);return b}).unwrapper("endattack")});this.wrap_before("resolveattack",this,function(b,e){-1<this.targeting.indexOf(e)&&e.wrap_after("getdicemodifiers",this,function(b){for(var e=[],f=0;f<b.length;f++)b[f].from!=DEFENSE_M&&e.push(b[f]);return b}).unwrapper("endbeingattacked")});this.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&this.candotarget()&&0==this.targeting.length&&(b.priority+=10)})}},{name:"Hera Syndulla",
unique:!0,faction:REBEL,unit:"VCX-100",skill:7,pilotid:162,ambiguous:!0,edition:"VCX-100",points:40,done:!0,upgrades:[SYSTEM,TURRET,TORPEDO,TORPEDO,CREW,CREW],init:function(){this.wrap_after("getmaneuverlist",this,function(b){return m.call(this,b)});for(var b=0;b<this.weapons.length;b++){var e=this.weapons[b];e.type==TORPEDO&&(e.auxiliary=AUXILIARY,e.subauxiliary=SUBAUXILIARY)}}},{name:"'Chopper'",unique:!0,pilotid:163,faction:REBEL,unit:"VCX-100",skill:4,points:37,done:!0,init:function(){this.wrap_after("begincombatphase",
this,function(b){for(var e=0;e<this.touching.length;e++)this.touching[e].isenemy(this.team)&&(this.touching[e].addstress(),this.touching[e].log("+1 %STRESS% [%0]",this.name));return b});for(var b=0;b<this.weapons.length;b++){var e=this.weapons[b];e.type==TORPEDO&&(e.auxiliary=AUXILIARY,e.subauxiliary=SUBAUXILIARY)}},upgrades:[SYSTEM,TURRET,TORPEDO,TORPEDO,CREW,CREW]},{name:"Ezra Bridger",faction:REBEL,unique:!0,done:!0,pilotid:164,unit:"Attack Shuttle",skill:4,points:20,init:function(){this.adddicemodifier(DEFENSE_M,
MOD_M,DEFENSE_M,this,{req:function(b,e){return 0<this.stress}.bind(this),f:function(b,e){var f=FE_focus(b);2<f&&(f=2);return 0<f?(this.log("%0 %FOCUS% -> %0 %EVADE%",f),b-f*FE_FOCUS+f*FE_EVADE):b}.bind(this),str:"focus"})},upgrades:[ELITE,TURRET,CREW]},{name:"Hera Syndulla",faction:REBEL,unique:!0,done:!0,pilotid:165,unit:"Attack Shuttle",skill:7,ambiguous:!0,edition:"Attack Shuttle",points:22,init:function(){this.wrap_after("getmaneuverlist",this,function(b){return m.call(this,b)})},upgrades:[ELITE,
TURRET,CREW]},{name:"Sabine Wren",faction:REBEL,unique:!0,done:!0,pilotid:166,unit:"Attack Shuttle",skill:5,points:21,ambiguous:!0,edition:"Attack Shuttle",init:function(){this.wrap_after("beginactivation",this,b)},upgrades:[ELITE,TURRET,CREW]},{name:"'Zeb' Orrelios",faction:REBEL,unique:!0,ambiguous:!0,edition:"Attack Shuttle",unit:"Attack Shuttle",skill:3,pilotid:167,points:18,done:!0,cancelhit:e,upgrades:[TURRET,CREW]},{name:"Kanan Jarrus",faction:REBEL,unique:!0,pilotid:168,unit:"VCX-100",skill:5,
points:38,upgrades:[SYSTEM,TURRET,TORPEDO,TORPEDO,CREW,CREW],done:!0,init:function(){for(var b=this,e=0;e<this.weapons.length;e++){var f=this.weapons[e];f.type==TORPEDO&&(f.auxiliary=AUXILIARY,f.subauxiliary=SUBAUXILIARY)}Unit.prototype.wrap_after("preattackroll",this,function(e,f){var h=this.selectnearbyenemy(2);b.canusefocus()&&-1<h.indexOf(b)&&!b.dead&&b.donoaction([{org:b,name:b.name,type:"FOCUS",action:function(e){this.wrap_after("getattackstrength",b,function(b,e,f){NOLOG=!0;b=this.weapons[b].getrangeattackbonus(e);
f-=b;NOLOG=!1;0<f&&--f;return f+b}).unwrapper("attackroll");b.removefocustoken();this.log("-1 attack against %0",b.name);this.select();b.endnoaction(e,"FOCUS")}.bind(this)}],"",!0)})}},{name:"'Wampa'",faction:EMPIRE,unique:!0,pilotid:169,unit:"TIE Fighter",wave:["epic"],skill:4,points:14,done:!0,init:function(){this.adddicemodifier(ATTACKCOMPARE_M,ADD_M,ATTACK_M,this,{req:function(b,e){return 0<e},f:function(b,e){this.log("cancel all dice");0<FCH_crit(b)&&(targetunit.log("+1 damage card [%0]",this.name),
targetunit.applydamage(1));return{m:0,n:0}}.bind(this),str:"critical"})},upgrades:[]},{name:"'Youngster'",faction:EMPIRE,unique:!0,pilotid:170,unit:"TIE Fighter",skill:6,wave:["epic"],points:15,done:!0,init:function(){var b=null,e=this;for(i=0;i<this.upgrades.length;i++)this.upgrades[i].type==ELITE&&"function"==typeof this.upgrades[i].action&&(b=$.extend({},this.upgrades[i]),b.clone=!0,b.isactive=!0);null!=b&&(this.log("share %0 upgrade",b.name),Unit.prototype.wrap_after("getupgactionlist",e,function(f){var h=
this.selectnearbyally(3);!e.dead&&this.ship.name.match(/.*TIE.*Fighter.*/)&&-1<h.indexOf(e)&&b.candoaction()&&b.isactive&&(this.log("elite action from %0 available",e.name),b.unit=this,f.push({org:b,action:b.action,type:b.type.toUpperCase(),name:b.name}));return f}))},upgrades:[ELITE]},{name:"'Chaser'",faction:EMPIRE,unique:!0,pilotid:171,done:!0,unit:"TIE Fighter",skill:3,wave:["epic"],points:14,init:function(){var b=this;Unit.prototype.wrap_after("removefocustoken",this,function(){!b.dead&&this.isally(b)&&
this!=b&&1>=this.getrange(b)&&(b.log("+1 %FOCUS%"),b.addfocustoken())})},upgrades:[]},{name:"Gamma Squadron Veteran",faction:EMPIRE,pilotid:172,done:!0,unit:"TIE Bomber",skill:5,wave:["aces"],points:19,upgrades:[ELITE,TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB]},{name:"The Inquisitor",faction:EMPIRE,pilotid:173,unit:"TIE Adv. Prototype",skill:8,unique:!0,done:!0,points:25,init:function(){this.weapons[0].wrap_after("getrangedefensebonus",this,function(b,e){1==e&&this.unit.log("defense range nullified");
return 0});this.wrap_after("getattackstrength",this,function(b,e,f){0==b&&1<this.weapons[0].getrange(e)&&(this.log("+1 attack die with primary weapon [%0]",this.name),f+=1);return f})},upgrades:[ELITE,MISSILE]},{name:"Valen Rudor",faction:EMPIRE,unique:!0,pilotid:174,unit:"TIE Adv. Prototype",skill:6,points:22,done:!0,init:function(){this.addafterdefenseeffect(this,function(b,e,f){this.candoaction()&&(this.log("+1 free action [%0]",this.name),this.doaction(this.getactionlist(),""))})},upgrades:[ELITE,
MISSILE]},{name:"Sienar Test Pilot",faction:EMPIRE,pilotid:175,done:!0,unit:"TIE Adv. Prototype",skill:2,points:16,upgrades:[MISSILE]},{name:"Zuckuss",faction:SCUM,pilotid:176,unique:!0,unit:"G-1A Starfighter",skill:7,points:28,done:!0,upgrades:[ELITE,CREW,SYSTEM,ILLICIT],init:function(){this.wrap_after("modifyattackdefense",this,function(b,e,f,l,m){m.a+=1;m.d+=1;return m})},preattackroll:function(b,e){var f={org:this,name:this.name,type:"HIT",action:function(b){this.log("+1 attack die");this.wrap_after("getattackstrength",
this,function(b,e,f){return 1+f}).unwrapper("attackroll");targetunit.wrap_after("getdefensestrength",this,function(b,e,f){return 1+f}).unwrapper("defenseroll");this.endnoaction(b,"HIT")}.bind(this)};this.donoaction([f],"select to add +1 attack roll",!0)}},{name:"4-LOM",faction:SCUM,pilotid:177,unique:!0,done:!0,unit:"G-1A Starfighter",skill:6,points:27,init:function(){this.wrap_before("endphase",this,function(){var b=this.selectnearbyunits(1,function(){return!0});0<this.stress&&this.selectunit(b,
function(b,e){b[e].addstress();this.removestresstoken();b[e].log("+1 %STRESS% [%0]",this.name);this.log("-1 %STRESS%")},["select unit (or self to cancel)"],!0)})},upgrades:[ELITE,CREW,SYSTEM,ILLICIT]},{name:"Nashtah Pup Pilot",faction:SCUM,done:!0,pilotid:178,unique:!0,unit:"Z-95 Headhunter",skill:2,wave:["8"],points:0,upgrades:[]},{name:"Dengar",faction:SCUM,unique:!0,pilotid:179,unit:"JumpMaster 5000",skill:9,points:33,done:!0,init:function(){this.dengarattack=-1;this.addattack(function(b,e,f){this.retaliationtarget=
f;return this.dengarattack<round&&f!=this&&this.isinprimaryfiringarc(f)},this,this.weapons,function(){this.dengarattack=round},function(){return[this.retaliationtarget]},"endbeingattacked")},upgrades:[ELITE,TORPEDO,TORPEDO,CREW,SALVAGED,ILLICIT]},{name:"Tel Trevura",faction:SCUM,unique:!0,pilotid:180,unit:"JumpMaster 5000",skill:7,points:30,done:!0,init:function(){this.resurrected=!1;this.wrap_before("checkdead",this,function(){0>=this.hull&&!this.dead&&!this.resurrected&&(this.addhull(this.ship.hull-
this.hull),this.criticals=[],SOUNDS.explode.play(),this.resurrected=!0,this.log("resists!"),this.applydamage(4),this.showoverflow())})},upgrades:[ELITE,TORPEDO,TORPEDO,CREW,SALVAGED,ILLICIT]},{name:"Manaroo",faction:SCUM,pilotid:181,unit:"JumpMaster 5000",skill:4,unique:!0,points:27,done:!0,init:function(){this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyally(1),function(b,e){for(var f=this.focus,h=this.evade,l=0;l<f;l++)this.removefocustoken(),b[e].addfocustoken();
for(l=0;l<h;l++)this.removeevadetoken(),b[e].addevadetoken();f=this.targeting;for(l=f.length-1;0<=l;l--)h=f[l],this.removetarget(h),b[e].addtarget(h);f=this.istargeted;for(l=f.length-1;0<=l;l--)h=f[l],h.removetarget(this),h.addtarget(b[e])},["select unit (or self to cancel) [%0]",this.name],!0)})},upgrades:[ELITE,TORPEDO,TORPEDO,CREW,SALVAGED,ILLICIT]},{name:"Tomax Bren",faction:EMPIRE,pilotid:182,unit:"TIE Bomber",skill:8,wave:["aces"],unique:!0,done:!0,points:24,upgrades:[ELITE,TORPEDO,TORPEDO,
MISSILE,MISSILE,BOMB],init:function(){var b=this;b.flip=-1;for(var e=0;e<this.upgrades.length;e++){var f=this.upgrades[e];f.type==ELITE&&function(e){e.wrap_after("desactivate",this,function(){b.flip<round&&b.donoaction([{org:b,name:b.name,type:"ELITE",action:function(f){e.isactive=!0;b.log("name reactivated:"+e.name);b.flip=round;b.endnoaction(f,"ELITE")}}],"Choose to reactivate an elite upgrade (or not)",!0)})}(f)}}},{name:"Lothal Rebel",faction:REBEL,done:!0,unit:"VCX-100",skill:3,pilotid:183,points:35,
upgrades:[SYSTEM,TURRET,TORPEDO,TORPEDO,CREW,CREW],init:function(){for(var b=0;b<this.weapons.length;b++){var e=this.weapons[b];e.type==TORPEDO&&(e.auxiliary=AUXILIARY,e.subauxiliary=SUBAUXILIARY)}}},{name:"Baron of the Empire",faction:EMPIRE,pilotid:184,done:!0,unit:"TIE Adv. Prototype",skill:4,points:19,upgrades:[ELITE,MISSILE]},{name:"Gand Findsman",faction:SCUM,pilotid:185,done:!0,unit:"G-1A Starfighter",skill:5,points:25,upgrades:[ELITE,CREW,SYSTEM,ILLICIT]},{name:"Ruthless Freelancer",faction:SCUM,
pilotid:186,done:!0,unit:"G-1A Starfighter",skill:3,points:23,upgrades:[CREW,SYSTEM,ILLICIT]},{name:"'Zeta Leader'",faction:EMPIRE,pilotid:187,done:!0,unique:!0,unit:"TIE/FO Fighter",skill:7,points:20,upgrades:[ELITE,TECH],modifyattackdefense:function(b,e,f,l){0==this.stress&&(this.addstress(),b+=1);return{a:b,d:e}},preattackroll:function(b,e){var f={org:this,name:this.name,type:"STRESS",action:function(b){this.log("+1 attack die");this.wrap_after("getattackstrength",this,function(b,e,f){return 1+
f}).unwrapper("attackroll");this.addstress();this.endnoaction(b,"STRESS")}.bind(this)};0==this.stress&&this.donoaction([f],"select to add +1 attack roll",!0)}},{name:"Countess Ryad",faction:EMPIRE,pilotid:188,done:!0,unique:!0,unit:"TIE Defender",skill:5,wave:["aces"],points:34,shipimg:"tie-defender-red",upgrades:[ELITE,CANNON,MISSILE],init:function(){this.wrap_after("getmaneuverlist",this,function(b){if(this.hasionizationeffect())return b;for(var e=1;5>=e;e++)"undefined"!=typeof b["F"+e]&&(b["K"+
e]={move:"K"+e,difficulty:b["F"+e].difficulty});return b})}},{name:"'Deathfire'",faction:EMPIRE,pilotid:189,done:!0,unique:!0,unit:"TIE Bomber",skill:3,wave:["aces"],points:17,upgrades:[TORPEDO,TORPEDO,MISSILE,MISSILE,BOMB],init:function(){var b;for(b=0;b<this.upgrades.length;b++){var e=this.upgrades[b];"function"==typeof e.action&&e.type==BOMB&&e.wrap_after("canbedropped",this,Bomb.prototype.canbedropped)}}},{name:"Rey",faction:REBEL,pilotid:190,done:!0,unique:!0,unit:"YT-1300",skill:8,wave:["aces"],
points:45,upgrades:[ELITE,MISSILE,CREW,CREW],init:function(){this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank"],n:function(){return 2},req:function(b,e,f){return b.isinfiringarc(f)}});this.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["blank"],n:function(){return 2},req:function(b,e,f){return f.isinfiringarc(b)}})}},{name:"Poe Dameron",faction:REBEL,pilotid:191,unit:"T-70 X-Wing",unique:!0,done:!0,ambiguous:!0,edition:"HoR",init:l,skill:9,wave:["aces"],upgrades:[ELITE,
TORPEDO,ASTROMECH,TECH],points:33},{name:"'Quickdraw'",faction:EMPIRE,pilotid:192,unit:"TIE/SF Fighter",unique:!0,done:!0,skill:9,upgrades:[ELITE,SYSTEM,MISSILE,TECH],points:29,init:function(){this.qdattack=-1;this.addattack(function(b,e){return this.qdattack<round},this,[this.weapons[0]],function(){this.qdattack=round},function(){return squadron},"removeshield")}},{name:"'Backdraft'",faction:EMPIRE,pilotid:193,unit:"TIE/SF Fighter",unique:!0,done:!0,skill:7,upgrades:[ELITE,SYSTEM,MISSILE,TECH],points:27,
init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){3>=this.weapons[0].getauxiliarysector(targetunit)&&(l+=FCH_CRIT);return l});this.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,e){return!targetunit.dead&&0==this.activeweapon&&3>=this.weapons[0].getauxiliarysector(targetunit)}.bind(this),f:function(b,e){this.log("%0 in auxiliary arc -> +1 %CRIT%",targetunit.name);return{m:b+FCH_CRIT,n:e+1}}.bind(this),str:"critical"})}},{name:"Zeta Specialist",faction:EMPIRE,
pilotid:194,done:!0,unit:"TIE/SF Fighter",skill:3,upgrades:[SYSTEM,MISSILE,TECH],points:23},{name:"Ketsu Onyo",faction:SCUM,pilotid:195,unit:"Lancer-class Pursuit Craft",unique:!0,skill:7,done:!0,upgrades:[ELITE,CREW,ILLICIT,ILLICIT],points:38,init:function(){var b=this;this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyenemy(1,function(e,f){var h=b.weapons[0];return 3>=h.getprimarysector(f)&&3>=h.getauxiliarysector(f)}),function(e,f){e[f].log("+1 tractor beam token [%0]",
b.name);e[f].addtractorbeam(b)},["select unit for tractor beam token [%0]",b.name],!1)})}},{name:"Asajj Ventress",faction:SCUM,pilotid:196,unit:"Lancer-class Pursuit Craft",unique:!0,done:!0,skill:6,upgrades:[ELITE,CREW,ILLICIT,ILLICIT],points:37,init:function(){var b=this;this.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyenemy(2,function(e,f){return 3>=b.weapons[0].getauxiliarysector(f)}),function(e,f){e[f].log("+1 stress [%0]",b.name);e[f].addstress(b)},["select unit [%0]",
b.name],!1)})}},{name:"Sabine Wren",faction:SCUM,pilotid:197,unit:"Lancer-class Pursuit Craft",unique:!0,done:!0,skill:5,upgrades:[CREW,ILLICIT,ILLICIT],points:35,init:function(){this.adddicemodifier(DEFENSE_M,ADD_M,DEFENSE_M,this,{req:function(b,e){return 2>=this.weapons[0].getauxiliarysector(activeunit)}.bind(this),f:function(b,e){this.log("Attacker inside Range 1-2 of mobile arc -> +1 %FOCUS%");return{m:b+FE_FOCUS,n:e+1}}.bind(this),str:"focus"})}},{name:"Shadowport Hunter",faction:SCUM,pilotid:198,
done:!0,unit:"Lancer-class Pursuit Craft",skill:2,upgrades:[CREW,ILLICIT,ILLICIT],points:33},{name:"Zealous Recruit",faction:SCUM,pilotid:199,done:!0,unit:"Protectorate Starfighter",skill:1,upgrades:[TORPEDO],points:20},{name:"Concord Dawn Veteran",faction:SCUM,pilotid:200,done:!0,unit:"Protectorate Starfighter",skill:3,upgrades:[ELITE,TORPEDO],points:22},{name:"Concord Dawn Ace",faction:SCUM,pilotid:201,done:!0,unit:"Protectorate Starfighter",skill:5,upgrades:[ELITE,TORPEDO],points:23},{name:"Kad Solus",
faction:SCUM,pilotid:202,unique:!0,done:!0,unit:"Protectorate Starfighter",skill:6,upgrades:[ELITE,TORPEDO],points:25,init:function(){this.wrap_after("handledifficulty",this,function(b){"RED"==b&&(this.addfocustoken(),this.addfocustoken(),this.log("red maneuver -> +2 %FOCUS% [%0]",this.name))})}},{name:"Old Teroch",faction:SCUM,pilotid:203,unique:!0,done:!0,unit:"Protectorate Starfighter",skill:7,upgrades:[ELITE,TORPEDO],points:26,init:function(){var b=this;this.wrap_before("begincombatphase",this,
function(){this.selectunit(this.selectnearbyenemy(1,function(b,e){return!0}),function(e,f){var h,l=e[f].focus,m=e[f].evade;if(0<l)for(e[f].log("-%0 %FOCUS% [%1]",l,b.name),h=0;h<l;h++)e[f].removefocustoken();if(0<m)for(e[f].log("-%0 %EVADE% [%1]",l,b.name),h=0;h<m;h++)e[f].removeevadetoken()},["select unit [%0]",b.name],!1)})}},{name:"Fenn Rau",faction:SCUM,pilotid:204,unique:!0,done:!0,unit:"Protectorate Starfighter",skill:9,upgrades:[ELITE,TORPEDO],points:28,init:function(){this.wrap_after("getattackstrength",
this,function(b,e,f){1==this.getrange(e)&&(this.log("+1 attack die"),f+=1);return f});this.wrap_after("getdefensestrength",this,function(b,e,f){1==this.getrange(e)&&(this.log("+1 defense die"),f+=1);return f})}},{name:"Norra Wexley",faction:REBEL,pilotid:205,unique:!0,unit:"ARC-170",skill:7,done:!0,upgrades:[ELITE,TORPEDO,CREW,ASTROMECH],points:29,init:function(){this.wrap_after("modifyattackroll",this,function(b,e,f,l){1==this.targeting.length&&(l+=FCH_FOCUS);return l});this.adddicemodifier(ATTACK_M,
ADD_M,ATTACK_M,this,{req:function(b,e){return this.canusetarget(targetunit)}.bind(this),f:function(b,e){this.removetarget(targetunit);this.log("1 %TARGET% -> 1 %FOCUS%");return{m:b+FCH_FOCUS,n:e+1}}.bind(this),str:"target"});this.adddicemodifier(DEFENSE_M,ADD_M,DEFENSE_M,this,{req:function(b,e){return this.canusetarget(activeunit)}.bind(this),f:function(b,e){this.removetarget(activeunit);this.log("1 %TARGET% -> 1 %FOCUS%");return{m:b+FE_FOCUS,n:e+1}}.bind(this),str:"target"})}},{name:"Shara Bey",
faction:REBEL,pilotid:206,unique:!0,done:!0,unit:"ARC-170",skill:6,upgrades:[ELITE,TORPEDO,CREW,ASTROMECH],points:28,init:function(){var b=this;Unit.prototype.wrap_after("canusetarget",b,function(e,f){return b!=this&&b.isally(this)&&2>=b.getrange(this)&&-1<b.targeting.indexOf(e)?!0:f});Unit.prototype.wrap_before("removetarget",b,function(e){b!=this&&b.isally(this)&&2>=b.getrange(this)&&-1==this.targeting.indexOf(e)&&-1<b.targeting.indexOf(e)&&b.removetarget(e)})}},{name:"Thane Kyrell",faction:REBEL,
pilotid:207,unique:!0,done:!0,unit:"ARC-170",skill:4,upgrades:[TORPEDO,CREW,ASTROMECH],points:26,init:function(){var b=this;Unit.prototype.wrap_after("afterdefenseeffect",this,function(e,f){b!=this&&this.isally(b)&&3>=b.getrange(this)&&b.candoaction()&&(b.log("+1 free action [%0]",b.name),b.doaction(b.getactionlist(),""))})}},{name:"Braylen Stramm",faction:REBEL,pilotid:208,unique:!0,done:!0,unit:"ARC-170",skill:3,upgrades:[TORPEDO,CREW,ASTROMECH],points:25,init:function(){this.wrap_before("endmaneuver",
this,function(){if(0<this.stress){var b=this.rollattackdie(1,this,"hit")[0];if("hit"==b||"critical"==b)this.log("-1 stress [%0]",this.name),this.removestresstoken()}})}},{name:"Omega Specialist",faction:EMPIRE,pilotid:209,done:!0,unit:"TIE/SF Fighter",skill:5,upgrades:[ELITE,SYSTEM,MISSILE,TECH],points:25},{name:"Sabine Wren",faction:REBEL,pilotid:210,done:!0,unique:!0,unit:"TIE Fighter",skill:5,ambiguous:!0,edition:"TIE Fighter",upgrades:[ELITE],points:15,wave:["10"],init:function(){this.wrap_after("beginactivation",
this,b)}},{name:"Chewbacca",unit:"YT-1300",skill:5,unique:!0,edition:"HoR",wave:["aces"],ambiguous:!0,done:!0,pilotid:211,faction:REBEL,upgrades:[ELITE,MISSILE,CREW,CREW],points:42,init:function(){var b=this;this.addattack(function(e,f,h){return 0>=e+f&&3>=b.getrange(h)},this,this.weapons,function(){},function(){return squadron},"warndeath")}},{name:"Han Solo",unit:"YT-1300",skill:9,done:!0,unique:!0,edition:"HoR",wave:["aces"],ambiguous:!0,pilotid:212,faction:REBEL,upgrades:[ELITE,MISSILE,CREW,CREW],
points:46},{name:"Nien Nunb",unit:"T-70 X-Wing",unique:!0,wave:["aces"],done:!0,pilotid:213,faction:REBEL,upgrades:[ELITE,TORPEDO,ASTROMECH,TECH],init:function(){this.wrap_after("addstress",this,function(){0<this.selectnearbyenemy(1,function(b,e){return b.isinprimaryfiringarc(e)}).length&&this.removestresstoken()})},points:29,skill:7},{name:"'Snap' Wexley",unit:"T-70 X-Wing",unique:!0,done:!0,pilotid:214,faction:REBEL,upgrades:[ELITE,TORPEDO,ASTROMECH,TECH],points:28,wave:["aces"],skill:6,init:function(){this.wrap_before("endmaneuver",
this,function(){var b=this.moves;for(i in b)b[i].move.match(/\w+[234]/)&&!this.collision&&this.candoboost()&&this.doaction([this.newaction(this.resolveboost,"BOOST")],"free %BOOST%")})}},{name:"Jess Pava",unit:"T-70 X-Wing",unique:!0,done:!0,pilotid:215,faction:REBEL,upgrades:[TORPEDO,ASTROMECH,TECH],points:25,skill:3,wave:["aces"],init:function(){var b=this,e=function(){return b.selectnearbyally(1,function(b,e){return b!=e}).length};this.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank",
"focus"],n:e,req:function(b,e,f){return!0}});this.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["blank","focus"],n:e,req:function(b,e,f){return!0}})}},{name:"Ahsoka Tano",faction:REBEL,pilotid:216,unique:!0,unit:"TIE Fighter",skill:7,upgrades:[ELITE],points:17,wave:["10"],done:!0,init:function(){var b=this;this.wrap_before("begincombatphase",this,function(){if(this.canusefocus()){var e=this.selectnearbyally(1);e.push(this);this.selectunit(e,function(e,f){e[f]!=b&&(b.removefocustoken(),
e[f].log("+1 free action [%0]",b.name),e[f].doaction(e[f].getactionlist(),""))},["select unit, self to cancel [%0]",b.name],!1)}})}},{name:"Captain Rex",faction:REBEL,pilotid:217,unique:!0,done:!0,unit:"TIE Fighter",skill:4,wave:["10"],upgrades:[ELITE],points:14,init:function(){this.wrap_after("endattack",this,function(b,e,f){new Condition(f,this,"Suppressive Fire")})}},{name:"Constable Zuvio",faction:SCUM,pilotid:218,unique:!0,unit:"Quadjumper",skill:7,upgrades:[ELITE,CREW,BOMB,TECH,ILLICIT],points:19,
done:!0,init:function(){this.wrap_after("getbombposition",this,function(b,e,f){var h=this.maneuver;if(this.getdial()[h].move.match(/R/))for(h=0;h<b.length;h++)f.push(this.getpathmatrix(this.m.clone(),b[h]).translate(0,-e+20));return f});for(var b=0;b<this.bombs.length;b++)this.bombs[b].wrap_after("canbedropped",this,function(b){return b||this.unit.getdial()[this.unit.maneuver].move.match(/R/)})}},{name:"Unkar Plutt",faction:SCUM,pilotid:219,unique:!0,unit:"Quadjumper",skill:3,upgrades:[CREW,BOMB,
TECH,ILLICIT],points:17,done:!0,init:function(){this.wrap_after("endactivationphase",this,function(){for(var b in this.touching){var e=this.touching[b];this.log("+1 tractor beam for %0",e.name);e.addtractorbeam(this)}})}},{name:"Jakku Gunrunner",faction:SCUM,pilotid:220,done:!0,unit:"Quadjumper",skill:1,upgrades:[CREW,BOMB,TECH,ILLICIT],points:15},{name:"Heff Tobber",faction:REBEL,pilotid:221,unique:!0,unit:"U-Wing",skill:3,upgrades:[SYSTEM,TORPEDO,CREW,CREW],points:24,done:!0,init:function(){this.wrap_after("collidedby",
this,function(b){this.doaction(this.getactionlist(),"")})}},{name:"Blue Squadron Pathfinder",faction:REBEL,pilotid:222,unit:"U-Wing",done:!0,skill:2,upgrades:[SYSTEM,TORPEDO,CREW,CREW],points:23},{name:"Bodhi Rook",faction:REBEL,unique:!0,pilotid:223,unit:"U-Wing",skill:4,done:!0,upgrades:[SYSTEM,TORPEDO,CREW,CREW],points:25,init:function(){var b=this;Unit.prototype.wrap_after("gettargetableunits",this,function(e,f){if(b.isally(this)){var h=[],l;for(l in squadron){var m=squadron[l];m.isally(b)&&(h=
h.concat(Unit.prototype.gettargetableunits.vanilla.call(m,3)))}return h}return f})}},{name:"'Duchess'",faction:EMPIRE,unique:!0,done:!0,pilotid:224,unit:"TIE Striker",skill:8,upgrades:[ELITE],points:23,init:function(){this.facultativeailerons=!0}},{name:"'Countdown'",faction:EMPIRE,unique:!0,pilotid:225,unit:"TIE Striker",skill:5,upgrades:[],done:!0,points:20,init:function(){this.adddicemodifier(ATTACKCOMPARE_M,ADD_M,DEFENSE_M,this,{req:function(b,e){return 0==this.stress&&0<e}.bind(this),f:function(b,
e){return 0==this.stress?(this.log("cancel all dice results"),this.applydamage(1),this.endattack(),this.addstress(),{m:0,n:0}):{m:b,n:e}}.bind(this),str:"hit"})}},{name:"'Pure Sabacc'",faction:EMPIRE,unique:!0,pilotid:226,unit:"TIE Striker",skill:6,upgrades:[ELITE],points:22,done:!0,init:function(){this.wrap_after("getattackstrength",this,function(b,e,f){1>=this.criticals.length&&(f+=1);return f})}},{name:"Imperial Trainee",faction:EMPIRE,pilotid:227,done:!0,unit:"TIE Striker",skill:1,upgrades:[],
points:17},{name:"Black Squadron Scout",faction:EMPIRE,pilotid:228,done:!0,unit:"TIE Striker",skill:4,upgrades:[ELITE],points:20},{name:"Scarif Defender",faction:EMPIRE,pilotid:229,done:!0,unit:"TIE Striker",skill:3,upgrades:[],points:18},{name:"Cassian Andor",faction:REBEL,pilotid:230,unit:"U-Wing",skill:6,unique:!0,done:!0,upgrades:[ELITE,SYSTEM,TORPEDO,CREW,CREW],points:27,init:function(){var b=this;this.wrap_after("beginactivationphase",this,function(e){var f=this.selectnearbyally(2,function(b,
e){return 0<e.stress?!0:!1});0<f.length&&this.doselection(function(e){this.log("select unit for -1 stress");this.resolveactionselection(f,function(h){f[h].removestresstoken();b.endnoaction(e)})}.bind(this));return e})}},{name:"Kylo Ren",faction:EMPIRE,pilotid:231,unique:!0,unit:"Upsilon-Class Shuttle",skill:6,done:!0,upgrades:[ELITE,SYSTEM,CREW,CREW,TECH,TECH],points:34,init:function(){this.firstroundhit=-1;this.wrap_after("resolveishit",this,function(b){this.firstroundhit<round&&(this.firstroundhit=
round,c=new Condition(b,this,"I'll Show You The Dark Side"))})}},{name:"Major Stridan",faction:EMPIRE,pilotid:232,unique:!0,done:!0,unit:"Upsilon-Class Shuttle",skill:4,upgrades:[SYSTEM,CREW,CREW,TECH,TECH],points:32,init:function(){this.wrap_after("selectnearbyally",this,function(b,e,f){"undefined"==typeof f&&(f=e,e=void 0);return 1<b?f:Unit.prototype.selectnearbyally.call(this,3,e)})}},{name:"Lieutenant Dormitz",faction:EMPIRE,pilotid:233,unique:!0,done:!0,unit:"Upsilon-Class Shuttle",skill:3,upgrades:[SYSTEM,
CREW,CREW,TECH,TECH],points:31},{name:"Starkiller Base Pilot",faction:EMPIRE,pilotid:234,done:!0,unit:"Upsilon-Class Shuttle",skill:2,upgrades:[SYSTEM,CREW,CREW,TECH,TECH],points:30},{name:"'Zeb' Orrelios",faction:REBEL,pilotid:235,unique:!0,done:!0,ambiguous:!0,edition:"TIE Fighter",unit:"TIE Fighter",skill:3,wave:["10"],upgrades:[],points:13,cancelhit:e},{name:"Resistance Sympathizer",faction:REBEL,pilotid:236,done:!0,unit:"YT-1300",skill:3,wave:["aces"],upgrades:[MISSILE,CREW,CREW],points:38},
{name:"Sarco Plank",faction:SCUM,pilotid:237,done:!0,unique:!0,unit:"Quadjumper",skill:5,upgrades:[ELITE,CREW,BOMB,TECH,ILLICIT],points:18,init:function(){this.wrap_after("getdefensestrength",this,function(b,e,f){b=0;e=this.getagility();0<=this.lastmaneuver&&(b=P[this.getdial()[this.lastmaneuver].move].speed);e<b&&(f=f-e+b);return f})}},{name:"Inaldra",faction:SCUM,pilotid:238,unique:!0,done:!0,unit:"M3-A Interceptor",skill:3,wave:["epic"],upgrades:[ELITE],points:15,init:function(){this.adddicemodifier(ATTACK_M,
REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 9},req:function(b,e,f){return 0<this.shield?!0:!1}.bind(this),side:function(){this.removeshield()}.bind(this)});this.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["blank","focus"],n:function(){return 9},req:function(b,e,f){return 0<this.shield?!0:!1}.bind(this),side:function(){this.removeshield()}.bind(this)})}},{name:"Genesis Red",faction:SCUM,pilotid:239,unique:!0,done:!0,unit:"M3-A Interceptor",skill:7,wave:["epic"],
upgrades:[ELITE],points:19,init:function(){this.wrap_after("addtarget",this,function(b){var e=b.evade-this.evade;(0<b.focus-this.focus||0<e)&&this.log("balance %FOCUS% and %EVADE% with %0",b.name);if(b.focus>this.focus)for(;b.focus>this.focus;)this.addfocustoken();if(b.evade>this.evade)for(;b.evade>this.evade;)this.addevadetoken()})}},{name:"Sunny Bounder",faction:SCUM,pilotid:240,unique:!0,unit:"M3-A Interceptor",skill:1,wave:["epic"],upgrades:[],points:14},{name:"Quinn Jast",faction:SCUM,pilotid:241,
unique:!0,wave:["epic"],unit:"M3-A Interceptor",skill:6,upgrades:[ELITE],points:18,done:!0,init:function(){this.wrap_before("begincombatphase",this,function(){this.donoaction([{action:function(b){this.noattack=round;for(var e in this.upgrades){var f=this.upgrades[e];f.type!=TORPEDO&&f.type!=MISSILE||0!=f.isactive||(f.isactive=!0)}this.endnoaction(b,"")}.bind(this),type:"TORPEDO",name:this.name}],"",!0)})}}]})();var UPGRADE_TYPES={Elite:"ept",Torpedo:TORPEDO,Astromech:"amd",Turret:"turret",Missile:"missile",Crew:"crew",Cannon:"cannon",Bomb:"bomb",Title:"title",Mod:"mod",System:"system",Illicit:"illicit",Salvaged:"salvaged",Tech:"tech"};function AUXILIARY(b,e){return this.getPrimarySectorString(b,e.clone().rotate(this.arcrotation,0,0))}function SUBAUXILIARY(b,e,f){return this.getPrimarySubSectorString(b,e,f.clone().rotate(this.arcrotation,0,0))}
function Laser(b,e,f){switch(e){case "Bilaser":case "Mobilelaser":return new Weapon(b,{type:e,name:"Laser",isactive:!0,attack:f,range:[1,3],isprimary:!0,issecondary:!1,auxiliary:AUXILIARY,subauxiliary:SUBAUXILIARY});case "Laser180":return new Weapon(b,{type:e,name:"Laser",isactive:!0,attack:f,range:[1,3],isprimary:!0,issecondary:!1,auxiliary:function(b,e){return this.getHalfRangeString(b,e)},subauxiliary:function(b,e,f){return this.getHalfSubRangeString(b,e,f)}});default:return new Weapon(b,{type:e,
name:"Laser",isactive:!0,attack:f,range:[1,3],isprimary:!0,issecondary:!1})}}function Bomb(b,e){$.extend(this,e);b.upgrades.push(this);this.isactive=!0;this.wrapping=[];this.unit=b;b.bombs.push(this);this.exploded=!1}
Bomb.prototype={isWeapon:function(){return!1},isBomb:function(){return!0},canbedropped:function(){return this.isactive&&!this.unit.hasmoved&&this.unit.lastdrop!=round},desactivate:function(){this.isactive=!1;this.unit.movelog("D-"+this.unit.upgrades.indexOf(this))},getBall:function(){var b=this.g.getBBox();return{x:b.x+b.width/2,y:b.y+b.height/2,diam:Math.max(b.width/2,b.height/2)}},actiondrop:function(b){this.unit.lastdrop=round;$(".bombs").remove();this.drop(this.unit.getbomblocation(),b)},toString:function(){this.tooltip=
formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;return Mustache.render(TEMPLATES.bomb,this)},getrangeallunits:function(){var b=[[],[],[],[],[]],e;for(e in squadron){var f=this.getrange(squadron[e]);0<f&&b[f].push({unit:e})}return b},getcollisions:function(){var b=this.getOutlineString(),e=[],f;for(f in squadron){var l=squadron[f],m=l.getOutlineString(l.m),h=m.s,m=m.p;(0<Snap.path.intersection(b.s,h).length||
this.unit.isPointInside(b.s,m)||this.unit.isPointInside(h,b.p))&&e.push(l)}return e},getrange:function(b){var e=this.getOutlineString(this.m).p;b=b.getOutlinePoints(b.m);var f=90001,l,m;for(l=0;l<e.length;l++)for(m=0;4>m;m++){var h=dist(b[m],e[l]);h<f&&(f=h)}return 9E4<f?4:1E4>=f?1:4E4>=f?2:3},resolveactionmove:function(b,e){var f;this.pos=[];var l=function(e,l,q){for(f=0;f<b.length;f++)this.pos[f].remove();this.m=e;q(this,l)}.bind(this);if(1==b.length)this.pos[0]=this.getOutline(b[0]).attr({fill:this.unit.color,
opacity:.7}),l(b[0],0,e);else for(f=0;f<b.length;f++)this.pos[f]=this.getOutline(b[f]).attr({fill:this.unit.color,opacity:.7}),function(f){this.pos[f].hover(function(){this.pos[f].attr({stroke:this.unit.color,strokeWidth:"4px"})}.bind(this),function(){this.pos[f].attr({strokeWidth:"0"})}.bind(this));this.pos[f].click(function(){l(b[f],f,e)})}.call(this,f)},drop:function(b,e){var f=this;this.ordnance?(this.ordnance=!1,f=$.extend({},this)):this.desactivate();f.resolveactionmove(this.unit.getbombposition(b,
this.size),function(b){this.display(0,0);this.unit.bombdropped(this);"undefined"!=typeof e&&this.unit.endnoaction(e,"DROP")}.bind(f),!1,!0)},display:function(b,e){if(0!=b||0!=e)this.m=this.m.clone().translate(b,e);this.img1=s.image("png/"+this.img,-this.width/2,-this.height/2,this.width,this.height);this.outline=this.getOutline(new Snap.Matrix).attr({display:"block","class":"bombanim",stroke:halftone(BLUE),strokeWidth:2,fill:"rgba(8,8,8,0.3)"});this.g=s.group(this.outline,this.img1);this.g.hover(function(){var b=
VIEWPORT.m.clone(),e=$("#svgout").width(),f=$("#svgout").height(),q=0,t=0;f>e?t=(f-e)/2:q=(e-f)/2;var w=Math.max(900/e,900/f),y=this.g.getBBox(),e=$("#svgout").position();$("#playmat").width();$("#playmat").height();f=b.x(y.x,y.y-20)/w;f+=e.left+q;b=b.y(y.x,y.y-20)/w;b+=e.top+t;this.outline.attr({stroke:BLUE});$(".info").css({left:f,top:b}).html(this.name).appendTo("body").show()}.bind(this),function(){$(".info").hide();this.outline.attr({stroke:halftone(BLUE)})}.bind(this));this.g.transform(this.m);
this.g.appendTo(VIEWPORT);this.g.attr("display","block");BOMBS.push(this);if(this.stay){OBSTACLES.push(this);var f=this.getcollisions();0<f.length&&this.unit.resolveactionselection(f,function(b){this.detonate(f[b],!0)}.bind(this))}},getOutline:function(b){return s.path(this.getOutlineString(b).s).appendTo(VIEWPORT)},getOutlineString:function(b){"undefined"==typeof b&&(b=this.m);var e=transformPoint(b,{x:-16,y:-15}),f=transformPoint(b,{x:16,y:-15}),l=transformPoint(b,{x:16,y:15});b=transformPoint(b,
{x:-16,y:15});e=this.op=[e,f,l,b];return{s:"M "+e[0].x+" "+e[0].y+" L "+e[1].x+" "+e[1].y+" "+e[2].x+" "+e[2].y+" "+e[3].x+" "+e[3].y+" Z",p:e}},explode_base:function(){this.exploded=!0;this.unit.log("%0 explodes",this.name);SOUNDS[this.snd].play();this.g.remove();BOMBS.splice(BOMBS.indexOf(this),1)},explode:function(){this.explode_base()},detonate:function(b,e){OBSTACLES.splice(OBSTACLES.indexOf(this),1);this.explode_base()},endround:function(){},show:function(){},wrap_before:Unit.prototype.wrap_before,
wrap_after:Unit.prototype.wrap_after};function Weapon(b,e){this.isprimary=!1;this.issecondary=!0;$.extend(this,e);b.upgrades[b.upgrades.length]=this;this.wrapping=[];this.ordnance=!1;this.isactive=!0;this.unit=b;b.weapons.push(this)}
Weapon.prototype={isBomb:function(){return!1},isWeapon:function(){return!0},desactivate:function(){this.ordnance&&this.type.match(/Torpedo|Missile|Illicit/)?this.ordnance=!1:this.isactive=!1},toString:function(){this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;if(this.isactive){var b,e=this.getrangeallunits();for(b=0;b<e.length&&!e[b].isenemy(this.unit);b++);this.nofire=b==e.length?!0:!1}this.attackkey=
A[this.type.toUpperCase()].key;this.req=[];"undefined"!=typeof this.getrequirements()&&("Target".match(this.getrequirements())&&this.req.push([A.TARGET.key]),"Focus".match(this.getrequirements())&&this.req.push(A.FOCUS.key));this.uid=squadron.indexOf(this.unit);this.rank=this.unit.upgrades.indexOf(this);return Mustache.render(TEMPLATES.weapon,this)},prehit:function(b,e,f){},posthit:function(b,e,f){},getrequirements:function(){return this.requires},getattack:function(){return this.attack},isTurret:function(){return this.type==
TURRET},getlowrange:function(){return this.range[0]},gethighrange:function(){return this.range[1]},isinrange:function(b){return b>=this.getlowrange()&&b<=this.gethighrange()},modifydamagegiven:function(b){return b},modifyattackroll:function(b,e,f){return b},modifydamageassigned:function(b,e){return b},canfire:function(b){return"undefined"==typeof b?!0:!this.isactive||this.unit.isally(b)||this.unit.checkcollision(b)?!1:"undefined"!=typeof this.getrequirements()?"Target".match(this.getrequirements())&&
this.unit.canusetarget(b)||"Focus".match(this.getrequirements())&&this.unit.canusefocus()?!0:!1:!0},getrangeattackbonus:function(b){return this.isprimary&&1==this.getrange(b)?(this.unit.log("+1 attack for range 1"),1):0},declareattack:function(b){"undefined"!=typeof this.getrequirements()&&("Target".match(this.getrequirements())&&1==this.consumes&&this.unit.canusetarget(b)?this.unit.removetarget(b):"Focus".match(this.getrequirements())&&1==this.consumes&&this.unit.canusefocus(b)&&this.unit.removefocustoken());
return!0},getrangedefensebonus:function(b){return this.isprimary&&3==this.getrange(b)?(b.log("+1 defense for range 3"),1):0},getauxiliarysector:function(b){return"undefined"==typeof this.auxiliary?4:this.unit.getauxiliarysector(b,this.unit.m,this.subauxiliary,this.auxiliary)},getprimarysector:function(b){return this.unit.getprimarysector(b,this.unit.m)},getsector:function(b){var e=this.unit.m,f=this.unit.getprimarysector(b,e);return 4>f?f:"undefined"==typeof this.auxiliary?4:this.unit.getauxiliarysector(b,
e)},getrange:function(b){if(!this.canfire(b))return 0;if(this.isTurret()||this.unit.isTurret(this))return b=this.unit.getrange(b),this.isinrange(b)?b:0;b=this.getsector(b);return b>=this.getlowrange()&&b<=this.gethighrange()?b:0},endattack:function(b,e){this.type.match(/Torpedo|Missile/)&&this.desactivate()},hasdoubleattack:function(){return!1},hasenemiesinrange:function(){for(var b in squadron){var e=squadron[b];if(this.unit.isenemy(e)&&0<this.getrange(e))return!0}return!1},getenemiesinrange:function(b){var e=
[];"undefined"==typeof b&&(b=squadron);for(var f in b){var l=b[f];l.isenemy(this.unit)&&0<this.getrange(l)&&e.push(l)}return e},getrangeallunits:function(){var b,e=[];for(b in squadron){var f=squadron[b];this.unit!=f&&0<this.getrange(f)&&e.push(f)}return e},wrap_before:Unit.prototype.wrap_before,wrap_after:Unit.prototype.wrap_after,endround:function(){},show:function(){}};
function Upgradefromid(b,e){var f=UPGRADES[e];f.id=e;return f.type==BOMB?new Bomb(b,f):"undefined"!=typeof f.isWeapon?f.isWeapon()?new Weapon(b,f):new Upgrade(b,e):f.type.match(/Turretlaser|Bilaser|Mobilelaser|Laser180|Laser|Torpedo|Cannon|Missile|Turret/)||1==f.isweapon?new Weapon(b,f):new Upgrade(b,e)}function Upgrade(b,e){$.extend(this,UPGRADES[e]);b.upgrades.push(this);this.isactive=!0;this.unit=b;this.wrapping=[];this.ordnance=!1}
Upgrade.prototype={toString:function(){this.tooltip=formatstring(getupgtxttranslation(this.name,this.type));this.trname=translate(this.name).replace(/\'/g,"&#39;");this.left=1==this.unit.team;this.hasshield="undefined"!=typeof this.shield&&0<this.shield?!0:!1;this.hasfocus="undefined"!=typeof this.focus&&0<this.focus?!0:!1;if("undefined"!=typeof this["switch"]&&this.canswitch()){for(var b=0;b<this.unit.upgrades.length&&this.unit.upgrades[b]!=this;b++);this.hasswitch={uid:this.unit.id,uuid:b}}else this.hasswitch=
!1;return Mustache.render(TEMPLATES.upgrade,this)},isWeapon:function(){return!1},isBomb:function(){return!1},getlowrange:function(){return this.range[0]},gethighrange:function(){return this.range[1]},endround:function(){},desactivate:function(){this.ordnance&&this.type.match(/Torpedo|Missile|Illicit/)?this.ordnance=!1:(this.isactive=!1,this.unit.movelog("D-"+this.unit.upgrades.indexOf(this)),this.unit.show())},show:function(){},install:function(b){if("undefined"!=typeof this.addedaction){var e=this.addedaction.toUpperCase();
b["addedaction"+this.id]=b.shipactionList.length;b.shipactionList.push(e);b.showactionlist()}"undefined"!=typeof this.upgrades&&(b["addedupg"+this.id]=b.upgradesno,"undefined"!=typeof this.pointsupg&&(b.upgbonus[this.upgrades[0]]=this.pointsupg),"undefined"!=typeof this.maxupg&&(b.maxupg[this.upgrades[0]]=this.maxupg),1==this.exclusive&&(b.exclupg[this.upgrades[0]]=!0),b.upgradetype=b.upgradetype.concat(this.upgrades),b.upgradesno=b.upgradetype.length,b.showupgradeadd());if("undefined"!=typeof this.lostupgrades){for(e=
0;e<b.upgradetype.length;e++)-1<this.lostupgrades.indexOf(b.upgradetype[e])&&(-1<b.upg[e]&&removeupgrade(b,e,b.upg[e]),b.upg[e]=-2);b.showupgradeadd()}if("undefined"!=typeof this.takesdouble){for(e=0;e<b.upgradetype.length&&(b.upgradetype[e]!=this.type||!(0>b.upg[e]||UPGRADES[b.upg[e]].name!=this.name));e++);e<b.upgradetype.length&&(-1<b.upg[e]&&removeupgrade(b,e,b.upg[e]),b.upg[e]=-2);b.showupgradeadd()}},uninstall:function(b){var e;"undefined"!=typeof this.addedaction&&(this.addedaction.toUpperCase(),
b.shipactionList.splice(b["addedaction"+this.id],1));if("undefined"!=typeof this.upgrades){"undefined"!=typeof this.pointsupg&&(b.upgbonus[this.upgrades[0]]=0);"undefined"!=typeof this.maxupg&&(b.maxupg[this.upgrades[0]]=0);for(e=0;e<this.upgrades.length;e++){var f=e+b["addedupg"+this.id],l=$("#unit"+b.id+" .upg div[num="+f+"]");0<l.length&&(l=l.attr("data"),removeupgrade(b,f,l))}1==typeof this.exclusive&&(b.exclupg[this.upgrades[0]]=!1);b.upgradetype.splice(b["addedupg"+this.id],this.upgrades.length);
b.upgradesno=b.upgradetype.length}if("undefined"!=typeof this.lostupgrades)for(e=0;e<b.upgradetype.length;e++)-1<this.lostupgrades.indexOf(b.upgradetype[e])&&(b.upg[e]=-1);if("undefined"!=typeof this.takesdouble)for(e=0;e<b.upgradetype.length;e++)b.upgradetype[e]==this.type&&-2==b.upg[e]&&(b.upg[e]=-1)},wrap_before:Unit.prototype.wrap_before,wrap_after:Unit.prototype.wrap_after};window.UPGRADES=[{name:"Ion Cannon Turret",type:TURRET,firesnd:"falcon_fire",points:5,attack:3,upgid:0,done:!0,modifyhit:function(b){return FCH_HIT},prehit:function(b,e,f){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT%, +1 ion token [%0]",this.name,1);b.addiontoken()},range:[1,2]},{name:"Proton Torpedoes",requires:"Target",consumes:!0,type:TORPEDO,firesnd:"missile",points:4,done:!0,attack:4,init:function(b){this.wrap_after("modifyattackroll",this,function(b,e,m,h){0<FCH_focus(h)&&
(h=h-FCH_FOCUS+FCH_CRIT);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(e,l){return b.weapons[b.activeweapon]==this}.bind(this),aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,e){0<FCH_focus(b)&&(this.unit.log("1 %FOCUS% -> 1 %CRIT% [%0]",this.name),b=b-FCH_FOCUS+FCH_CRIT);return b}.bind(this),str:"focus"});var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"R2 Astromech",
done:!0,install:function(b){var e,f=this,l=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0==l.length){for(e=0;e<b.length;e++){var h=P[b[e].move].speed,m=b[e].difficulty;if(1==h||2==h)m="GREEN";l[e]={move:b[e].move,difficulty:m}}this.log("1, 2 speed maneuvers are green [%0]",f.name)}return l})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)},type:ASTROMECH,points:1},{name:"R2-D2",done:!0,init:function(b){var e=this;b.wrap_after("handledifficulty",this,
function(b){"GREEN"==b&&this.shield<this.ship.shield&&(this.addshield(1),this.log("+1 %SHIELD% [%0]",e.name))})},unique:!0,type:ASTROMECH,points:4},{name:"R2-F2",done:!0,candoaction:function(){return this.isactive},action:function(b){var e=this.unit;this.isactive&&(this.unit.log("+1 agility until end of round [%0]",e.name),e.wrap_after("getagility",this,function(b){return b+1}).unwrapper("endphase"),e.showstats());e.endaction(b,ASTROMECH);return!0},unique:!0,type:ASTROMECH,points:3},{name:"R5-D8",
done:!0,candoaction:function(){if(!this.isactive)return!1;for(var b=0;b<this.unit.criticals.length;b++)if(0==this.unit.criticals[b].isactive)return!0;return!1},action:function(b){var e=this;this.isactive?this.unit.endaction(b,ASTROMECH):this.unit.defenseroll(1).done(function(f){if(0<FE_evade(f.roll)+FE_focus(f.roll))for(f=0;f<this.criticals.length;f++)if(0==this.criticals[f].isactive){this.log("-1 %HIT% [%0]",e.name);this.criticals.slice(f,1);this.addhull(1);this.show();break}this.endaction(b,ASTROMECH)}.bind(this.unit))},
unique:!0,type:ASTROMECH,points:3},{name:"R5-X3",unique:!0,type:ASTROMECH,points:1,done:!0,init:function(b){var e=this;b.wrap_after("updateactivationdial",this,function(){this.addactivationdial(function(){return!this.hasionizationeffect()&&e.isactive}.bind(this),function(){this.log("ignore obstacles [%0]",e.name);e.desactivate();this.wrap_after("hascollidedobstacle",e,function(b){return!1}).unwrapper("endphase");this.wrap_after("isfireobstructed",this,function(){return!1}).unwrapper("endphase");this.wrap_after("getobstructiondef",
this,function(){return 0}).unwrapper("endphase");this.show()}.bind(this),A[ASTROMECH.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})}},{name:"BB-8",unique:!0,done:!0,type:ASTROMECH,points:2,init:function(b){var e=this;e.bb=-1;b.wrap_after("updateactivationdial",this,function(b){e.isactive&&e.bb!=round&&!this.hasionizationeffect()&&this.addactivationdial(function(){return!this.hasmoved&&-1<this.maneuver&&"GREEN"==this.getmaneuver().difficulty&&this.candoroll()&&
!this.hasionizationeffect()}.bind(this),function(){e.bb=round;this.doaction([this.newaction(this.resolveroll,"ROLL")],e.name+" free roll for green maneuver.")}.bind(this),A[ASTROMECH.toUpperCase()].key,$("<div>").attr({"class":"symbols",title:e.name}));return this.activationdial})}},{name:"Integrated Astromech",points:0,type:MOD,ship:"X-Wing",done:!0,init:function(b){var e=this;b.wrap_after("deal",this,function(b,l,m){var f=-1,q;for(q in this.upgrades)if(b=this.upgrades[q],b.type==ASTROMECH&&1==b.isactive){f=
q;break}if(-1==f||!e.isactive)return m;var t=$.Deferred();m.then(function(b){1==this.shield+this.hull||b.face==FACEUP&&b.crit.lethal&&2>=this.shield+this.hull?(this.upgrades[f].desactivate(),this.log("%0 is inactive, damage discarded [%1]",this.upgrades[f].name,e.name),e.desactivate(),t.resolve({crit:b.crit,face:DISCARD})):t.resolve(b)}.bind(this));return t.promise()})}},{name:"Weapons Guidance",points:2,type:TECH,done:!0,init:function(b){var e=this;b.wrap_after("modifyattackroll",this,function(b,
e,m,h){0==FCH_focus(h)&&0<FCH_blank(h,e)&&this.canusefocus()&&(h+=FCH_HIT);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,l){return e.isactive&&this.canusefocus()}.bind(b),aiactivate:function(b,e){return 0<FCH_blank(b,e)},f:function(b,l){var f=FCH_blank(b,l);this.removefocustoken();displayattacktokens(this);0<f&&(this.log("1 blank -> 1 %HIT% [%0]",e.name),b+=FCH_HIT);return b}.bind(b),str:"blank"})}},{name:"R5-K6",init:function(b){var e=this;b.wrap_after("removetarget",
this,function(b){this.defenseroll(1).done(function(f){0<FE_evade(f.roll)&&(this.addtarget(b),this.log("+1 %TARGET% / %1 [%0]",e.name,b.name))}.bind(this))})},done:!0,unique:!0,type:ASTROMECH,points:2},{name:"R5 Astromech",done:!0,init:function(b){var e=this;b.wrap_before("endphase",this,function(){for(var b=-1,l=-1,m=0;m<this.criticals.length;m++){var h=this.criticals[m];if(h.isactive&&"ship"==h.type&&(b=m,h.lethal)){l=m;break}}-1<l?(this.log("repairing critical %1 [%0]",e.name,this.criticals[l].name),
this.criticals[l].facedown()):-1<b&&(this.log("repairing critical %1 [%0]",e.name,this.criticals[b].name),this.criticals[b].facedown())})},type:ASTROMECH,points:1},{name:"Determination",done:!0,rating:1,init:function(b){var e=this;b.wrap_after("deal",this,function(b,l,m){if("pilot"!=b.type)return m;var f=$.Deferred();m.then(function(b){b.face==FACEUP?(this.log("discarding critical %1 [%0]",e.name,b.crit.name),f.resolve({crit:b.crit,face:DISCARD})):f.resolve(b)}.bind(this));return f.promise()})},type:ELITE,
points:1},{name:"Swarm Tactics",type:ELITE,points:2,done:!0,init:function(b){var e=this;"undefined"==typeof Unit.prototype.getswarm&&(Unit.prototype.getswarm=function(){return[[],[],[]]});Unit.prototype.wrap_after("getswarm",this,function(b){b[e.unit.team]=b[e.unit.team].concat(e.unit);return b});e.unit.propswarm=-1;b.wrap_before("begincombatphase",this,function(){var b=this.getswarm()[this.team],l=this;if(this==b[0])for(var m=b.length,h=0;h<m;h++)this.doselection(function(f){b.sort(function(b,e){return b.getskill()>
e.getskill()?1:b.getskill()<e.getskill()?-1:0});var h=b.pop(),m=h.selectnearbyally(1,function(b,e){return b.getskill()>e.getskill()});h.select();var q=h.getskill();0==m.length?l.endnoaction(f,"SELECT"):h.resolveactionselection(m,function(b){m[b].wrap_after("getskill",e,function(b){return q}).unwrapper("endcombatphase");m[b].log("PS set to %1 [%0]",e.name,q);m[b].showskill();l.endnoaction(f,"SELECT")})})})}},{name:"Squad Leader",unique:!0,done:!0,type:ELITE,points:2,candoaction:function(){var b=this.unit.selectnearbyally(2,
function(b,f){return f.getskill()<b.getskill()&&f.candoaction()});return this.isactive&&0<b.length},action:function(b){var e=this.unit,f=e.selectnearbyally(2,function(b,e){return e.getskill()<b.getskill()&&e.candoaction()});0<f.length?e.resolveactionselection(f,function(l){f[l].select();f[l].doaction(f[l].getactionlist(),"+1 free action").done(function(){e.select()});e.endaction(b,"ELITE")}):(e.log("no lower skilled pilot within range 2 [%0]",this.name),e.endaction(b,"ELITE"))}},{name:"Expert Handling",
rating:1,candoaction:function(){return this.isactive&&-1==this.unit.actionsdone.indexOf("ROLL")},action:function(b){-1==this.unit.shipactionList.indexOf("ROLL")&&this.unit.addstress();0<this.unit.istargeted.length?(this.unit.log("select target to lock [%0]",this.name),this.unit.resolveactionselection(this.unit.istargeted,function(e){this.istargeted[e].removetarget(this);this.resolveroll(b)}.bind(this.unit))):this.unit.resolveroll(b)},type:ELITE,done:!0,points:2},{name:"Marksmanship",rating:1,init:function(b){this.mark=
-1;var e=this;b.wrap_after("modifyattackroll",this,function(b,e,m,h){b=FCH_focus(h);0<b&&(h=h-FCH_FOCUS*b+FCH_CRIT+(b-1)*FCH_HIT);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return this.mark==round&&this.isactive}.bind(this),aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,l){var f=FCH_focus(b);0<f&&this.mark==round&&(1<f?this.unit.log("%0 %FOCUS% -> 1 %CRIT%, %1 %HIT% [%2]",f,f-1,e.name):this.unit.log("1 %FOCUS% -> 1 %CRIT% [%1]",f,e.name),b=b-FCH_FOCUS*
f+FCH_CRIT+(f-1)*FCH_HIT);return b}.bind(this),str:"focus",noreroll:"focus"})},candoaction:function(){return this.isactive},action:function(b){this.mark=round;this.unit.endaction(b,ELITE)},done:!0,type:ELITE,points:3},{name:"Concussion Missiles",requires:"Target",consumes:!0,type:MISSILE,firesnd:"missile",points:4,attack:4,done:!0,modifyattackroll:function(b,e,f){0<FCH_blank(b,e)&&(b+=FCH_HIT);return b},init:function(b){var e=this;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(f,l){return b.weapons[b.activeweapon]==
this&&e.isactive}.bind(this),f:function(b,e){0<FCH_blank(b,e)&&(b+=FCH_HIT);return b}.bind(this),str:"blank"});b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"Cluster Missiles",type:MISSILE,firesnd:"missile",requires:"Target",consumes:!0,points:4,attack:3,done:!0,followupattack:function(){return this.unit.weapons.indexOf(this)},hasdoubleattack:function(){return this.twinattack=!this.twinattack},init:function(b){this.twinattack=
!1;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&self.isactive&&this.candotarget()&&(b.priority+=10)})},range:[1,2]},{name:"Daredevil",done:!0,rating:1,candoaction:function(){return this.isactive},action:function(b){var e=this;console.log("this:"+this.name);console.log("unit:"+typeof this.unit);this.unit.log("select maneuver [%0]",this.name);this.unit.resolveactionmove([this.unit.getpathmatrix(this.unit.m,"TL1"),this.unit.getpathmatrix(this.unit.m,"TR1")],function(f,l){if(-1==l)return f.endaction(b,
ELITE);f.addstress();if(-1==f.shipactionList.indexOf("BOOST")){f.log("2 rolls for damage [%0]",e.name);for(var m=f.rollattackdie(2,e,"hit"),h=0;2>h;h++)"hit"==m[h]?f.resolvehit(1):"critical"==m[h]&&f.resolvecritical(1);f.checkdead()}f.endaction(b,ELITE)},!0,!0)},type:ELITE,points:3},{name:"Elusiveness",done:!0,rating:1,init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,MOD_M,ATTACK_M,this,{req:function(){return 0==this.stress&&targetunit==this&&e.isactive}.bind(b),aiactivate:function(e,l){b.log("activate elusiveness "+
FCH_crit(e)+" "+FCH_hit(e));return 0<FCH_crit(e)+FCH_hit(e)},f:function(b,e){this.unit.addstress();0<FCH_crit(b)?(this.unit.log("1 %CRIT% rerolled [%0]",this.name),b=b-FCH_CRIT+activeunit.attackroll(1)):0<FCH_hit(b)&&(this.unit.log("1 %HIT% rerolled [%0]",this.name),b=b-FCH_HIT+activeunit.attackroll(1));return b}.bind(this),str:"critical"})},type:ELITE,points:2},{name:"Homing Missiles",requires:"Target",consumes:!1,type:MISSILE,firesnd:"missile",attack:4,range:[2,3],done:!0,declareattack:function(b){targetunit.wrap_after("canuseevade",
this,function(){return!1}).unwrapper("afterdefenseeffect");targetunit.log("cannot use evade tokens [%0]",this.name);return Weapon.prototype.declareattack.call(this,b)},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},points:5},{name:"Push the Limit",init:function(b){var e=this;e.r=-1;b.wrap_before("endaction",this,function(b,l){e.r!=round&&this.candoaction()&&null!=l&&(e.r=round,this.doaction(this.getactionbarlist(),
"+1 free action (Skip to cancel) ["+e.name+"]").done(function(b){null==b?e.r=-1:this.addafteractions(function(){this.addstress()}.bind(this))}.bind(this)))})},done:!0,type:ELITE,points:3},{name:"Deadeye",islarge:!1,rating:2,init:function(b){for(var e in b.weapons)b.weapons[e].wrap_after("getrequirements",this,function(b){return"Target"==b?"Target|Focus":b})},done:!0,type:ELITE,points:1},{name:"Expose",rating:0,candoaction:function(){return this.isactive},action:function(b){var e=this.unit.weapons[0];
this.unit.log("-1 agility, +1 primary attack until end of turn [%0]",this.name);this.unit.wrap_after("getagility",this,function(b){return 0<b?b-1:0}).unwrapper("endphase");e.wrap_after("getattack",this,function(b){return b+1}).unwrapper("endround");this.unit.showstats();this.unit.endaction(b,ELITE)},done:!0,type:ELITE,points:4},{name:"Gunner",done:!0,init:function(b){for(var e in b.weapons)b.weapons[e].immediateattack={pred:function(b){return 0==b},weapon:function(){return 0}};b.addattack(function(b,
e){return this.weapons[0].isactive&&0==b+e},this,[b.weapons[0]],function(){this.noattack=round},function(){return this.selectnearbyenemy(3)})},type:CREW,points:5},{name:"Ion Cannon",type:CANNON,firesnd:"slave_fire",done:!0,modifyhit:function(b){return FCH_HIT},prehit:function(b,e,f){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT%, +1 ion token [%0]",this.name,1);b.addiontoken()},points:3,attack:3,range:[1,3]},{name:"Heavy Laser Cannon",type:CANNON,firesnd:"slave_fire",done:!0,
modifydamagegiven:function(b){if(0<FCH_crit(b)){var e=FCH_crit(b);this.unit.log("%0 %CRIT%-> %0 %HIT% [%1]",e,this.name);b=b-FCH_CRIT*e+e*FCH_HIT}return b},points:7,attack:4,range:[2,3]},{name:"Seismic Charges",done:!0,img:"seismic.png",snd:"explode",width:16,height:8,size:15,explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),e=0;e<b[1].length;e++){var f=squadron[b[1][e].unit];f.log("+1 %HIT% [%0]",this.name);f.resolvehit(1);f.checkdead()}this.explode_base()}},
type:BOMB,points:2},{name:"Mercenary Copilot",init:function(b){var e=this;b.wrap_after("modifyattackroll",this,function(b,e,m,h){0<FCH_hit(b)&&(b=b-FCH_HIT+FCH_CRIT);return b});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return 3==this.getrange(targetunit)}.bind(b),aiactivate:function(b,e){return 0<FCH_hit(b)},f:function(b,l){0<FCH_hit(b)&&(this.log("1 %HIT% -> 1 %CRIT% [%0]",e.name),b=b-FCH_HIT+FCH_CRIT);return b}.bind(b),str:"hit"})},done:!0,type:CREW,points:2},{name:"Assault Missiles",
type:MISSILE,requires:"Target",consumes:!0,firesnd:"missile",done:!0,prehit:function(b,e,f){e=b.getrangeallunits();for(f=0;f<e[1].length;f++)squadron[e[1][f].unit]!=b&&(squadron[e[1][f].unit].log("+1 %HIT% [%0]",this.name),squadron[e[1][f].unit].resolvehit(1))},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},points:5,attack:4,range:[2,3]},{name:"Veteran Instincts",done:!0,install:function(b){b.installed=
!0;b.wrap_after("getskill",this,function(b){return b+2});b.showskill()},uninstall:function(b){"function"==typeof b.getskill.unwrap&&b.getskill.unwrap(this);b.showskill()},type:ELITE,points:1},{name:"Proximity Mines",img:"proximity.png",snd:"explode",width:18,height:18,size:35,done:!0,stay:!0,candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},explode:function(){},detonate:function(b){if(!this.exploded){for(var e=
this.unit.rollattackdie(3,this,"critical"),f=0;3>f;f++)"hit"==e[f]?(b.log("+1 %HIT% [%0]",this.name),b.resolvehit(1),b.checkdead()):"critical"==e[f]&&(b.log("+1 %CRIT% [%0]",this.name),b.resolvecritical(1),b.checkdead());Bomb.prototype.detonate.call(this)}},getOutlineString:function(b){var e="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var f=0;25>f;f++){var l=transformPoint(b,{x:this.size*Math.sin(2*f*Math.PI/25),y:this.size*Math.cos(2*f*Math.PI/25)});this.op.push(l);e+=l.x+" "+l.y+" ";0==
f&&(e+="L ")}return{s:e+"Z",p:this.op}},type:BOMB,points:3},{name:"Weapons Engineer",type:CREW,points:3,done:!0,init:function(b){this.second=!1;var e=this;b.boundtargets=function(b){if(-1<this.targeting.indexOf(b))return!0;for(b=this.targeting.length-2;0<=b;b--)this.removetarget(this.targeting[b]);return!1};b.wrap_after("addtarget",this,function(b){1==this.second?this.second=!1:this.doselection(function(b){this.second=!0;this.log("select target to lock [%0]",e.name);this.resolvetargetnoaction(b,!0)}.bind(this))})}},
{name:"Draw Their Fire",rating:1,init:function(b){var e=this;e.ea=Unit.prototype.resolvecritical;Unit.prototype.resolvecritical=function(f){!e.unit.dead&&e.isactive&&0<f&&e.unit in this.selectnearbyally(1)?(this.selectunit([this,b],function(f,m){0==m?e.ea.call(this,1):e.ea.call(b,1)},["select unit [%0]",e.name],!1),e.ea.call(this,f-1)):e.ea.call(this,f);return f}},done:!0,type:ELITE,points:1},{name:"Luke Skywalker",faction:REBEL,unique:!0,done:!0,init:function(b){var e=this,f;for(f in b.weapons)b.weapons[f].immediateattack=
{pred:function(b){return 0==b},weapon:function(){return 0}};b.addattack(function(b,e){return this.weapons[0].isactive&&0==b+e},this,[b.weapons[0]],function(){this.noattack=round},function(){return this.selectnearbyenemy(3)});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,f){return e.unit.addedattack==round&&e.isactive},aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,f){0<FCH_focus(b)&&(this.log("1 %FOCUS% -> 1 %HIT% [%0]",e.name),b=b-FCH_FOCUS+FCH_HIT);return b},str:"focus"})},
type:CREW,points:7},{name:"Nien Nunb",faction:REBEL,done:!0,install:function(b){b.installed=!0;b.wrap_after("getdial",this,function(b){for(var e=0;e<b.length;e++)b[e].move.match(/F[1-5]/)&&(b[e].difficulty="GREEN");return b});b.wrap_after("getmaneuver",this,function(b){return b.move.match(/F[1-5]/)?{move:b.move,difficulty:"GREEN"}:b})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)},unique:!0,type:CREW,points:1},{name:"Chewbacca",faction:REBEL,unique:!0,done:!0,
type:CREW,init:function(b){var e=this;b.wrap_after("deal",this,function(b,l,m){if(!e.isactive)return m;var f=$.Deferred();m.then(function(b){1==this.hull+this.shield||b.face==FACEUP&&b.crit.lethal&&2>=this.hull+this.shield?(this.shield<this.ship.shield&&this.addshield(1),this.log("+1 %SHIELD%, 1 damage discarded [%0]",e.name),e.desactivate(),f.resolve({crit:b.crit,face:DISCARD})):f.resolve(b)}.bind(this));return f.promise()})},points:4},{name:"Advanced Proton Torpedoes",requires:"Target",consumes:!0,
type:TORPEDO,firesnd:"missile",attack:5,done:!0,range:[1,1],init:function(b){var e=this;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(e,l){return b.weapons[b.activeweapon]==this}.bind(this),aiactivate:function(b,e){return 0<FCH_blank(b,e)},f:function(b,e){var f=FCH_blank(b,e);3<f&&(f=3);0<f&&(this.unit.log("%0 blanks -> %0 %FOCUS% [%1]",f,this.name),b+=f*FCH_FOCUS);return b}.bind(this),str:"blank"});b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&
(b.priority+=10)})},points:6},{name:"Autoblaster",type:CANNON,done:!0,firesnd:"slave_fire",attack:3,declareattack:function(b){var e=this;b.wrap_after("cancelhit",e,function(b,l,m){e.unit.log("%HIT% cannot be cancelled [%0]",e.name);return b}).unwrapper("afterdefenseeffect");return Weapon.prototype.declareattack.call(this,b)},range:[1,1],points:5},{name:"Fire-Control System",done:!0,init:function(b){var e=this;e.f=-1;b.wrap_before("postattack",this,function(b){this.reroll=10});b.addafterattackeffect(this,
function(){-1<this.gettargetableunits(3).indexOf(targetunit)?(this.log("+1 %TARGET% / %1 [%0]",e.name,targetunit.name),this.addtarget(targetunit)):this.log("no valid target [%0]",e.name)})},type:SYSTEM,points:2},{name:"Blaster Turret",type:TURRET,done:!0,firesnd:"falcon_fire",requires:"Focus",consumes:!0,points:4,attack:3,range:[1,2]},{name:"Recon Specialist",init:function(b){var e=this;b.wrap_before("addfocus",this,function(f){b.log("+1 %FOCUS% [%0]",e.name);b.addfocustoken()})},done:!0,type:CREW,
points:3},{name:"Saboteur",type:CREW,done:!0,candoaction:function(){var b=this.unit.selectnearbyenemy(1);return this.isactive&&0<b.length},action:function(b){var e=this;if(this.isactive){var f=this.unit.selectnearbyenemy(1);0<f.length?(this.unit.log("select unit [%0]",this.name),this.unit.resolveactionselection(f,function(l){var m,h=[];for(m=0;m<f[l].criticals.length;m++)0==f[l].criticals[m].isactive&&h.push(m);0<h.length?(m=f[l].rand(h.length),f[l].log("turn faceup one damage card [%0]",e.name),
f[l].criticals[h[m]].faceup(),f[l].show()):f[l].log("no damage card [%0]",e.name);this.endaction(b,"CREW")}.bind(this.unit))):this.unit.endaction(b,"CREW")}else this.unit.endaction(b,"CREW")},points:2},{name:"Intelligence Agent",done:!0,init:function(b){var e=this;b.wrap_before("beginactivationphase",this,function(){this.selectunit(this.selectnearbyenemy(2),function(b,l){b[l].showmaneuver();var f=b[l].getmaneuver();b[l].log("has a %0<span class='symbols'>"+P[f.move].key+"</span> maneuver [%1]",P[f.move].speed,
e.name)},["select unit [%0]",e.name],!1)})},type:CREW,points:1},{name:"Proton Bombs",done:!0,width:32,height:30,size:15,snd:"explode",img:"proton.png",explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),e=0;e<b[1].length;e++)squadron[b[1][e].unit].applycritical(1),squadron[b[1][e].unit].checkdead();this.explode_base()}},type:BOMB,points:5},{name:"Adrenaline Rush",done:!0,rating:1,init:function(b){var e=this;b.wrap_after("updateactivationdial",this,function(){this.addactivationdial(function(){return!this.hasionizationeffect()&&
!this.hasmoved&&e.isactive&&-1<this.maneuver&&"RED"==this.getmaneuver().difficulty}.bind(this),function(){this.log("red into white maneuver [%0]",e.name);e.desactivate();this.wrap_after("getmaneuver",e,function(b){return{move:b.move,difficulty:"WHITE"}}).unwrapper("endactivationphase");this.show()}.bind(this),A[ELITE.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})},type:ELITE,points:1},{name:"Advanced Sensors",done:!0,init:function(b){var e=this;b.wrap_before("beginactivation",
this,function(){this.candoaction()&&!this.hasionizationeffect()&&this.doaction(this.getactionlist(),"").done(function(b){null!=b&&this.wrap_after("candoendmaneuveraction",e,function(){return!1}).unwrapper("endactivationphase")}.bind(this))})},type:SYSTEM,points:3},{name:"Sensor Jammer",init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,MOD_M,ATTACK_M,this,{req:function(b,l){return e.isactive}.bind(b),aiactivate:function(b,e){return 0<FCH_hit(b)},f:function(b,l){0<FCH_hit(b)&&(this.unit.log("1 %HIT% -> 1 %FOCUS% [%0]",
e.name),b=b-FCH_HIT+FCH_FOCUS);return b}.bind(this),str:"hit"})},done:!0,type:SYSTEM,points:4},{name:"Darth Vader",faction:EMPIRE,unique:!0,done:!0,init:function(b){var e=this;b.addafterattackeffect(e,function(){this.hasfired&&this.donoaction([{org:e,type:"CREW",name:e.name,action:function(b){e.unit.log("+%1 %HIT% [%0]",e.name,2);targetunit.log("+1 %CRIT% [%0]",e.name);this.resolvehit(2);SOUNDS.explode.play();targetunit.resolvecritical(1);this.checkdead();targetunit.checkdead();this.endnoaction(b,
"CREW")}.bind(this)}],"",!0)})},type:CREW,points:3},{name:"Rebel Captive",faction:EMPIRE,done:!0,init:function(b){var e=this;b.rebelcaptive=0;b.wrap_before("isattackedby",this,function(b,l){this.rebelcaptive!=round&&(l.log("+1 %STRESS% [%0]",e.name),l.addstress(),this.rebelcaptive=round)}.bind(this))},unique:!0,type:CREW,points:3},{name:"Flight Instructor",init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["focus"],n:function(){return 2>=activeunit.getskill()?2:
1},req:function(b,l,m){this.isactive&&this.unit.log("+%1 %FOCUS% reroll(s) [%0]",e.name,2>=activeunit.getskill()?2:1);return this.isactive}.bind(this)})},done:!0,type:CREW,points:4},{name:"Navigator",init:function(b){b.wrap_after("getmaneuverlist",this,function(b){var e=this.getdial();if(this.hasionizationeffect())return b;for(var l in b){var m=l.replace(/\d/,"");for(j=0;j<e.length;j++)!e[j].move.match(m)||"undefined"!=typeof b[e[j].move]||"RED"==e[j].difficulty&&0!=this.stress||(b[e[j].move]=e[j])}return b})},
done:!0,type:CREW,points:3},{name:"Opportunist",rating:2,done:!0,init:function(b){var e=this;b.wrap_after("preattackroll",this,function(b,l){0==l.focus+l.evade&&0==this.stress&&this.donoaction([{org:this,name:this.name,type:"ELITE",action:function(b){this.wrap_after("getattackstrength",e,function(b,e,f){return f+1}).unwrapper("endattack");this.addstress();this.log("+1 attack against %1, +1 %STRESS% [%0]",e.name,l.name);this.endnoaction(b,"ELITE")}.bind(this)}],"",!0)})},type:ELITE,points:4},{name:"Ion Pulse Missiles",
requires:"Target",consumes:!1,type:MISSILE,firesnd:"missile",done:!0,modifyhit:function(b){return FCH_HIT},prehit:function(b,e,f){this.unit.log("+%1 %HIT%, +1 ion token [%0]",this.name,2);this.unit.hitresolved=1;this.unit.criticalresolved=0;b.addiontoken();b.addiontoken()},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},points:3,attack:3,range:[2,3]},{name:"Wingman",done:!0,init:function(b){var e=this;b.wrap_before("begincombatphase",
this,function(){this.selectunit(this.selectnearbyally(1,function(b,e){return 0<e.stress}),function(b,e){b[e].removestresstoken()},["select unit [%0]",e.name],!1)})},type:ELITE,points:2},{name:"Decoy",rating:1,init:function(b){var e=this;b.wrap_before("begincombatphase",this,function(){this.selectunit(this.selectnearbyally(2),function(b,l){var f=b[l].getskill(),h=this.getskill();this.wrap_after("getskill",e,function(b){return f}).unwrapper("endcombatphase");b[l].wrap_after("getskill",e,function(b){return h}).unwrapper("endcombatphase")},
["select unit (or self to cancel) [%0]",e.name],!0)})},done:!0,type:ELITE,points:2},{name:"Outmaneuver",done:!0,init:function(b){var e=this;b.wrap_before("resolveattack",this,function(b,l){l.wrap_after("getdefensestrength",e,function(b,f,l){return!this.isinfiringarc(f)&&f.isinfiringarc(this)&&0<l?(this.log("-1 defense [%0]",e.name),l-1):l}).unwrapper("dodefenseroll")})},type:ELITE,points:3},{name:"Predator",done:!0,init:function(b){var e=this;b.wrap_after("attackrerolls",this,function(b,e,m){return 2>=
e.getskill()?2:1});b.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 2>=targetunit.getskill()?2:1},req:function(b,l,m){this.log("+%1 reroll(s) [%0]",e.name,2>=targetunit.getskill()?2:1);return e.isactive}.bind(b)})},type:ELITE,points:3},{name:"Flechette Torpedoes",requires:"Target",consumes:!0,type:TORPEDO,firesnd:"missile",done:!0,endattack:function(b,e){4>=targetunit.hull&&targetunit.addstress();Weapon.prototype.endattack.call(this)},init:function(b){var e=
this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},points:2,attack:3,range:[2,3]},{name:"R7 Astromech",type:ASTROMECH,points:2,done:!0,init:function(b){b.adddicemodifier(DEFENSE_M,REROLL_M,ATTACK_M,this,{dice:["critical","hit","focus"],n:function(){return 9},req:function(){return-1<this.targeting.indexOf(activeunit)}.bind(b),mustreroll:!0})}},{name:"R7-T1",candoaction:function(){return this.isactive},action:function(b){var e=this.unit.selectnearbyenemy(2);
0<e.length&&this.isactive?(this.unit.log("select unit [%0]",this.name),this.unit.resolveactionselection(e,function(f){e[f]!=this?(e[f].isinfiringarc(this)&&this.addtarget(e[f]),this.resolveboost(b)):this.endaction(b,"ASTROMECH")}.bind(this.unit))):this.unit.endaction(b,"ASTROMECH")},done:!0,unique:!0,type:ASTROMECH,points:3},{name:"Tactician",type:CREW,limited:!0,points:2,done:!0,init:function(b){var e=this;b.addafterattackeffect(this,function(b,l){2==this.getsector(targetunit)&&(targetunit.addstress(),
targetunit.log("+1 %STRESS% [%0]",e.name))})}},{name:"R2-D2",faction:REBEL,unique:!0,type:CREW,points:4,done:!0,init:function(b){var e=this;b.wrap_after("endphase",this,function(){for(var b=[],l=this.criticals,m=0;m<l.length;m++)l[m].isactive||b.push(l[m]);0==this.shield&&0<this.ship.shield&&(this.log("+1 %SHIELD% [%0]",e.name),this.addshield(1),this.show(),0<b.length&&(b=b[this.rand(b.length)],0<FCH_hit(this.attackroll(1))&&(this.log("+1 %CRIT% [%0]",this.name),b.faceup())))})}},{name:"C-3PO",unique:!0,
faction:REBEL,type:CREW,points:3,done:!0,init:function(b){var e=-1;b.wrap_after("defenseroll",this,function(b,l){if(e==round)return l;var f=$.Deferred();e=round;l.done(function(b){this.guessevades(b,f)}.bind(this));return f.promise()})}},{name:"R3-A2",done:!0,init:function(b){var e=this;b.wrap_after("declareattack",this,function(b,l,m){this.isinfiringarc(l)&&m&&this.donoaction([{org:e,name:e.name,type:"ASTROMECH",action:function(b){this.addstress();this.log("+1 %STRESS% [%0]",e.name);l.log("+1 %STRESS% [%0]",
e.name);l.addstress();this.endnoaction(b,"ASTROMECH")}.bind(this)}],"",!0)})},unique:!0,type:ASTROMECH,points:2},{name:"R2-D6",upgrades:[ELITE],noupgrades:ELITE,skillmin:3,done:!0,unique:!0,type:ASTROMECH,points:1},{name:"Enhanced Scopes",done:!0,init:function(b){var e=this;b.wrap_before("beginactivationphase",this,function(){this.log("PS set to %1 [%0]",e.name,0);this.wrap_after("getskill",e,function(b){return 0}).unwrapper("endactivationphase")})},type:SYSTEM,points:1},{name:"Chardaan Refit",type:MISSILE,
done:!0,firesnd:"missile",isWeapon:function(){return!1},points:-2,ship:"A-Wing"},{name:"Proton Rockets",type:MISSILE,firesnd:"missile",requires:"Focus",consumes:!1,points:3,attack:2,done:!0,getattack:function(){a=this.attack;return a=3>=this.unit.agility?a+this.unit.agility:a+3},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"FOCUS"==b.type&&e.isactive&&this.candofocus()&&(b.priority+=10)})},range:[1,1]},{name:"Kyle Katarn",faction:REBEL,unique:!0,done:!0,type:CREW,points:3,
init:function(b){var e=this;b.wrap_after("removestresstoken",this,function(){this.log("-1 stress -> +1 %FOCUS% [%0]",e.name);this.addfocustoken()})}},{name:"Jan Ors",faction:REBEL,unique:!0,type:CREW,points:2,done:!0,init:function(b){this.jan=-1;var e=this;Unit.prototype.wrap_after("addfocustoken",this,function(){!e.unit.dead&&3>=this.getrange(b)&&this.isally(b)&&e.jan<round&&(this.log("select %FOCUS% or %EVADE% token [%0]",e.name),this.donoaction([{name:e.name,org:e,type:"FOCUS",action:function(b){this.endnoaction(b,
"FOCUS")}.bind(this)},{name:e.name,org:e,type:"EVADE",action:function(b){e.jan=round;this.focus--;this.addevadetoken();this.endnoaction(b,"EVADE")}.bind(this)}],"",!1))})}},{name:"R4-D6",init:function(b){var e=this;b.wrap_after("cancelhit",this,function(f,l,m){f=FCH_hit(m.ch);if(3<=f){b.log("cancelling %0 hits [%1]",f-2,e);f-=2;l=m.ch-f*FCH_HIT;for(var h=0;h<f;h++)b.addstress();return{ch:l,e:m.e}}return m})},done:!0,unique:!0,type:ASTROMECH,points:1},{name:"R5-P9",done:!0,init:function(b){var e=this;
b.wrap_before("endcombatphase",this,function(){this.canusefocus()&&this.shield<this.ship.shield&&(this.addshield(1),this.log("1 %FOCUS% -> 1 %SHIELD% [%0]",e.name),this.removefocustoken())})},unique:!0,type:ASTROMECH,points:3},{name:"Han Solo",faction:REBEL,init:function(b){var e=this;b.wrap_after("modifyattackroll",this,function(b,e,m,h){b=FCH_focus(h);0<b&&0<this.targeting.length&&(this.removetarget(targetunit),h=h-FCH_FOCUS*b+FCH_HIT*b);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,
{req:function(b,l){return e.isactive&&-1<this.targeting.indexOf(targetunit)}.bind(b),aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,l){var f=FCH_focus(b);this.log("%0 %FOCUS% -> %0 %HIT% [%1]",f,e.name);this.removetarget(targetunit);return b-FCH_FOCUS*f+FCH_HIT*f}.bind(b),str:"target",noreroll:"focus"})},type:CREW,unique:!0,done:!0,points:2},{name:"Leia Organa",faction:REBEL,type:CREW,unique:!0,done:!0,init:function(b){var e=this;b.wrap_before("beginactivationphase",this,function(){e.isactive&&
this.donoaction([{type:"CREW",org:e,name:e.name,action:function(f){e.desactivate();for(var l in squadron)squadron[l].isally(b)&&squadron[l].wrap_after("getmaneuver",e,function(b){"RED"==b.difficulty&&(b.difficulty="WHITE");return b}).unwrapper("endactivationphase");this.endnoaction(f,"CREW")}.bind(this)}],"",!0)})},points:4},{name:"Targeting Coordinator",type:CREW,limited:!0,done:!0,points:4},{name:"Lando Calrissian",faction:REBEL,type:CREW,unique:!0,done:!0,candoaction:function(){return this.isactive},
action:function(b){var e=this,f="";this.isactive?this.unit.defenseroll(2).done(function(l){var m=FE_focus(l.roll);l=FE_evade(l.roll);for(var h=0;h<m;h++)this.addfocustoken();0<m&&(f+=" +"+m+" %FOCUS%");for(h=0;h<l;h++)this.addevadetoken();0<l&&(f+=" +"+l+" %EVADE%");""==f?this.log("no effect [%0]",e.name):this.log(f+" [%0]",e.name);this.endaction(b,"CREW")}.bind(this.unit)):this.unit.endaction(b,"CREW")},points:3},{name:"Mara Jade",faction:EMPIRE,type:CREW,unique:!0,done:!0,init:function(b){var e=
this;b.wrap_before("endcombatphase",this,function(){for(var b=this.gettargetableunits(1),l=0;l<b.length;l++)0==b[l].stress&&(b[l].log("+1 %STRESS% [%0]",e.name),b[l].addstress())})},points:3},{name:"Fleet Officer",faction:EMPIRE,type:CREW,done:!0,candoaction:function(){return this.isactive},action:function(b){if(this.isactive){var e=this.unit.selectnearbyally(2);0<e.length?1==e.length?(e[0].addfocustoken(),this.unit.addstress(),this.unit.endaction(b,CREW)):2==e.length?(e[0].addfocustoken(),e[1].addfocustoken(),
e[0].log("adding focus"),e[1].log("adding focus"),this.unit.addstress(),this.unit.endaction(b,CREW)):(this.unit.log("select 2 units [%0]",this.name),this.unit.resolveactionselection(e,function(f){e[f].addfocustoken();e.splice(f,1);0<e.length?this.resolveactionselection(e,function(f){e[f].addfocustoken();this.addstress();this.endaction(b,CREW)}.bind(this)):this.endaction(b,CREW)}.bind(this.unit))):this.unit.endaction(b,CREW)}else this.unit.endaction(b,CREW)},points:3},{name:"Stay On Target",type:ELITE,
points:2,done:!0,init:function(b){b.wrap_after("getmaneuverlist",this,function(b){var e=this.getdial();if(this.hasionizationeffect()||0<this.stress)return b;for(var l in b)for(var m=b[l].move.substr(-1),h=0;h<e.length;h++)e[h].move.substr(-1)==m&&"undefined"==typeof b[e[h].move]&&(b[e[h].move]={move:e[h].move,difficulty:"RED",halfturn:!1});return b})}},{name:"Dash Rendar",faction:REBEL,unique:!0,done:!0,init:function(b){b.wrap_after("isfireobstructed",this,function(){return!1});b.wrap_after("getobstructiondef",
this,function(){return 0})},type:CREW,points:2},{name:"Lone Wolf",done:!0,rating:3,init:function(b){var e=this;b.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank"],n:function(){return 1},req:function(b,l,m){b=this.unit.selectnearbyally(2,function(b,e){return b!=e});0==b.length&&e.isactive&&this.unit.log("+1 blank reroll [%0]",e.name);return 0==b.length&&e.isactive}.bind(this)});b.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["blank"],n:function(){return 1},req:function(b,l,
m){b=this.unit.selectnearbyally(2,function(b,e){return b!=e});0==b.length&&e.isactive&&this.unit.log("+1 blank reroll [%0]",e.name);return 0==b.length&&e.isactive}.bind(this)})},unique:!0,type:ELITE,points:2},{name:"'Leebo'",faction:REBEL,unique:!0,candoaction:function(){return this.unit.candoboost()&&this.isactive},action:function(b){this.isactive?(this.unit.log("free %BOOST% and ion token [%0]",this.name),this.unit.addiontoken(),this.unit.resolveboost(b)):this.unit.endaction(b,"BOOST")},done:!0,
type:CREW,points:2},{name:"Ruthlessness",faction:EMPIRE,type:ELITE,points:3,done:!0,init:function(b){var e=this;b.addafterattackeffect(this,function(b,l){if(0!=b+l){var f=targetunit.selectnearbyunits(1,function(b,e){return e!=targetunit});this.selectunit(f,function(b,f){b[f].log("+%1 %HIT% [%0]",e.name,1);b[f].resolvehit(1);b[f].checkdead()},["select unit [%0]",e.name],!1)}})}},{name:"Intimidation",done:!0,rating:1,init:function(b){var e=this.unit,f=this;Unit.prototype.wrap_after("getagility",this,
function(b){return!e.dead&&this.isenemy(e)&&0<b&&"undefined"!=typeof this.touching&&-1<this.touching.indexOf(e)?(this.log("-1 agility [%0]",f.name),b-1):b})},type:ELITE,points:2},{name:"Ysanne Isard",faction:EMPIRE,unique:!0,init:function(b){var e=this;b.wrap_before("begincombatphase",this,function(){0<this.criticals.length&&this.candoevade()&&(this.addevadetoken(),this.log("+1 %EVADE% [%0]",e.name))})},done:!0,type:CREW,points:4},{name:"Moff Jerjerrod",faction:EMPIRE,unique:!0,done:!0,type:CREW,
points:2,init:function(b){var e=this;b.wrap_after("deal",this,function(b,l,m){if(!e.isactive)return m;var f=$.Deferred();m.then(function(h){var l,m=[];if(h.crit.lethal&&2>=this.hull+this.shield&&h.face==FACEUP||1==this.hull+this.shield){for(l=0;l<this.upgrades.length;l++){var q=this.upgrades[l];q.type==CREW&&q!=e&&q.isactive&&m.push(q)}m.push(e);m[0].desactivate();this.log("discard %0 to remove critical %1 [%2]",m[0].name,b.name,e.name);f.resolve({crit:h.crit,face:FACEDOWN});return!1}f.resolve(h)}.bind(this));
return f.promise()})}},{name:"Ion Torpedoes",requires:"Target",consumes:!0,type:TORPEDO,firesnd:"missile",done:!0,prehit:function(b,e,f){b.addiontoken();b=b.getrangeallunits();for(e=0;e<b[1].length;e++)squadron[b[1][e].unit].log("+1 ion token [%0]",this.name),squadron[b[1][e].unit].addiontoken()},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},points:5,attack:4,range:[2,3]},{name:"Bodyguard",faction:SCUM,
rating:0,unique:!0,done:!0,init:function(b){var e=this;b.wrap_before("begincombatphase",this,function(){var b=this.selectnearbyally(1,function(b,e){return b.getskill()<e.getskill()});this.canusefocus()&&this.selectunit(b,function(b,f){b[f].wrap_after("getagility",e,function(b){return b+1}).unwrapper("endcombatphase");this.removefocustoken()},["select unit (or self to cancel) [%0]",e.name],!0)})},type:ELITE,points:2},{name:"Calculation",done:!0,rating:1,init:function(b){var e=this;b.wrap_after("modifyattackroll",
this,function(b,e,m,h){this.canusefocus()&&0<FCH_focus(h)&&(this.removefocustoken(),h=h-FCH_FOCUS+FCH_CRIT);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,l){return this.canusefocus()&&e.isactive}.bind(b),aiactivate:function(b,e){return FCH_focus(b)},f:function(b,l){var f=FCH_focus(b);this.removefocustoken();displayattacktokens(this);return 0<f?(this.log("1 %FOCUS% -> 1 %CRIT% [%0]",e.name),b-FCH_FOCUS+FCH_CRIT):b}.bind(b),str:"focus"})},type:ELITE,points:1},{name:"Accuracy Corrector",
init:function(b){var e=this;console.log("calling init");b.wrap_after("modifyattackroll",this,function(b,e,m,h){return 2>FCH_hit(h)+FCH_crit(h)?(console.log("modified "+h),2*FCH_HIT):h});b.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,l){return e.isactive},aiactivate:function(b,e){return 2>FCH_hit(b)+FCH_crit(b)},f:function(b,l){this.log("replace all dice by 2 %HIT% [%0]",e.name);return{m:2,n:2}}.bind(b),str:"hit"})},done:!0,type:SYSTEM,points:3},{name:"Inertial Dampeners",done:!0,init:function(b){var e=
this;b.wrap_after("updateactivationdial",this,function(){this.addactivationdial(function(){return!this.hasmoved&&e.isactive&&!this.hasionizationeffect()}.bind(this),function(){e.desactivate();this.addstress();this.wrap_after("getmaneuver",e,function(b){return{move:"F0",difficulty:"WHITE"}}).unwrapper("endactivationphase");this.show()}.bind(this),A[ILLICIT.toUpperCase()].key,$("<div>").attr({"class":"symbols"}));return this.activationdial})},type:ILLICIT,points:1},{name:"Tractor Beam",type:CANNON,
points:1,attack:3,done:!0,modifyhit:function(b){return 0},prehit:function(b,e,f){this.unit.hitresolved=0;this.unit.criticalresolved=0;b.log("+1 tractor beam token [%0]",this.name);b.addtractorbeam(this.unit)},range:[1,3]},{name:"Flechette Cannon",type:CANNON,firesnd:"slave_fire",done:!0,modifyhit:function(b){return FCH_HIT},prehit:function(b,e,f){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+1 %HIT%, +1 %STRESS% [%0]",this.name);0==b.stress&&b.addstress()},points:2,attack:3,range:[1,
3]},{name:"'Mangler' Cannon",type:CANNON,firesnd:"slave_fire",points:4,attack:3,done:!0,init:function(b){var e=this;this.wrap_after("modifyattackroll",this,function(b,e,m,h){0<FCH_hit(h)&&(h=h-FCH_HIT+FCH_CRIT);return h});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(f,l){return b.weapons[b.activeweapon]==this?e.isactive:!1}.bind(this),aiactivate:function(b,e){return 0<FCH_hit(b)},f:function(b,l){return 0<FCH_hit(b)?(this.log("1 %HIT% -> 1 %CRIT% [%0]",e.name),b+FCH_CRIT-FCH_HIT):b}.bind(b),
str:"hit"})},range:[1,3]},{name:"Dead Man's Switch",done:!0,init:function(b){var e=this;b.wrap_before("dies",this,function(){for(var f=b.getrangeallunits(),l=0;l<f[1].length;l++)squadron[f[1][l].unit].log("+%1 %HIT% [%0]",e.name,1),squadron[f[1][l].unit].applydamage(1)})},type:ILLICIT,points:2},{name:"Feedback Array",type:ILLICIT,done:!0,range:[1,1],isTurret:function(){return!0},issecondary:!1,firesnd:"missile",isWeapon:function(){return!0},declareattack:function(b){this.unit.addhasfired();this.unit.resolvehit(1);
this.unit.addiontoken();SOUNDS.explode.play();this.unit.log("-1 %HIT%, +1 %ION% [%0]",this.name);b.log("-1 %HIT% [%0]",this.name);b.resolvehit(1);b.checkdead();this.unit.checkdead();this.unit.hasdamaged=!0;this.unit.cancelattack();return!1},init:function(b){this.toString=Upgrade.prototype.toString},points:2},{name:"'Hot Shot' Blaster",done:!0,isWeapon:function(){return!0},isTurret:function(){return!0},endattack:function(b,e){this.desactivate()},type:ILLICIT,firesnd:"xwing_fire",points:3,attack:3,
range:[1,2]},{name:"Greedo",faction:SCUM,unique:!0,done:!0,type:CREW,init:function(b){b.greedoa=-1;b.greedod=-1;var e=this;b.wrap_before("hashit",e,function(b,l){e.unit.greedoa<round&&b.wrap_after("deal",e,function(b,f,l){return e.unit.greedoa<round?(e.unit.greedoa=round,this.log("first damage is a faceup damage [%0]",e.name),dd=$.Deferred(),dd.resolve({crit:b,face:FACEUP}).promise()):l}).unwrapper("endbeingattacked");return l});b.wrap_after("resolveishit",e,function(){this.greedod<round&&this.wrap_after("deal",
e,function(b,l,m){return this.greedod<round?(this.greedod=round,this.log("first damage is a faceup damage [%0]",e.name),dd=$.Deferred(),dd.resolve({crit:b,face:FACEUP}).promise()):m}).unwrapper("endbeingattacked")})},points:1},{name:"Salvaged Astromech",type:SALVAGED,done:!0,points:2,init:function(b){var e=this;b.wrap_after("deal",this,function(b,l,m){if(!e.isactive)return m;var f=$.Deferred();m.then(function(b){"ship"==b.crit.type&&b.face==FACEUP?(e.desactivate(),this.log("remove critical %0 [%1]",
b.crit.name,e.name),f.resolve({crit:b.crit,face:DISCARD})):f.resolve(b)}.bind(this));return f.promise()})}},{name:"Bomb Loadout",upgrades:[BOMB],done:!0,firesnd:"missile",isWeapon:function(){return!1},limited:!0,type:TORPEDO,points:0,ship:"Y-Wing"},{name:"'Genius'",unique:!0,done:!0,init:function(b){var e=this;b.wrap_after("handledifficulty",this,function(b){b=[];if(this.lastdrop!=round){for(var f=0;f<this.bombs.length;f++){var m=this.bombs[f];"undefined"==typeof m.action&&m.isactive&&b.push({type:"BOMB",
name:m.name,org:e,action:function(b){this.actiondrop(b)}.bind(m)})}this.donoaction(b,"",!0)}})},type:SALVAGED,points:0},{name:"Unhinged Astromech",type:SALVAGED,done:!0,install:function(b){var e=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0==e.length)for(var f=0;f<b.length;f++){var m=b[f].difficulty,h=b[f].move;h.match(/[A-Z]+3/)&&(m="GREEN");e[f]={move:h,difficulty:m}}return e})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)},points:1},{name:"R4-B11",
unique:!0,type:SALVAGED,points:3,done:!0,init:function(b){var e=this;b.adddicemodifier(ATTACK_M,MOD_M,DEFENSE_M,this,{req:function(b,e){return-1<this.targeting.indexOf(targetunit)}.bind(b),f:function(b,l){var f=FE_evade(b),h=FE_focus(b);targetunit.canusefocus()||(h=0);this.removetarget(targetunit);if(0<f+h){targetunit.log("Reroll %0 %EVADE%, %1 %FOCUS% [%2]",f,h,e.name);var q=targetunit.rolldefensedie(h,e,"evade");b-=FE_EVADE*f+FE_FOCUS*h;for(var t=0;t<h+f;t++)"evade"==q[t]&&(b+=FE_EVADE),"focus"==
q[t]&&(b+=FE_FOCUS)}return b}.bind(b),str:"target"})}},{name:"Autoblaster Turret",type:TURRET,firesnd:"falcon_fire",done:!0,points:2,attack:2,declareattack:function(b){var e=this;b.wrap_after("cancelhit",e,function(b,l,m){e.unit.log("%HIT% cannot be cancelled [%0]",e.name);return b}).unwrapper("afterdefenseeffect");return Weapon.prototype.declareattack.call(this,b)},range:[1,1]},{name:"R4 Agromech",done:!0,init:function(b){var e=this;this.spendfocus=!1;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,
{req:function(b,l){return e.spendfocus}.bind(b),f:function(b,l){e.spendfocus=!1;this.addtarget(targetunit);this.log("+1 %TARGET% / %1 [%0]",e.name,targetunit.name);displayattacktokens2(this);return b}.bind(b),str:"target"});b.wrap_before("resolveattack",this,function(b,l){e.spendfocus=!1;this.wrap_before("removefocustoken",e,function(){e.spendfocus=!0;displayattacktokens2(this);this.log("+1 %TARGET% / %1 [%0]",e.name,l.name)}).unwrapper("endattack")})},type:SALVAGED,points:2},{name:"K4 Security Droid",
faction:SCUM,type:CREW,done:!0,init:function(b){var e=this;b.wrap_before("handledifficulty",this,function(b){"GREEN"==b&&this.selectunit(this.gettargetableunits(3),function(b,f){this.addtarget(b[f]);this.log("+1 %TARGET% / %1 [%0]",e.name,b[f].name)},["select unit (or self to cancel) [%0]",e.name],!0)})},points:3},{name:"Outlaw Tech",faction:SCUM,beta:!0,limited:!0,done:!0,type:CREW,init:function(b){var e=this;b.wrap_after("handledifficulty",this,function(f){"RED"==f&&(b.log("+1 %FOCUS% [%0]",e.name),
b.addfocustoken())})},points:2},{name:"Advanced Targeting Computer",type:SYSTEM,points:5,init:function(b){var e=this;b.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,l){return-1<this.targeting.indexOf(targetunit)&&1==e.isactive}.bind(b),f:function(b,l){return-1<this.targeting.indexOf(targetunit)?(this.log("+1 %CRIT% [%0]",e.name),$("#atokens > .xtargettoken").remove(),{m:b+10,n:l+1}):{m:b,n:l}}.bind(b),str:"critical"})},ship:"TIE Advanced",done:!0},{name:"Stealth Device",type:MOD,done:!0,
install:function(b){b.wrap_after("getagility",this,function(b){return b+1});b.showstats()},uninstall:function(b){"function"==typeof b.getagility.unwrap&&b.getagility.unwrap(this);b.showstats()},init:function(b){var e=this;b.log("+1 agility [%0]",e.name);b.wrap_before("resolveishit",this,function(b){e.isactive&&(e.uninstall(this),e.desactivate(),this.log("%0 is hit => destroyed",e.name),this.show())})},points:3},{name:"Shield Upgrade",type:MOD,done:!0,install:function(b){b.installed=!0;b.shield++;
b.ship.shield++;b.showstats()},uninstall:function(b){b.shield--;b.ship.shield--;b.showstats()},points:4},{name:"Engine Upgrade",type:MOD,done:!0,addedaction:"Boost",points:4},{name:"Anti-Pursuit Lasers",type:MOD,islarge:!0,done:!0,points:2,init:function(b){var e=this;b.wrap_before("collidedby",this,function(b){if(e.isactive&&b.isenemy(this)){var f=this.rollattackdie(1,e,"hit")[0];"hit"==f||"critical"==f?(b.log("+%1 %HIT% [%0]",e.name,1),b.resolvehit(1),b.checkdead()):b.log("no effect [%0]",e.name)}})}},
{name:"Targeting Computer",type:MOD,done:!0,addedaction:"Target",points:2},{name:"Hull Upgrade",type:MOD,done:!0,install:function(b){b.hull++;b.ship.hull++;b.installed=!0;b.showstats()},uninstall:function(b){b.hull--;b.ship.hull--;b.showstats()},points:3},{name:"Munitions Failsafe",type:MOD,init:function(b){var e=this;b.addafterattackeffect(this,function(b,l){this.weapons[this.activeweapon].isprimary||0!=b+l||(this.log("%0 still active [%1]",this.weapons[this.activeweapon].name,e.name),this.weapons[this.activeweapon].isactive=
!0,this.show())})},done:!0,points:1},{name:"Stygium Particle Accelerator",type:MOD,done:!0,init:function(b){b.wrap_after("resolvedecloak",this,function(){this.candoevade()&&this.doaction([this.newaction(this.addevade,"EVADE")],"Stygium P.A.: +1 %EVADE%");return!0});b.wrap_after("addcloak",this,function(b){this.candoevade()&&this.doaction([this.newaction(this.addevade,"EVADE")],"Stygium P.A.: +1 %EVADE%")})},points:2},{name:"Advanced Cloaking Device",type:MOD,points:4,done:!0,init:function(b){var e=
this;b.addafterattackeffect(this,function(){this.candoaction()&&this.candocloak()&&this.doaction([this.newaction(this.addcloak,"CLOAK")],e.name+": free cloack action")})},ship:"TIE Phantom"},{name:"B-Wing/E2",type:MOD,done:!0,upgrades:[CREW],points:1,ship:"B-Wing",install:function(b){b.shipimg="b-wing-1.png"},uninstall:function(b){b.shipimg="b-wing-2.png"}},{name:"Countermeasures",type:MOD,islarge:!0,done:!0,init:function(b){var e=this;b.wrap_before("begincombatphase",this,function(){e.isactive&&
this.donoaction([{action:function(b){e.desactivate();this.wrap_after("getagility",e,function(b){return b+1}).unwrapper("endphase");0<this.istargeted.length?(this.log("select a lock to remove [%0]",e.name),this.resolveactionselection(this.istargeted,function(e){this.istargeted[e].removetarget(this);this.endnoaction(b,"MOD")}.bind(this))):this.endnoaction(b,"MOD")}.bind(this),type:e.type.toUpperCase(),name:e.name}],"",!0)})},points:3},{name:"Experimental Interface",type:MOD,unique:!0,points:3,init:function(b){var e=
this;e.r=-1;b.wrap_before("endaction",this,function(b,l){e.r!=round&&this.candoaction()&&null!=l&&(e.r=round,this.doaction(this.getupgactionlist(),"+1 free action (Skip to cancel)").done(function(b){null==b?e.r=-1:this.addafteractions(function(){this.addstress()}.bind(this))}.bind(this)))})},done:!0},{name:"Tactical Jammer",type:MOD,islarge:!0,points:1,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("getobstructiondef",this,function(f,l){!e.unit.dead&&this.isenemy(b)&&0==l&&(OBSTACLES.push(b),
l=this.getoutlinerange(this.m,f).o?1:0,OBSTACLES.splice(OBSTACLES.indexOf(b),1),1==l&&this.log("fire obstructed by %0",b.name));return l})}},{name:"Autothrusters",type:MOD,actionrequired:"Boost",points:2,done:!0,init:function(b){var e=this;b.wrap_after("modifydefenseroll",this,function(b,e,m,h){2<b.getsector(this)&&0<FE_blank(h,m)&&(h+=FE_EVADE);return h});b.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,this,{req:function(b,l){return 2<activeunit.getsector(this)?e.isactive:!1}.bind(b),f:function(b,l){0<
FE_blank(b,l)&&(this.log("1 blank -> 1 %EVADE% [%0]",e.name),b+=FE_EVADE);return b}.bind(b),str:"blank"})}},{name:"Slave I",type:TITLE,unique:!0,points:0,done:!0,ship:"Firespray-31",upgrades:[TORPEDO]},{name:"Millennium Falcon",type:TITLE,done:!0,addedaction:"Evade",unique:!0,points:1,ship:"YT-1300"},{name:"Moldy Crow",type:TITLE,init:function(b){var e=this;b.wrap_after("resetfocus",this,function(){0<this.focus&&this.log("keep %FOCUS% tokens [%0]",e.name);return this.focus})},unique:!0,done:!0,points:3,
ship:"HWK-290"},{name:"ST-321",type:TITLE,done:!0,init:function(b){b.wrap_after("gettargetableunits",this,function(b){b=[];for(i in squadron)squadron[i].isenemy(this)&&b.push(squadron[i]);return b})},unique:!0,points:3,ship:"Lambda-Class Shuttle"},{name:"Royal Guard TIE",type:TITLE,done:!0,upgrades:[MOD],skillmin:5,points:0,install:function(b){b.shipimg="tie-interceptor-1.png"},uninstall:function(b){b.shipimg="tie-interceptor-2.png"},ship:"TIE Interceptor"},{name:"A-Wing Test Pilot",type:TITLE,done:!0,
upgrades:[ELITE],skillmin:2,points:0,ship:"A-Wing",exclusive:!0,install:function(b){b.shipimg="a-wing-1.png"},uninstall:function(b){b.shipimg="a-wing-2.png"}},{name:"Outrider",type:TITLE,done:!0,install:function(b){var e;for(e=0;e<b.weapons.length;e++)if(b.weapons[e].type==CANNON){b.weapons[0].desactivate();b.log("primary weapon inactive [%0]",this.name);b.weapons[e].isTurret=function(){return!0};b.log("%0 can fire in 360 degrees [%0]",b.weapons[e].name,this.name);break}},uninstall:function(b){b.weapons[0].isactive=
!0;for(var e=0;e<b.weapons.length;e++)b.weapons[e].type==CANNON&&(b.weapons[e].isTurret=function(){return!1})},unique:!0,points:5,ship:"YT-2400"},{name:"Dauntless",type:TITLE,done:!0,init:function(b){var e=this;b.wrap_after("doendmaneuveraction",this,function(){this.candoaction()&&this.collision&&(this.log("+1 free action [%0]",e.name),this.doaction(this.getactionlist(),"").done(function(b){null!=b&&this.addstress()}.bind(this)))})},unique:!0,points:2,ship:"VT-49 Decimator"},{name:"Virago",type:TITLE,
done:!0,upgrades:[ILLICIT,SYSTEM],unique:!0,points:1,skillmin:4,ship:"StarViper"},{name:"'Heavy Scyk' Interceptor",done:!0,upgrades:["Cannon|Torpedo|Missile"],type:TITLE,points:2,ship:"M3-A Interceptor",install:function(b){b.ship.hull++;b.installed=!0;b.showstats()},init:function(b){this.wrap_after("uninstall",this,function(b){b.ship.hull--;b.showstats()})}},{name:"IG-2000",type:TITLE,done:!0,install:function(b){b.ig2000=!0},uninstall:function(b){b.ig2000=!1},init:function(b){for(var e in squadron){var f=
squadron[e];f!=b&&1==f.ig2000&&f.isally(b)&&(b.log("copying %0 abilities [%1]",f.name,this.name),f.init.call(b,f))}},points:0,ship:"Aggressor"},{name:"BTL-A4 Y-Wing",type:TITLE,done:!0,init:function(b){for(var e=[],f=0;f<b.weapons.length;f++){var l=b.weapons[f];l.type==TURRET&&0==l.isprimary&&(e.push(l),l.wrap_after("isTurret",this,function(){return!1}))}0!=e.length&&(b.wrap_after("isTurret",this,function(b,e){return!1}),b.addattack(function(b,e){return this.weapons[this.activeweapon].isprimary},
this,e))},points:0,ship:"Y-Wing"},{name:"Andrasta",type:TITLE,done:!0,upgrades:[BOMB,BOMB],unique:!0,points:0,ship:"Firespray-31"},{name:"TIE/x1",type:TITLE,done:!0,upgrades:[SYSTEM],pointsupg:-4,points:0,ship:"TIE Advanced"},{name:"Emperor Palpatine",type:CREW,unique:!0,takesdouble:!0,done:!0,points:8,faction:EMPIRE,init:function(){var b=this;b.unit.emperor=-1;var e=function(e,l,m,h){if(b.unit.isally(this)&&!b.unit.dead&&"undefined"!=typeof m&&b.unit.emperor<round){for(e=0;e<h.length&&h[e]==m;e++);
e<h.length&&confirm("Emperor Palpatine effect\n"+l.name+": "+h[0]+" die -> "+m+" die ?")&&(b.unit.log("%0 -> %1 [%2]",h[e],m,b.name),h[e]=m,b.unit.emperor=round)}return"undefined"!=typeof m?h:l};Unit.prototype.wrap_after("rollattackdie",b,e);Unit.prototype.wrap_after("rolldefensedie",b,e);Unit.prototype.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(e,l){return!b.unit.dead&&b.unit.emperor<round&&activeunit.isally(b.unit)},f:function(e,l){b.unit.emperor=round;var f=FCH_focus(e),h=FCH_blank(e,
l),q=FCH_hit(e);0<h?(activeunit.log("blank -> %CRIT% [%0]",b.name),e+=FCH_CRIT,b.round=round):0<f?(activeunit.log("%FOCUS% -> %CRIT% [%0]",b.name),e=e-FCH_FOCUS+FCH_CRIT):0<q&&(activeunit.log("%HIT% -> %CRIT% [%0]",b.name),e=e-FCH_HIT+FCH_CRIT);return e},str:"crew"});Unit.prototype.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,this,{req:function(e,l){return!b.unit.dead&&targetunit.isally(b.unit)&&b.unit.emperor<round},f:function(e,l){b.unit.emperor=round;var f=FE_focus(e);0<FE_blank(e,l)?(targetunit.log("blank -> %EVADE% [%0]",
b.name),e+=FE_EVADE):0<f&&(targetunit.log("%FOCUS% -> %EVADE% [%0]",b.name),e=e+FE_EVADE-FE_FOCUS);return e},str:"crew"})}},{name:"Extra Munitions",type:TORPEDO,limited:!0,firesnd:"missile",isWeapon:function(){return!1},points:2,done:!0,init:function(b){for(var e=0;e<b.upgrades.length;e++){var f=b.upgrades[e];f.type.match(/Missile|Torpedo|Bomb/)&&(f.ordnance=!0)}}},{name:"Cluster Mines",type:BOMB,snd:"explode",img:"cluster.png",width:15,height:10,repeatx:42,size:22,stay:!0,done:!0,getOutlineStringsmall:function(b){var e=
"M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var f=0;20>f;f++){var l=transformPoint(b,{x:this.size*Math.sin(2*f*Math.PI/20),y:this.size*Math.cos(2*f*Math.PI/20)});this.op.push(l);e+=l.x+" "+l.y+" ";0==f&&(e+="L ")}return{s:e+"Z",p:this.op}},candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},explode:function(){},detonate:function(b){if(!this.exploded){for(var e=this.unit.rollattackdie(2,this,"hit"),
f=0;2>f;f++)if("hit"==e[f]||"critical"==e[f])b.log("+1 %HIT% [%0]",this.name),b.resolvehit(1),b.checkdead();Bomb.prototype.detonate.call(this)}},display:function(b,e){this.getOutlineString=this.getOutlineStringsmall;var f=$.extend({},this),l=$.extend({},this);Bomb.prototype.display.call(f,this.repeatx,0);Bomb.prototype.display.call(l,-this.repeatx,0);Bomb.prototype.display.call(this,0,0)},init:function(b){b=s.path("M41.844,-21 C54.632,-21 65,-11.15 65,1 C65,13.15 54.632,23 41.844,23 C33.853,22.912 25.752,18.903 21.904,12.169 C17.975,18.963 10.014,22.806 1.964,23 C-7.439,22.934 -14.635,18.059 -18.94,10.466 C-22.908,18.116 -30.804,22.783 -39.845,23 C-52.633,23 -63,13.15 -63,1 C-63,-11.15 -52.633,-21 -39.845,-21 C-30.441,-20.935 -23.246,-16.06 -18.94,-8.466 C-14.972,-16.116 -7.076,-20.783 1.964,-21 C9.956,-20.913 18.055,-16.902 21.904,-10.17 C25.832,-16.964 33.795,-20.807 41.844,-21 z").attr({display:"none"});
var e=b.getTotalLength();this.op0=[];for(var f=0;60>f;f++)this.op0[f]=b.getPointAtLength(f*e/60)},getOutlineString:function(b){var e="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var f=0;60>f;f++){var l=transformPoint(b,this.op0[f]);this.op.push(l);e+=l.x+" "+l.y+" ";0==f&&(e+="L ")}return{s:e+"Z",p:this.op}},points:4},{name:"Glitterstim",type:ILLICIT,points:2,activated:-1,done:!0,init:function(b){var e=this;b.glitter=-1;b.wrap_after("modifyattackroll",this,function(b,e,m,h){b=FCH_focus(h);
0<b&&0==this.stress&&(h+=(FCH_HIT-FCH_FOCUS)*b);return h});b.wrap_after("begincombatphase",this,function(b){e.isactive&&this.donoaction([{org:e,name:e.name,type:"ILLICIT",action:function(b){this.addstress();this.glitter=round;this.endnoaction(b,"ILLICIT")}.bind(this)}],"",!0);return b});b.wrap_before("endphase",this,function(){this.glitter==round&&e.desactivate()});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,l){return this.glitter==round&&e.isactive}.bind(b),f:function(b,l){var f=
FCH_focus(b);0<f&&(this.log("%1 %FOCUS% -> %1 %HIT% [%0]",e.name,f),b=b-FCH_FOCUS*f+f*FCH_HIT);return b}.bind(b),str:"focus",noreroll:"focus"});b.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,this,{req:function(b,l){return this.glitter==round&&e.isactive}.bind(b),f:function(b,l){var f=FE_focus(b);0<f&&(this.log("%1 %FOCUS% -> %1 %EVADE% [%0]",e.name,f),b=b-FE_FOCUS*f+FE_EVADE*f);return b}.bind(b),str:"focus",noreroll:"focus"})}},{name:"Cloaking Device",type:ILLICIT,islarge:!1,points:2,candoaction:function(){return this.isactive&&
!this.unit.iscloaked},action:function(b){var e=this.unit;e.log("cloaked [%0]",this.name);e.addcloak(b)},done:!0,init:function(b){var e=this;b.wrap_after("endphase",this,function(){e.isactive&&("focus"==this.rollattackdie(1,e,"blank")[0]&&this.iscloaked&&1==e.isactive?(this.log("%0 failed -> decloaking",e.name),this.resolvedecloak(!0),e.desactivate()):this.log("%0 still working",e.name))})}},{name:"Bossk",unique:!0,faction:SCUM,type:CREW,points:2,done:!0,init:function(b){var e=this;b.wrap_after("hashit",
this,function(b,l){l||(this.log("+1 stress, +1 %FOCUS%, +1 %TARGET% [%0]",e.name),0==this.stress&&this.addstress(),-1<this.gettargetableunits(3).indexOf(b)?this.addtarget(b):this.log("no valid target [%0]",e.name),this.addfocustoken());return l})}},{name:"Wired",type:ELITE,init:function(b){var e=this,f=function(){return 0<this.stress?(this.log("+%1 %FOCUS% reroll(s) [%0]",e.name,this.focus),e.isactive):!1}.bind(b);b.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["focus"],n:function(){return 9},
req:f});b.adddicemodifier(DEFENSE_M,REROLL_M,DEFENSE_M,this,{dice:["focus"],n:function(){return 9},req:f})},done:!0,points:1},{name:"Cool Hand",type:ELITE,points:1,rating:1,done:!0,init:function(b){var e=this;b.wrap_after("addstress",this,function(){e.isactive&&this.donoaction([{type:"FOCUS",name:e.name,org:e,action:function(b){e.desactivate();this.addfocustoken();this.endnoaction(b,"ELITE")}.bind(this)},{type:"EVADE",name:e.name,org:e,action:function(b){e.desactivate();this.addevadetoken();this.endnoaction(b,
"ELITE")}.bind(this)}],"Add %EVADE% or %FOCUS% instead of %STRESS% token",!0)})}},{name:"Juke",rating:2,type:ELITE,points:2,islarge:!1,done:!0,init:function(b){var e=this;b.wrap_after("modifydefenseroll",this,function(b,e,m,h){0<FE_evade(h)&&(h=h-FE_EVADE+FE_FOCUS);return h});b.adddicemodifier(ATTACK_M,MOD_M,DEFENSE_M,this,{req:function(){return 0<e.unit.evade},f:function(b,l){0<FE_evade(b)&&(targetunit.log("%EVADE% -> %FOCUS% [%0]",e.name),b=b-FE_EVADE+FE_FOCUS);return b},str:"evade"});b.wrap_after("setpriority",
this,function(b){"EVADE"==b.type&&0==this.evade&&(b.priority=10)})}},{name:"Lightning Reflexes",type:ELITE,rating:1,points:1,done:!0,init:function(b){var e=this;b.wrap_after("handledifficulty",this,function(b){"WHITE"!=b&&"GREEN"!=b||!e.isactive||this.donoaction([{type:"ELITE",name:e.name,org:e,action:function(b){e.desactivate();this.addstress(1);this.m=this.m.rotate(180,0,0);this.show();this.endnoaction(b,ELITE)}.bind(this)}],"",!0)})},islarge:!1},{name:"Twin Laser Turret",type:TURRET,firesnd:"falcon_fire",
points:6,done:!0,attack:3,range:[2,3],followupattack:function(){return this.unit.weapons.indexOf(this)},modifyhit:function(b){return FCH_HIT},prehit:function(b,e,f){this.unit.hitresolved=1;this.unit.criticalresolved=0;b.log("+%1 %HIT% [%0]",this.name,1)},hasdoubleattack:function(){return this.twinattack=!this.twinattack},init:function(b){this.twinattack=!1}},{name:"Plasma Torpedoes",type:TORPEDO,points:3,attack:4,firesnd:"missile",requires:"Target",consumes:!0,done:!0,posthit:function(b,e,f){0<b.shield&&
b.log("-1 %SHIELD% [%0]",this.name);b.removeshield(1)},init:function(b){var e=this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})},range:[2,3]},{name:"Ion Bombs",type:BOMB,points:2,width:14,height:14,size:15,done:!0,snd:"explode",img:"ion.png",explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),e=0;e<b[1].length;e++)squadron[b[1][e].unit].addiontoken(),squadron[b[1][e].unit].addiontoken();
this.explode_base()}}},{name:"Conner Net",type:BOMB,snd:"explode",img:"conner-net3.png",width:40,height:60,size:40,done:!0,init:function(){this.conner=-1;var b=s.path("M-11.379,-0.26 C-11.241,-6.344 -16.969,-14.641 -19.247,-20.448 C-21.524,-26.255 -24.216,-38.147 -20.213,-39.46 C-16.21,-40.774 -8.619,-37.594 2.424,-37.663 C13.466,-37.732 22.162,-41.327 23.68,-39.322 C25.198,-37.317 26.716,-30.404 22.714,-21.278 C18.711,-12.152 14.156,-6.828 14.087,0.293 C14.018,7.414 19.47,15.364 22.3,22.555 C25.129,29.745 25.681,39.908 23.128,41.429 C20.574,42.95 13.673,41.29 4.218,41.29 C-5.237,41.29 -19.316,42.742 -20.903,41.29 C-22.49,39.839 -24.354,34.446 -20.213,23.108 C-16.072,11.769 -11.448,11.424 -11.379,1.606 C-11.322,-6.487 -11.514,5.685 -11.379,-0.26 z").attr({display:"none"}),
e=b.getTotalLength();this.op0=[];for(var f=0;60>f;f++)this.op0[f]=b.getPointAtLength(f*e/60)},getOutlineString:function(b){var e="M ";this.op=[];"undefined"==typeof b&&(b=this.m);for(var f=0;60>f;f++){var l=transformPoint(b,this.op0[f]);this.op.push(l);e+=l.x+" "+l.y+" ";0==f&&(e+="L ")}return{s:e+"Z",p:this.op}},stay:!0,candoaction:function(){return this.unit.lastdrop!=round&&this.isactive},action:function(b){this.actiondrop(b)},canbedropped:function(){return!1},explode:function(){},detonate:function(b,
e){var f=this;this.exploded||(e?b.hasmoved?(b.log("+1 %HIT%, +2 %ION% next turn [%0]",f.name),b.wrap_after("beginplanningphase",this,function(b){this.log("+2 ion tokens [%0]",f.name);this.addiontoken();this.addiontoken();this.beginplanningphase.unwrap(f);return b})):(b.log("%1 skips action phase [%0]",f.name,b.name),b.wrap_after("candoendmaneuveraction",f,function(){return!1}).unwrapper("endactivationphase")):(b.wrap_before("cleanupmaneuver",this,function(){b.log("+1 %HIT%, +2 %ION% [%0]",this.name);
b.resolvehit(1);b.checkdead();b.addiontoken();b.addiontoken();b.log("%1 skips action phase [%0]",this.name,b.name)}).unwrapper("endactivationphase"),b.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("endactivationphase")),Bomb.prototype.detonate.call(this,e))},points:4},{name:"Bombardier",type:CREW,points:1,done:!0,init:function(b){b.wrap_after("getbomblocation",this,function(b){return-1<b.indexOf("F1")?b.concat("F2"):b})}},{name:"Agent Kallus",type:CREW,faction:EMPIRE,points:2,
done:!0,init:function(b){var e=this;this.unit.nemesis=null;b.wrap_after("beginactivationphase",e,function(b){1==round&&this.selectunit(this.selectnearbyenemy(4),function(b,f){this.nemesis=b[f];this.log("%0 chosen as nemesis [%1]",b[f].name,e.name)});return b},["select unit [%0]",e.name],!1);b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,e,{req:function(){return targetunit==this.nemesis}.bind(b),f:function(b,l){0<FCH_focus(b)&&(b=b-FCH_FOCUS+FCH_HIT,this.log("1 %FOCUS% -> 1 %HIT% [%0]",e.name));return b}.bind(b),
str:"focus"});b.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,e,{req:function(){return activeunit==this.nemesis}.bind(b),f:function(b,l){0<FE_focus(b)&&(b=b-FE_FOCUS+FE_EVADE,this.log("1 %FOCUS% -> 1 %EVADE% [%0]",e.name));return b}.bind(b),str:"focus"})}},{name:"'Crack Shot'",type:ELITE,points:1,rating:3,done:!0,init:function(b){var e=this;b.wrap_after("modifydefenseroll",this,function(b,e,m,h){0<FE_evade(h)&&(h-=FE_EVADE);return h});b.adddicemodifier(ATTACKCOMPARE_M,MOD_M,DEFENSE_M,this,{req:function(){return this.isinfiringarc(targetunit)&&
e.isactive}.bind(b),aiactivate:function(b,e){return 0<FE_evade(b)},f:function(f,l){e.desactivate();0<FE_evade(f)&&(b.log("-1 %EVADE% [%0]",e.name),f-=FE_EVADE);return f},str:"evade"})}},{name:"Advanced Homing Missiles",type:MISSILE,firesnd:"missile",points:3,requires:"Target",consumes:!1,attack:3,range:[2,2],done:!0,modifyhit:function(b){return FCH_CRIT},prehit:function(b,e,f){b.log("+1 %CRIT% [%0]",this.name);b.applycritical(1);this.unit.hitresolved=0;this.unit.criticalresolved=0},init:function(b){var e=
this;b.wrap_after("setpriority",this,function(b){"TARGET"==b.type&&e.isactive&&this.candotarget()&&(b.priority+=10)})}},{name:"Advanced SLAM",type:MOD,done:!0,points:2,init:function(b){var e=this;b.wrap_after("resolveslam",this,function(){this.doaction(this.getactionlist(),"+1 free action (Skip to cancel) ["+e.name+"]")})}},{name:"Twin Ion Engine Mk. II",type:MOD,points:1,ship:"TIE",done:!0,install:function(b){var e=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0==e.length)for(var f=
0;f<b.length;f++){var m=b[f].move,h=b[f].difficulty;m.match(/BL\d|BR\d/)&&(h="GREEN");e[f]={move:m,difficulty:h}}return e});b.wrap_after("getmaneuver",this,function(b){return b.move.match(/BL\d|BR\d/)?{move:b.move,difficulty:"GREEN"}:b})},uninstall:function(b){"function"==typeof b.getdial.unwrap&&b.getdial.unwrap(this)}},{name:"Maneuvering Fins",type:MOD,points:1,ship:"YV-666",done:!0,init:function(b){var e=this;b.wrap_after("getmaneuverlist",e,function(b){if(this.hasionizationeffect())return b;for(var f in b)if(f.match(/TR\d|TL\d/)){this.log("change turn into a bank [%0]",
e.name);var m=f.replace(/T/,"B");b[m]={move:m,difficulty:b[f].difficulty,halfturn:b[f].halfturn}}return b}.bind(b))}},{name:"Hound's Tooth",points:6,type:TITLE,unique:!0,ship:"YV-666",done:!0,getdeploymentmatrix:function(b){for(var e=b.getdial(),f=[],l=0;l<e.length;l++){var m=this.unit.m.clone().translate(0,20).rotate(180,0,0);f.push(b.getpathmatrix(m,e[l].move))}for(l=0;l<e.length;l++)m=this.unit.m.clone().translate(0,-20),f.push(b.getpathmatrix(m,e[l].move));return f},init:function(b){var e=this,
f,l=-1;for(f in squadron)if("Nashtah Pup Pilot"==squadron[f].name){l=f;break}if(-1<l)p=squadron[l],p.skill=b.skill;else{for(f=0;f<PILOTS.length&&"Nashtah Pup Pilot"!=PILOTS[f].name;f++);p=new Unit(b.team,f);p.upg=[];p.skill=b.skill;p.tosquadron(s);allunits.push(p);squadron.push(p);TEAMS[b.team].units.push(p)}p.dock(b);p.show();b.wrap_before("dies",e,function(){var b=this.docked;this.init.call(b);this.hasfired=0;b.wrap_before("endphase",b,function(){this.hasmoved=!1});b.noattack=round;b.deploy(this,
e.getdeploymentmatrix(b))})}},{name:"XX-23 S-Thread Tracers",points:1,type:MISSILE,firesnd:"missile",range:[1,3],attack:3,done:!0,requires:"Focus",consumes:!1,modifyhit:function(b){return 0},prehit:function(b,e,f){e=this.unit.selectnearbyally(2);f="";if(0<e.length){e=e.concat(this.unit);for(var l=0;l<e.length;l++)-1<e[l].gettargetableunits(3).indexOf(b)?(e[l].addtarget(b),f+=e[l].name+" "):e[l].log("no valid target [%0]",this.name);this.unit.log("all dice cancelled, %0 now targeted by %1",b,f);this.unit.hitresolved=
0;this.unit.criticalresolved=0}}},{name:"Comm Relay",points:3,type:TECH,done:!0,init:function(b){var e=this;b.wrap_after("addevadetoken",this,function(){1<this.evade&&(this.log("1 %EVADE% max [%0]",e.name),this.evade=1);this.showinfo()});b.wrap_after("resetevade",this,function(){var b=0;0<this.evade&&(this.log("keep 1 %EVADE% token [%0]",e.name),b=1);return b})}},{name:"Dorsal Turret",type:TURRET,points:3,firesnd:"falcon_fire",attack:2,range:[1,2],done:!0,getrangeattackbonus:function(b){return 1==
this.getrange(b)?(this.unit.log("+1 attack for range 1"),1):0}},{name:"'Chopper'",type:CREW,points:0,done:!0,init:function(b){b.wrap_after("hasnostresseffect",this,function(b){return!0});b.wrap_before("endaction",this,function(b,f){null!=f&&0<this.stress&&(this.log("%STRESS% -> +1 %HIT% [%0]",this.name),this.resolvehit(1),this.checkdead())})},faction:REBEL,unique:!0},{name:"Hera Syndulla",type:CREW,points:1,faction:REBEL,done:!0,init:function(b){b.wrap_after("canreveal",this,function(b,f){return"RED"==
b.difficulty&&0<this.stress?!0:f})},unique:!0},{name:"'Zeb' Orrelios",type:CREW,points:1,faction:REBEL,unique:!0,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("checkcollision",this,function(f,l){return!e.unit.dead&&f==b&&b.isinfiringarc(f)?!1:l});b.wrap_after("checkcollision",this,function(f,l){return!e.unit.dead&&b.isinfiringarc(f)?!1:l})}},{name:"Ezra Bridger",type:CREW,points:3,faction:REBEL,unique:!0,done:!0,init:function(b){var e=this;b.wrap_after("modifyattackroll",this,function(b,
e,m,h){return 0<FCH_focus(b)?b-FCH_FOCUS+FCH_CRIT:b});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(f,l){return e.isactive&&0<b.stress}.bind(this),f:function(b,e){return 0<FCH_focus(b)?(this.unit.log("1 %FOCUS% -> 1 %CRIT% [%0]",this.name),b-FCH_FOCUS+FCH_CRIT):b}.bind(this),str:"focus"})}},{name:"Kanan Jarrus",type:CREW,points:3,faction:REBEL,unique:!0,done:!0,init:function(b){var e=this;this.rd=-1;Unit.prototype.wrap_before("endmaneuver",e,function(){var b=this.maneuverdifficulty;
!e.unit.dead&&"WHITE"==b&&0<this.stress&&e.rd<round&&this.isally(e.unit)&&2>=this.getrange(e.unit)&&(this.log("-1 %STRESS% [%0]",e.name),e.rd=round,this.removestresstoken())})}},{name:"Sabine Wren",type:CREW,points:2,upgrades:[BOMB],faction:REBEL,unique:!0,done:!0,rd:-1,init:function(b){var e=this;e.rd=-1;Bomb.prototype.wrap_after("explode_base",this,function(){var b=[e.unit];if(e.rd!=round&&!this.unit.isenemy(e.unit)){for(var l in squadron){var m=squadron[l];this.unit.isenemy(m)&&1==this.getrange(m)&&
b.push(m)}this.unit.selectunit(b,function(b,f){0!=f&&e.rd!=round&&(b[f].log("+1 %HIT% [%0]",e.name),b[f].resolvehit(1),e.rd=round,SOUNDS.explode.play(),b[f].checkdead())},["select unit (or self to cancel) [%0]",e.name],!1)}})}},{name:"Ghost",type:TITLE,points:0,unique:!0,done:!0,getdeploymentmatrix:function(b){for(var e=b.getdial(),f=[],l=0;l<e.length;l++){var m=this.unit.m.clone().translate(0,20).rotate(180,0,0);f.push(b.getpathmatrix(m,e[l].move))}return f},init:function(b){var e=-1,f=this,l;for(l in squadron){var m=
squadron[l];if(m.isally(b)&&b!=m)for(var h=0;h<m.upgrades.length;h++)if("Phantom"==m.upgrades[h].name){e=l;break}if(-1!=e)break}-1!=e?(m=squadron[e],1==TEAMS[b.team].isia&&(m=$.extend(m,IAUnit.prototype)),m.dock(b),b.weapons[0].auxiliary=AUXILIARY,b.weapons[0].subauxiliary=SUBAUXILIARY,b.weapons[0].type="Bilaser",b.wrap_after("endmaneuver",this,function(){this.docked&&m.donoaction([{org:f,type:"TITLE",name:f.name,action:function(b){this.weapons[0].auxiliary=void 0;this.weapons[0].subauxiliary=void 0;
this.weapons[0].type="Laser";m.deploy(this,f.getdeploymentmatrix(m));m.endnoaction(b,"TITLE")}.bind(this)}],"",!0)}),b.wrap_after("endcombatphase",this,function(){if(this.docked)for(var b=0;b<this.weapons.length;b++){var e=this.weapons[b];if(e.type==TURRET&&e.isactive&&this.noattack<round){this.log("+1 attack with %1 [%0]",f.name,e.name);this.noattack=round;this.selecttargetforattack(b);break}}}),b.wrap_after("dies",this,function(){this.docked&&(this.docked.noattack=round,this.log("emergency deployment of %0, +1 %HIT% [%1]",
this.docked.name,this.name),this.docked.resolvehit(1),this.docked.hasfired=0,this.docked.wrap_before("endphase",this.docked,function(){this.hasmoved=!1}),m.deploy(this,f.getdeploymentmatrix(m)))})):b.log("Phantom not found")},ship:"VCX-100"},{name:"Phantom",type:TITLE,points:0,unique:!0,done:!0,ship:"Attack Shuttle"},{name:"Reinforced Deflectors",points:3,type:SYSTEM,islarge:!0,done:!0,init:function(b){var e=this;b.addafterdefenseeffect(e,function(b,l,m){3<=b+l&&this.addshield(1)&&this.log("+1 %SHIELD% [%0]",
e.name)})}},{name:"Targeting Astromech",points:2,type:ASTROMECH,done:!0,init:function(b){var e=this;b.wrap_after("handledifficulty",this,function(b){"RED"==b&&this.selectunit(this.gettargetableunits(3),function(b,e){this.addtarget(b[e])},["select target or self to cancel [%0]",e.name],!0)})}},{name:"TIE/x7",points:-2,type:TITLE,lostupgrades:[CANNON,MISSILE],ship:"TIE Defender",done:!0,init:function(b){var e=this;b.wrap_before("endmaneuver",this,function(){this.getdial()[this.maneuver].move.match(/[345]/)&&
-1==this.ocollision.overlap&&0==this.touching.length&&this.candoevade()&&(this.log("+1 %EVADE% [%0]",e.name),this.doselection(function(b){this.addevade(b)}.bind(this)))})}},{name:"TIE/D",points:0,type:TITLE,ship:"TIE Defender",done:!0,init:function(b){this.unit.tiedattack=-1;for(var e in b.weapons);b.addattack(function(b,e){var f=this.weapons[this.activeweapon];return f.type==CANNON&&3>=f.points&&this.tiedattack<round},this,[b.weapons[0]],function(){this.tiedattack=round})}},{name:"TIE Shuttle",points:0,
done:!0,type:TITLE,ship:"TIE Bomber",maxupg:4,lostupgrades:[TORPEDO,MISSILE,BOMB],upgrades:[CREW,CREW]},{name:"Guidance Chips",points:0,type:MOD,done:!0,init:function(b){var e=this;for(i in b.weapons){var f=FCH_HIT,l=b.weapons[i],m=b.weapons[0];m.isprimary&&3<=m.getattack()&&(f=FCH_CRIT);l.type.match(/Torpedo|Missile/)&&l.wrap_after("modifyattackroll",this,function(b,e,l,m){0<FCH_blank(m,e)?m+=f:0<FCH_focus(m)?m=m-FCH_FOCUS+f:0<FCH_crit(m)&&(m=m-FCH_HIT+f);return m})}b.adddicemodifier(ATTACK_M,MOD_M,
ATTACK_M,this,{req:function(b,e){var f=this.weapons[this.activeweapon].type;return f==TORPEDO||f==MISSILE?!0:!1}.bind(b),f:function(f,l){var h=FCH_blank(f,l),m=FCH_focus(f),q=FCH_hit(f),v=FCH_HIT,z="%HIT%";this.weapons[0].isactive&&3<=this.weapons[0].getattack()&&(v=FCH_CRIT,z="%CRIT%");0<h?(b.log("+1 "+z+" [%0]",e.name),f+=v):0<m?(b.log("%FOCUS% -> "+z+" [%0]",e.name),f+=v-FCH_FOCUS):0<q&&v==FCH_CRIT&&(b.log("%HIT% -> %CRIT% [%0]",e.name),f+=v-FCH_HIT);return f}.bind(b),str:"target"})}},{name:"TIE/v1",
ship:"TIE Adv. Prototype",points:1,done:!0,init:function(b){var e=this;b.wrap_after("addtarget",this,function(b){e.isactive&&this.candoaction()&&this.candoevade()&&(this.log("free %EVADE% action [%0]",this.name),this.doselection(function(b){this.addevade(b)}.bind(this)))})},type:TITLE},{name:"Zuckuss",faction:SCUM,points:1,unique:!0,done:!0,type:CREW,init:function(b){var e=this;b.adddicemodifier(ATTACK_M,MOD_M,DEFENSE_M,this,{req:function(f,l){return e.isactive&&0==b.stress},f:function(f,l){var m=
FE_focus(f);if(0<m&&0==b.stress){targetunit.log("Reroll %0 %FOCUS% [%1]",m,e.name);b.log("+%0 %STRESS% [%1]",m,e.name);var h=b.rolldefensedie(m,e,"evade");f-=FE_FOCUS*m;for(var q=0;q<m;q++)b.addstress(),"evade"==h[q]&&(f+=FE_EVADE),"focus"==h[q]&&(f+=FE_FOCUS)}return f},str:"focus"});b.adddicemodifier(ATTACK_M,MOD_M,DEFENSE_M,this,{req:function(f,l){return e.isactive&&0==b.stress},f:function(f,l){var m=FE_evade(f);if(0<m&&0==b.stress){targetunit.log("Reroll %0 %EVADE% [%1]",m,e.name);b.log("+%0 %STRESS% [%1]",
m,e.name);var h=b.rolldefensedie(m,e,"evade");f-=FE_EVADE*m;for(var q=0;q<m;q++)b.addstress(),"evade"==h[q]&&(f+=FE_EVADE),"focus"==h[q]&&(f+=FE_FOCUS)}return f},str:"evade"})}},{name:"4-LOM",faction:SCUM,points:1,unique:!0,done:!0,type:CREW,init:function(b){var e=this;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(){return targetunit.canusefocus()},f:function(b,l){this.addiontoken();targetunit.canusefocus()&&(targetunit.log("cannot use focus in this attack [%0]",e.name),targetunit.wrap_after("canusefocus",
this,function(){return!1}).unwrapper("afterdefenseeffect"));return b}.bind(b),str:"focus"});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(){return targetunit.canuseevade()},f:function(b,l){this.addiontoken();targetunit.canusefocus()&&(targetunit.log("cannot use evade in this attack [%0]",e.name),targetunit.wrap_after("canuseevade",this,function(){return!1}).unwrapper("afterdefenseeffect"));return b}.bind(b),str:"evade"})}},{name:"Mist Hunter",type:TITLE,points:0,addedaction:"Roll",
done:!0,ship:"G-1A Starfighter",unique:!0,upgrades:[CANNON],install:function(b){var e,f;b.installed=!0;for(f=0;f<UPGRADES.length&&"Tractor Beam"!=UPGRADES[f].name;f++);if(f!=UPGRADES.length)for(e=0;e<b.upgradetype.length;e++)if(b.upgradetype[e]==UPGRADES[f].type&&-1==b.upg[e]){addupgrade(b,f,e,!0);b.log("%0 added [%1]",UPGRADES[f].name,this.name);break}}},{name:"Adaptability(+1)",type:ELITE,points:0,invisible:!0},{name:"Adaptability(-1)",type:ELITE,points:0,invisible:!0},{name:"Dengar",unique:!0,
type:CREW,points:3,faction:SCUM,done:!0,init:function(b){b.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 1==targetunit.unique?2:1},req:function(b,f,l){return this.isactive}.bind(this)})}},{name:"'Gonk'",unique:!0,type:CREW,points:2,faction:SCUM,shield:0,candoaction:function(){return this.isactive},action:function(b){var e=this.unit;this.isactive&&(e.log("+1 %SHIELD% on %0 [%0]",this.name),this.shield++);e.endaction(b,CREW);return!0},candoaction2:function(){return this.isactive},
action2:function(b){var e=this.unit;this.isactive&&0<this.shield&&this.unit.shield<this.unit.ship.shield&&(e.shield<e.ship.shield&&e.log("+1 %SHIELD% [%0]",this.name),e.addshield(1),this.shield--,e.show());e.endaction(b,CREW);return!0},done:!0},{name:"Boba Fett",unique:!0,type:CREW,points:1,faction:SCUM,done:!0,init:function(b){var e=this;b.wrap_before("hashit",this,function(b){var f=this;e.isactive&&b.wrap_after("deal",e,function(l,h,q){q.then(function(h){if(h.face==FACEUP){h=[];for(i in b.upgrades){var l=
b.upgrades[i];l.type.match(/Missile|Torpedo|Crew|Bomb|Cannon|Turret|Astromech|System|Illicit|Salvaged|Tech|Elite/)&&h.push(l)}b.log("select upgrade to desactivate [%0]",e.name);f.selectupgradetodesactivate(h,e)}});return q}).unwrapper("afterdefenseeffect")})}},{name:"R5-P8",unique:!0,type:SALVAGED,points:3,done:!0,r5p8:-1,init:function(b){var e=this;b.addafterdefenseeffect(this,function(b,l,m){e.r5p8!=round&&(e.r5p8=round,this.donoaction([{name:this.name,org:this,type:"HIT",action:function(b){var f=
this.rollattackdie(1,e,"hit")[0];this.log("roll 1 attack dice [%0]",e.name);if("hit"==f||"critical"==f)m.log("+1 %HIT% [%1]",e.name),m.resolvehit(1),m.checkdead();"critical"==f&&(this.log("+1 %HIT% [%1]",e.name),this.resolvehit(1),this.checkdead());this.endnoaction(b,"")}.bind(this)}],"",!0))})}},{name:"Attanni Mindlink",type:ELITE,points:1,rating:2,done:!0,faction:SCUM,init:function(b){var e=this;"undefined"==typeof Unit.prototype.getattanni&&(Unit.prototype.getattanni=function(){return[]});Unit.prototype.wrap_after("getattanni",
this,function(b){return b.concat(e.unit)});b.wrap_after("addfocustoken",this,function(){if(!this.dead&&e.isactive){var b=this.getattanni(),l;for(l in b)b[l]!=this&&b[l].isally(this)&&0==b[l].focus&&(b[l].addfocustoken(),b[l].log("+1 %FOCUS% [%0]",e.name))}});b.wrap_after("addstress",this,function(){if(!this.dead&&e.isactive){var b=this.getattanni(),l;for(l in b)b[l]!=this&&b[l].isally(this)&&0==b[l].stress&&(b[l].addstress(),b[l].log("+1 %STRESS% [%0]",e.name))}})}},{name:"Rage",type:ELITE,round:-1,
candoaction:function(){return this.isactive},action:function(b){var e=this.unit;this.isactive&&(this.unit.log("+1 %FOCUS%, +2 %STRESS%, 3 rerolls [%0]",e.name),this.round=round,e.addfocustoken(),e.addstress(),e.addstress());e.endaction(b,ELITE);return!0},init:function(b){b.adddicemodifier(ATTACK_M,REROLL_M,ATTACK_M,this,{dice:["blank","focus"],n:function(){return 3},req:function(b,f,l){return this.isactive&&this.round==round}.bind(this)})},done:!0,points:1},{name:"Punishing One",type:TITLE,unique:!0,
points:12,done:!0,ship:"JumpMaster 5000",install:function(b){b.installed=!0;b.weapons[0].wrap_after("getattack",this,function(b){return b+1});b.showstats()},uninstall:function(b){"function"==typeof b.weapons[0].getattack.unwrap&&b.weapons[0].getattack.unwrap(this);b.showstats()}},{name:"Long-Range Scanners",type:MOD,points:0,done:!0,requiredupg:[TORPEDO,MISSILE],init:function(b){b.wrap_after("gettargetableunits",this,function(b,f){var e=[];if(3>b)return e;for(var m in squadron)squadron[m].isenemy(this)&&
3<=this.getrange(squadron[m])&&e.push(squadron[m]);return e})}},{name:"Electronic Baffle",type:SYSTEM,points:1,done:!0,init:function(b){var e=this;b.wrap_after("addstress",this,function(){this.donoaction([{type:"SYSTEM",name:e.name,org:e,action:function(b){this.removestresstoken();this.log("-1 %STRESS%, +1 %HIT% [%0]",e.name);this.resolvehit(1);this.endnoaction(b,"SYSTEM")}.bind(this)}],"Take 1 %HIT% instead of %STRESS% token",!0)});b.wrap_after("addiontoken",this,function(){this.donoaction([{type:"SYSTEM",
name:e.name,org:e,action:function(b){this.removeiontoken();this.log("-1 %ION%, +1 %HIT% [%0]",e.name);this.resolvehit(1);this.endnoaction(b,"SYSTEM")}.bind(this)}],"Take 1 %HIT% instead of %ION% token",!0)})}},{name:"Overclocked R4",type:SALVAGED,points:1,done:!0,init:function(b){var e=this;b.wrap_after("begincombatphase",e,function(b){this.wrap_after("removefocustoken",e,function(){this.donoaction([{type:"STRESS",name:e.name,org:e,action:function(b){this.addstress();this.addfocustoken();this.endnoaction(b,
"SALVAGED")}.bind(this)}],"Add %STRESS% for %FOCUS%",!0)}).unwrapper("endcombatphase");return b})}},{name:"Thermal Detonators",done:!0,img:"seismic.png",snd:"explode",width:16,height:8,size:15,explode:function(){if(phase==ACTIVATION_PHASE&&!this.exploded){for(var b=this.getrangeallunits(),e=0;e<b[1].length;e++){var f=squadron[b[1][e].unit];f.log("+1 %HIT%, +1 %STRESS% [%0]",this.name);f.resolvehit(1);f.addstress();f.checkdead()}this.explode_base()}},type:BOMB,points:3},{name:"Ion Projector",type:MOD,
islarge:!0,done:!0,points:2,init:function(b){var e=this;b.wrap_before("collidedby",this,function(b){if(e.isactive&&b.isenemy(this)){var f=this.rollattackdie(1,e,"hit")[0];if("hit"==f||"critical"==f)b.log("+%1 %ION% [%0]",e.name,1),b.addiontoken()}else b.log("no effect [%0]",e.name)})}},{name:"Adaptability",type:ELITE,rating:2,points:0,done:!0,faceup:!1,canswitch:function(){return phase<=SETUP_PHASE},"switch":function(){this.variant=(this.faceup=!this.faceup)?"+1":"-1";this.unit.showskill()},init:function(b){var e=
this;b.wrap_after("getskill",this,function(b){return e.faceup?b+1:b-1});this["switch"]();b.showskill()}},{name:"Systems Officer",type:CREW,limited:!0,faction:EMPIRE,done:!0,points:2,init:function(b){b.wrap_after("endmaneuver",this,function(){var b=this.getdial()[this.lastmaneuver].difficulty,f=this.selectnearbyally(1);"GREEN"==b&&0<f.length&&this.selectunit(f,function(b,e){b[e].selectunit(b[e].gettargetableunits(3),function(b,e){this.addtarget(b[e])},["select target to lock"],!1)},["select unit for free %TARGET% (or self to cancel)"],
!0)})}},{name:"Special Ops Training",type:TITLE,faction:EMPIRE,ship:"TIE/SF Fighter",points:0,done:!0,init:function(b){var e=this;b.addattack(function(b,e){return this.secondattack},this,[b.weapons[0]],function(){},function(){var b=this.weapons[0].getenemiesinrange(),e=[],m;for(m in b)this.isinprimaryfiringarc(b[m])||e.push(b[m]);return e});b.wrap_after("preattackroll",this,function(b,l){var f=this.weapons[b];this.secondattack=!1;f.isprimary&&this.isinprimaryfiringarc(l)&&(f={org:e,name:e.name,type:"HIT",
action:function(b){this.log("+1 attack die");this.wrap_after("getattackstrength",this,function(b,e,f){return f+1}).unwrapper("attackroll");this.endnoaction(b,"HIT")}.bind(this)},this.donoaction([f],"Add 1 additional attack die or one auxiliary arc attack (by default)",!0,function(){this.secondattack=!0}.bind(this)))})}},{name:"Sensor Cluster",type:TECH,points:2,done:!0,init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,MOD_M,DEFENSE_M,e,{req:function(b,l){return e.isactive&&this.canusefocus()}.bind(b),
aiactivate:function(b,e){return 0<FE_blank(b,e)&&0==FE_focus(b)},f:function(b,l){0<this.canusefocus()&&0<FE_blank(b,l)&&(this.removefocustoken(),this.log("1 blank -> 1 %EVADE% [%0]",e.name),b+=FE_EVADE);return b}.bind(b),str:"blank"})}},{name:"R3 Astromech",type:ASTROMECH,points:2,done:!0,init:function(b){var e=this,f=-1;b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,e,{req:function(b,e){return 0<FCH_focus(b)&&f<round}.bind(b),aiactivate:function(b,e){return!1},f:function(b,m){0<FCH_focus(b,m)&&f<round&&
(this.addevadetoken(),this.log("1 %FOCUS% -> 1 blank, +1 %EVADE% [%0]",e.name),f=round,b-=FCH_FOCUS);return b}.bind(b),str:"focus"})}},{name:"Vectored Thrusters",type:MOD,done:!0,islarge:!1,addedaction:"Roll",points:2},{name:"Tail Gunner",type:CREW,done:!0,limited:!0,points:2,init:function(b){b.wrap_before("resolveattack",this,function(b,f){var e=this.weapons[b];e.isprimary&&3>=e.getauxiliarysector(f)&&"Bilaser"==e.type&&(f.log("-1 defense [%0]",this.name),f.wrap_after("getagility",this,function(b){return 0<
b?b-1:b}).unwrapper("afterdefenseeffect"),f.showstats())})}},{name:"Collision Detector",type:SYSTEM,done:!0,points:0,init:function(b){var e=this;b.wrap_after("canmoveonobstacles",this,function(b,e){return b.match(/DECLOAK|ROLL|BOOST/)?!0:e});b.wrap_after("canhavecriticalocollision",this,function(){this.log("ignoring collision with obstacle [%0]",e.name);return!1})}},{name:"Alliance Overhaul",type:TITLE,done:!0,points:0,ship:"ARC-170",init:function(b){var e=this;b.wrap_after("modifyattackroll",this,
function(b,e,m,h){4>this.weapons[activeweapon].getauxiliarysector(targetunit)&&0<FCH_focus(h)&&(h+=FCH_CRIT-FCH_FOCUS);return h});b.wrap_after("getattackstrength",this,function(b,l,m){return this.weapons[b].isprimary&&this.isinprimaryfiringarc(l)?(this.log("+1 attack die [%0]",e.name),m+1):m});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(b,e){return!this.isinprimaryfiringarc(targetunit)}.bind(b),aiactivate:function(b,e){return 0<FCH_focus(b)},f:function(b,e){return 0<FCH_focus(b)?
(this.log("1 %FOCUS% ->1 %CRIT%"),b-FCH_FOCUS+FCH_CRIT):b}.bind(b),str:"focus"})}},{name:"Concord Dawn Protector",type:TITLE,done:!0,points:1,ship:"Protectorate Starfighter",init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,ADD_M,DEFENSE_M,this,{req:function(b,e){return activeunit.isinfiringarc(this)&&this.isinfiringarc(activeunit)&&1==activeunit.getrange(this)}.bind(b),aiactivate:function(b,e){return!0},f:function(b,l){this.log("+1 %EVADE% [%0]",e.name);return{m:b+FE_EVADE,n:l+1}}.bind(b),
str:"evade"})}},{name:"Fearlessness",type:ELITE,rating:2,done:!0,points:1,faction:SCUM,init:function(b){var e=this;b.wrap_after("modifyattackroll",this,function(b,e,m,h){1==this.getrange(targetunit)&&(h+=FCH_HIT);return h});b.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,e){return targetunit.isinfiringarc(this)&&this.isinfiringarc(targetunit)&&1==targetunit.getrange(this)}.bind(b),aiactivate:function(b,e){return!0},f:function(b,l){this.log("+1 %HIT% [%0]",e.name);return{m:b+FCH_HIT,
n:l+1}}.bind(b),str:"hit"})}},{name:"Seismic Torpedo",type:TORPEDO,points:2,done:!0,firesnd:"missile",isWeapon:function(){return!1},candoaction:function(){return this.isactive&&0<this.unit.selectnearbyobstacle(2).length},action:function(b){var e=this.unit,f=e.selectnearbyobstacle(2);0<f.length&&this.isactive?e.resolveactionselection(f,function(l){f[l].type=NONE;f[l].g.attr({display:"none"});SOUNDS.explode.play();for(var m in squadron){var h=squadron[m];if(1E4>=h.getdist(h.m,f[l])){var q=h.rollattackdie(1,
e,"critical")[0];"hit"==q?(h.log("+1 %HIT% [%0]",this.name),h.resolvehit(1),h.checkdead()):"critical"==q&&(h.log("+1 %CRIT% [%0]",this.name),h.resolvecritical(1),h.checkdead())}}this.desactivate();e.endaction(b,TORPEDO)}.bind(this)):e.endaction(b,TORPEDO)}},{name:"Latts Razzi",type:CREW,faction:SCUM,points:2,unique:!0,done:!0,init:function(b){var e=this;b.adddicemodifier(DEFENSE_M,ADD_M,DEFENSE_M,this,{req:function(b,e){return 0<activeunit.stress},aiactivate:function(b,e){return 0<activeunit.stress},
f:function(b,l){return 0<activeunit.stress?(activeunit.log("-1 stress, +1 %EVADE% for %0 [%1]",e.unit,e.name),activeunit.removestresstoken(),{m:b+FE_EVADE,n:l+1}):{m:b,n:l}},str:"evade"})}},{name:"Ketsu Onyo",type:CREW,faction:SCUM,points:1,unique:!0,done:!0,init:function(b){var e=this;b.wrap_before("endphase",this,function(){var b=this.selectnearbyenemy(2,function(b,e){return 0<b.tractorbeam});0<b.length&&this.selectunit(b,function(b,f){b[f].wrap_after("resettractorbeam",e,function(b){return this.tractorbeam}).unwrapper("beginplanningphase");
b[f].log("keeps %0 tractor beam tokens [%1]",this.tractorbeam,e.name)},["select unit"],!0)})}},{name:"IG-88D",type:CREW,faction:SCUM,points:1,unique:!0,done:!0,init:function(b){for(var e in squadron){var f=squadron[e];f!=b&&1==f.ig2000&&f.isally(b)&&(b.log("copying %0 abilities [%1]",f.name,this.name),f.init.call(b,f))}}},{name:"Rigged Cargo Chute",type:ILLICIT,islarge:!0,points:1,done:!0,candoaction:function(){return this.isactive},action:function(b){var e=this.unit,f=e.getpathmatrix(e.m.clone().rotate(180,
0,0),"F1").translate(40,-20).split(),f=new Rock(MAXROCKS+9,[f.dx,f.dy,f.rotate+90],e.team,OBSTACLES.length);OBSTACLES.push(f);this.desactivate();e.endaction(b,ILLICIT)}},{name:"Black Market Slicer Tools",type:ILLICIT,points:1,done:!0,candoaction:function(){return this.isactive},action:function(b){var e=this,f=e.unit.selectnearbyenemy(2,function(b,e){return 0<e.stress});0<f.length&&this.isactive&&this.unit.selectunit(f,function(b,f){var h=e.unit.rollattackdie(1,e,"blank")[0];if("hit"==h||"critical"==
h)b[f].applydamage(1),b[f].removestresstoken(),b[f].checkdead()},["select unit [%0]",e.name],!1);this.unit.endaction(b,ILLICIT)}},{name:"Gyroscopic Targeting",ship:"Lancer-class Pursuit Craft",type:MOD,points:2,done:!0,init:function(b){var e=this;b.gtmaneuver=-1;b.wrap_before("endmaneuver",this,function(b){b=this.getmaneuver();this.gtmaneuver=-1;b.move.match(/\w+[345]/)&&(this.gtmaneuver=round)});b.wrap_before("endcombatphase",this,function(){this.gtmaneuver==round&&this.donoaction([{org:e,type:"MOD",
name:e.name,action:function(b){this.log("Free moving arc rotation [%0]",e.name);this.resolvearcrotate(b,!0)}.bind(this)}],"",!0)})}},{name:"Shadow Caster",ship:"Lancer-class Pursuit Craft",type:TITLE,points:3,done:!0,unique:!0,init:function(b){var e=this;b.wrap_after("hashit",this,function(b,l){l&&2>=this.weapons[0].getauxiliarysector(b)&&(this.log("+1 tractor beam token [%0]",e.name),b.addtractorbeam(this));return l})}},{name:"Jyn Erso",faction:REBEL,points:2,unique:!0,done:!0,type:CREW,candoaction:function(){return this.isactive&&
!this.unit.dead},action:function(b){var e=this.unit,f=e.selectnearbyally(2),f=f.push(e),l=e.selectnearbyenemy(3,function(b,e){return b.isinfiringarc(e)});0<f.length&&0<l.length?e.resolveactionselection(f,function(m){var h=l.length;3<h&&(h=3);for(var q=0;q<h;q++)f[m].addfocustoken();e.endaction(b,"CREW")}):(e.log("no effect [%0]",this.name),e.endaction(b,"CREW"))}},{name:"Unkar Plutt",faction:SCUM,points:1,type:CREW,done:!0,unique:!0,init:function(b){var e=this;b.unkar=-1;b.wrap_after("getcollidingunits",
this,function(b,l){0<l.length&&this.unkar<round&&(this.unkar=round,this.donoaction([{org:e,type:"CREW",name:e.name,action:function(b){e.unit.log("+1 %HIT%, +1 free action [%0]",e.name);this.resolvehit(1);SOUNDS.explode.play();this.checkdead();this.doaction(this.getactionlist(),"");this.endnoaction(b,"CREW")}.bind(this)}],"",!0));return l})}},{name:"Sabine's Masterpiece",faction:REBEL,ship:"TIE Fighter",unique:!0,done:!0,type:TITLE,upgrades:[CREW,ILLICIT],points:1},{name:"Millennium Falcon(HoR)",faction:REBEL,
ambiguous:!0,ship:"YT-1300",unique:!0,done:!0,type:TITLE,points:1,init:function(b){var e=this;b.wrap_after("getmaneuverlist",this,function(b){if(this.hasionizationeffect())return b;for(var f in b)f.match(/BR3|BL3/)&&(this.log("perform half-turn after a bank [%0]",e.name),b["K"+f]={move:f,difficulty:b[f].difficulty,halfturn:!0});return b});b.wrap_before("completemaneuver",this,function(b,e,m){b.match(/BR3|BL3/)&&1==m&&this.addstress()})}},{name:"Smuggling Compartment",ship:"YT-",type:MOD,limited:!0,
done:!0,points:0,upgrades:[MOD,ILLICIT],maxupg:3},{name:"Burnout Slam",islarge:!0,done:!0,type:ILLICIT,addedaction:"SLAM",points:1,init:function(b){var e=this;b.wrap_after("resolveslam",this,function(){if(e.isactive){var b=e.unit.shipactionList.indexOf("SLAM");e.unit.shipactionList.splice(b,1);e.desactivate()}}.bind(b))}},{name:"Finn",faction:REBEL,points:5,unique:!0,type:CREW,done:!0,init:function(b){b.adddicemodifier(ATTACK_M,ADD_M,ATTACK_M,this,{req:function(b,f){return this.isactive&&this.unit.isinfiringarc(targetunit)}.bind(this),
f:function(b,f){this.unit.log("+1 blank [%0]",this.name);return{m:b,n:f+1}}.bind(this),str:"crew"});b.adddicemodifier(DEFENSE_M,ADD_M,DEFENSE_M,this,{req:function(b,f){return this.isactive&&this.unit.isinfiringarc(activeunit)}.bind(this),f:function(b,f){this.unit.log("+1 blank [%0]",this.name);return{m:b,n:f+1}}.bind(this),str:"crew"})}},{name:"Rey",faction:REBEL,points:2,unique:!0,type:CREW,done:!0,init:function(b){var e=this;e.focus=0;b.wrap_before("endphase",this,function(){this.log("+1 %FOCUS% on %0",
e.name);0<this.focus&&(e.focus++,this.removefocustoken())});b.wrap_before("begincombatphase",this,function(){0<e.focus&&this.donoaction([{org:e,type:"CREW",name:e.name,action:function(b){e.focus--;e.unit.addfocustoken();e.unit.endnoaction(b,"CREW")}}],"",!0)})}},{name:"Black One",points:1,unique:!0,done:!0,ship:"T-70 X-Wing",type:TITLE,skillmin:7,init:function(b){var e=this;b.wrap_after("endaction",this,function(b,l){if("BOOST"==l||"ROLL"==l){var f=this.selectnearbyally(1,function(b,e){for(var f=
0;f<e.istargeted.length;f++)if(!e.istargeted[f].isally(e))return!0;return!1});0<f.length&&this.selectunit(f,function(b,f){for(var h=0;h<b[f].istargeted.length;h++){var l=b[f].istargeted[h];if(!b[f].isally(l)){b[f].log("removing %TARGET% from %0 [%1]",l.name,e.name);l.removetarget(b[f]);break}}},["select unit (or self to cancel) [%0]",e.name],!1)}})}},{name:"Primed Thrusters",points:1,done:!0,islarge:!1,type:TECH,init:function(b){b.wrap_after("isactiondone",this,function(b,f){if(0<this.stress&&"ROLL"!=
b&&"BOOST"!=b)return!0;0<this.stress&&"ROLL"==b&&f&&this.log("can do %ROLL% [%0]");0<this.stress&&"BOOST"==b&&f&&this.log("can do %BOOST% [%0]");return f});b.wrap_after("hasnostresseffect",this,function(){return 3>this.stress})}},{name:"Snap Shot",points:2,type:ELITE,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("doendmaneuveraction",e,function(){var f=[],l;for(l in e.unit.weapons)0<e.unit.weapons[l].getrange(this)&&f.push(e.unit.weapons[l]);0<f.length&&b.doselection(function(b){e.unit.select();
e.unit.wrap_before("selecttargetforattack",e,function(){e.unit.endnoaction(b,"ATTACK")}).unwrapper("selecttargetforattack");e.unit.wrap_after("getdicemodifiers",e,function(){return[]}).unwrapper("cleanupattack");e.unit.wrap_before("cancelattack",e,function(){e.unit.maxfired++;$("#attackdial").hide();e.unit.endnoaction(b,"ATTACK")}).unwrapper("cleanupattack");e.unit.doattack(f,[this])}.bind(this))})}},{name:"M9-G8",type:ASTROMECH,points:3,unique:!0,done:!0,init:function(b){var e=this;b.wrap_after("gettargetableunits",
this,function(b,e){return this.selectnearbyunits(b)});Unit.prototype.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(){return e.isactive&&!e.unit.isally(this)},f:function(b,e){0<FCH_crit(b)?(this.log("1 %CRIT% rerolled [%0]",this.name),b=b-FCH_CRIT+activeunit.attackroll(1)):0<FCH_hit(b)&&(this.log("1 %HIT% rerolled [%0]",this.name),b=b-FCH_HIT+activeunit.attackroll(1));return b},str:"critical"});Unit.prototype.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,this,{req:function(){return e.isactive&&
e.unit.isally(this)},f:function(b,e){0<FCH_blank(b)?(this.log("1 blank rerolled [%0]",this.name),b+=activeunit.attackroll(1)):0<FCH_focus(b)&&!this.canusefocus()&&(this.log("1 %FOCUS% rerolled [%0]",this.name),b=b-FCH_FOCUS+activeunit.attackroll(1));return b},str:"blank"})}},{name:"Pattern Analyzer",type:TECH,points:2},{name:"General Hux",type:CREW,faction:EMPIRE,points:5,unique:!0,done:!0,candoaction:function(){return!0},action:function(b){var e=this.unit,f=e.selectnearbyally(2);0<f.length?(1==f.length?
(new Condition(f[0],e,"Fanatical Devotion"),f[0].addfocustoken(),e.endaction(b,CREW)):2<=f.length?(f.push(e),e.log("select up to 3 units (self to cancel) [%0]",e.name),e.resolveactionselection(f,function(l){f[l]==this&&this.endaction(b,CREW);new Condition(f[l],e,"Fanatical Devotion");f[l].addfocustoken();f.splice(l,1);1<f.length?this.resolveactionselection(f,function(e){f[e]==this&&this.endaction(b,CREW);f[e].addfocustoken();f.splice(e,1);1<f.length?this.resolveactionselection(f,function(e){f[e]==
this&&this.endaction(b,CREW);f[e].addfocustoken();this.endaction(b,CREW)}.bind(this)):this.endaction(b,CREW)}.bind(this)):this.endaction(b,CREW)}.bind(e))):e.endaction(b,CREW),e.addstress()):e.endaction(b,CREW)}},{name:"Kylo Ren",type:CREW,faction:EMPIRE,points:3,unique:!0,done:!0,candoaction:function(){return 0<this.unit.selectnearbyenemy(3).length},action:function(b){var e=this.unit,f=e.selectnearbyenemy(3);this.resolveactionselect(f,function(b){new Condition(f[b],e,"I'll Show You The Dark Side")}.bind(this))}},
{name:"Operations Specialist",type:CREW,points:3,limited:!0,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("endattack",e,function(b,l,m){if(e.isactive&&this.isally(e.unit)&&2>=this.getrange(e.unit)&&0==b+l){var f=this.selectnearbyally(3);0<f.length&&(console.log(e.name+" "+this.name),this.doselection(function(b){this.resolveactionselect(f,function(e){f[e].addfocustoken();this.endnoaction(b,"OP")}.bind(this))}.bind(this)))}})}},{name:"Kylo Ren's Shuttle",type:TITLE,points:2,ship:"Upsilon-Class Shuttle",
unique:!0,done:!0,init:function(b){b.wrap_after("endcombatphase",this,function(){var e=this.selectnearbyenemy(2,function(b,e){return 0==e.stress});0<e.length&&0<e[0].selectnearbyally(3,function(e,l){return 2>=l.getrange(b)&&0==l.stress}).length&&e[0].doselection(function(b){this.resolveactionselect(e,function(f){e[f].addstress();e[0].endnoaction(b,TITLE)})})})}},{name:"Targeting Synchronizer",type:TECH,points:3,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("canusetarget",e,function(b,
l){return e.unit!=this&&e.unit.isally(this)&&2>=e.unit.getrange(this)&&-1<e.unit.targeting.indexOf(b)?!0:l});Unit.prototype.wrap_before("removetarget",e,function(b){e.unit!=this&&e.unit.isally(this)&&2>=e.unit.getrange(this)&&-1==this.targeting.indexOf(b)&&-1<e.unit.targeting.indexOf(b)&&e.unit.removetarget(b)})}},{name:"Hyperwave Comm Scanner",type:TECH,done:!0,points:1,init:function(b){var e=this;b.wrap_after("endsetupphase",this,function(){var b=this.selectnearbyunit(2);if(e.isactive)for(var l in b){var m=
b[l];m.donoaction([{type:"FOCUS",name:e.name,org:e,action:function(b){this.addfocustoken();this.endnoaction(b,"TECH")}.bind(m)},{type:"EVADE",name:e.name,org:e,action:function(b){e.desactivate();this.addevadetoken();this.endnoaction(b,"TECH")}.bind(m)}],"+1 %EVADE% / %FOCUS%",!0)}})}},{name:"A Score To Settle",type:ELITE,points:0,done:!0,init:function(b){var e=this;b.ascoretosettle=e;b.wrap_after("endsetupphase",this,function(){var b=[],l;for(l in squadron)squadron[l].team!=this.team&&b.push(squadron[l]);
0<b.length&&(this.log("select unit for condition [%0]",e.name),this.resolveactionselection(b,function(e){new Condition(b[e],this,"A Debt To Pay")}.bind(this)),this.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,e,{req:function(b,e){return"undefined"!=typeof targetunit.adebttopay?targetunit.adebttopay.isactive:!1},f:function(b,f){this.log("1 %FOCUS% -> 1 %CRIT% [%0]",e.name);return b=b-FCH_FOCUS+FCH_CRIT}.bind(this),str:"focus"}))})}},{name:"Cassian Andor",type:CREW,points:2,faction:REBEL,unique:!0,init:function(b){b.wrap_after("endplanningphase",
this,function(){var b=this.selectnearbyenemy(2);0<b&&this.doselection(function(e){this.resolveactionselect(b,function(e){this.guessmove(b[e].maneuver)}.bind(this))}.bind(this))})}},{name:"Captain Rex",type:CREW,points:2,faction:REBEL,unique:!0,done:!0,init:function(b){var e=this;b.wrap_after("hashit",this,function(b,l){l||(this.log("+1 stress, +1 %FOCUS% [%0]",e.name),this.addfocustoken());return l})}},{name:"EMP Device",unique:!0,type:ILLICIT,points:2,range:[1,1],done:!0,isTurret:function(){return!0},
issecondary:!1,firesnd:"missile",isWeapon:function(){return!0},getenemiesinrange:function(){return[this.unit]},declareattack:function(b){if(!this.isactive)return!1;b=this.unit.selectnearbyunits(1,function(b,f){return b!=f});for(i in b)b[i].addiontoken(),b[i].addiontoken(),b[i].log("+2 %ION% [%0]",this.name);this.isactive=!1;this.unit.cancelattack();return!1},init:function(b){this.toString=Upgrade.prototype.toString}},{name:"Captured TIE",unique:!0,type:MOD,ship:"TIE Fighter",faction:REBEL,points:1,
done:!0,init:function(b){var e=this,f=!1;b.wrap_after("declareattack",function(b,e){e&&(f=!0);return e});b.wrap_after("isenemy",this,function(b,m){return m||!f&&b.getskill()<this.getskill()&&e.isactive})}},{name:"Spacetug Tractor Array",type:MOD,ship:"Quadjumper",points:2,done:!0,candoaction:function(){return this.isactive},action:function(b){var e=this.unit,f=e.selectnearbyunits(1,function(b,e){return b!=e&&b.isinfiringarc(e)});0<f.length?e.resolveactionselection(f,function(e){f[e].addtractorbeam(this);
this.unit.endaction(b,"MOD")}):e.endaction(b,"MOD")}},{name:"Scavenger Crane",type:ILLICIT,points:2,done:!0,init:function(b){var e=this;Unit.prototype.wrap_before("dies",this,function(){if(this!=b&&e.isactive&&2>=b.getrange(this)){for(var f in b.upgrades){var l=b.upgrades[f];if((l.type==TORPEDO||l.type==MISSILE||l.type==BOMB||l.type==CANNON||l.type==TURRET||l.type==MOD)&&0==l.isactive){this.log("%0 active again [%1]",l.name,e.name);l.isactive=!0;break}}"blank"==b.rollattackdie(1)[0]&&e.desactivate()}})}},
{name:"Inspiring Recruit",type:CREW,points:1,done:!0,init:function(b){var e=this;Unit.prototype.wrap_after("removestresstoken",this,function(){this.isally(b)&&2>=this.getrange(b)&&0<this.stress&&(this.log("-1 stress token [%0]",e.name),this.removestresstoken.vanilla.call(this))})}},{name:"Baze Malbus",type:CREW,points:3,unique:!0,done:!0,faction:REBEL,init:function(b){var e=this;b.addattack(function(b,e){return this.weapons[0].isactive&&0==b+e},this,[b.weapons[0]],function(){this.noattack=round},
function(){this.log("+1 attack [%0]",e.name);return this.selectnearbyenemy(3,function(b,e){return e!=targetunit})})}},{name:"Bodhi Rook",type:CREW,points:1,unique:!0,faction:REBEL,done:!0,init:function(b){b.wrap_after("gettargetableunits",this,function(b,f){var e=[],m;for(m in squadron)squadron[m].isally(this)&&(e=e.concat(Unit.prototype.gettargetableunits.vanilla.call(e,3)));return e})}},{name:"Pivot Wing",type:TITLE,points:0,ship:"U-Wing",canbeswitched:!1,done:!0,canswitch:function(){return this.canbeswitched},
"switch":function(){var b=this.unit;this.canbeswitched=!1;this.faceup?("undefined"!=typeof b.getagility.unwrap&&b.getagility.unwrap(this),b.wrap_after("getmaneuverlist",this,function(b){"undefined"!=typeof b.F0&&(b.F0r={move:b.F0.move,difficulty:b.F0.difficulty,halfturn:!0});return b}),this.variant="Landing"):("undefined"!=typeof b.getmaneuverlist.unwrap&&b.getmaneuverlist.unwrap(this),b.wrap_after("getagility",this,function(b){return b+1}),this.variant="Attack");this.faceup=!this.faceup},init:function(b){var e=
this;this["switch"]();this.unit.wrap_before("endmaneuver",this,function(){e.canbeswitched=!0})}},{name:"Adaptive Ailerons",type:TITLE,points:0,ship:"TIE Striker",done:!0,init:function(b){var e=this;b.adaptive=-1;"undefined"==typeof b.facultativeailerons&&(b.facultativeailerons=!1);b.wrap_after("premove",this,function(){var b=["F1","BR1","BL1"],e=this.moves[0];this.facultativeailerons||(this.moves=[]);this.moves=this.moves.concat([this.getpathmatrix(e,b[0]),this.getpathmatrix(e,b[1]),this.getpathmatrix(e,
b[2])])});b.wrap_before("beginactivation",this,function(){for(var b=this.maneuver,l=this.getdial(),m=[],h=[],q=0;q<l.length;q++)l[q].move.match(/F1|BL1|BR1/)&&(m.push(this.getpathmatrix(this.m,l[q].move)),h.push(q));this.adaptive<round&&(this.adaptive=round,this.donoaction([{org:e,type:"TITLE",name:e.name,action:function(f){this.wrap_after("candoendmaneuveraction",this,function(){return!1}).unwrapper("cleanupmaneuver");this.wrap_after("getdial",this,function(b){for(var e=[],f=0;f<b.length;f++)e[f]=
{move:b[f].move,difficulty:"WHITE"};return e}).unwrapper("endmaneuver");this.wrap_before("cleanupmaneuver",e,function(){this.maneuver=b;this.cleanupmaneuver.unwrap(e);this.endnoaction(f,"TITLE");this.hasmoved=!1;this.newlock().done(function(){this.newlock().done(nextactivation);nextactivation()}.bind(this))});this.resolveactionmove(m,function(b,e){this.maneuver=h[e];this.resolvemaneuver()}.bind(this),!1,!0)}.bind(this)}],"",this.facultativeailerons))})}},{name:"Swarm Leader",unique:!0,points:3,type:ELITE,
done:!0,init:function(b){var e=this;b.wrap_after("preattackroll",this,function(b,l){var f=this.selectnearbyally(3,function(b,e){return e.canuseevade()&&e.isinfiringarc(l)?!0:!1}),h=0;0<f.length&&(h++,f[0].removeevadetoken());1<f.length&&(h++,f[1].removeevadetoken());this.log("+%1 attack die [%0]",h,e.name);this.wrap_after("getattackstrength",this,function(b,e,f){return f+h}).unwrapper("attackroll")})}},{name:"Lightweight Frame",type:MOD,points:2,agilitymax:3,ship:"TIE",done:!0,init:function(b){var e=
this;b.wrap_after("predefenseroll",this,function(b,l){getattackdice()>getdefensedice()&&(this.log("+1 defense roll [%0]",e.name),this.wrap_after("getagility",e,function(b){return b+1}).unwrapper("dodefenseroll"))})}},{name:"'Light Scyk' Interceptor",type:TITLE,points:-2,ship:"M3-A Interceptor",lostupgrades:[MOD],done:!0,init:function(b){this.deal=function(b,e){return $.Deferred().resolve({crit:b,face:FACEUP})};var e=[];b.installed=!0;b.wrap_after("getdial",this,function(b){if(0==e.length)for(var f=
0;f<b.length;f++){var m=b[f].move,h=b[f].difficulty;m.match(/BL\d|BR\d/)&&(h="GREEN");e[f]={move:m,difficulty:h}}return e})}},{name:"Hotshot Co-Pilot",type:CREW,points:4,done:!0,init:function(b){var e=this,f=function(){if(this.canusefocus()){this.log("- %0 %FOCUS% [%1]",this.focus,e.name);for(var b=0;b<this.focus;b++)this.removefocustoken()}};b.wrap_before("resolveattack",this,function(b,m){this.weapons[b].isprimary&&m.wrap_before("endmodifydefensestep",e,f)});b.wrap_before("isattackedby",this,function(b,
m){m.wrap_before("endmodifyattackstep",e,f)})}},{name:"Trick Shot",type:ELITE,points:0,done:!0,init:function(b){var e=this;b.wrap_after("getattackstrength",this,function(b,l,m){0<this.getobstructiondef(l)&&(this.log("obstructed attack => +1 die [%0]",e.name),m+=1);return m})}},{name:"Bistan",type:CREW,points:2,unique:!0,done:!0,faction:REBEL,init:function(b){b.wrap_after("modifyattackroll",this,function(b,f,l,m){2>=this.getrange(targetunit)&&(m=m+FCH_CRIT-FCH_HIT);return m});b.adddicemodifier(ATTACK_M,
MOD_M,ATTACK_M,this,{req:function(e,f){return 2>=b.getrange(targetunit)}.bind(this),aiactivate:function(b,f){return!0},f:function(b,f){0<FCH_hit(b)&&(this.unit.log("%HIT% -> %CRIT% [%0]",this.name),b=b+FCH_CRIT-FCH_HIT);return b}.bind(this),str:"hit"})}},{name:"Expertise",type:ELITE,rating:2,points:4,done:!0,init:function(b){b.wrap_after("modifyattackroll",this,function(b,f,l,m){0==this.stress&&FCH_focus(m)&&(m+=(FCH_HIT-FCH_FOCUS)*FCH_focus(m));return m});b.adddicemodifier(ATTACK_M,MOD_M,ATTACK_M,
this,{req:function(e,f){return 0==b.stress}.bind(this),aiactivate:function(b,f){return 0<FCH_focus(b)},f:function(b,f){0<FCH_focus(b)&&(this.unit.log("%FOCUS% -> %HIT% [%0]",this.name),b+=FCH_focus(b)*(FCH_HIT-FCH_FOCUS));return b}.bind(this),str:"focus"})}},{name:"BoShek",type:CREW,points:2},{name:"Pulse Ray Shield",type:MOD,faction:"REBEL|SCUM",points:2,init:function(b){var e=this;b.wrap_before("endphase",this,function(){this.donoaction([{org:e,type:"SHIELD",name:e.name,action:function(b){e.unit.log("+1 %ION%, +1 %SHIELD% [%0]",
e.name);e.unit.addiontoken();e.unit.addshield(1);this.endnoaction(b,"SHIELD")}.bind(this)}],"",!0)})}},{name:"Arc Caster",type:CANNON,faction:"REBEL|SCUM",range:[1,1],attack:4,canbeswitched:function(){return!1},points:2},{name:"Cikatro Vizago",type:CREW,unique:!0,faction:"SCUM",points:0},{name:"Jabba The Hutt",unique:!0,done:!0,takesdouble:!0,type:CREW,faction:"SCUM",points:5,init:function(b){for(var e in squadron)if(squadron[e].team==b.team){var f=squadron[e],l;for(l in f.upgrades)f.upgrades[l].type==
ILLICIT&&(f.log("x2 %0 [%1]",f.upgrades[l].name,this.name),f.upgrades[l].ordnance=!0)}}}];var allunits=[];function Team(b){this.team=b;this.initiative=this.isia=this.isdead=!1;this.units=[];this.conditions={};this.captain=null;this.faction="REBEL";this.allhits=this.allcrits=this.allevade=this.allred=this.allgreen=0}
Team.prototype={setia:function(){for(var b in squadron)if(squadron[b].team==this.team){for(var e in IAUnit.prototype)squadron[b][e]=IAUnit.prototype[e];squadron[b].IAinit()}this.ia=!0},setplayer:function(){for(var b in squadron)if(squadron[b].team==this.team)for(var e in IAUnit.prototype)"undefined"!=typeof Unit.prototype[e]&&(squadron[b][e]=Unit.prototype[e]);this.ia=!1},setfaction:function(b){$(".listunits .generic").remove();this.faction=b;$("#"+b+"select").prop("checked",!0);this.color="REBEL"==
this.faction?RED:"EMPIRE"==this.faction?GREEN:YELLOW},changefaction:function(b,e){$("#rocks").hide();$("#debris").hide();$("#caroussel").show();if(this.faction!=b||1==e){for(var f in generics)generics[f].team==this.team&&delete generics[f];$("#totalpts").html(0);this.setfaction(b);displayfactionunits()}},setrocks:function(b){this.rocks="undefined"==typeof b?[-1,-1,-1]:b},displayrockdebris:function(b,e,f,l,m,h,q){var t=b%MAXROCKS+(b>=MAXROCKS?ROCKS.length:0),w=m[t].getBBox();e=b<MAXROCKS?MT(b*e/ROCKS.length+
e/ROCKS.length/4,f/4-w.height*l/2).scale(l,l):MT((b-MAXROCKS)*e/DEBRISCLOUD.length+e/DEBRISCLOUD.length/4,3*f/4-w.height*l/2).scale(l,l);m[t].transform(e);m[t].appendTo(h);m[t].hover(function(){m[t].attr({strokeWidth:12})},function(){m[t].attr({strokeWidth:3})});m[t].click(function(){var e=this.rocks.indexOf(b);if(-1<e)this.rocks[e]=-1,m[t].attr("fill",q);else{-1==this.rocks[0]?this.rocks[0]=b:-1==this.rocks[1]?this.rocks[1]=b:-1==this.rocks[2]&&(this.rocks[2]=b);if(-1<this.rocks[0]&&-1<this.rocks[1]&&
-1<this.rocks[2])for(e=0;3>e;e++){var f=OBSTACLES[e+3*(this.team-1)];f.g.remove();OBSTACLES[e+3*(this.team-1)]=new Rock(this.rocks[e],[f.tx,f.ty,f.alpha],this.team,e)}-1<this.rocks.indexOf(b)&&m[t].attr("fill",halftone(this.color))}}.bind(this))},selectrocks:function(){"undefined"==typeof this.rocks&&(this.rocks=[-1,-1,-1]);$(".aster").empty();for(var b=Snap(".aster"),e=[],f=b.g(),l=0,m=0,h=b.image(DEBRISIMG,0,0,256,256).pattern(0,0,256,256),q=b.image(ROCKIMG,0,0,256,256).pattern(0,0,256,256),t=0;t<
ROCKS.length+DEBRISCLOUD.length;t++){t<ROCKS.length?(e[t]=b.path(ROCKS[t]).attr({strokeWidth:3}),-1<this.rocks.indexOf(t)?e[t].attr({fill:halftone(this.color),stroke:this.color}):e[t].attr({fill:q,stroke:"#888"})):(e[t]=b.path(DEBRISCLOUD[t-ROCKS.length]).attr({strokeWidth:3}),-1<this.rocks.indexOf(t)?e[t].attr({fill:halftone(this.color),stroke:this.color}):e[t].attr({fill:h,stroke:"#888"}));var w=e[t].getBBox();l<w.width&&(l=w.width);m<w.height&&(m=w.height)}b=$(".aster").height();w=$(".aster").width();
m=b/2/m;w/l/ROCKS.length<m&&(m=w/l/ROCKS.length);for(t=0;t<ROCKS.length;t++)this.displayrockdebris(t,w,b,m,e,f,q);for(t=0;t<DEBRISCLOUD.length;t++)this.displayrockdebris(t+MAXROCKS,w,b,m,e,f,h)},checkdead:function(){var b,e=!0;for(b=0;b<this.units.length;b++)if(!this.units[b].dead){e=!1;break}return this.isdead=e},toggleplayer:function(b){this.isia=!this.isia},updatepoints:function(){var b=0;$("#listunits li").each(function(){var e=0;$(this).find(".pts").each(function(){e+=parseInt($(this).text())});
$(this).find(".upts span:first-child").html(e);b+=e});$(".upts span:nth-child(2)").html(b)},addunit:function(b){-1==b&&log("unknown addunit pilot "+pilots[b]);b=new Unit(this.team,b);$("#listunits").append(""+b);this.updatepoints()},tosquadron:function(b){var e=[],f,l,e=this.sortedgenerics(),m=0,h=0;for(f in generics)1==generics[f].team&&m++;this.captain=null;for(f=0;f<e.length;f++)if(this.team==e[f].team){e[f].id=h++;2==e[f].team&&(e[f].id+=m);var q=e[f];for(l in PILOTS[q.pilotid]){var t=PILOTS[q.pilotid];
"function"==typeof t[l]&&(q[l]=t[l])}q.tosquadron(b);allunits.push(q);squadron.push(q);this.units.push(q)}for(f in squadron)q=squadron[f],q.team==this.team&&"function"==typeof q.init&&q.init();for(f in squadron)if(q=squadron[f],q.team==this.team)for(l=0;l<q.upgrades.length;l++)b=q.upgrades[l],0<=b.id&&"function"==typeof UPGRADES[b.id].uninstall&&UPGRADES[b.id].uninstall(q),"function"==typeof b.install&&b.install(q);for(f in squadron)if(q=squadron[f],q.team==this.team)for(l=0;l<q.upgrades.length;l++)b=
q.upgrades[l],"function"!=typeof b.init||q.isdocked||b.init(q);this.units.sort(function(b,e){return e.getskill()-b.getskill()});this.history={title:{text:UI_translation["Damage taken per turn"]},axisX:{interval:1,title:UI_translation.Turns},axisY:{title:UI_translation["Cumulated damage"]},rawdata:[],data:[{indexLabelFontColor:"darkSlateGray",name:"views",type:"area",color:"rgba(200,10,10,0.8)",markerSize:8,dataPoints:[]}]};return this.units},endsetup:function(){var b;for(b=0;b<this.units.length;b++)this.units[b].g.undrag()},
endselection:function(b){var e=this.team;this.name=$("#teamname"+this.team).val();""==this.name&&(this.name="Squad #"+e);$("#team"+e).empty();$("#importexport"+e).remove();sq=this.tosquadron(b);for(b=0;b<sq.length;b++){if(1==e){if(0>=sq[b].tx||0>=sq[b].ty)sq[b].tx=80-(sq[b].islarge?20:0),sq[b].ty=70+82*b,sq[b].alpha=90;$("#team1").append('<div id="'+sq[b].id+'" onclick=\'select($(this).attr("id"))\'>'+sq[b]+"</div>")}else{if(0>=sq[b].tx||0>=sq[b].ty)sq[b].tx=820+(sq[b].islarge?20:0),sq[b].ty=70+82*
b,sq[b].alpha=-90;$("#team2").append('<div id="'+sq[b].id+'" onclick=\'select("'+sq[b].id+"\")'>"+sq[b]+"</div>")}sq[b].m.translate(sq[b].tx,sq[b].ty).rotate(sq[b].alpha,0,0);sq[b].show()}$("#team"+e).css("top",$("nav").height()+2);activeunit=sq[0]},sortedgenerics:function(){var b=[],e;for(e in generics)generics[e].team==this.team&&b.push(generics[e]);b.sort(function(b,e){"undefined"==typeof b.points&&log("undefined score");return b.points<e.points?-1:b.points>e.points?1:b.toJuggler(!1)<e.toJuggler(!1)});
return b},toASCII:function(){for(var b="",e=this.sortedgenerics(),f=0;f<e.length;f++)b+=e[f].toASCII()+";";return b},toKey:function(){var b="",e=[],f;for(f in generics)generics[f].team==this.team&&e.push(generics[f]);e.sort(function(b,e){return b.pilotid-e.pilotid});for(f=0;f<e.length;f++)b+=e[f].toKey()+";";return b},toJSON:function(){var b={description:""};b.faction={REBEL:"rebels",SCUM:"scum",EMPIRE:"empire"}[this.faction];b.name=this.name;for(var e=[],f=0,l=this.sortedgenerics(),m=0;m<l.length;m++){var h=
l[m].toJSON(),f=f+h.points;e.push(h)}b.pilots=e;this.points=b.points=f;b.vendor={xwsbenchmark:{builder:"Squadron Benchmark",builder_url:"http://xws-bench.github.io/bench/"}};b.version="0.3.0";return b},toJuggler:function(b,e){for(var f="",l=this.sortedgenerics(),m=0;m<l.length;m++)f+=l[m].toJuggler(b,e)+"\n";return f},parseJuggler:function(b,e){var f,l,m,h;f=-1;var q=function(b){return"REBEL"==b?1:"SCUM"==b?2:4};f=7;if(""!=b){var t=b.trim().split("\n");for(l in generics)generics[l].team==this.team&&
delete generics[l];for(l=0;l<t.length;l++){var w=t[l].split(/\s+\+\s+/),y=0;for(m=0;m<PILOTS.length;m++){var v=PILOTS[m].name;h=translate(v);var z="";1==PILOTS[m].ambiguous&&"undefined"!=typeof PILOTS[m].edition&&(z="("+PILOTS[m].edition+")");h+=z;v+=z;v.replace(/\'/g,"")==w[0]&&(y|=q(PILOTS[m].faction));h.replace(/\'/g,"")==w[0]&&(y|=q(PILOTS[m].faction))}f&=y}this.faction=1==(f&1)?"REBEL":2==(f&2)?"SCUM":"EMPIRE";this.color="REBEL"==this.faction?RED:"EMPIRE"==this.faction?GREEN:YELLOW;for(l=0;l<
t.length;l++){f=-1;w=t[l].split(/\s+\+\s+/);for(m=0;m<PILOTS.length;m++)if(h=v=PILOTS[m].name,z="",PILOTS[m].faction==this.faction){h=translate(v);1==PILOTS[m].ambiguous&&"undefined"!=typeof PILOTS[m].edition&&(z="("+PILOTS[m].edition+")");v+=z;h+=z;if(v.replace(/\'/g,"")==w[0]){f=m;break}if(h.replace(/\'/g,"")==w[0]){f=m;e=!0;break}}-1==f&&console.log("pid undefined:"+e+"!!"+w[0]+"!!"+this.faction);-1==f&&log("unknown Juggler pilot:"+t[l]+"/"+b);v=new Unit(this.team,f);v.upg=[];for(m=0;10>m;m++)v.upg[m]=
-1;"undefined"==typeof v.pilotid&&(console.log(f+" "+v.name+" "+v.pilotid),console.trace());z=[TITLE,MOD].concat(PILOTS[v.pilotid].upgrades);for(m=1;m<w.length;m++)for(h=0;h<UPGRADES.length;h++){if((1==e&&translate(UPGRADES[h].name).replace(/\'/g,"").replace(/\(Crew\)/g,"")==w[m]||UPGRADES[h].name.replace(/\'/g,"")==w[m])&&-1<z.indexOf(UPGRADES[h].type)){"undefined"!=typeof UPGRADES[h].upgrades&&("Cannon|Torpedo|Missile"==UPGRADES[h].upgrades[0]?(z=z.concat([CANNON,TORPEDO,MISSILE]),v.upgradetype=
v.upgradetype.concat([CANNON,TORPEDO,MISSILE])):(z=z.concat(UPGRADES[h].upgrades),v.upgradetype=v.upgradetype.concat(UPGRADES[h].upgrades)));break}h==UPGRADES.length&&log("UPGRADE undefined: "+w[m])}for(m=1;m<w.length;m++)for(h=0;h<UPGRADES.length;h++)if(1==e&&translate(UPGRADES[h].name).replace(/\'/g,"").replace(/\(Crew\)/g,"")==w[m]||UPGRADES[h].name.replace(/\'/g,"")==w[m])if(-1<z.indexOf(UPGRADES[h].type)){for(f=0;f<v.upgradetype.length;f++)if(v.upgradetype[f]==UPGRADES[h].type&&-1==v.upg[f]){v.upg[f]=
h;break}break}else log("** "+w[m]+" UPGRADE not listed: "+UPGRADES[h].type+" in "+v.name+"/"+b)}}},parseASCII:function(b){b=b.split(";");for(var e in generics)generics[e].team==this.team&&delete generics[e];for(e=0;e<b.length-1;e++){var f=b[e].split(":"),l=f[0].split(","),m=parseInt(l[0],10);this.faction=PILOTS[m].faction;this.color="REBEL"==this.faction?RED:"EMPIRE"==this.faction?GREEN:YELLOW;-1==m&&log("unknown ASCII pilot "+b[e]);m=new Unit(this.team,m);m.upg=[];for(var h=0;10>h;h++)m.upg[h]=-1;
for(h=1;h<l.length;h++){for(var q=parseInt(l[h],10),t=0;t<m.upgradetype.length;t++)if(m.upgradetype[t]==UPGRADES[q].type&&-1==m.upg[t]){m.upg[t]=q;break}m.upg[t]==q&&"undefined"!=typeof UPGRADES[q].upgrades&&(m.upgradetype="Cannon|Torpedo|Missile"==UPGRADES[q].upgrades[0]?m.upgradetype.concat([CANNON,TORPEDO,MISSILE]):m.upgradetype.concat(UPGRADES[q].upgrades))}1<f.length&&(f=f[1].split(","),m.tx=parseInt(f[0],10),m.ty=parseInt(f[1],10),m.alpha=parseInt(f[2],10))}},parseJSON:function(b,e){var f,l=
{rebel:REBEL,scum:SCUM,imperial:EMPIRE};try{f="string"==typeof b?$.parseJSON(b):b,ga("send","event",{eventCategory:"social",eventAction:"receive",eventLabel:"xws"})}catch(B){return this.parseJuggler(b,e)}var m,h,q;this.name=f.name;this.points=f.points;this.faction=l[f.faction];this.color="REBEL"==this.faction?RED:"EMPIRE"==this.faction?GREEN:YELLOW;for(m in generics)generics[m].team==this.team&&delete generics[m];for(m=0;m<f.pilots.length;m++){var t=f.pilots[m],w,l=-1;t.team=this.team;null!=t.name.match(/-/)&&
(t.name=t.name.split("-")[0]);for(h=0;h<PILOTS.length;h++)if(PILOTS[h].faction==this.faction&&PILOTS[h].unit==PILOT_dict[t.ship]&&(va=PILOTS[h].name,va==PILOT_dict[t.name])){l=h;break}if(-1==l)throw"pid undefined:"+PILOT_dict[t.name]+"-"+t.name+"/"+this.faction+"/"+PILOT_dict[t.ship];w=new Unit(this.team,l);w.upg=[];for(h=0;10>h;h++)w.upg[h]=-1;if("undefined"!=typeof t.upgrades){var y=0;for(h in t.upgrades){var v=t.upgrades[h];for(q=0;q<v.length;q++){y++;for(var z=0;z<UPGRADES.length;z++)if(UPGRADES[z].name==
UPGRADE_dict[v[q]]){for(l=0;l<w.upgradetype.length;l++)if(w.upgradetype[l]==UPGRADES[z].type&&-1==w.upg[l]){w.upg[l]=z;break}break}}}}}}};var a1=[.25,.375];a1[10]=.125;a1[100]=.25;var d1=[.375,.375];d1[10]=.25;function addattackdice(b,e){var f,l,m,h,q=[];for(f=0;f<b;f++)for(m=0;m<b-f;m++)for(l=0;l<b-m-f;l++)h=100*f+m+10*l,q[h]=0,q[h+1]=0,q[h+10]=0,q[h+100]=0;for(f=0;f<b;f++)for(m=0;m<b-f;m++)for(l=0;l<b-m-f;l++)h=100*f+m+10*l,q[h]+=e[h]*a1[0],q[h+1]+=e[h]*a1[1],q[h+10]+=e[h]*a1[10],q[h+100]+=e[h]*a1[100];return q}
function adddefensedice(b,e){var f,l,m,h=[];for(f=0;f<b;f++)for(l=0;l<b-f;l++)m=10*f+l,h[m]=0,h[m+1]=0,h[m+10]=0;for(f=0;f<b;f++)for(l=0;l<b-f;l++)m=10*f+l,h[m]+=e[m]*d1[0],h[m+1]+=e[m]*d1[1],h[m+10]+=e[m]*d1[10];return h}function attackproba(b){var e,f=[];f[0]=a1[0];f[1]=a1[1];f[10]=a1[10];f[100]=a1[100];for(e=2;e<=b;e++)f=addattackdice(e,f);return f}function defenseproba(b){var e,f=[];f[0]=d1[0];f[1]=d1[1];f[10]=d1[10];for(e=2;e<=b;e++)f=adddefensedice(e,f);return f}
function attackwithreroll(b,e,f){var l,m,h,q,t,w,y,v,z=[];if(0==b.reroll||"undefined"==typeof b.reroll)return e;for(l=0;l<=f;l++)for(m=0;m<=f-l;m++)for(h=0;h<=f-m-l;h++)y=100*l+m+10*h,z[y]=0;var B,E;for(l=0;l<=f;l++)for(m=0;m<=f-l;m++)for(h=0;h<=f-m-l;h++)if(y=100*l+m+10*h,q=f-m-h-l,E=b.reroll,B=l,b.reroll>q&&(0==b.focus?b.reroll>l+q?(E=l+q,B=0):B=l-(E-q):E=q),0==E)z[y]+=e[y];else for(q=0;q<=E;q++)for(t=0;t<=E-q;t++)for(w=0;w<=E-q-t;w++)v=100*q+t+10*w,k=100*(B+q)+m+t+10*(h+w),z[k]+=e[y]*ATTACK[E][v];
return z}function defendwithreroll(b,e,f){var l,m,h,q,t,w,y=[];if(0==b.reroll||"undefined"==typeof b.reroll)return e;for(l=0;l<=f;l++)for(m=0;m<=f-l;m++)y[10*l+m]=0;var v,z;for(l=0;l<=f;l++)for(m=0;m<=f-l;m++)if(t=10*l+m,h=f-m-l,z=b.reroll,v=l,b.reroll>h&&(0==b.focus?b.reroll>l+h?(z=l+h,v=0):v=l-(z-h):z=h),0==z)y[t]+=e[t];else for(h=0;h<=z;h++)for(q=0;q<=z-h;q++)w=10*h+q,k=10*(v+h)+m+q,y[k]+=e[t]*DEFENSE[z][w];return y}
function tohitproba(b,e,f,l,m,h,q,t){var w=[],y,v,z,B,E,D,K,J,L,H=0,F=0,G=0,I,Q=m,O=h;m=0==q?[]:m;for(v=0;v<=h;v++)for(z=0;z<=h-v;z++)D=v+10*z,w[D]=0;"undefined"==typeof t&&(t=!1);if("undefined"==typeof l)return{proba:[],tohit:0,meanhit:0,meancritical:0,tokill:0};0<q&&(Q=defendwithreroll(f,m,q));for(y=0;y<=h;y++)for(v=0;v<=h-y;v++)for(z=0;z<=h-v-y;z++){J=FCH_FOCUS*y+FCH_CRIT*z+FCH_HIT*v;var S,V,la=b.focus,ta=b.reroll;"undefined"!=typeof b.attackrerolls&&(b.reroll=Math.max(b.attackrerolls(e,f),b.reroll));
I=attackwithreroll(b,l,h);var Z=I[FCH_FOCUS*y+FCH_HIT*v+FCH_CRIT*z];J=e.modifyattackroll(J,h,f);"undefined"!=typeof b.modifyattackroll&&(J=b.modifyattackroll(J,h,f));B=FCH_focus(J);I=FCH_crit(J);J=FCH_hit(J);0<b.focus&&0<B&&(J+=B,b.focus--);for(S=0;S<=q;S++)for(V=0;V<=q-S;V++){var na=f.evade,qa=f.focus;D=FE_FOCUS*S+FE_EVADE*V;B=0==q?1:Q[D];"undefined"!=typeof b.modifydefenseroll&&(D=b.modifydefenseroll(b,D,q));E=FE_focus(D);L=FE_evade(D);D=0;0<f.focus&&0<E&&L<J+I&&(L+=E,f.focus--);0<f.evade&&L<J+
I&&(L+=1,f.evade--);"undefined"!=typeof f.cancelhit?(D=f.cancelhit({ch:J*FCH_HIT+I*FCH_CRIT,e:L},targetunit),D=f.cancelcritical(D,targetunit),D=D.ch):(J>L?(D=FCH_HIT*(J-L),L=0):L-=J,I>L&&(D+=FCH_CRIT*(I-L)));"function"==typeof e.modifyhit&&0<D&&(D=e.modifyhit(D));b.reroll=0;if("function"==typeof e.followupattack&&0==t)for(K in E=tohitproba(b,e,f,l,m,h,q,!0),O=2*h,E.proba)L=D+1*K,"undefined"==typeof w[L]&&(w[L]=0),w[L]+=E.proba[K]*Z*B;else w[D]+=Z*B;f.focus=qa;f.evade=na}b.focus=la;b.reroll=ta}for(v=
0;v<=O;v++)for(z=0;z<=O-v;z++)D=FCH_HIT*v+FCH_CRIT*z,0<D&&"undefined"!=typeof w[D]&&(H+=w[D]),F+=v*w[D],G+=z*w[D];return{proba:w,tohit:Math.floor(1E4*H)/100,meanhit:0==H?0:Math.floor(100*F)/100,meancritical:0==H?0:Math.floor(100*G)/100}};var cmd=[],startreplayall=function(){if(0!=REPLAY.length){try{FAST="W"!=REPLAY.substr(-1)&&window.self==window.top,window.self!=window.top&&console.log("REPLAY in FRAME: "+FAST)}catch(b){FAST=!1}ANIM=REPLAY;cmd=LZString.decompressFromEncodedURIComponent(decodeURI(window.location.search.substr(1))).split("&")[6].split("_");cmd.splice(0,1);if(0!=cmd.length){$(".nextphase").prop("disabled",!0);$(".unit").css("cursor","pointer");actionrlock=$.Deferred();actionrlock.progress(replayall);1==TEAMS[1].isia&&
TEAMS[1].setia();1==TEAMS[2].isia&&TEAMS[2].setia();subphase=ACTIVATION_PHASE;for(i in squadron)squadron[i].hasmoved=!1,squadron[i].maneuver=-1,squadron[i].hasdecloaked=!1;replayall()}}},stopreplay=function(){actionrlock=$.Deferred()},restartreplay=function(){ga("send","event",{eventCategory:"interaction",eventAction:"replay",eventLabel:"replay"});actionrlock=$.Deferred();actionrlock.progress(replayall);replayall()},replayall=function(){if(""==cmd){FAST=!1;filltabskill();if(phase!=SETUP_PHASE)setphase();
else{$(".imagebg").hide();$(".nextphase").prop("disabled",!1);for(var b=0;b<OBSTACLES.length;b++)OBSTACLES[b].addDrag();1==TEAMS[1].isia&&TEAMS[1].setplayer();1==TEAMS[2].isia&&TEAMS[2].setplayer();displayplayertype(1);displayplayertype(2)}INREPLAY=!1}else{INREPLAY=!0;var e=cmd[0].split("-");console.log(cmd[0]);cmd.splice(0,1);var f=null,l;if(0<e[0].length){f=parseInt(e[0],10);for(l in squadron)if(squadron[l].id==f)break;if(squadron[l].id==f)f=squadron[l];else{console.log("cannot find id "+f);actionrlock.notify();
return}}var m={fo:"removefocustoken",FO:"addfocustoken",e:"removeevadetoken",E:"addevadetoken",ct:"removecloaktoken",CT:"addcloaktoken",i:"removeiontoken",I:"addiontoken",tb:"removetractorbeamtoken",TB:"addtractorbeamtoken",ST:"addstress",DPY:"deploy",st:"removestresstoken",d:"dies"};if("string"==typeof m[e[1]])b=Unit.prototype[m[e[1]]],"function"==typeof b.vanilla?b.vanilla.call(f,h):b.call(f),actionrlock.notify();else switch(e[1]){case "W":break;case "P":r=parseInt(e[2],10);phase=parseInt(e[3],
10);if(round!=r)for(b in $("#turnselector").append("<option value='"+round+"'>"+UI_translation["turn #"]+round+"</option>"),round=r,squadron)f=squadron[b],f.focus=Unit.prototype.resetfocus.call(f),f.evade=Unit.prototype.resetevade.call(f),f.tractorbeam=Unit.prototype.resettractorbeam.call(f),f.showinfo();phase==SETUP_PHASE+1&&1==r&&endsetupphase();$("#phase").html(UI_translation["turn #"]+round+" "+UI_translation["phase"+phase]);actionrlock.notify();break;case "L":FAST?actionrlock.notify():(b=decodeURIComponent(e[2].substring(2,
e[2].length-2)),f.setinfo(b).delay(1500).fadeOut(400),setTimeout(function(){actionrlock.notify()},2E3));break;case "t":for(l in squadron)if(squadron[l].id==parseInt(e[2],10))break;if(squadron[l].id!=parseInt(e[2],10)){console.log("cannot find target "+e[2]);actionrlock.notify();break}var h=squadron[l];"function"==typeof Unit.prototype.removetarget.vanilla?Unit.prototype.removetarget.vanilla.call(f,h):Unit.prototype.removetarget.call(f,h);actionrlock.notify();break;case "T":for(l in squadron)if(squadron[l].id==
parseInt(e[2],10))break;if(squadron[l].id!=parseInt(e[2],10)){console.log("cannot find target "+e[2]);actionrlock.notify();break}h=squadron[l];"function"==typeof Unit.prototype.addtarget.vanilla?Unit.prototype.addtarget.vanilla.call(f,h):Unit.prototype.addtarget.call(f,h);actionrlock.notify();break;case "R":f.setarcrotate(parseInt(e[2],10));actionrlock.notify();break;case "s":Unit.prototype.removeshield.call(f,parseInt(e[2],10));f.show();actionrlock.notify();break;case "S":Unit.prototype.addshield.call(f,
parseInt(e[2],10));f.show();actionrlock.notify();break;case "h":Unit.prototype.removehull.call(f,parseInt(e[2],10));f.show();actionrlock.notify();break;case "H":Unit.prototype.addhull.call(f,parseInt(e[2],10));f.show();actionrlock.notify();break;case "f":f.select();for(l in squadron)if(squadron[l].id==parseInt(e[2],10))break;squadron[l].id!=parseInt(e[2],10)?(console.log("cannot find target unit "+e[2]),actionrlock.notify()):(targetunit=squadron[l],f.activeweapon=parseInt(e[3],10),FAST||f.playfiresnd(),
setTimeout(function(){actionrlock.notify()},FAST?0:1E3));break;case "am":f.select();f.m=(new Snap.Matrix).translate(e[2]-300,e[3]-300).rotate(e[4],0,0);f.g.transform(f.m);f.geffect.transform(f.m);actionrlock.notify();break;case "c":(new Critical(f,parseInt(e[2],10))).faceup();actionrlock.notify();break;case "D":f.upgrades[parseInt(e[2],10)].desactivate();actionrlock.notify();break;case "m":f.select();var h=e[2],q=parseInt(e[4],10),t=f.m,w=P[h].path;if(FAST){f.m=f.getmatrixwithmove(t,w,q);f.m.rotate(parseFloat(e[3],
0,0),0,0);f.g.transform(f.m);f.geffect.transform(f.m);actionrlock.notify();break}SOUNDS[f.ship.flysnd].play();Snap.animate(0,q,function(b){b=this.getmatrixwithmove(t,w,b);this.g.transform(b);this.geffect.transform(b)}.bind(f),TIMEANIM*q/200,mina.linear,function(){this.m=this.getmatrixwithmove(t,w,q);this.m.rotate(parseFloat(e[3]),0,0);this.g.transform(this.m);this.geffect.transform(this.m);actionrlock.notify()}.bind(f));break;default:console.log("unknown cmd:"+e[1]),FAST=!1,filltabskill(),setphase(phase==
SETUP_PHASE)}}};var phase=1,subphase=0,round=1,skillturn=0,tabskill,VERSION="v0.99",LANG="en",ENGAGED=!1,FILTER="none",DECLOAK_PHASE=1,WEBSITE="http://xws-bench.github.io/bench/index.html",DICES="focusred hitred criticalred blankred focusgreen evadegreen blankgreen".split(" "),SETUP_PHASE=2,PLANNING_PHASE=3,ACTIVATION_PHASE=4,COMBAT_PHASE=5,SELECT_PHASE=1,CREATION_PHASE=6,XP_PHASE=7,MAIN_PHASE=0,BOMBS=[],ROCKDATA="",WINCOND=0,INREPLAY=!1,allunits=[],PILOT_translation,SHIP_translation,CRIT_translation,UI_translation,
UPGRADE_translation,PILOT_dict,UPGRADE_dict,RATINGS_upgrades,RATINGS_ships,RATING_pilots,TOP_squads,CC,actionr=[],actionrlock,HISTORY=[],replayid=0,dice=1,ATTACK=[],DEFENSE=[],SEARCHINGSQUAD,FACTIONS={rebel:"REBEL",empire:"EMPIRE",scum:"SCUM"},SQUADLIST,SCENARIOLIST,TEAMS=[new Team(0),new Team(1),new Team(2),new Team(3)],currentteam=TEAMS[0],teamtarget=0,VIEWPORT,ANIM="",SETUP,SHOWDIAL=[],TRACE=!1,TEMPLATES={},FE_EVADE=1,FE_FOCUS=10,FCH_HIT=1,FCH_FOCUS=100,FCH_CRIT=10,HEADER="",SCENARIOTITLE="",WAVEFILTER=
"0",UNITFILTER={},ACTIONFILTER={},MOVEFILTER={},TEXTFILTER="",COSTFILTER=50,UNIQUE=[],stype="",REPLAY="",PERMALINK="",SCENARIOS={"Battle of Yavin, the final":{text:"Here you are, Red 5, in the trench leading to the exhaust port. Destroy it ! Beware of the Imperial squad on your tail and of the ionization turrets. You have less than 12 turns.",link:"GQVgNAjA7AbAXBATFCZEA4AsYC0BOABgG5wDJYF0U1lcJ1jTz4II9EwQBmbYxcCCCiQuwvBDi1EXGGEJF+kISLETFXLmXm0Q6JcIii5EqOAzh58ZDGzI9+YsGAAzAIYAbAM4BTYABcAJwBXXwARb1c-AAtPP1cApwAhSL93bwACAHtndIBNVwA3AEsAOzB06IznUo9gAAlvAIyAT0yg9PjvcoAlbwATdPB00oqojMDvEoBjKPS01z7SgHMKzNGM7wAPKNcg2PSAB0yAvwA6dPDYgMzm4b90gEJ0xO8Ad06snMr0gEkAWwOjSKHnSngAjkEFlkSulWkEAhVXEV3B0SgNsuthpkSkUAF6RIrYirwpp+TznXJtdI7AoZNKeTyjVwwpDEgIlcnpACyrlu32cxymGQARhlXkVorCqQ9gEggA",
wincond:12},"A secret trench":{text:"A new death star has been built! There's a secret trench that leads to an exhaust port. You must destroy it before turn 10, take your best pilot with an agile ship.",link:"GQVgNAjALAHAXAZgAwCYwJWgnEg3OaeEKANjBCTAFod9JY4B2GRsKLa2ghhV2GMF3rwIJNIyisqUELhJwYINIrQ08wYADMAhgBsAzgFNgAFwBOAV2MARQ9pMALfSe1mUGgIIACIwGMzhiZe5oYAdr4OwN6hhgDuXgAmdo4+LmZeDtr6XgBGhmG5FgCWuiYAhF4AKg6GAQDk2do+hv6BwQHhDsGZQbp2CdkmAPZe2qFehgAemRbOXgAOQ2YmAHReAJpDFl4AtrNBSc5mQwCeXkVBeZpLhsEWZuMcwdoA1rcnW+l5c-MlQ0GxC5dMajADmJVu+gcRXmawAstozo5btczL5bnkvICUh9tmVgBAkEA",
wincond:10},"The Pirate Magic Roundabout":{link:"GQRgTAzANCAsAcMAMEBcBWJBOKmDsUAtCBOgNzjRyIgqoRYhQNhSzmUwLJrvQR4kULEgqQuNOuybowOQiLLAIYWMxVtWo2INy6sOeGVkF0cGDjDGAbAVhJryKNbIQSbLFUewysLIjlDHHRgADMAQwAbAGcAU2AAFwAnAFd4gBFY0NiAOwATWKTgYAAVAAtYgAIABQBLJPCEqoBZcIBzWoBjSoAlAHsU-PCAIwGE4ABBUKakyvDKyL6ctsqywYSoSoBPAcrQ2pyoyK29gfzKhIrKgAd6xqqc2OiEgDpKzOekvpPL2IBbOaRSIAQkqACFYgB3cJJKp9UIXK7hZ6FPq1PLRF7AJBAA",text:"After a long hunt, you finally find the pirate nest. Destroy all of them!",wincond:0},"Asteroid Field":{link:"GQFgHANCAMEEwHYBcYFwgZgKwEYIFoBOaAbnClkRThHkMIOLMhnmTBqh3SNODlR1a+AGy1SGaJA4iCI9CJJYQ6BGFn4wtOEpwIo9AoLAkBsEdB4h9cHErhYIOMBgJYb0YADMAhgBsAZwBTYAAXACcAVxCAYT8fAICASwBjAEJgYABBANCg8IB7JIATAAIvJKC-YuAYqICAC1LQhqSA0oAHSIA7AE9S8KCAIyrygvCUoIA6UoAVBqD+1uKg0qTu5oXShLzCktKhyNDSgBlxsoA1HxXw0oB3H27Q9u6C0qCADxTI4IzoIA",
text:"Crush this puny rebel force. They hide in the asteroid but Lord Vader wants no excuse!",wincond:0}},SETUPS={Classic:{background:"css/playmat10.jpg",zone1:"M 0 0 L 100 0 100 900 0 900 Z",zone2:"M 800 0 L 900 0 900 900 800 900 Z",playzone1:"M 0 0 L 900 0 900 900 0 900 Z",asteroids:6},"Cloud City":{background:"css/playmat6.jpg",zone1:"M 0 0 L 100 0 100 900 0 900 Z",zone2:"M 800 0 L 900 0 900 900 800 900 Z",playzone1:"M 0 0 L 900 0 900 900 0 900 Z",asteroids:6},"Blue Sky":{background:"css/playmat13.jpg",
zone1:"M 0 0 L 100 0 100 900 0 900 Z",zone2:"M 800 0 L 900 0 900 900 800 900 Z",playzone1:"M 0 0 L 900 0 900 900 0 900 Z",asteroids:0},"Blue Planet":{background:"css/playmat11.jpg",zone1:"M 0 0 L 100 0 100 900 0 900 Z",zone2:"M 800 0 L 900 0 900 900 800 900 Z",playzone1:"M 0 0 L 900 0 900 900 0 900 Z",asteroids:6},Mars:{background:"css/playmat14.jpg",zone1:"M 0 0 L 100 0 100 900 0 900 Z",zone2:"M 800 0 L 900 0 900 900 800 900 Z",playzone1:"M 0 0 L 900 0 900 900 0 900 Z",asteroids:6},Defender:{playzone1:"M 0 0 L 900 0 900 900 0 900 Z",
playzone2:"M340,450a110,110 0 1,0 220,0a110,110 0 1,0 -220,0",background:"css/playmat10.jpg",zone2:"M340,450a110,110 0 1,0 220,0a110,110 0 1,0 -220,0",zone1:"M 0 0 L 100 0 100 900 0 900 Z",asteroids:12},Deathstar:{playzone1:"M 0 200 L 1300 200 1300 400 1800 400 1800 200 2800 200 2800 360 1960 360 1960 560 1100 560 1100 360 0 360 Z",background:"css/deathstar.png",pattern:"css/deathstar2.png",zone2:"M 0 200 L 100 200 100 360 0 360 Z",zone1:"M 500 200 L 600  200 600 360 500 360 Z",asteroids:0},Deathstar2:{playzone1:"M 12.241 24.907 L 803.813 24.907 C 861.372 36.696 884.737 73.238 873.908 134.534 C 867.964 168.18 604.249 421.618 188.337 459.88 C 57.346 471.931 307.368 724.082 701.233 804.672 C 746.071 813.845 823.307 826.148 873.908 822.354 C 883.509 821.635 888.068 844.03 887.586 889.544 C 887.569 891.228 727.43 885.923 407.173 873.629 C 243.345 867.341 68.391 771.86 15.662 523.532 C -7.502 414.436 60.669 277.644 241.335 293.67 C 518.775 318.28 758.698 119.655 747.395 113.317 C 747.395 113.317 509.751 112.728 34.467 111.549 C 6.27 111.48 -1.138 82.599 12.241 24.907 Z",
background:"css/deathstar.png",pattern:"css/deathstar2.png",zone1:"M 12 24 L 140 24 140 110 12 110 Z",zone2:"M 0 0",asteroids:0}};function setSetup(b){"undefined"!=typeof SETUPS[b]?(SETUP=SETUPS[b],SETUP.name=b):(SETUP=SETUPS.Classic,SETUP.name="Classic");"undefined"==typeof SETUP.playzone2&&(SETUP.playzone2=SETUP.playzone1)}function sleep(b){for(var e=(new Date).getTime(),f=0;1E7>f&&!((new Date).getTime()-e>b);f++);}
function changeimage(b){if(b.files&&b.files[0]){var e=new FileReader;e.onload=function(b){var e=ZONE[0].getBBox();b=s.image(b.target.result,0,0,e.w,e.h).pattern(0,0,e.w,e.h);ZONE[0].attr({fill:b,fillOpacity:1})};e.readAsDataURL(b.files[0])}}
function center(){var b=activeunit.g.getBBox(),e=b.x+b.width/2,f=b.y+b.height/2,b=$("#svgout").width(),l=$("#svgout").height(),m=0,h=0;l>b?h=(l-b)/2:m=(b-l)/2;var q=Math.min(b/900,l/900),t=m+VIEWPORT.m.x(e,f)*q,e=h+VIEWPORT.m.y(e,f)*q;VIEWPORT.m.invert();if(0>t||t>b)VIEWPORT.m=MT((-t+b/2-m)/q,0).add(VIEWPORT.m);if(0>e||e>l)VIEWPORT.m=MT(0,(-e+l/2-h)/q).add(VIEWPORT.m);VIEWPORT.transform(VIEWPORT.m);activeunit.show()}
var AIstats=function(b,e,f){if("undefined"!=typeof f.rows)for(b=1;b<f.rows.length;b+=200){e=0;for(var l=1;200>l&&l+b<f.rows.length;l++){var m=f.rows[b+l].cellsArray[0].split(" "),h=m[0].split(":"),q=h[0],h=h[1],t=m[1].split(":"),m=t[0],t=t[1],w=0,y=0;m!=q&&("Player"==m?y+=parseInt(t,10):w+=parseInt(t,10),parseInt(h,10),e++)}}},mk2split=function(b){b=b.split(".");for(var e=[],f=!1,l=1;l<b.length;l++)b[l].match(/_II.*/)?(e.push(b[l-1]+"."+b[l]),b[l]=null,f=!1):(b[l-1]&&e.push(b[l-1]),f=!0);f&&e.push(b[b.length-
1]);return e},save=function(){movelog("W");var b=WEBSITE+"?"+permalink(!1);$(".social").html(Mustache.render(TEMPLATES.social,{url:b,name:"save this link",encodedurl:encodeURI(b)}));"undefined"!=typeof gapi&&"undefined"!=typeof gapi.client&&"undefined"!=typeof gapi.client.urlshortener?gapi.client.urlshortener.url.insert({longUrl:b}).then(function(b){b=b.result.id;$(".tweet").show();$("#submission").contents().find("#entry_245821581").val(b);$("#submission").contents().find("#ss-form").submit();$(".social").html(Mustache.render(TEMPLATES.social,
{url:b,name:b,encodedurl:encodeURI(b)}))},function(b){$("#submission").contents().find("#ss-form").submit();console.log("Error: "+b.result.error.message)}):$("#submission").contents().find("#ss-form").submit()},myCallbacksl=function(b,e,f){if(null!=f&&"undefined"!=typeof f.rows)for(b=1;b<f.rows.length;b++)try{myTemplatesl(b,f.rows[b].cellsArray,null,null)}catch(l){}},myTemplate=function(b){b=b.cellsArray;var e=b[0].split(" ");if(!(2>e.length)){var f=e[0].split(":"),l=f[0],f=f[1],e=e[1].split(":"),
m=e[0],h=e[1],q=b[1].split("VS"),t=mk2split(q[0]),w=mk2split(q[1]),y=e="",v="",z="";if(q[0]==SEARCHINGSQUAD)var q=h,B=m,h=t,t=w,w=h,h=f,m=l,f=q,l=B;for(q=0;q<t.length-1;q++)y+=t[q].replace(/\*/g," + ").replace(/_/g," ")+"\n",e+=t[q].replace(/\*/g," + ").replace(/_/g," ")+"<br>";for(q=0;q<w.length-1;q++)z+=w[q].replace(/\*/g," + ").replace(/_/g," ")+"\n",v+=w[q].replace(/\*/g," + ").replace(/_/g," ")+"<br>";TEAMS[2].parseJuggler(y,!1);"en"!=LANG&&(e=TEAMS[2].toJuggler(!0).replace(/\n/g,"<br>"));TEAMS[1].parseJuggler(z,
!1);"en"!=LANG&&(v=TEAMS[1].toJuggler(!0).replace(/\n/g,"<br>"));f=""+f;h=""+h;for(t=0;3>t;t++)3>f.length&&(f="0"+f),3>h.length&&(h="0"+h);"Player"==m&&(h="<b>"+h+"</b>");"Player"==l&&(f="<b>"+f+"</b>");l=b[2].split("?");m=LZString.decompressFromEncodedURIComponent(decodeURI(l[1]));w=m.split("&");if("W"!=w[6].split(-1)){m="";for(t=0;t<w.length;t++)m+=(0<t?"&":"")+w[t];l[0]=WEBSITE;src=l[0]+"?"+LZString.compressToEncodedURIComponent(m)}else src=b[2];$("#squadbattlediv").html(Mustache.render(TEMPLATES["combat-display"],
{s1:e,s2:v,score:h+" - "+f}));$("#replay").attr("src",src);return""}},computeurl=function(b,e,f){b=[];if("undefined"!=typeof f.rows)for(var l=1;l<f.rows.length;l++){var m=f.rows[l].cellsArray[0].split("VS");e=mk2split(m[0]);for(var m=mk2split(m[1]),h="",q="",t=0;t<e.length-1;t++)h+=e[t].replace(/\*/g," + ").replace(/_/g," ")+"\n";try{TEAMS[1].parseJuggler(h,!1);for(t=0;t<m.length-1;t++)q+=m[t].replace(/\*/g," + ").replace(/_/g," ")+"\n";TEAMS[2].parseJuggler(q,!1)}catch(w){}for(t in generics)"undefined"==
typeof b[generics[t].pilotid]&&(b[generics[t].pilotid]=0),b[generics[t].pilotid]++}for(l in b)console.log(PILOTS[l].name+":"+b[l])};
function translate(b){return"undefined"!=typeof PILOT_translation[b]&&"undefined"!=typeof PILOT_translation[b].name?PILOT_translation[b].name:"undefined"!=typeof PILOT_translation[b+" (Scum)"]&&"undefined"!=typeof PILOT_translation[b+" (Scum)"].name?PILOT_translation[b+" (Scum)"].name:"undefined"!=typeof UPGRADE_translation[b]&&"undefined"!=typeof UPGRADE_translation[b].name?UPGRADE_translation[b].name:"undefined"!=typeof UPGRADE_translation[b+"(Crew)"]&&"undefined"!=typeof UPGRADE_translation[b+
"(Crew)"].name?UPGRADE_translation[b+"(Crew)"].name:"undefined"!=typeof CRIT_translation[b]&&"undefined"!=typeof CRIT_translation[b].name?CRIT_translation[b].name:b}
function formatstring(b){return b.replace(/%HIT%/g,"<code class='hit'></code>").replace(/%ACTION%/g,"<b>Action:</b>").replace(/%STRESS%/g,"<code class='xstresstoken'></code>").replace(/%CRIT%/g,"<code class='critical'></code>").replace(/%EVADE%/g,"<code class='symbols'>e</code>").replace(/%FOCUS%/g,"<code class='symbols'>f</code>").replace(/%SHIELD%/g,"<code class='cshield'></code>").replace(/%HULL%/g,"<code class='chull'></code>").replace(/%ROLL%/g,"<code class='symbols'>r</code>").replace(/%TURNLEFT%/g,
"<code class='symbols'>4</code>").replace(/%TURNRIGHT%/g,"<code class='symbols'>6</code>").replace(/%BOOST%/g,"<code class='symbols'>b</code>").replace(/%ELITE%/g,"<code class='symbols'>E</code>").replace(/%ION%/g,"<code class='xionizedtoken'></code>").replace(/%BOMB%/g,"<code class='symbols'>B</code>").replace(/%STRAIGHT%/g,"<code class='symbols'>8</code>").replace(/%STOP%/g,"<code class='symbols'>5</code>").replace(/%TARGET%/g,"<code class='symbols'>l</code>").replace(/%TORPEDO%/g,"<code class='symbols'>P</code>").replace(/%CANNON%/g,
"<code class='symbols'>C</code>").replace(/%SYSTEM%/g,"<code class='symbols'>S</code>").replace(/%ILLICIT%/g,"<code class='symbols'>I</code>").replace(/%MISSILE%/g,"<code class='symbols'>M</code>").replace(/%TURRET%/g,"<code class='symbols'>U</code>").replace(/%BANKLEFT%/g,"<code class='symbols'>7</code>").replace(/%BANKRIGHT%/g,"<code class='symbols'>9</code>").replace(/%UTURN%/g,"<code class='symbols'>2</code>").replace(/%SLOOPLEFT%/g,"<code class='symbols'>1</code>").replace(/%SLOOPRIGHT%/g,"<code class='symbols'>3</code>").replace(/%TALONLEFT%/g,
"<code class='symbols'>;</code>").replace(/%TALONRIGHT%/g,"<code class='symbols'>:</code>").replace(/%ASTROMECH%/g,"<code class='symbols'>A</code>").replace(/%CREW%/g,"<code class='symbols'>W</code>").replace(/%MOD%/g,"<code class='symbols'>m</code>").replace(/%SLAM%/g,"<code class='symbols'>s</code>")}
function displayplayertype(b,e){TEAMS[b].isia?($("#player"+b+" option[value='computer']").prop("selected",!0),$("#player"+b+" option[value='computer']").text(UI_translation.computer)):($("#player"+b+" option[value='human']").prop("selected",!0),$("#player"+b+" option[value='human']").text(UI_translation.human));$("#playerteam"+b).text({REBEL:"x",EMPIRE:"y",SCUM:"z"}[TEAMS[b].faction])}
function nextunit(b,e,f,l){var m,h=!1,q=0;if(0>skillturn||12<skillturn)return f();for(m=0;m<tabskill[skillturn].length;m++){var t=tabskill[skillturn][m];if(b(t)&&1!=t.isdocked){h=!0;q=m;break}}if(!h){do if(e(tabskill),q=0,0<=skillturn&&12>=skillturn){for(;q<tabskill[skillturn].length&&(1==tabskill[skillturn][q].isdocked||!b(tabskill[skillturn][q]));)q++;q==tabskill[skillturn].length&&(q=-1)}while(0<=skillturn&&12>=skillturn&&-1==q)}if(0>skillturn||12<skillturn||-1==q)return f();barrier(function(){active=
q;tabskill[skillturn][q].select();l()})}function endphase(){for(var b in squadron)squadron[b].endphase();for(b in OBSTACLES)"undefined"!=typeof OBSTACLES[b].endphase&&OBSTACLES[b].endphase()}
function nextcombat(){nextunit(function(b){return b.canfire()},function(b){var e=!1;0<=skillturn&&skillturn--;for(var f=0;f<b[skillturn+1].length;f++){var l=b[skillturn+1][f];l.canbedestroyed(skillturn)&&l.checkdead()&&(e=!0)}e&&(b=TEAMS[1].checkdead(),e=TEAMS[2].checkdead(),b&&e?win(0):b?win(1):e&&win(2))},function(){return enablenextphase()},function(){activeunit.beginattack();activeunit.doattack()})}
function nextactivation(){nextunit(function(b){return b.candomaneuver()},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.beginactivation();activeunit.doactivation()})}function nextdecloak(){nextunit(function(b){return b.candecloak()},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.dodecloak()})}
function nextplanning(){nextunit(function(b){return-1==b.maneuver},function(){13>skillturn&&skillturn++},function(){return enablenextphase()},function(){activeunit.select();activeunit.doplan()})}function getattackresult(){var b=$(".hitreddice").length,e=$(".criticalreddice").length;return FCH_CRIT*e+FCH_HIT*b}function getdefenseresult(){return $(".evadegreendice").length+$(".evadegreen").length}function addattackdie(b,e){for(var f=0;f<e;f++)$("#attack").append("<td class="+b+"reddice'></td>")}
function adddefensedie(b,e){for(var f=0;f<e;f++)$("#defense").append("<td class="+b+"greendice'></td>")}function getattackdice(){return $(".focusreddice").length+$(".criticalreddice").length+$(".hitreddice").length+$(".blankreddice").length}function getattackvalue(){return $(".focusreddice").length*FCH_FOCUS+$(".criticalreddice").length*FCH_CRIT+$(".hitreddice").length*FCH_HIT}function getdefensedice(){return $(".focusgreendice").length+$(".blankgreendice").length+$(".evadegreendice").length}
function displaycombatdial(){$("#attackdial").empty();$("#dtokens").empty();$("#defense").empty();$("#combatdial").show()}
function addredclickchange(){var b=function(){$(this).hasClass("focusreddice")?($(this).removeClass("focusreddice"),$(this).addClass("hitreddice")):$(this).hasClass("blankreddice")?($(this).removeClass("blankreddice"),$(this).addClass("focusreddice")):$(this).hasClass("hitreddice")?($(this).removeClass("hitreddice"),$(this).addClass("criticalreddice")):$(this).hasClass("criticalreddice")&&($(this).removeClass("criticalreddice"),$(this).addClass("blankreddice"))};$(".focusreddice").click(b);$(".hitreddice").click(b);
$(".blankreddice").click(b);$(".criticalreddice").click(b)}
function displayattackroll(b,e){var f,l=0;for(f=0;f<DICES.length;f++)$("."+DICES[f]+"dice").remove();$("#attack").empty();for(f=0;f<Math.floor(b/100)%10;f++,l++)$("#attack").append("<td class='focusreddice'></td>");for(f=0;f<Math.floor(b/10)%10;f++,l++)$("#attack").append("<td class='criticalreddice'></td>");for(f=0;f<b%10;f++,l++)$("#attack").append("<td class='hitreddice'></td>");for(f=l;f<e;f++)$("#attack").append("<td class='blankreddice'></td>");addredclickchange()}
function displayattacktokens(b,e){$("#atokens").empty();var f=targetunit.getresultmodifiers(b.ar,b.ad,DEFENSE_M,ATTACK_M);0<f.length?($("#atokens").append(f),$("#atokens").append($("<button>").addClass("m-done").click(function(){displayattacktokens2(b,e)}))):displayattacktokens2(b,e)}
function displayattacktokens2(b,e){"function"!=typeof e?e=b.lastaf:b.lastaf=e;$("#atokens").empty();var f=b.getresultmodifiers(b.ar,b.ad,ATTACK_M,ATTACK_M);0<f.length?($("#atokens").append(f),$("#atokens").append($("<button>").addClass("m-done").click(function(){$("#atokens").empty();this.endmodifyattackstep();e(this)}.bind(b)))):e(b)}
function displaydefensetokens(b,e){$("#dtokens").empty();var f=activeunit.getresultmodifiers(b.dr,b.dd,ATTACK_M,DEFENSE_M);0<f.length?($("#dtokens").append(f),$("#dtokens").append($("<button>").addClass("m-done").click(function(){displaydefensetokens2(b,e)}))):displaydefensetokens2(b,e)}
function displaydefensetokens2(b,e){"function"!=typeof e&&(e=b.lastdf);b.lastdf=e;$("#dtokens").empty();var f=b.getresultmodifiers(b.dr,b.dd,DEFENSE_M,DEFENSE_M);FAST?displaycompareresults(b,e):($("#dtokens").append(f),$("#dtokens").append($("<button>").addClass("m-fire").click(function(){this.endmodifydefensestep();displaycompareresults(activeunit,e)}.bind(b))))}
function displaycompareresults(b,e){"function"!=typeof e&&(e=b.lastdf);b.lastdf=e;$("#dtokens").empty();dm=targetunit.getresultmodifiers(targetunit.dr,targetunit.dd,ATTACKCOMPARE_M,DEFENSE_M);am=b.getresultmodifiers(b.ar,b.ad,ATTACKCOMPARE_M,ATTACK_M);FAST||0==dm.length&&0==am.length?($("#combatdial").hide(),e()):($("#dtokens").append(dm).append(am),$("#dtokens").append($("<button>").addClass("m-fire").click(function(){$("#combatdial").hide();e()}.bind(b))))}
function FE_focus(b){return Math.floor(b/10)%10}function FE_evade(b){return b%10}function FE_blank(b,e){return e-FE_evade(b)-FE_focus(b)}function FCH_hit(b){return b%10}function FCH_focus(b){return Math.floor(b/100)%10}function FCH_crit(b){return Math.floor(b/10)%10}function FCH_blank(b,e){return e-FCH_crit(b)-FCH_focus(b)-FCH_hit(b)}function costfilter(b){COSTFILTER="undefined"==typeof b?10:parseInt(b,10);displayfactionunits(!0)}function wavefilter(b){WAVEFILTER=b;displayfactionunits(!0)}
function unitfilter(b){"undefined"!=typeof UNITFILTER[b]?delete UNITFILTER[b]:UNITFILTER[b]=!0;displayfactionunits(!0)}function actionfilter(b){"undefined"!=typeof ACTIONFILTER[b]?delete ACTIONFILTER[b]:ACTIONFILTER[b]=!0;displayfactionunits(!0)}function textfilter(b){TEXTFILTER=b;displayfactionunits(!0)}
function addroll(b,e,f){if(f==DEFENSE_M)return addrolld(b,e);f=getattackdice();var l=$(".focusreddice").length,m=$(".hitreddice").length,h=$(".criticalreddice").length;b=b(100*l+10*h+m,f);displayattackroll(b.m,b.n);$("#atokens #mod"+e).remove()}function addrolld(b,e){var f=getdefensedice(),l=$(".focusgreendice").length,m=$(".evadegreendice").length,f=b(10*l+m,f);displaydefenseroll(f.m,f.n);$("#dtokens #mod"+e).remove()}
function modroll(b,e,f){if(f==DEFENSE_M)return modrolld(b,e);f=getattackdice();var l=$(".focusreddice").length,m=$(".hitreddice").length,h=$(".criticalreddice").length;b=b(100*l+10*h+m,f);displayattackroll(b,f);$("#atokens #mod"+e).remove()}function modrolld(b,e){var f=getdefensedice(),l=$(".focusgreendice").length,m=$(".evadegreendice").length,l=b(10*l+m,f);displaydefenseroll(l,f);$("#dtokens #mod"+e).remove()}
function addgreenclickchange(){var b=function(){$(this).hasClass("focusgreendice")?($(this).removeClass("focusgreendice"),$(this).addClass("evadegreendice")):$(this).hasClass("blankgreendice")?($(this).removeClass("blankgreendice"),$(this).addClass("focusgreendice")):$(this).hasClass("evadegreendice")&&($(this).removeClass("evadegreendice"),$(this).addClass("blankgreendice"))};$(".focusgreendice").click(b);$(".evadegreendice").click(b);$(".blankgreendice").click(b)}
function displaydefenseroll(b,e){var f,l=0;$("#defense").empty();for(f=0;f<Math.floor(b/10);f++,l++)$("#defense").append("<td class='focusgreendice'></td>");for(f=0;f<b%10;f++,l++)$("#defense").append("<td class='evadegreendice'></td>");for(f=l;f<e;f++)$("#defense").append("<td class='blankgreendice'></td>");addgreenclickchange()}
function reroll(b,e,f,l,m){var h,q,t=0,w=["blank","focus","hit","critical"],y=["blank","focus","evade"];"function"==typeof l.f&&l.f();var v="";if(f==ATTACK_M){for(h=0;4>h;h++)if((!activeunit.hasnorerollmodifiers(e,f,getattackvalue(),getattackdice(),"focus")||"undefined"!=typeof l.mustreroll||"focus"!=w[h])&&-1<l.dice.indexOf(w[h]))if(q=$("."+w[h]+"reddice:not([noreroll])"),q.length<b)q.remove(),v+=("<span class='"+w[h]+"reddice'></span>").repeat(q.length),t+=q.length,b-=q.length;else{$("."+w[h]+"reddice:lt("+
b+"):not([noreroll])").remove();v+=("<span class='"+w[h]+"reddice'></span>").repeat(b);t+=b;b=0;break}v+=" -> ";$("#atokens #reroll"+m).remove();b=activeunit.rollattackdie(t);for(h=0;h<t;h++)v+="<span class='"+b[h]+"reddice'></span>",$("#attack").append("<td class='"+b[h]+"reddice' noreroll></td>");addredclickchange()}else{for(h=0;3>h;h++)if(("undefined"!=typeof l.mustreroll||!targetunit.hasnorerollmodifiers(e,f,getattackvalue(),getattackdice(),"focus")||"focus"!=w[h])&&-1<l.dice.indexOf(y[h]))if(q=
$("."+y[h]+"greendice:not([noreroll])"),q.length<b)q.remove(),t+=q.length,b-=q.length;else{$("."+w[h]+"greendice:lt("+b+"):not([noreroll])").remove();t+=b;b=0;break}$("#dtokens #reroll"+m).remove();activeunit.defenseroll(t).done(function(b){var e;for(e=0;e<FE_evade(b.roll);e++)$("#defense").append("<td class='evadegreendice'></td>");for(e=0;e<FE_focus(b.roll);e++)$("#defense").append("<td class='focusgreendice'></td>");for(e=0;e<FE_blank(b.roll,b.dice);e++)$("#defense").append("<td class='blankgreendice'></td>");
addgreenclickchange()})}}function next_replay(){var b=[];0<REPLAY.length&&(b=REPLAY[replayid].split("_"));return b}
function enablenextphase(){var b,e=!0;switch(phase){case SELECT_PHASE:b=parseInt($("#squad1points").text(),10);var f=parseInt($("#squad2points").text(),10);if(mode==FREECOMBAT&&(0==b||0==f)||mode==SCENARIO&&(0==b||0==$("#scenariolist tr.selected").length)||mode==SCENARIOCREATOR&&(0==f||""==SCENARIOTITLE||""==HEADER))e=!1,$(".nextphase").addClass("disabled");break;case PLANNING_PHASE:for(b in squadron)if(0>squadron[b].maneuver&&!squadron[b].isdocked){e=!1;break}e&&$(".nextphase").hasClass("disabled")&&
log(UI_translation["All units have planned a maneuver, ready to end phase"]);break;case ACTIVATION_PHASE:if(subphase!=ACTIVATION_PHASE){subphase=ACTIVATION_PHASE;skillturn=0;e=!1;for(b in squadron)squadron[b].enddecloak().done(nextactivation);barrier(nextactivation)}else{for(b in squadron)if(-1<squadron[b].maneuver&&!squadron[b].isdocked){e=!1;break}e&&$(".nextphase").hasClass("disabled")&&log(UI_translation["All units have been activated, ready to end phase"])}break;case COMBAT_PHASE:if(0>skillturn){$("#attackdial").hide();
for(b in squadron)squadron[b].endcombatphase();log(UI_translation["No more firing units, ready to end phase."]);barrier(endphase);e=!0}else e=!1}e&&$(".nextphase").removeClass("disabled");return e&&FAST&&phase>=SETUP_PHASE?nextphase():e}
function win(b){log("Team %0 was destroyed!",b);movelog("W");var e="m-draw",f,l="",m="",h=0,q=0,t=!1,w=!1;for(f=0;f<allunits.length;f++){var y=allunits[f];y.dead||1!=y.team||(t=!0);y.dead||2!=y.team||(w=!0);if(y.dead||y.islarge&&y.shield+y.hull<(y.ship.hull+y.ship.shield)/2){var v=y.dead?y.points:y.points/2;1==y.team?(m+="<tr><td>"+y.name+(y.dead?"":" (1/2 points)")+"</td><td>"+v+"</td></tr>",q+=v):(l+="<tr><td>"+y.name+(y.dead?"":" (1/2 points)")+"</td><td>"+v+"</td></tr>",h+=v)}}0==t&&(q=100);0==
w&&(h=100);""==l&&(l="<tr><td class='m-nocasualty'></td><td>0</td></tr>");""==m&&(m="<tr><td class='m-nocasualty'></td><td>0</td></tr>");t=h-q;h=t+100;q=100-t;$(".victory-table").empty();$(".victory-table").append("<tr><th class='m-squad1'></th><th>"+h+"</th></tr>");$(".victory-table").append(l);$(".victory-table").append("<tr><th class='m-squad2'></th><th>"+q+"</th></tr>");$(".victory-table").append(m);if(0<t&&0>WINCOND||2==b&&(WINCOND>round||0==WINCOND))e="m-1win";else if(0>t&&0>WINCOND||1==b&&
(WINCOND>round||0==WINCOND))e="m-2win";$(".victory").addClass(e);b=(TEAMS[1].isia?"Computer":"Player")+":"+h+" "+(TEAMS[2].isia?"Computer":"Player")+":"+q;e=TEAMS[1].toJuggler(!1);e+="VS"+TEAMS[2].toJuggler(!1);e=e.replace(/\n/g,".");e=e.replace(/ \+ /g,"*");e=e.replace(/ /g,"_");l=encodeURI(WEBSITE+"?"+permalink(!1));$("#submission").contents().find("#entry_209965003").val(b);$("#submission").contents().find("#entry_390767903").val(e);$("#submission").contents().find("#entry_245821581").val("no short url");
$("#submission").contents().find("#entry_1690611500").val(l);$(".tweet").hide();save();for(f in["email","facebook","tweet","googlep"])(function(b){$("."+b).click(function(){ga("send","event",{eventCategory:"social",eventAction:"send",eventLabel:b})})})(f);$(".victory-link").attr("href",l);window.location="#modal"}function page_creation(){$("#selectphase").hide();$(".headlines").hide();$("#creation").show()}
function page_main(){$("#addcomment").hide();$(".buttonbar .share-buttons").hide();$(".h2 .share-buttons").show();$(".permalink").hide();$(".activeunit").prop("disabled",!0);$("#rightpanel").hide();$("#leftpanel").hide();$("#game").hide();$("nav").hide();$(".mainarticle").hide();$(".headlines").show();SCENARIOTITLE=HEADER="";currentteam.setfaction("REBEL");window.location="index.html"}
function page_select(){$("#creation").hide();$("nav").hide();$("#game").hide();$("#rightpanel").hide();$("#leftpanel").hide();$("#selectphase").show();$(".nextphase").addClass("disabled");enablenextphase();phase=SELECT_PHASE}
function createsquad(b){page_creation();var e=currentteam.faction;"undefined"!=typeof b&&(e=b);$(".activeunit").prop("disabled",!0);$("#consolecb").removeAttr("Checked");currentteam.changefaction(e);$(".factionselect selected").val(e);b={getdial:function(){return[{move:"TL1",difficulty:"WHITE"},{move:"BL1",difficulty:"WHITE"},{move:"F1",difficulty:"WHITE"},{move:"SL2",difficulty:"WHITE"},{move:"TL2",difficulty:"WHITE"},{move:"BL2",difficulty:"WHITE"},{move:"F2",difficulty:"WHITE"},{move:"K2",difficulty:"WHITE"},
{move:"SL3",difficulty:"WHITE"},{move:"TL3",difficulty:"WHITE"},{move:"BL3",difficulty:"WHITE"},{move:"F3",difficulty:"WHITE"},{move:"K3",difficulty:"WHITE"},{move:"F4",difficulty:"WHITE"},{move:"K4",difficulty:"WHITE"},{move:"F5",difficulty:"WHITE"},{move:"K5",difficulty:"WHITE"}]}};$(".dialfilter").html(Unit.prototype.getdialstring.call(b));$(".dialfilter td[move]").click(function(){var b=$(this).attr("move");"undefined"!=typeof MOVEFILTER[b]?(delete MOVEFILTER[b],$(this).removeClass("selected")):
(MOVEFILTER[b]=!0,$(this).addClass("selected"));displayfactionunits(!0)});displayfactionunits(!1);for(var f in generics)if(b=generics[f],b.team==currentteam.team)for(addunit(b.pilotid,currentteam.faction,b),e=0;e<b.upgradetype.length;e++){var l=b.upg[e];-1<l&&addupgrade(b,l,e)}}
function switchdialimg(b){1==b?($("#caroussel .shipimg").css("display","none"),$("#caroussel .shipdial").css("display","table-cell")):($("#caroussel .shipdial").css("display","none"),$("#caroussel .shipimg").css("display","table-cell"))}var mySpreadsheets=["https://docs.google.com/spreadsheets/d/1KR1uc7QgbiDkxCU5J1rm9qBMMjwKC0WyfAuDhnrbgAA/edit#gid=0"];
function displayAIperformance(){for(var b=0;b<mySpreadsheets.length;b++)$("#squadbattlediv").sheetrock({url:mySpreadsheets[b],query:"select B",callback:AIstats,rowTemplate:function(){return""},labels:["Score"]})}function selectrocks(){var b=[1,2,3,4,5,6];$(".aster img").click(function(e){e=parseInt(e.target.id.substr(1),10);if(-1<b.indexOf(e))b[e]=null;else{var f;for(f=0;6>f&&null!=b[f];f++);6>f&&(b[f]=e,$("#a"+e).addClass("selected"))}}.bind(this))}
function recomputeurl(){$("#squadbattlediv").sheetrock({url:mySpreadsheets[0],query:"select C",callback:computeurl,rowTemplate:function(){return""},labels:["ascii","short","long"]})}
function displaysquads(b){var e=b;b=b.replace(/\n/g,".");b=b.replace(/ \+ /g,"*");SEARCHINGSQUAD=b=b.replace(/ /g,"_");e.replace(/\n/g,"<br>");for(e=0;e<mySpreadsheets.length;e++)$("#squadlistdiv").sheetrock({url:mySpreadsheets[e],query:"select C where C contains '"+b+"'",callback:myCallbacksl,fetchSize:2,rowTemplate:function(){return""},labels:" Type Pts Units  ".split(" ")})}
function dial2JSON(b){var e=[],f,l;for(f=0;5>=f;f++)e[f]={item:"",moves:null};for(f=0;f<b.length;f++){d=b[f];var m=MPOS[d.move][0],h=MPOS[d.move][1];e[5-m].item=m;if(null==e[5-m].moves)for(e[5-m].moves=[],l=0;6>=l;l++)e[5-m].moves[l]={difficulty:"",key:""};e[5-m].moves[h]={difficulty:d.difficulty,key:P[d.move].key}}return e}function selectweapon(b){$("#attackdial").html(Mustache.render(TEMPLATES.selectweapon,b)).show()}
function getpilottexttranslation(b,e){var f=b.name+(e==SCUM?" (Scum)":"");if("undefined"!=typeof b.edition){var l=b.name+"("+b.edition+")";if("undefined"!=typeof PILOT_translation[l]&&"undefined"!=typeof PILOT_translation[l].text)return formatstring(PILOT_translation[l].text)}return"undefined"!=typeof PILOT_translation[f]&&"undefined"!=typeof PILOT_translation[f].text?formatstring(PILOT_translation[f].text):""}
function getupgtxttranslation(b,e){var f=b+(e==CREW?"(Crew)":"");return"undefined"!=typeof UPGRADE_translation[f]&&"undefined"!=typeof UPGRADE_translation[f].text?formatstring(UPGRADE_translation[f].text):""}
function importsquad(b){currentteam.parseJSON($("#squad"+b).val(),!0);currentteam.name="SQUAD."+currentteam.toASCII();var e=currentteam.toJuggler(!0);currentteam.toJSON();$("#squad"+b+"points").html(currentteam.points);localStorage[currentteam.name]=JSON.stringify({pts:currentteam.points,faction:currentteam.faction,jug:currentteam.toJuggler(!1)});SQUADLIST.addrow(b,currentteam.name,currentteam.points,currentteam.faction,e);enablenextphase()}
function findsquad(b){currentteam.parseJSON($("#squad"+b).val(),!0);var e=currentteam.toJuggler(!1).replace(/ \+.*/g,"").replace(/\n/g,".*.").replace(/ /g,"_");$("#squad"+b).sheetrock({url:mySpreadsheets[0],query:"select C where C matches '.*VS"+e+"'",callback:matchsquad,fetchSize:100,rowTemplate:function(){return""},labels:["squad"]})}
function matchsquad(b,e,f){if(null!=f&&"undefined"!=typeof f.rows){f.rows.sort(function(b,e){return b.cellsArray[0]<e.cellsArray[0]});b="";for(var l in f.rows)e=f.rows[l].cellsArray[0].split("VS"),e[1]!=b&&(b=e[1])}}function startcombat(){}
function filltabskill(){var b;tabskill=[];for(b=0;12>=b;b++)tabskill[b]=[];for(b in squadron)tabskill[squadron[b].getskill()].push(squadron[b]);for(b=0;12>=b;b++)tabskill[b].sort(function(b,f){var e=0,m=0;1==TEAMS[b.team].initiative&&(e=1);1==TEAMS[f.team].initiative&&(m=1);return 0==m-e?f.id-b.id:m-e})}var ZONE=[];function movelog(b){ANIM+="_-"+b}
function endsetupphase(){$(".buttonbar .share-buttons").hide();$("#leftpanel").show();$(".bigbutton").hide();$(".playertype").prop("disabled",!0);ZONE[2].remove();ZONE[3].remove();TEAMS[1].endsetup();TEAMS[2].endsetup();PERMALINK=permalink(!0);$("#turnselector").append("<option value='0'>"+UI_translation["phase"+SETUP_PHASE]+"</option>");$(".playerselect").remove();$(".nextphase").addClass("disabled");$(".unit").css("cursor","pointer");$("#positiondial").hide();for(var b=0;b<OBSTACLES.length;b++)OBSTACLES[b].unDrag();
HISTORY=[];for(b in squadron)squadron[b].endsetupphase()}
function nextphase(){var b;window.location="#";switch(phase){case SELECT_PHASE:mode==SCENARIO&&(b=$("#scenariolist tr.selected").attr("id"),b=parseInt(b.replace(/sc([0-9]+)/,"$1"),10),SCENARIOLIST.checkrow(b));$(".mainarticle").hide();$(".permalink").show();$("nav").show();$("#game").show();$("#rightpanel").show();$("#leftpanel").show();break;case SETUP_PHASE:if(mode==SCENARIOCREATOR){phase=SELECT_PHASE-1;SCENARIOLIST.addrow(SCENARIOTITLE,HEADER,WINCOND,permalink(!0));break}"human"==$("#player1 option:checked").val()?
TEAMS[1].isia=!1:TEAMS[1].isia=!0;"human"==$("#player2 option:checked").val()?TEAMS[2].isia=!1:TEAMS[2].isia=!0;1==TEAMS[1].isia&&TEAMS[1].setia();1==TEAMS[2].isia&&TEAMS[2].setia();$(".imagebg").hide();endsetupphase();break;case PLANNING_PHASE:$("#maneuverdial").hide();for(b in squadron)squadron[b].endplanningphase();break;case ACTIVATION_PHASE:$("#activationdial").hide();for(b in squadron)squadron[b].hasmoved=!1,squadron[b].hasdecloaked=!1,squadron[b].actiondone=!1,squadron[b].endactivationphase();
var e=[];for(b=0;b<BOMBS.length;b++)e[b]=BOMBS[b];for(b=0;b<e.length;b++)e[b].explode();break;case COMBAT_PHASE:$("#attackdial").hide();$("#listunits").html("");for(b in squadron)squadron[b].endround();$("#turnselector").append("<option value='"+round+"'>"+UI_translation["turn #"]+round+"</option>");round++;WINCOND<round&&0<WINCOND&&win(0);-WINCOND<round&&0>WINCOND&&win(0)}phase>=SELECT_PHASE&&(phase=phase==COMBAT_PHASE?PLANNING_PHASE:phase+1,movelog("P-"+round+"-"+phase),1>=phase?$("#phase").empty():
3>phase?$("#phase").html(UI_translation["phase"+phase]):$("#phase").html(UI_translation["turn #"]+round+" "+UI_translation["phase"+phase]),$("#combatdial").hide(),$(".nextphase").removeClass("disabled"));setphase()}
function setphase(b){$(".imagebg").hide();switch(phase){case SELECT_PHASE:page_select();$(".nextphase").addClass("disabled");break;case SETUP_PHASE:$(".imagebg").show();$("#addcomment").show();for(var e="bomb weapon upgrade social condition squad-display".split(" "),f=0;f<e.length;f++)TEMPLATES[e[f]]=$("#"+e[f]).html(),Mustache.parse(TEMPLATES[e[f]]);var e=UI_translation.human,l=UI_translation.computer;$("#player1").html("<option selected value='human'>"+e+"</option>");$("#player1").append("<option value='computer'>"+
l+"</option>");$("#player2").html("<option selected value='human'>"+e+"</option>");$("#player2").append("<option value='computer'>"+l+"</option>");$("#player1").change(function(){TEAMS[1].isia=!TEAMS[1].isia;displayplayertype(1)});$("#player2").change(function(){TEAMS[2].isia=!TEAMS[2].isia;displayplayertype(2)});TEAMS[1].isia=!1;displayplayertype(1);TEAMS[2].isia=!0;displayplayertype(2);$(".bigbutton").show();$(".bigbutton2").prop("disabled",!1);$(".buttonbar .share-buttons").show();$("#team2").css("top",
$("nav").height()+2);$("#team1").css("top",$("nav").height()+2);$(".ctrl").css("display","block");ZONE[0]=s.path(SETUP.playzone1).attr({strokeWidth:6,stroke:halftone(WHITE),strokeDasharray:"20,10,5,5,5,10",id:"ZONE1",fillOpacity:1,filter:"drop-shadow( 5px 5px 5px #000 )",pointerEvents:"none"});SETUP.playzone1!=SETUP.playzone2?(ZONE[1]=s.path(SETUP.playzone2).attr({strokeWidth:6,stroke:halftone(WHITE),strokeDasharray:"20,10,5,5,5,10",id:"ZONE2",fillOpacity:0,pointerEvents:"none"}),ZONE[1].appendTo(VIEWPORT)):
ZONE[1]=ZONE[0];$("#imagebg").change(function(){changeimage(this)});""!=SETUP.background&&$(".playmat").css({background:"url("+SETUP.background+") no-repeat",backgroundSize:"100% 100%"});""==SETUP.pattern?ZONE[0].attr("fillOpacity",0):(e=s.image(SETUP.pattern,0,0,360,360).pattern(0,0,360,360),ZONE[0].attr("fill",e));ZONE[0].appendTo(VIEWPORT);ZONE[2]=s.path(SETUP.zone1).attr({fill:TEAMS[1].color,strokeWidth:2,opacity:.3,pointerEvents:"none"});ZONE[2].appendTo(VIEWPORT);ZONE[3]=s.path(SETUP.zone2).attr({fill:TEAMS[2].color,
strokeWidth:2,opacity:.3,pointerEvents:"none"});ZONE[3].appendTo(VIEWPORT);TEAMS[1].endselection(s);TEAMS[2].endselection(s);loadsound();""!=HEADER&&2>round&&($("footer").hide(),$("#titlecontent").html("<h1>"+SCENARIOTITLE+"</h1>"+HEADER));TEAMS[1].points>TEAMS[2].points?TEAMS[2].initiative=!0:TEAMS[1].initiative=!0;1==TEAMS[1].initiative?log("TEAM #1 has initiative"):log("TEAM #2 has initiative");$(".activeunit").prop("disabled",!1);for(f in squadron)if(!squadron[f].isdocked)break;activeunit=squadron[f];
activeunit.select();activeunit.show();jwerty.key("f",function(){console.log("SETUP:"+SETUP.name)});$("#svgout").bind("mousewheel DOMMouseScroll",function(b){var e=b.originalEvent;b=Math.pow(1.1,"undefined"!=typeof e.wheelDelta?e.wheelDelta/360:e.detail/-9);var f=e.clientX-$("#team1").width(),e=e.clientY-$("nav").height(),l=$("#svgout").width(),m=$("#svgout").height(),y=0,v=0;m>l?v=(m-l)/2:y=(l-m)/2;l=Math.max(900/l,900/m);f=(f-y)*l;v=(e-v)*l;y=VIEWPORT.m.clone().invert();e=y.x(f,v);f=y.y(f,v);VIEWPORT.m.translate(e,
f).scale(b).translate(-e,-f);VIEWPORT.transform(VIEWPORT.m);activeunit.show()});$("#svgout").mousedown(function(b){dragstart(b)});$("#svgout").mousemove(function(b){dragmove(b)});$("#svgout").mouseup(function(b){dragstop(b)});jwerty.key("escape",nextphase);jwerty.key("alt+p",function(){activeunit.showpositions(activeunit.getdial())},{});jwerty.key("alt+g",function(){TEAMS[activeunit.team].isia?activeunit.showgrouppositions():console.log("not an IA")},{});jwerty.key("alt+m",function(){activeunit.showmeanposition()});
jwerty.key("alt+shift+p",function(){$(".possible").remove()});jwerty.key("alt+1",function(){activeunit.addfocustoken();activeunit.show()});jwerty.key("alt+2",function(){activeunit.addevadetoken();activeunit.show()});jwerty.key("alt+3",function(){activeunit.iscloaked||(activeunit.addcloaktoken(),activeunit.show())});jwerty.key("alt+4",function(){activeunit.addstress();activeunit.show()});jwerty.key("alt+5",function(){activeunit.addiontoken();activeunit.show()});jwerty.key("alt+6",function(){activeunit.addtractorbeamtoken();
activeunit.show()});jwerty.key("alt+shift+1",function(){0<activeunit.focus&&activeunit.removefocustoken();activeunit.show()});jwerty.key("alt+shift+2",function(){0<activeunit.evade&&activeunit.removeevadetoken();activeunit.show()});jwerty.key("alt+shift+3",function(){activeunit.iscloaked&&(activeunit.removecloaktoken(),activeunit.show())});jwerty.key("alt+shift+4",function(){0<activeunit.stress&&activeunit.removestresstoken();activeunit.show()});jwerty.key("alt+shift+5",function(){0<activeunit.ionized&&
activeunit.removeiontoken()});jwerty.key("alt+shift+6",function(){0<activeunit.tractorbeam&&activeunit.removetractorbeamtoken()});jwerty.key("alt+d",function(){activeunit.resolvehit(1)});jwerty.key("alt+c",function(){activeunit.resolvecritical(1)});jwerty.key("alt+shift+d",function(){activeunit.hull<activeunit.ship.hull?activeunit.addhull(1):activeunit.shield<activeunit.ship.shield&&activeunit.addshield(1);activeunit.show()});0<SETUP.asteroids&&loadrock(s,ROCKDATA);log("<div>["+UI_translation["turn #"]+
round+"]"+UI_translation["phase"+phase]+"</div>");$("footer").show();$(".unit").css("cursor","move");$("#positiondial").show();$(".permalink").show();$("#savebtn").hide();if(1!=b)startreplayall();else for(f in squadron)squadron[f].beginsetupphase();break;case PLANNING_PHASE:active=0;actionr=[$.Deferred().resolve()];actionrlock=$.Deferred().resolve();log("<div>["+UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$(".nextphase").addClass("disabled");$("#maneuverdial").show();
skillturn=0;filltabskill();$("#savebtn").show();for(f in squadron)squadron[f].newm=squadron[f].m,squadron[f].beginplanningphase().progress(nextplanning);nextplanning();break;case ACTIVATION_PHASE:log("<div>["+UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$(".nextphase").addClass("disabled");$("#activationdial").show();for(f in squadron)squadron[f].beginactivationphase().done(nextdecloak);filltabskill();subphase=DECLOAK_PHASE;skillturn=0;barrier(nextdecloak);break;case COMBAT_PHASE:log("<div>["+
UI_translation["turn #"]+round+"]"+UI_translation["phase"+phase]+"</div>");$("#attackdial").show();skillturn=12;$(".nextphase").addClass("disabled");for(f in squadron)squadron[f].begincombatphase().done(nextcombat);barrier(nextcombat)}}function barrier(b){$.when.apply(null,actionr).done(b)}function log(b){$("#log").append("<div>"+b+"<div>");$("#log").scrollTop(1E4)}
function permalink(b){var e="";b||(e=ANIM);return LZString.compressToEncodedURIComponent(TEAMS[1].toASCII()+"&"+TEAMS[2].toASCII()+"&"+saverock()+"&"+TEAMS[1].isia+"&"+TEAMS[2].isia+"&"+SETUP.name+(MOVING_ASTER?"!":"")+"&"+e+"&"+SCENARIOTITLE+"&"+HEADER+"&"+WINCOND)}function savesquad(){return LZString.compressToEncodedURIComponent(TEAMS[3].toASCII()+"&&")}
function resetlink(b,e,f){switch(phase){case SETUP_PHASE:case SELECT_PHASE:document.location.search="";f=document.location.href;0<f.indexOf("?")&&(f=f.substring(0,f.indexOf("?")),window.history.replaceState({},document.title,f));location.reload();break;default:1==b?""!=document.location.search?document.location.search="":document.location.reload():(1==e?ANIM="":1==f?$("#turnselector option:selected").each(function(){var b=$(this).val();-1!=b&&(0==b?ANIM="":(b=ANIM.search("_-P-"+b+"-3"),ANIM=ANIM.slice(0,
ANIM.indexOf("_",b+1))))}):(b=ANIM.search("_-P-"+f+"-3"),-1==ANIM.indexOf("_",b+1)&&(b=ANIM.search("_-P-"+(f-1)+"-3")),ANIM=ANIM.slice(0,ANIM.indexOf("_",b+1))),f=LZString.decompressFromEncodedURIComponent(decodeURI(PERMALINK)),args=f.split("&"),args[2]=saverock(),args[6]=ANIM,args[7]=SCENARIOTITLE,args[8]=HEADER,args[9]=WINCOND,f=args.join("&"),document.location.search="?"+LZString.compressToEncodedURIComponent(f))}}function record(b,e,f){}
function history_toASCII(){for(var b="",e=0;e<HISTORY.length;e++)b+=HISTORY[e].s+"_"+HISTORY[e].id+";";return b}function select(b){for(var e in squadron)if(squadron[e].id==b)break;squadron[e].select();$("#"+activeunit.id).attr({color:"white",background:"tomato"})}
function probatable(b,e){var f,l,m="";for(f=0;5>=f;f++){m+="<tr><td>"+f+"</td>";for(l=0;5>=l;l++){var h=l;0<e.adddice&&(h+=e.adddice);h=tohitproba(b,{modifyattackroll:function(b,e,f){return b}},e,ATTACK[f],DEFENSE[h],f,h);m+="<td class='probacell' style='background:hsl("+1.2*(100-h.tohit)+",100%,80%)'>";m+="<div>"+h.tohit+"%</div><div><code class='symbols'>d</code>"+h.meanhit+"</div><div><code class='symbols'>c</code>"+h.meancritical+"</div></td>"}m+="</tr>"}return m}
function fillprobatable(){var b={focus:$("#focusA").prop("checked")?1:0,reroll:$("#targetA").prop("checked")?5:0},e={focus:$("#focusD").prop("checked")?1:0,evade:$("#evadeD").prop("checked")?1:0,adddice:$("#cloakD").prop("checked")?2:0,reroll:0},f;f=parseInt($("#rerollA").val(),10);var l=parseInt($("#rerollD").val(),10);if(0==b.reroll||0<f&&f<b.reroll)b.reroll=f;if(0==e.reroll||0<l&&l<e.reroll)e.reroll=l;b="<tr><th>Rolls</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th></tr>"+probatable(b,
e);$("#probatable").html(b)}function modal_dragstart(b){var e=window.getComputedStyle(b.originalEvent.target,null);b.originalEvent.dataTransfer.setData("text/plain",b.target.parentElement.id+","+(parseInt(e.getPropertyValue("left"),10)-b.originalEvent.clientX)+","+(parseInt(e.getPropertyValue("top"),10)-b.originalEvent.clientY))}function modal_dragover(b){b.originalEvent.preventDefault();return!1}
function modal_drop(b){var e=b.originalEvent.dataTransfer.getData("text/plain").split(","),f=e[0];$("#"+f+" > div").css("left",b.originalEvent.clientX+parseInt(e[1],10)+"px");$("#"+f+" > div").css("top",b.originalEvent.clientY+parseInt(e[2],10)+"px");b.originalEvent.preventDefault();return!1}
var viewport_translate=function(b,e){VIEWPORT.m=MT(b,e).add(VIEWPORT.m);$(".phasepanel").hide();VIEWPORT.transform(VIEWPORT.m)},viewport_zoom=function(b){$("#svgout").width();$("#svgout").height();var e=activeunit.m.x(0,0),f=activeunit.m.y(0,0),l=VIEWPORT.m.clone().invert(),m=l.x(e,f),e=l.y(e,f);VIEWPORT.m.translate(m,e).scale(b).translate(-m,-e);VIEWPORT.transform(VIEWPORT.m);activeunit.show()},dragmove=function(b){if(1!=activeunit.dragged&&VIEWPORT.dragged){var e=$("#svgout").width(),f=$("#svgout").height(),
e=Math.max(900/e,900/f);VIEWPORT.dragMatrix=MT((b.offsetX-VIEWPORT.x0)*e,(b.offsetY-VIEWPORT.y0)*e).add(VIEWPORT.m);VIEWPORT.dragged=!0;$(".phasepanel").hide();VIEWPORT.transform(VIEWPORT.dragMatrix)}},dragstart=function(b){VIEWPORT.dragged=!0;"svgout"==b.originalEvent.target.id?(VIEWPORT.x0=b.offsetX,VIEWPORT.y0=b.offsetY,VIEWPORT.dragged=!0,VIEWPORT.dragMatrix=VIEWPORT.m):VIEWPORT.dragged=!1},dragstop=function(b){VIEWPORT.dragged&&(VIEWPORT.m=VIEWPORT.dragMatrix,VIEWPORT.m.clone(),VIEWPORT.transform(VIEWPORT.m),
activeunit.show());VIEWPORT.dragged=!1},scrolloverflow=function(b){$("#"+b.target.id+" .outoverflow").each(function(b){"auto"!=$(this).css("top")&&$(this).css("top",$(this).parent().offset().top+"px")})},changelanguage=function(b){localStorage.LANG=b;location.reload()};
$(document).ready(function(){var b;s=Snap("#svgout");VIEWPORT=s.g().attr({id:"viewport"});VIEWPORT.m=new Snap.Matrix;FILTER=s.filter(Snap.filter.blur(5,5));P={F0:{path:s.path("M 0 0 L 0 0"),speed:0,key:"5"},F1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"8"},RF1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"|"},F2:{path:s.path("M 0 0 L 0 -120"),speed:2,key:"8"},F3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"8"},F4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"8"},F5:{path:s.path("M 0 0 L 0 -240"),speed:5,
key:"8"},TR1:{path:s.path("M0 0 C 0 -40 15 -55 55 -55"),speed:1,key:"6"},TR2:{path:s.path("M0 0 C 0 -50 33 -83 83 -83"),speed:2,key:"6"},TRR2:{path:s.path("M0 0 C 0 -50 33 -83 83 -83"),speed:2,key:";"},TR3:{path:s.path("M0 0 C 0 -60 45 -105 105 -105"),speed:3,key:"6"},TRR3:{path:s.path("M0 0 C 0 -60 45 -105 105 -105"),speed:3,key:";"},TL1:{path:s.path("M0 0 C 0 -40 -15 -55 -55 -55"),speed:1,key:"4"},TL2:{path:s.path("M0 0 C 0 -50 -33 -83 -83 -83"),speed:2,key:"4"},TRL2:{path:s.path("M0 0 C 0 -50 -33 -83 -83 -83"),
speed:2,key:":"},TL3:{path:s.path("M0 0 C 0 -60 -45 -105 -105 -105"),speed:3,key:"4"},TRL3:{path:s.path("M0 0 C 0 -60 -45 -105 -105 -105"),speed:3,key:":"},BR1:{path:s.path("M0 0 C 0 -20 18 -72 38 -92"),speed:1,key:"9"},RL1:{path:s.path("M0 0 C 0 -20 18 -72 38 -92"),speed:1,key:"}"},BR2:{path:s.path("M0 0 C 0 -30 24 -96 54 -126"),speed:2,key:"9"},SR2:{path:s.path("M0 0 C 0 -30 24 -96 54 -126"),speed:2,key:"3"},BR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),speed:3,key:"9"},SR3:{path:s.path("M0 0 C 0 -40 29 -120 69 -160"),
speed:3,key:"3"},BL1:{path:s.path("M0 0 C 0 -20 -18 -72 -38 -92"),speed:1,key:"7"},RR1:{path:s.path("M0 0 C 0 -20 -18 -72 -38 -92"),speed:1,key:"{"},BL2:{path:s.path("M0 0 C 0 -30 -24 -96 -54 -126"),speed:2,key:"7"},SL2:{path:s.path("M0 0 C 0 -30 -24 -96 -54 -126"),speed:2,key:"1"},BL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"7"},SL3:{path:s.path("M0 0 C 0 -40 -29 -120 -69 -160"),speed:3,key:"1"},K1:{path:s.path("M 0 0 L 0 -80"),speed:1,key:"2"},K2:{path:s.path("M 0 0 L 0 -120"),
speed:2,key:"2"},K3:{path:s.path("M 0 0 L 0 -160"),speed:3,key:"2"},K4:{path:s.path("M 0 0 L 0 -200"),speed:4,key:"2"},K5:{path:s.path("M 0 0 L 0 -240"),speed:5,key:"2"}};for(b in P)P[b].path.attr({display:"none"});$(".menu").mouseover(function(){$(".menu ul").css({display:"block",visibility:"visible"})}).mouseout(function(){$("nav ul").css({display:"none",visibility:"hidden"})});$("footer").hide();$("#squad1").on("paste",function(){setTimeout(function(){currentteam=TEAMS[1];importsquad(1)},4)});
$("#squad2").on("paste",function(){setTimeout(function(){currentteam=TEAMS[2];importsquad(2)},4)});LANG=localStorage.LANG||window.navigator.userLanguage||window.navigator.language;LANG=LANG.substring(0,2);$.ajaxSetup({beforeSend:function(b){b.overrideMimeType&&b.overrideMimeType("application/json")},isLocal:!0});log("loading jsons");-1=="en fr de es it pl".split(" ").indexOf(LANG)&&(LANG="en");$("#langselect").val(LANG);$.when($.ajax("data/ships.json",{error:function(b,f,l){console.log("**Error loading ships.json\n"+
f+" "+l)}}),$.ajax("data/strings."+LANG+".json",{error:function(b,f,l){console.log("**Error loading strings."+LANG+".json\n"+f+" "+l)}}),$.ajax("data/xws.json",{error:function(b,f,l){console.log("**Error loading xws.json\n"+f+" "+l)}}),$.ajax("data/strings.en.json",{error:function(b,f,l){console.log("**Error loading strings."+LANG+".json\n"+f+" "+l)}}),$.ajax("data/ratings.json",{error:function(b,f,l){console.log("**Error loading ratings.json\n"+f+" "+l)}}),$.ajax("data/countrycodes.json",{error:function(b,
f,l){console.log("**Error loading countrycodes.json\n"+f+" "+l)}})).done(function(b,f,l,m,h,q){var e=setInterval(function(){ATTACK[dice]=attackproba(dice);DEFENSE[dice]=defenseproba(dice);dice++;8==dice&&(fillprobatable(),$("#showproba").prop("disabled",!1),clearInterval(e))},500);unitlist=b[0];ENSHIP_translation=m[0].ships;ENPILOT_translation=m[0].pilots;ENUPGRADE_translation=m[0].upgrades;SHIP_translation=f[0].ships;PILOT_translation=f[0].pilots;UPGRADE_translation=f[0].upgrades;RATINGS_upgrades=
h[0].upgrades;RATINGS_ships=h[0].ships;RATINGS_pilots=h[0].pilots;CC=q[0];UI_translation=f[0].ui;CRIT_translation=f[0].criticals;m=f[0].css;b="";if("en"!=LANG){for(v in ENUPGRADE_translation)f=ENUPGRADE_translation[v],h=UPGRADE_translation[v],"undefined"==typeof h&&(UPGRADE_translation[v]=f);for(v in ENPILOT_translation)f=ENPILOT_translation[v],h=PILOT_translation[v],"undefined"==typeof h&&(PILOT_translation[v]=f)}for(v in m)b+="."+v+'::after { content:"'+m[v]+'";}\n';$("#localstrings").html(b);UPGRADE_dict=
l[0].upgrades;PILOT_dict=l[0].pilots;for(w in PILOT_dict){for(v=0;v<PILOTS.length;v++)PILOTS[v].name==PILOT_dict[w]&&(PILOTS[v].dict=w);for(v in unitlist)v==PILOT_dict[w]&&(unitlist[v].dict=w)}for(v=0;v<UPGRADES.length;v++)f=UPGRADES[v],f.type==TITLE&&(unitlist[f.ship].hastitle=!0);for(v=0;v<PILOTS.length;v++){l=!1;for(var w in PILOT_dict)if(PILOTS[v].name==PILOT_dict[w]){l=!0;break}l||log("no xws translation for "+PILOTS[v].name)}for(v=0;v<UPGRADES.length;v++){l=!1;for(w in UPGRADE_dict)if(UPGRADES[v].name==
UPGRADE_dict[w]){l=!0;break}l||log("no xws translation for "+UPGRADES[v].name)}squadron=[];s.attr({width:"100%",height:"100%",viewBox:"0 0 900 900"});m=f=l=0;b="";for(v=0;v<PILOTS.length;v++)1==PILOTS[v].done&&(PILOTS[v].unique&&f++,l++),PILOTS[v].done||(b=PILOTS[v].unique?b+", .":b+", ",b+=PILOTS[v].name);console.log(l+"/"+PILOTS.length+" pilots with full effect");log(l+"/"+PILOTS.length+" pilots with full effect<br/>");""!=b&&log("Pilots NOT working yet:"+b+"<br/>");l=0;b="";for(v=0;v<UPGRADES.length;v++)UPGRADES[v].invisible||
(1==UPGRADES[v].done?l++:b+=(""==b?"":", ")+(UPGRADES[v].unique?".":"")+UPGRADES[v].name,m++);$(".ver").html(VERSION);console.log(l+"/"+m+" upgrades with full effect");log(l+"/"+m+" upgrades with full effect<br/>");""!=b&&log("Upgrades NOT working yet:"+b+"<br/>");$("#showproba").prop("disabled",!0);"undefined"==typeof localStorage.volume&&(localStorage.volume=.8);var y=new Hammer(document.getElementById("svgout"));y.get("pinch").set({enable:!0});y.get("pan").set({direction:Hammer.DIRECTION_ALL});
y.on("panleft panright panup pandown",function(b){"svgout"==b.target.id&&1!=activeunit.dragged&&viewport_translate(50*b.velocityX,50*b.velocityY)});l="unit-creation combat-display unit-printable unit-combat upglist-creation faction usabletokens selectweapon".split(" ");for(v in l)TEMPLATES[l[v]]=$("#"+l[v]).html(),Mustache.parse(TEMPLATES[l[v]]);$("body").on("mousedown","footer",function(){$(this).addClass("draggable").parents().on("mousemove",function(b){$(".draggable").offset({top:b.pageY-$(".draggable").outerHeight()/
2,left:b.pageX-$(".draggable").outerWidth()/2}).on("mouseup",function(){$(this).removeClass("draggable")})});"function"==typeof(0).preventDefault&&(0).preventDefault()}).on("mouseup",function(){$(".draggable").removeClass("draggable")});y.zoom=1;y.on("pinch",function(b){if("svgout"==b.target.id&&1!=activeunit.dragged){var e=VIEWPORT.m.clone().invert(),f=e.x(b.center.x,b.center.y),e=e.y(b.center.x,b.center.y);VIEWPORT.m.translate(f,e).scale(b.scale).scale(1/y.zoom).translate(-f,-e);y.zoom=b.scale;
VIEWPORT.transform(VIEWPORT.m);activeunit.show();b["final"]&&(y.zoom=1)}});$("aside").on("scroll touchmove touchstart mousewheel",scrolloverflow);scenariomode(FREECOMBAT);"CREATION"==localStorage.mode?(delete localStorage.mode,page_creation()):page_select();b=LZString.decompressFromEncodedURIComponent(decodeURI(window.location.search.substr(1)));l=[];null!=b&&(l=b.split("&"));if(1<l.length)if(log("Loading permalink..."),ROCKDATA=l[2],TEAMS[1].parseASCII(l[0]),TEAMS[1].toJSON(),""==l[1])for(w in TEAMS[3].parseASCII(l[0]),
currentteam=TEAMS[3],currentteam.team=3,createsquad(currentteam.faction),generics){if(f=generics[w],3==f.team)for(var v in metaUnit.prototype)f[v]=metaUnit.prototype[v]}else return TEAMS[2].parseASCII(l[1]),TEAMS[2].toJSON(),TEAMS[1].isia=!1,TEAMS[2].isia=!1,"true"==l[3]&&(TEAMS[1].isia=!0),"true"==l[4]&&(TEAMS[2].isia=!0),MOVING_ASTER=!1,"undefined"!=typeof l[5]&&(b=l[5],"!"==b.substr(-1,1)&&(MOVING_ASTER=!0,b=b.substr(0,b.len-1)),setSetup(b)),phase=SELECT_PHASE,SCENARIOTITLE=HEADERS="",6<l.length&
""!=l[6]&&(REPLAY=l[6]),8<l.length&&(HEADER=l[8],SCENARIOTITLE=l[7]),WINCOND=9<l.length?parseInt(l[9],10):0,PERMALINK=LZString.compressToEncodedURIComponent(TEAMS[1].toASCII()+"&"+TEAMS[2].toASCII()+"&"+saverock()+"&"+TEAMS[1].isia+"&"+TEAMS[2].isia+"&"+l[5]+"&&"+SCENARIOTITLE+"&"+HEADERS+"&"+WINCOND),nextphase();delete localStorage.imageplayer;delete localStorage.playername;phase=SELECT_PHASE;setSetup("Classic");SQUADLIST=new Squadlist("#squadlist");SQUADLIST.latest();SCENARIOLIST=new Scenariolist("#scenariolist");
SCENARIOLIST.user();for(v in squadron)delete squadron[v];$("#caroussel").hover(function(){$(this).scrollLeft(10)});squadron=[];generics=[];TEAMS[3].changefaction(REBEL,!0);w=[];for(v=0;v<PILOTS.length;v++)l=v,b=translate(PILOTS[v].name),1==PILOTS[v].ambiguous&&"undefined"!=typeof PILOTS[v].edition&&(b+="("+PILOTS[v].edition+")"),w.push(b.replace(/\'/g,"").replace(/\(Scum\)/g,""));l=[];for(v in UPGRADE_translation)l.push(" "+translate(v).replace(/\'/g,"").replace(/\(Crew\)/g,""));$(".squadbg > textarea").asuggest(w,
{delimiters:"^\n",cycleOnTab:!0});$(".squadbg > textarea").asuggest(l,{delimiters:"+",cycleOnTab:!0});return!0})});
function printunits(){var b="",e=0,f;for(f in generics){var l=generics[f];if(l.team==currentteam.team){var m=0,h;for(h in l.upgrades){var q=l.upgrades[h];"undefined"==typeof q.points&&(q.points=l.points,q.name="Ship:"+l.ship.name);m+=parseInt(q.points,10)}l.totpoints=m;e+=m;b+=Mustache.render(TEMPLATES["unit-printable"],l)}}$("#factionname").addClass(currentteam.faction.toUpperCase());$("#pointsname").html(e);$("#printunits").html(b)};var JUGGLERWEBSITE="http://lists.starwarsclubhouse.com/api/v1/";function Squadlist(b){this.id=b;TEMPLATES["row-manage"]=$("#row-manage").html();Mustache.parse(TEMPLATES["row-manage"]);TEMPLATES["header-manage"]=$("#header-manage").html();Mustache.parse(TEMPLATES["header-manage"]);$(b).html(Mustache.render(TEMPLATES["header-manage"],{translation:UI_translation.type}));$(b+" tbody").on("click","tr",function(){$(b+" .selected").removeClass("selected");$(this).addClass("selected")})}
Squadlist.prototype={isinrow:function(b){return"undefined"!=typeof this.rows&&-1<this.rows.indexOf(b)},filter:function(b){for(var e in this.rows)this.rows[e].match(b)?$("#r"+e).show():$("#r"+e).hide()},"import":function(b){},addrow:function(b,e,f,l,m,h,q){b=l.toUpperCase();if("undefined"==typeof localStorage[e]||1==h)this.rows[this.nrows]=m,TEAMS[0].parseJuggler(m,!1),m=TEAMS[0].toJuggler(!1,!0),$(this.id+" tbody").append(Mustache.render(TEMPLATES["row-manage"],{nrows:this.nrows,faction:b,pts:f,name:e,
tournament:q,jug:m})),this.nrows++},removerow:function(b){b=this.table.row(b.parents("tr"));var e=b.data()[4];delete localStorage[e];b.remove().draw(!1)},createfromrow:function(b){b=this.rows[b];currentteam=TEAMS[3];currentteam.parseJuggler(b,!0);createsquad(currentteam.faction);for(var e in generics)if(b=generics[e],3==b.team)for(var f in metaUnit.prototype)b[f]=metaUnit.prototype[f]},toplist:function(){var b;this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};for(b=0;b<TOP_squads.length;b++)TEAMS[0].parseJuggler(TOP_squads[b],
!1),"en"!=LANG?this.addrow(0,b,TEAMS[0].points,TEAMS[0].faction,TEAMS[0].toJuggler(!0),!0):this.addrow(0,b,TEAMS[0].points,TEAMS[0].faction,TEAMS[0].toJuggler(!1),!0)},user:function(){var b;this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};for(b in localStorage)if("string"==typeof localStorage[b]&&b.match(/SQUAD.*/)){var e=$.parseJSON(localStorage[b]);"undefined"==typeof e.jug||"undefined"==typeof e.pts||"undefined"==typeof e.faction?delete localStorage[b]:"en"!=LANG?(TEAMS[0].parseJuggler(e.jug,
!1),this.addrow(0,b,e.pts,e.faction,TEAMS[0].toJuggler(!0),!0)):this.addrow(0,b,e.pts,e.faction,e.jug,!0)}},addtournamentlists:function(b){var e=new XMLHttpRequest;e.open("GET",JUGGLERWEBSITE+"tournament/"+b,!0);e.onreadystatechange=function(){if(4===e.readyState)if(200<=e.status&&400>e.status){var f=$.parseJSON(e.responseText),l="us";"undefined"==typeof CC[f.tournament.venue.country]?console.log("No country:"+f.tournament.venue.country):l=CC[f.tournament.venue.country].toLowerCase();var l={cc:l,
country:f.tournament.venue.country,type:f.tournament.type,format:f.tournament.format.replace(/Standard -/,""),date:f.tournament.date},m=[],h;for(h in f.tournament.players){var q=f.tournament.players[h];if("undefined"!=typeof q.list&&(TEAMS[0].parseJSON(q.list),TEAMS[0].toJSON(),q=TEAMS[0].toKey(),1!=this.allresults[q])){var t=TEAMS[0].toJuggler(!0);m.push({points:TEAMS[0].points,faction:TEAMS[0].faction,jug:t});this.addrow(0,"COMPETITION"+q,TEAMS[0].points,TEAMS[0].faction,t,!1,l);this.allresults[q]=
!0}}localStorage["_TOURNAMENT"+b]=JSON.stringify({list:m,event:l})}else console.log("no tournament "+b+" (status:"+e.status+")")}.bind(this);e.send()},latest:function(){var b=new XMLHttpRequest,e;this.allresults={};this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};b.open("GET",JUGGLERWEBSITE+"tournaments",!0);b.onreadystatechange=function(){if(4===b.readyState)if(200<=b.status&&400>b.status){var f=$.parseJSON(b.responseText);f.tournaments.sort(function(b,e){return parseInt(b,10)-
parseInt(e,10)});var l=[];for(e=0;5>e;e++){var m=f.tournaments[f.tournaments.length-1-e];if("undefined"==typeof localStorage["_TOURNAMENT"+m])this.addtournamentlists(m);else{var h=$.parseJSON(localStorage["_TOURNAMENT"+m]),q;for(q in h.list){var t=h.list[q];this.addrow(0,"COMPETITION0",t.points,t.faction,t.jug,!1,h.event)}console.log("tournament "+m+" in cache")}l[e]=parseInt(m,10)}for(e in localStorage)null!=e.match(/_TOURNAMENT/)&&(f=parseInt(e.replace(/_TOURNAMENT([0-9]*)/,"$1"),10),-1==l.indexOf(f)&&
(console.log("removing old tournament "+e),delete localStorage[e]))}else console.log("tournaments not loaded (status:"+b.status+")")}.bind(this);b.send()},latest2:function(){this.rows=[];this.nrows=0;$(this.id+" tbody").html("");this.log={};for(var b=0;b<mySpreadsheets.length;b++)$("#squadlist").sheetrock({url:mySpreadsheets[b],query:"select C order by A desc",fetchSize:40,rowTemplate:this.myTemplatesl})},myTemplatesl:function(b){var e=b.cellsArray[0].split("VS");if(!(2>e.length)){b=mk2split(e[0]);
for(var e=mk2split(e[1]),f="",l="",m="",h="",q=0;q<b.length-1;q++)l+=b[q].replace(/\*/g," + ").replace(/_/g," ")+"\n",f+=b[q].replace(/\*/g," + ").replace(/_/g," ")+"\n";for(q=0;q<e.length-1;q++)h+=e[q].replace(/\*/g," + ").replace(/_/g," ")+"\n",m+=e[q].replace(/\*/g," + ").replace(/_/g," ")+"\n";TEAMS[0].parseJuggler(l,!1);TEAMS[0].toJSON();"undefined"==typeof SQUADLIST.log[f]&&(SQUADLIST.addrow(0,"SQUAD."+TEAMS[0].toASCII(),TEAMS[0].points,TEAMS[0].faction,f,!0),SQUADLIST.log[f]=!0);TEAMS[0].parseJuggler(h,
!1);TEAMS[0].toJSON();"undefined"==typeof SQUADLIST.log[m]&&(SQUADLIST.addrow(0,"SQUAD."+TEAMS[0].toASCII(),TEAMS[0].points,TEAMS[0].faction,m,!0),SQUADLIST.log[m]=!0)}},displaycombats:function(b){generics=[];squadron=[];"undefined"!=typeof b&&(TEAMS[0].parseJuggler(this.rows[b],!0),b=TEAMS[0].toJuggler(!1),b=b.replace(/\n/g,"."),b=b.replace(/ \+ /g,"*"),SEARCHINGSQUAD=b=b.replace(/ /g,"_"));stype="";b=SEARCHINGSQUAD;$("#replay").attr("src","space.html");for(var e=0;e<mySpreadsheets.length;e++)$("#squadbattlediv").sheetrock({url:mySpreadsheets[e],
query:"select B,C,E,A where C contains '"+b+"'",fetchSize:2,rowTemplate:myTemplate})},printfromrow:function(b){b=this.rows[b];generics=[];squadron=[];TEAMS[0].parseJuggler(b,!0);currentteam=TEAMS[0];for(var e in generics)if(b=generics[e],0==b.team){addunit(b.pilotid,currentteam.faction,b);for(var f=0;f<b.upgradetype.length;f++){var l=b.upg[f];-1<l&&addupgrade(b,l,f)}}printunits();window.print()},checkrow:function(b,e){prepareforcombat(this.rows[e],b)}};function displayfactionunits(b){var e=0,f=0,l,m,h,q=TEAMS[3].faction,t={},w=[];currentteam=TEAMS[3];"REBEL"==q?($(".dialfilter td[move=SL3]").text(P.TRL3.key).attr("move","TRL3"),$(".dialfilter td[move=SL2]").text(P.TRL2.key).attr("move","TRL2")):($(".dialfilter td[move=TRL3]").text(P.SL3.key).attr("move","SL3"),$(".dialfilter td[move=TRL2]").text(P.SL2.key).attr("move","SL2"));for(l in unitlist)-1<unitlist[l].faction.indexOf(q)&&e++;1==b?$("#caroussel").html(""):$(".caroussel").html("");for(l=0;l<
PILOTS.length;l++){var y=PILOTS[l].unit,e="";b=PILOTS[l].name;if(PILOTS[l].faction==q){"undefined"==typeof t[y]&&(t[y]=[]);-1<PILOTS[l].upgrades.indexOf(ELITE)&&(PILOTS[l].haselite=!0);var v=getpilottexttranslation(PILOTS[l],q);""!=v&&(v+=1==PILOTS[l].done?"":"<div><strong class='m-notimplemented'></strong></div>");PILOTS[l].faction==SCUM&&(b+="(SCUM)");"undefined"!=typeof PILOTS[l].edition&&(b+=" ("+PILOTS[l].edition+")");"undefined"!=typeof RATINGS_pilots[b]&&(v=v+"<hr/><p class='strategy'>"+RATINGS_pilots[b].text+
"</p>",e=repeat("\u00ff",RATINGS_pilots[b].rating));PILOTS[l].tooltip=v;PILOTS[l].rating=e;PILOTS[l].trname=translate(PILOTS[l].name);t[y].push(PILOTS[l])}}for(y in t)t[y].sort(function(b,e){return b.points-e.points});for(l in unitlist)-1<unitlist[l].faction.indexOf(q)&&(unitlist[l].trname=SHIP_translation[l],unitlist[l].name=l,"undefined"==typeof unitlist[l].trname&&(unitlist[l].trname=l),w.push(unitlist[l]));w.sort(function(b,e){return b.trname>e.trname});for(l=0;l<w.length;l++){f++;y=w[l];b=t[y.name];
var z=t[y.name][0].upgrades,e=!0;if("0"!=WAVEFILTER){v=[];for(h in b){var B=b[h];"undefined"!=typeof B.wave?-1<B.wave.indexOf(WAVEFILTER)&&v.push(B):y.wave==WAVEFILTER&&v.push(B)}0==v.length&&(e=!1);b=v}for(m in UNITFILTER)-1==z.indexOf(m)&&(e=!1);for(m in ACTIONFILTER)-1==y.actionList.indexOf(m)&&(e=!1);if(0<COSTFILTER){v=[];for(h in b)B=b[h],B.points<=COSTFILTER&&v.push(B);0==v.length&&(e=!1);b=v}if(""!=TEXTFILTER&&1==e){v=[];for(h in b){var B=b[h],z=getpilottexttranslation(B,q),E=translate(B.name),
D=new RegExp(TEXTFILTER,"i");(z.match(D)||E.match(D))&&v.push(B)}0==v.length&&(e=!1);b=v}for(m in MOVEFILTER){v=!1;for(h=0;h<y.dial.length;h++)y.dial[h].move==m&&(v=!0);v||(e=!1)}e&&(e=[],b=Mustache.render(TEMPLATES.faction,{shipimg:y.img[0],fire:repeat("u",y.fire),evade:repeat("u",y.evade),hull:repeat("u",y.hull),shield:repeat("u",y.shield),diallist:dial2JSON(y.dial),shipname:y.trname,primary:y.weapon_type,faction:q,actionlist:function(){var b=[];for(m=0;m<y.actionList.length;m++)b[m]=A[y.actionList[m]].key;
return b},hastitle:y.hastitle,shipupgrades:t[y.name][0].upgrades,pilots:b}),$("#caroussel").append("<li>"+b+"</li>"))}}function addunique(b){var e;UNIQUE[b]=!0;for(e=0;e<PILOTS.length;e++)b==PILOTS[e].name&&$(".pilots button[pilotid="+PILOTS[e].pilotid+"]").prop("disabled",!0);for(e=0;e<UPGRADES.length;e++)b==UPGRADES[e].name&&$(".upglist button[data="+e+"]").prop("disabled",!0)}
function removeunique(b){UNIQUE[b]=!1;for(var e=0;e<PILOTS.length;e++)b==PILOTS[e].name&&$(".pilots button[pilotid="+PILOTS[e].pilotid+"]").prop("disabled",!1);for(e=0;e<UPGRADES.length;e++)b==UPGRADES[e].name&&$(".upglist button[data="+e+"]").prop("disabled",!1)}function addlimited(b,e){$("#unit"+b.id+" .upglist button[data="+e+"]").prop("disabled",!0)}function removelimited(b,e){$("#unit"+b.id+" .upglist button[data="+e+"]").prop("disabled",!1)}
function addupgradeaddhandler(b){$("#unit"+b.id+" button.upgrades").click(function(b){var e=b.currentTarget.getAttribute("class").split(" ")[1];b=b.currentTarget.getAttribute("num");var l=this.getupgradelist(e);$("#unit"+this.id+" .upgs .upgavail").hide();$("#unit"+this.id+" .upgs .upg").hide();"undefined"==typeof this.upgbonus[e]&&(this.upgbonus[e]=0);for(var m=[],h=0;h<l.length;h++){var q=UPGRADES[l[h]],t,w=[];if(!q.invisible){t=1==UNIQUE[q.name]||(1==q.limited||1==this.exclupg[q.type])&&0<$("#unit"+
this.id+" .upg tr[data="+l[h]+"]").length;var y=q.points+this.upgbonus[e];0<q.points&&0>y&&(y=0);var v=formatstring(getupgtxttranslation(q.name,q.type));1!=q.done&&(v+="<div><strong class='m-notimplemented'></strong></div>");"undefined"!=typeof q.attack&&(w=[{attack:q.attack,lrange:q.range[0],hrange:q.range[1]}]);var z=0,B="",E=q.name+(q.type==CREW?"(Crew)":"");"undefined"!=typeof RATINGS_upgrades[E]&&"undefined"!=typeof RATINGS_upgrades[E].rating?(z=RATINGS_upgrades[E].rating,B=RATINGS_upgrades[E].text):
console.log("no rating for "+q.name);m.push({pts:y,rating:repeat("\u00ff",z),tooltip:[v+"<hr/><p class='strategy'>"+B+"</p>"],text:v,isdisabled:t,num:b,data:l[h],name:translate(q.name).replace(/\(Crew\)/g,""),attacks:w})}}$("#unit"+this.id+" .upglist").html(Mustache.render(TEMPLATES["upglist-creation"],{upglist:m}));$("#unit"+this.id+" .upglist button").click(function(b){var e=b.currentTarget.getAttribute("data");b=b.currentTarget.getAttribute("num");$("#unit"+this.id+" .upgs .upgavail").show();$("#unit"+
this.id+" .upgs .upg").show();addupgrade(this,e,b)}.bind(this))}.bind(b))}
function addunit(b,e,f){if("undefined"==typeof f){f=new Unit(currentteam.team,b);f.faction=e;for(var l in metaUnit.prototype)f[l]=metaUnit.prototype[l];for(var m in PILOTS[f.pilotid])b=PILOTS[f.pilotid],"function"==typeof b[m]&&(f[m]=b[m])}"undefined"!=typeof f.init&&f.init();3==currentteam.team?($("#listunits").append("<li id='unit"+f.id+"'></li>"),f.show(),$("li#unit"+f.id).hover(function(){$(".highlighted").removeClass("highlighted");$(this).addClass("highlighted")},function(){}),1==f.unique&&
addunique(f.name),$("#unit"+f.id+" .close").click(function(){var b=$(this).attr("data"),e=generics["u"+b];$("#unit"+b+" .upg tr[data]").each(function(){var b=$(this).attr("data");1==UPGRADES[b].unique&&removeunique(UPGRADES[b].name)});1==PILOTS[e.pilotid].unique&&removeunique(e.name);$("#unit"+b).remove();delete generics["u"+b];currentteam.updatepoints()}),$("#unit"+f.id+" .duplicate").click(function(){var b=$(this).attr("data"),f=generics["u"+b],l=addunit(f.pilotid,e);$("#unit"+b+" .upg tr[data]").each(function(){var b=
$(this).attr("data"),e=$(this).attr("num");1!=UPGRADES[b].unique&&f.upgnocopy!=b&&addupgrade(l,b,e)})}),$("#unit"+f.id+" .dialopen").click(function(){var b=$(this).attr("data");$("#unit"+b+" .upg").hide();$("#unit"+b+" .upglist").hide();$("#unit"+b+" .upgavail").hide();$("#unit"+b+" .statlist").hide();$("#unit"+b+" .shipdial").show();$("#unit"+b+" .movelist").hide()}),$("#unit"+f.id+" .upgradelists").click(function(){var b=$(this).attr("data");$("#unit"+b+" .upg").show();$("#unit"+b+" .upglist").empty();
$("#unit"+b+" .upglist").show();$("#unit"+b+" .upgavail").show();$("#unit"+b+" .statlist").hide();$("#unit"+b+" .shipdial").hide();$("#unit"+b+" .movelist").hide()}),$("#unit"+f.id+" .moves").click(function(){var b=$(this).attr("data"),e=generics["u"+b];$("#unit"+b+" .upg").hide();$("#unit"+b+" .upglist").hide();$("#unit"+b+" .upgavail").hide();$("#unit"+b+" .statlist").hide();$("#unit"+b+" .shipdial").hide();$("#unit"+b+" .movelist").show();var f=Snap("#unit"+b+" .movesvg");$("#unit"+b+" .statbutton");
f.clear();var l=$(".movesvg").width();targetunit=new Unit(0,13);for(var m in metaUnit.prototype)targetunit[m]=metaUnit.prototype[m];e.moves=[MT(l/2,l/2)];e.doactivation();e.s=f;setTimeout(function(){for(m in e.moves)f.path(e.getOutlineString(e.moves[m]).s).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none"});f.path(e.getOutlineString(MT(l/2,l/2)).s).attr({"stroke-width":5,stroke:"#a00",opacity:1,fill:"rgba(0,0,0,0)",pointerEvents:"none"})})}),$("#unit"+f.id+
" .statistics").click(function(){var b=$(this).attr("data"),e=generics["u"+b];$("#unit"+b+" .upg").hide();$("#unit"+b+" .upglist").hide();$("#unit"+b+" .upgavail").hide();$("#unit"+b+" .statlist").show();$("#unit"+b+" .shipdial").hide();$("#unit"+b+" .movelist").hide();var f=Snap("#unit"+b+" .statisticsvg");$("#unit"+b+" .statbutton");f.clear();var l=$(".statisticsvg").width();targetunit=new Unit(0,13);for(var m in metaUnit.prototype)targetunit[m]=metaUnit.prototype[m];e.moves=[MT(l/2,l/2)];e.doactivation();
e.s=f;var v=f.text(0,0,"Computing...").attr({"font-size":50,stroke:WHITE});setTimeout(function(){e.showattack(e.weapons,f);v.attr({display:"none"});f.path(e.getOutlineString(MT(l/2,l/2)).s).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none"});for(m=1;5>=m;m++)f.path(e.getRangeString(m,MT(l/2,l/2))).attr({"stroke-width":5,stroke:"#0a0",opacity:.5,fill:"rgba(0,0,0,0)",pointerEvents:"none","stroke-dasharray":"5,5"});var b=f.gradient("l(0,0,0,1)hsl(0,80,50)-hsl(60,100,50)-hsl(120,100,25)");
f.rect(-400,-500,30,800).attr({fill:b});f.text(-350,-450,"100%").attr({"font-size":50,stroke:WHITE});f.text(-350,-75,"50%").attr({"font-size":50,stroke:WHITE});f.text(-350,300,"0%").attr({"font-size":50,stroke:WHITE})},30)}),currentteam.updatepoints(),addupgradeaddhandler(f)):currentteam.updatepoints();return f}
function addupgrade(b,e,f,l){var m=UPGRADES[e];$("#unit"+b.id+" .upglist").empty();if("undefined"!=typeof m){1==m.unique&&addunique(m.name);1==m.limited&&addlimited(b,e);$("#unit"+b.id+" .upgavail span[num="+f+"]").hide();var h=translate(m.name).replace(/\(Crew\)/g,"").replace(/\'/g,"");"undefined"==typeof b.upgbonus[m.type]&&(b.upgbonus[m.type]=0);var q=m.points+b.upgbonus[m.type];0<=m.points&&0>q&&(q=0);var t="",w=formatstring(getupgtxttranslation(m.name,m.type));""!=w&&(t=w+(1==m.done?"":"<div><strong class='m-notimplemented'></strong></div>"));
$("#unit"+b.id+" .upg").append("<tr data="+e+" num="+f+"><td><span class='upgrades "+m.type+"'></span></td><td><button>"+h+"</button></td><td class='pts'>"+q+"</td><td class='tooltip'>"+t+"</td></tr>");b.upg[f]=e;m=Upgradefromid(b,e);"undefined"!=typeof UPGRADES[e].install&&m.install(b);Upgrade.prototype.install.call(m,b);"undefined"!=typeof m.init&&m.init(b);$("#unit"+b.id+" .shipdial").html("<table>"+b.getdialstring()+"</table>");b.showupgradeadd();b.showactionlist();b.showstats();currentteam.updatepoints();
"undefined"==typeof l?$("#unit"+b.id+" .upg tr[num="+f+"] button").click(function(e){var f=e.currentTarget.parentElement.parentElement.getAttribute("num");e=e.currentTarget.parentElement.parentElement.getAttribute("data");$("#unit"+b.id+" .upglist").empty();removeupgrade(b,f,e)}.bind(b)):b.upgnocopy=e}}
function removeupgrade(b,e,f){for(var l in b.upgrades)if(b.upgrades[l].id==f)break;l=b.upgrades[l];if("undefined"!=typeof b["addedupg"+f]){var m=b["addedupg"+f];-1<b.upg[m]&&removeupgrade(b,m,b.upg[m])}$("#unit"+b.id+" .upgavail span[num="+e+"]").show();$("#unit"+b.id+" .upg tr[num="+e+"]").remove();1==l.unique&&removeunique(l.name);1==l.limited&&removelimited(b,f);b.upg[e]=-1;"undefined"!=typeof l.uninstall&&l.uninstall(b);Upgrade.prototype.uninstall.call(l,b);l.isactive=!1;$("#unit"+b.id+" .shipdial").html("<table>"+
b.getdialstring()+"</table>");b.showupgradeadd();b.showactionlist();b.showstats();currentteam.updatepoints()};var FREECOMBAT=0,SCENARIO=1,SCENARIOCREATOR=2,mode=FREECOMBAT;
function prepareforcombat(b,e){$("#squad"+e).html(b);TEAMS[e].parseJuggler(b);TEAMS[e].name="SQUAD."+TEAMS[e].toASCII();TEAMS[e].toJSON();"undefined"==typeof localStorage[TEAMS[e].name]&&(localStorage[TEAMS[e].name]=JSON.stringify({pts:TEAMS[e].points,faction:TEAMS[e].faction,jug:b}));SQUADLIST.isinrow(b)||SQUADLIST.addrow(0,TEAMS[e].name,TEAMS[e].points,TEAMS[e].faction,TEAMS[e].toJuggler(!0),!0);$("#squad"+e+"points").html(TEAMS[e].points);enablenextphase()}
function scenariomode(b){mode=b;switch(b){case SCENARIO:$(".duelmode").hide();$(".scenariocreator").hide();$(".scenariomode").show();break;case FREECOMBAT:$(".scenariocreator").hide();$(".scenariomode").hide();$(".duelmode").show();break;case SCENARIOCREATOR:$(".duelmode").hide(),$(".scenariomode").hide(),$(".scenariocreator").show()}enablenextphase()}
function Scenariolist(b){this.id=b;TEMPLATES["scenario-row-manage"]=$("#scenario-row-manage").html();Mustache.parse(TEMPLATES["scenario-row-manage"]);TEMPLATES["scenario-header-manage"]=$("#scenario-header-manage").html();Mustache.parse(TEMPLATES["scenario-header-manage"]);$(b).html(Mustache.render(TEMPLATES["scenario-header-manage"],{}));$(b+" tbody").on("click","tr",function(){$(b+" .selected").removeClass("selected");$(this).addClass("selected")});this.rows=[];this.nrows=0;this.log={};for(var e in SCENARIOS){var f=
SCENARIOS[e];this.addrow(e,f.text,f.wincond,f.link)}}
Scenariolist.prototype={remove:function(b){$("#sc"+b).remove();delete localStorage["SCENARIO"+this.rows[b].title];delete this.rows[b]},isinrow:function(b){return"undefined"!=typeof this.rows&&-1<this.rows.indexOf(b)},addrow:function(b,e,f,l){this.rows[this.nrows]={title:b,text:e,link:l,wincond:f};var m=LZString.decompressFromEncodedURIComponent(l).split("&");TEAMS[3].parseASCII(m[1]);m="Death match";0<f&&(m="Destroy all units before "+f+" turns");0>f&&(m="Highest score after "+f+" turns");$(this.id+
" tbody").append(Mustache.render(TEMPLATES["scenario-row-manage"],{nrows:this.nrows,title:b,text:e,faction:TEAMS[3].faction,wincond:m,link:l}));this.nrows++;"undefined"==typeof localStorage["SCENARIO"+b]&&(localStorage["SCENARIO"+b]=JSON.stringify({title:b,text:e,link:l,wincond:f}))},user:function(){var b;$(this.id+" tbody").html("");for(b in localStorage)if("string"==typeof localStorage[b]&&b.match(/SCENARIO.*/)){var e=$.parseJSON(localStorage[b]);"undefined"==typeof e.title||"undefined"==typeof e.text||
"undefined"==typeof e.link?delete localStorage[b]:("undefined"==typeof e.wincond&&(e.wincond=0),this.addrow(e.title,e.text,e.wincond,e.link))}},checkrow:function(b){HEADERS=this.rows[b].text;SCENARIOTITLE=this.rows[b].title;WINCOND=this.rows[b].wincond;b=LZString.decompressFromEncodedURIComponent(this.rows[b].link);var e=b.split("&");prepareforcombat($("#squad1").html(),1);e[0]=TEAMS[1].toASCII();b=e.join("&");TEAMS[1].parseASCII(e[0]);document.location.search="?"+LZString.compressToEncodedURIComponent(b)}};
